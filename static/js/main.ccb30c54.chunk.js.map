{"version":3,"sources":["sdk/ppsspp.js","utils/listeners.js","utils/game.js","components/DebuggerContext.js","components/common/FitModal.js","components/common/Field.js","components/common/Form.js","utils/timeouts.js","utils/format.js","components/CPU/BreakpointModal.js","utils/clipboard.js","components/CPU/DisasmContextMenu.js","components/CPU/DisasmBranchGuide.js","utils/dom.js","components/CPU/BreakpointIcon.js","components/CPU/DisasmLine.js","components/CPU/DisasmList.js","components/CPU/DisasmSearch.js","components/CPU/StatusBar.js","components/CPU/Disasm.js","components/CPU/DisasmButtons.js","components/common/GotoBox.js","components/CPU/FuncList.js","components/CPU/RegList.js","components/CPU/RegPanel.js","components/CPU/VisualizeVFPU.js","components/CPU/LeftPanel.js","components/CPU.js","components/GPU.js","components/LogItem.js","components/Log.js","components/NotConnected.js","assets/logo.svg","components/App.js","registerServiceWorker.js","index.js"],"names":["NoResponseEvents","ErrorLevels","PPSSPP","onError","onClose","socket_","pendingTickets_","listeners_","this","Promise","reject","Error","err","fetch","then","response","json","listing","tryNextEndpoint_","setupSocket_","bind","specificError","message","originalError","uri","resolve","possibleSocket","WebSocket","onopen","onclose","failAllPending_","close","eventName","handler","push","remove","list","index","indexOf","splice","data","includes","event","send","JSON","stringify","ticket","makeTicket_","result","name","originalMessage","onmessage","e","parse","handleError_","level","handled","handleTicket_","handleMessage_","length","endpoint","ip","p","connect","slice","executeHandlers_","undefined","Number","console","error","log","Math","random","toString","substr","hasOwnProperty","listeners","changeCallbacks_","ppsspp_","connected_","ppsspp","connected","callback","onConnectionChange","handlers","listener","onConnection","listen","GameStatus","state","stepping","paused","started","pc","currentThread","setState","stateListeners","values","onStepping","category","register","uintValue","categories","uintValues","forget","changed","k","defaultContext","gameStatus","DebuggerContext","createContext","displayName","DebuggerProvider","children","Provider","value","FitModal","handleRequestClose","props","confirmClose","window","confirm","className","overlayClassName","onRequestClose","closeTimeoutMS","PureComponent","Field","handleChange","ev","onChange","component","target","prop","dataset","type","checked","label","htmlFor","fieldID","renderInput","renderText","renderHex","renderRadio","renderCheckboxes","other","primary","fieldValue","id","pattern","title","options","map","option","disabled","constructor","Component","Form","action","classNames","onSubmit","heading","Buttons","saveHandler","onSave","saveButton","onClick","cancelButton","onCancel","propTypes","PropTypes","oneOfType","func","bool","node","Timeout","ms","cancel","handle","setTimeout","clearTimeout","toString08X","val","toUpperCase","typeOptions","operationOptions","actionOptions","BreakpointModal","cleanState","isOpen","derivedBreakpoint","cleanBreakpoint","address","size","condition","logFormat","read","write","change","enabled","operation","context","thread","expression","breakpoint","deleteOld","saveNew","updateExisting","alert","preventDefault","getEvent","cleanTimeout","start","Object","assign","initialOverrides","editing","contentLabel","hasChanges","renderMemory","renderExecute","compareTo","keys","find","key","prevProps","prevState","runEarly","nextProps","contextType","userInitiated","getScratchpad","div","document","getElementById","createElement","style","width","height","opacity","position","top","left","pointerEvents","whiteSpace","body","appendChild","createScratchpad","copyText","text","scratchpad","textContent","textNode","firstChild","range","createRange","setStart","setEnd","selection","getSelection","oldRange","rangeCount","getRangeAt","removeAllRanges","addRange","execCommand","prompt","hasClosestMatch","selector","matches","parentNode","Element","prototype","msMatchesSelector","addEventListener","collapsed","activeElement","test","navigator","platform","clipboardData","setData","replace","DisasmContextMenu","handleCopyAddress","line","focus","handleCopyHex","getSelectedLines","macroEncoding","join","encoding","handleCopyDisasm","getSelectedDisasm","handleAssemble","assembleInstruction","catch","handleRunUntil","handleJumpPC","handleToggleBreakpoint","toggleBreakpoint","handleFollowBranch","followBranch","handleTodo","trigger","branch","relevantData","divider","connectMenu","DisasmBranchGuide","pos","calcPos","lineHeight","classes","selected","xmlns","d","buildPath","guide","yCenter","floor","trailingEdge","sourceEdge","arrowEdge","path","direction","bottom","end","findAddressOffset","right","lane","down","off","offsets","isSubsetBounds","bounds","parentBounds","ensureInView","windowBounds","innerHeight","innerWidth","rect","getBoundingClientRect","HTMLElement","getComputedStyle","overflows","overflow","overflowX","overflowY","isInView","scrollIntoView","contextMenuStatus","hasContextMenu","BreakpointIcon","viewBox","DisasmLine","ref","createRef","focused","cursor","isCurrentPC","mapData","current","attributes","onDoubleClick","tabIndex","contextmenu","renderTag","collect","holdToDisplay","backgroundColor","data-address","renderAddress","highlight","params","highlightParams","renderConditional","symbol","addressHex","displaySymbols","conditionMet","before","after","fullText","toLowerCase","matchLength","beforeLength","split","toHighlight","param","button","needsScroll","triggerNode","block","lineNode","querySelector","DisasmList","mouseDown","lineOffsets","pendingLineParams","selectedLineParams","prevLines","prevSelectionTop","prevSelectionBottom","onCopy","cursorRef","focusTimeout","paramsTimeout","events","onMouseDownCapture","onMouseDown","onMouseUpCapture","onMouseUp","onMouseMove","onKeyDown","onBlur","onFocusChange","onFocus","lines","renderLine","branchGuides","renderBranchGuide","isLineSelected","shouldHighlight","highlightText","shouldHighlightParams","String","match","parts","some","part","addressBoundingTop","filter","l","update","reset","mouseEventToLine","updateCursor","applySelection","buttons","modifiers","ctrlKey","metaKey","altKey","shiftKey","dist","visibleLines","lineIndex","findCursorLineIndex","newIndex","min","max","applyScroll","findCursorLine","updateDisplaySymbols","searchPrompt","searchNext","promptGoto","editBreakpoint","selectionTop","selectionBottom","updateSelection","y","pageY","pageYOffset","addr","i","addressSize","forEach","selectedLines","linesChanged","selectionChanged","offsetsUpdate","calcOffsets","selectedUpdate","getSelectedLineParams","DisasmSearch","updateSearchString","handleNext","handleCancel","handleKeyDown","searchString","inProgress","hidden","placeholder","role","StatusBar","renderLeftStatus","function","dataAccess","renderDataAccess","renderBranch","stringValue","renderString","renderDataSymbol","dataSymbol","status","valueSymbol","toString04X","targetAddress","MIN_BUFFER","Disasm","wantDisplaySymbols","searchInProgress","editingBreakpoint","creatingBreakpoint","jumpStack","needsOffsetFix","updatesCancel","updatesSequence","lastSearch","minBuffer","maxBuffer","updateDisasmNow","branchAddresses","unlabeledBranches","b","firstLine","flag","gotoAddress","pop","startCode","code","writeInstruction","nextAddress","updateDisasm","assignment","keep","breakpointAddress","bp","breakpoints","closeEditBreakpoint","snap","searchDisasm","cont","continueLast","searchCancel","last","cancelState","finally","listRef","ensureCursorInView","searchRef","scrollTop","onScroll","onDragStart","renderContextMenu","renderNotStarted","centerAddress","hasRange","snapshot","disasmChange","updateDisasmRange","setInitialPC","foundLine","clientHeight","jumpMarker","newRange","updateRange","defaultBuffer","count","cleanupBranchGuides","unique","Map","set","bufferRange","bufferTop","bufferBottom","scrollHeight","visibleEachDirection","DisasmButtons","breakpointModalOpen","lastThread","threads","handleGoBreak","updateCurrentThread","handleStepInto","handleStepOver","handleStepOut","threadID","handleNextHLE","handleThreadSelect","th","handleBreakpointOpen","handleBreakpointClose","showNavTray","renderThreadList","renderThread","isCurrent","updateThreadList","resetCurrentThread","GotoBox","handleSubmit","select","handlePC","jumpToReg","handleRA","autoComplete","renderPCButtons","includePC","promptGotoMarker","FuncList","loading","rowHeight","functions","filteredFunctions","renderSizedList","rowRenderer","renderFunc","rowCount","handleFilter","applyFilter","handleClick","gotoDisasm","renderList","updateList","measureHeight","sort","a","localeCompare","RegList","registerNames","reg","renderReg","cat","format","ddClasses","floatValues","uintValuesLast","RegPanel","handleViewMemory","handleViewDisassembly","handleCopyReg","regNode","handleChangeReg","prevValue","registerName","newValue","packet","renderTabs","c","updateRegs","updateReg","keepLast","hasPrev","prevCat","floatValuesLast","replaceCopy","arr","item","concat","floatValue","VisualizeVFPU","handleFormat","matrices","m","renderMatrix","renderColumn","renderValue","r","LeftPanel","vfpuModalOpen","everShownFuncs","handleSelect","handleVFPUOpen","handleVFPUClose","onSelect","forceRender","CPU","lastTicks","ticks","navTray","hideNavTray","updateInitialPC","disasmProps","GPU","recording","beginRecord","setAttribute","href","click","removeChild","LogItem","formatLogEvent","renderInternal","makeClassName","timestamp","header","channel","Log","items","divRef","renderItem","newItem","itemWithId","addLogItem","onLogEvent","NotConnected","connecting","elements","versionInfo","process","version","App","handleAutoConnect","autoConnect","handleDisconnect","disconnect","logRef","updateTitle","game","originalTitle","React","init","listenState","to","isActive","pathname","src","logo","alt","renderContent","testing","isLocalhost","Boolean","location","hostname","registerValidSW","swUrl","serviceWorker","registration","onupdatefound","installingWorker","installing","onstatechange","controller","ReactDOM","render","Modal","setAppElement","URL","origin","headers","get","ready","unregister","reload","checkValidServiceWorker","registerServiceWorker"],"mappings":"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","file":"static/js/main.ccb30c54.chunk.js","sourcesContent":["// PPSSPP debugger API client\n//\n// Most operations use promises and are asynchronous.\n//\n// Example usage:\n//\n//    let ppsspp = new PPSSPP();\n//    ppsspp.listen('cpu.stepping', function () {\n//        console.log('Hit a breakpoint');\n//    });\n//    ppsspp.autoConnect().then(function () {\n//        return ppsspp.send({ event: 'cpu.getReg', name: 'pc' });\n//    }).then(function (result) {\n//        console.log('pc: ', result.uintValue);\n//    }).catch(function (err) {\n//        console.log('Something went wrong', err);\n//    });\n//\n// Methods:\n//  - autoConnect(): Find and connect to PPSSPP automatically.  Returns a promise.\n//  - connect(uri): Connect to a specific WebSocket URI (begins with ws://.)  Returns a promise.\n//  - disconnect(): Disconnect from PPSSPP.  No return.\n//  - listen(name, handler): Adds a listener for unsolicited events (e.g. 'log') or '*' for all.  No return.\n//      The handler takes two parameter, the data object, and whether any previous handler returned true.\n//  - send(object): Send an event to PPSSPP.  Returns a promise resolving to the data object.\n//      Note that not all PPSSPP events have a response.  You may receive null or it may never resolve.\n//\n// Properties:\n//  - onError: Set this to a function receiving (message, level) for errors.\n//  - onClose: Set this to a function with no parameters called when on disconnect.\n//\n// For documentation on the actual events for send() and listen(), look in PPSSPP's source code.\n// Start with the comment in Core/Debugger/WebSocket.cpp.\n// Individual files in Core/Debugger/WebSocket/ also have comments describing the events and parameters.\n\n// We fast-resolve these to avoid confusion.\nconst NoResponseEvents = [\n\t'cpu.stepping',\n\t'cpu.resume',\n];\n\nconst ErrorLevels = {\n\tNOTICE: 1,\n\tERROR: 2,\n\tWARN: 3,\n\tINFO: 4,\n\tDEBUG: 5,\n\tVERBOSE: 6,\n};\n\nconst PPSSPP_MATCH_API = '//report.ppsspp.org/match/list';\nconst PPSSPP_SUB_PROTOCOL = 'debugger.ppsspp.org';\nconst PPSSPP_DEFAULT_PATH = '/debugger';\n\nexport default class PPSSPP {\n\tautoConnect() {\n\t\tif (this.socket_ !== null) {\n\t\t\treturn Promise.reject(new Error('Already connected, disconnect first'));\n\t\t}\n\n\t\tlet err = new Error('Couldn\\'t connect');\n\n\t\treturn fetch(PPSSPP_MATCH_API).then((response) => {\n\t\t\treturn response.json();\n\t\t}).then((listing) => {\n\t\t\treturn this.tryNextEndpoint_(listing);\n\t\t}).then(this.setupSocket_.bind(this), specificError => {\n\t\t\terr.message = specificError.message;\n\t\t\terr.originalError = specificError;\n\t\t\tthrow err;\n\t\t});\n\t}\n\n\tconnect(uri) {\n\t\tif (this.socket_ !== null) {\n\t\t\treturn Promise.reject(new Error('Already connected, disconnect first'));\n\t\t}\n\n\t\t// In case it fails, prepare the error (and stack trace) now.\n\t\tlet err = new Error('Couldn\\'t connect to ' + uri);\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst possibleSocket = new WebSocket(uri, PPSSPP_SUB_PROTOCOL);\n\n\t\t\tpossibleSocket.onopen = () => {\n\t\t\t\tthis.socket_ = possibleSocket;\n\t\t\t\tresolve();\n\t\t\t};\n\t\t\tpossibleSocket.onclose = () => {\n\t\t\t\treject(err);\n\t\t\t};\n\t\t}).then(this.setupSocket_.bind(this));\n\t}\n\n\tdisconnect() {\n\t\tif (this.socket_ === null) {\n\t\t\tthrow new Error('Not connected');\n\t\t}\n\n\t\tthis.failAllPending_('Disconnected from PPSSPP');\n\n\t\tthis.socket_.close(1000);\n\t\tthis.socket_ = null;\n\t}\n\n\tlisten(eventName, handler) {\n\t\tif (!(eventName in this.listeners_)) {\n\t\t\tthis.listeners_[eventName] = [];\n\t\t}\n\n\t\tthis.listeners_[eventName].push(handler);\n\n\t\treturn {\n\t\t\tremove: () => {\n\t\t\t\tconst list = this.listeners_[eventName];\n\t\t\t\tconst index = list.indexOf(handler);\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tlist.splice(index, 1);\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t}\n\n\tsend(data) {\n\t\tif (this.socket_ === null) {\n\t\t\treturn Promise.reject(new Error('Not connected'));\n\t\t}\n\n\t\t// Prepare a stack trace now, not when resolving (since that will trace to the onmessage.)\n\t\tlet err = new Error('PPSSPP returned an error');\n\n\t\t// Avoid confusion by resolving immediately for known no-response events.\n\t\tif (NoResponseEvents.includes(data.event)) {\n\t\t\tthis.socket_.send(JSON.stringify(data));\n\t\t\treturn Promise.resolve(null);\n\t\t}\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst ticket = this.makeTicket_();\n\n\t\t\tthis.pendingTickets_[ticket] = function (result) {\n\t\t\t\tif (result.event === 'error') {\n\t\t\t\t\terr.name = 'DebuggerError';\n\t\t\t\t\terr.message = result.message;\n\t\t\t\t\terr.originalMessage = result;\n\t\t\t\t\treject(err);\n\t\t\t\t} else {\n\t\t\t\t\tresolve(result);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tthis.socket_.send(JSON.stringify({ ...data, ticket }));\n\t\t});\n\t}\n\n\tsetupSocket_() {\n\t\tthis.socket_.onclose = () => {\n\t\t\tif (this.onClose) {\n\t\t\t\tthis.onClose();\n\t\t\t}\n\n\t\t\tthis.failAllPending_('PPSSPP disconnected');\n\t\t\tthis.socket_ = null;\n\t\t};\n\n\t\tthis.socket_.onmessage = (e) => {\n\t\t\ttry {\n\t\t\t\tconst data = JSON.parse(e.data);\n\n\t\t\t\tif (data.event === 'error') {\n\t\t\t\t\tthis.handleError_(data.message, data.level);\n\t\t\t\t}\n\n\t\t\t\tlet handled = false;\n\t\t\t\tif ('ticket' in data) {\n\t\t\t\t\thandled = this.handleTicket_(data.ticket, data);\n\t\t\t\t}\n\t\t\t\tthis.handleMessage_(data, handled);\n\t\t\t} catch (err) {\n\t\t\t\tthis.handleError_('Failed to parse message from PPSSPP: ' + err.message, ErrorLevels.ERROR);\n\t\t\t}\n\t\t};\n\t}\n\n\ttryNextEndpoint_(listing) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (!listing || listing.length === 0) {\n\t\t\t\treturn reject(new Error('Couldn\\'t connect automatically.  Is PPSSPP connected to the same network?'));\n\t\t\t}\n\n\t\t\tconst endpoint = 'ws://' + listing[0].ip + ':' + listing[0].p + PPSSPP_DEFAULT_PATH;\n\t\t\treturn this.connect(endpoint).then(resolve, err => {\n\t\t\t\tif (listing.length > 1) {\n\t\t\t\t\tresolve(this.tryNextEndpoint_(listing.slice(1)));\n\t\t\t\t} else {\n\t\t\t\t\treject(err);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\thandleTicket_(ticket, data) {\n\t\tif (ticket in this.pendingTickets_) {\n\t\t\tconst handler = this.pendingTickets_[data.ticket];\n\t\t\tdelete this.pendingTickets_[data.ticket];\n\n\t\t\thandler(data);\n\t\t\treturn true;\n\t\t}\n\n\t\tthis.handleError_('Received mismatched ticket: ' + JSON.stringify(data), ErrorLevels.ERROR);\n\t\treturn false;\n\t}\n\n\thandleMessage_(data, handled) {\n\t\thandled = this.executeHandlers_(data.event, data, handled);\n\t\tthis.executeHandlers_('*', data, handled);\n\t}\n\n\texecuteHandlers_(name, data, handled) {\n\t\tif (name in this.listeners_) {\n\t\t\tfor (let handler of this.listeners_[name]) {\n\t\t\t\tif (handler(data, handled)) {\n\t\t\t\t\thandled = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn handled;\n\t}\n\n\thandleError_(message, level) {\n\t\tif (this.onError) {\n\t\t\tthis.onError(message, level);\n\t\t} else if (level === undefined || Number(level) === ErrorLevels.ERROR) {\n\t\t\tconsole.error(message);\n\t\t} else {\n\t\t\tconsole.log(message);\n\t\t}\n\t}\n\n\tmakeTicket_() {\n\t\tlet ticket = Math.random().toString(36).substr(2);\n\t\tif (ticket in this.pendingTickets_) {\n\t\t\treturn this.makeTicket_();\n\t\t}\n\t\treturn ticket;\n\t}\n\n\tfailAllPending_(message) {\n\t\tconst data = { event: 'error', message, level: ErrorLevels.ERROR };\n\n\t\tfor (let ticket in this.pendingTickets_) {\n\t\t\tif (this.pendingTickets_.hasOwnProperty(ticket)) {\n\t\t\t\tthis.pendingTickets_[ticket](data);\n\t\t\t}\n\t\t}\n\t\tthis.pendingTickets_ = {};\n\t}\n\n\tonError = null;\n\tonClose = null;\n\n\tsocket_ = null;\n\tpendingTickets_ = {};\n\tlisteners_ = {};\n}\n\nexport { ErrorLevels };\n","class Listeners {\n\tconstructor() {\n\t\tthis.changeCallbacks_ = [];\n\t\tthis.ppsspp_ = null;\n\t\tthis.connected_ = false;\n\t}\n\n\tinit(ppsspp) {\n\t\tthis.ppsspp_ = ppsspp;\n\t}\n\n\t// Change the active connection.\n\tchange(connected) {\n\t\tthis.connected_ = connected;\n\t\tfor (let callback of this.changeCallbacks_) {\n\t\t\tcallback(connected);\n\t\t}\n\t}\n\n\tonConnectionChange(callback) {\n\t\tthis.changeCallbacks_.push(callback);\n\t\treturn {\n\t\t\tremove: () => {\n\t\t\t\tconst index = this.changeCallbacks_.indexOf(callback);\n\t\t\t\tif (index !== -1) {\n\t\t\t\t\tthis.changeCallbacks_.splice(index, 1);\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\t}\n\n\tonConnection(callback) {\n\t\tconst changeCallback = (connected) => {\n\t\t\tif (connected) {\n\t\t\t\tcallback(true);\n\t\t\t}\n\t\t};\n\t\tif (this.connected_) {\n\t\t\tcallback(true);\n\t\t}\n\n\t\treturn this.onConnectionChange(changeCallback);\n\t}\n\n\t// Listen for events (and re-register as necessary.)\n\tlisten(handlers) {\n\t\tlet result = [];\n\t\tfor (let name in handlers) {\n\t\t\tif (handlers.hasOwnProperty(name)) {\n\t\t\t\tlet listener;\n\t\t\t\tif (name === 'connection') {\n\t\t\t\t\tlistener = this.onConnection(handlers[name]);\n\t\t\t\t} else if (name === 'connection.change') {\n\t\t\t\t\tlistener = this.onConnectionChange(handlers[name]);\n\t\t\t\t} else {\n\t\t\t\t\tlistener = this.ppsspp_.listen(name, handlers[name]);\n\t\t\t\t}\n\t\t\t\tresult.push(listener);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tforget(listeners) {\n\t\tfor (let listener of listeners) {\n\t\t\tlistener.remove();\n\t\t}\n\t}\n}\n\nconst listeners = new Listeners();\nexport default listeners;\n","import listeners from '../utils/listeners.js';\n\n/**\n * @typedef GameStatusValues\n * @property {boolean} connected Whether a connection to PPSSPP is active.\n * @property {boolean} stepping Whether CPU is in stepping / break mode.\n * @property {boolean} paused Whether game emulation is paused.\n * @property {boolean} started Whether game emulation has been started yet.\n * @property {number} pc Integer PC value, or 0.\n * @property {number} currentThread Thread ID of active thread or undefined.\n * @property {Function} setState Method to update state.\n */\n\nclass GameStatus {\n\t/**\n\t * @type {GameStatusValues}\n\t */\n\tstate = {\n\t\tconnected: false,\n\t\tstepping: false,\n\t\tpaused: true,\n\t\tstarted: false,\n\t\tpc: 0,\n\t\tcurrentThread: undefined,\n\t\tsetState: undefined,\n\t};\n\tstateListeners = [];\n\tlisteners_;\n\tppsspp_;\n\n\tinit(ppsspp) {\n\t\tthis.state.setState = values => {\n\t\t\tthis.setState(values);\n\t\t};\n\n\t\tthis.ppsspp_ = ppsspp;\n\t\tthis.listeners_ = listeners.listen({\n\t\t\t'connection': () => this.onConnection(),\n\t\t\t'connection.change': (connected) => this.onConnectionChange(connected),\n\t\t\t'cpu.stepping': (data) => this.onStepping(data),\n\t\t\t'cpu.resume': () => this.setState({ stepping: false }),\n\t\t\t'game.start': () => {\n\t\t\t\tthis.setState({ started: true, paused: false });\n\t\t\t},\n\t\t\t'game.quit': () => {\n\t\t\t\tthis.setState({\n\t\t\t\t\tstarted: false,\n\t\t\t\t\tstepping: false,\n\t\t\t\t\tpaused: true,\n\t\t\t\t\tpc: 0,\n\t\t\t\t\tcurrentThread: undefined,\n\t\t\t\t});\n\t\t\t},\n\t\t\t'game.pause': () => this.setState({ paused: true }),\n\t\t\t'game.resume': () => this.setState({ paused: false }),\n\t\t\t'cpu.setReg': (result) => {\n\t\t\t\tif (result.category === 0 && result.register === 32) {\n\t\t\t\t\tthis.setState({ pc: result.uintValue });\n\t\t\t\t}\n\t\t\t},\n\t\t\t'cpu.getAllRegs': (result) => {\n\t\t\t\tconst pc = result.categories[0].uintValues[32];\n\t\t\t\tthis.setState({ pc });\n\t\t\t},\n\t\t});\n\t}\n\n\tshutdown() {\n\t\tlisteners.forget(this.listeners_);\n\t\tthis.listeners_ = null;\n\t}\n\n\tonConnectionChange(connected) {\n\t\t// On any reconnect, assume paused until proven otherwise.\n\t\tthis.setState({ connected, started: false, stepping: false, paused: true });\n\t\tif (!connected) {\n\t\t\tthis.setState({ currentThread: undefined });\n\t\t}\n\t}\n\n\tonConnection() {\n\t\t// Update the status of this connection immediately too.\n\t\tthis.ppsspp_.send({ event: 'cpu.status' }).then((result) => {\n\t\t\tconst { stepping, paused, pc } = result;\n\t\t\tconst started = pc !== 0 || stepping;\n\n\t\t\tthis.setState({ connected: true, started, stepping, paused, pc });\n\t\t}, (err) => {\n\t\t\tthis.setState({ stepping: false, paused: true });\n\t\t});\n\t}\n\n\tonStepping(data) {\n\t\tthis.setState({\n\t\t\tstepping: true,\n\t\t\tpc: data.pc,\n\t\t});\n\t}\n\n\tlistenState(callback) {\n\t\tthis.stateListeners.push(callback);\n\t}\n\n\tsetState(values) {\n\t\tlet changed = false;\n\t\tfor (let k in values) {\n\t\t\tif (values[k] !== this.state[k]) {\n\t\t\t\tchanged = true;\n\t\t\t}\n\t\t}\n\n\t\tif (changed) {\n\t\t\tthis.state = { ...this.state, ...values };\n\t\t\tfor (let callback of this.stateListeners) {\n\t\t\t\tcallback(this.state);\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport default GameStatus;\n","import { createContext, useContext } from 'react';\nimport PPSSPP from '../sdk/ppsspp.js';\nimport { GameStatusValues } from '../utils/game.js';\n\n/**\n * @callback LogCallback\n * @param {string} message Message to log.\n */\n\n/**\n * @typedef {object} DebuggerContextValues\n * @property {PPSSPP|null} ppsspp PPSSPP SDK instance.\n * @property {GameStatusValues|null} gameStatus Basic thread/stepping information.\n * @property {LogCallback} log Function to display a log message.\n */\n\n/**\n * @type {DebuggerContextValues}\n */\nconst defaultContext = {\n\tppsspp: null,\n\tgameStatus: null,\n\tlog: (message) => console.error(message),\n};\n\nconst DebuggerContext = createContext(defaultContext);\nDebuggerContext.displayName = 'DebuggerContext';\nexport default DebuggerContext;\n\nexport function useDebuggerContext() {\n\treturn useContext(DebuggerContext);\n}\n\nexport function DebuggerProvider({ children, gameStatus, log, ppsspp }) {\n\treturn (\n\t\t<DebuggerContext.Provider value={{ gameStatus, log, ppsspp }}>\n\t\t\t{children}\n\t\t</DebuggerContext.Provider>\n\t);\n}\n","import { PureComponent } from 'react';\nimport PropTypes from 'prop-types';\nimport Modal from 'react-modal';\nimport '../ext/react-modal.css';\n\nclass FitModal extends PureComponent {\n\trender() {\n\t\treturn (\n\t\t\t<Modal\n\t\t\t\tclassName=\"ReactModal__FitContent\" overlayClassName=\"ReactModal__FitOverlay\"\n\t\t\t\tonRequestClose={this.handleRequestClose}\n\t\t\t\tcloseTimeoutMS={150}\n\t\t\t\t{...this.props}\n\t\t\t/>\n\t\t);\n\t}\n\n\thandleRequestClose = () => {\n\t\tif (this.props.confirmClose) {\n\t\t\tif (!window.confirm(this.props.confirmClose)) {\n\t\t\t\t// Don't close.\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.props.onClose();\n\t}\n}\n\nFitModal.propTypes = {\n\tisOpen: PropTypes.bool.isRequired,\n\tonClose: PropTypes.func.isRequired,\n\tconfirmClose: PropTypes.string,\n\tchildren: PropTypes.node,\n};\n\nexport default FitModal;\n","import { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nclass Field extends Component {\n\trender() {\n\t\tconst { label, children } = this.props;\n\t\treturn (\n\t\t\t<div className=\"Field\">\n\t\t\t\t<label className=\"Field__label\" htmlFor={this.fieldID()}>{label}</label>\n\t\t\t\t{this.renderInput()}\n\t\t\t\t{children}\n\t\t\t</div>\n\t\t);\n\t}\n\n\trenderInput() {\n\t\tif (this.props.type === 'text') {\n\t\t\treturn this.renderText();\n\t\t} else if (this.props.type === 'hex') {\n\t\t\treturn this.renderHex();\n\t\t} else if (this.props.type === 'radio') {\n\t\t\treturn this.renderRadio();\n\t\t} else if (this.props.type === 'checkboxes') {\n\t\t\treturn this.renderCheckboxes();\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\trenderText(other = {}) {\n\t\tlet { label, type, children, onChange, component, prop, ...primary } = this.props;\n\t\tprimary.value = this.fieldValue();\n\t\treturn <input type=\"text\" id={this.fieldID()} onChange={this.handleChange} {...primary} {...other} />;\n\t}\n\n\trenderHex() {\n\t\treturn this.renderText({ pattern: '(0x)?[0-9A-Fa-f]+', title: 'Hexadecimal value' });\n\t}\n\n\trenderRadio() {\n\t\tconst value = this.fieldValue();\n\t\treturn this.props.options.map(option => {\n\t\t\tconst props = {\n\t\t\t\tname: this.fieldID(),\n\t\t\t\tvalue: option.value,\n\t\t\t\tchecked: value === option.value,\n\t\t\t\tonChange: this.handleChange,\n\t\t\t\tdisabled: this.props.disabled,\n\t\t\t};\n\t\t\treturn (\n\t\t\t\t<label key={option.value}>\n\t\t\t\t\t<input type=\"radio\" {...props} />\n\t\t\t\t\t{' ' + option.label}\n\t\t\t\t</label>\n\t\t\t);\n\t\t});\n\t}\n\n\trenderCheckboxes() {\n\t\treturn this.props.options.map(option => {\n\t\t\tconst props = {\n\t\t\t\t'data-prop': option.value,\n\t\t\t\tchecked: this.props.component.state[option.value],\n\t\t\t\tonChange: this.handleChange,\n\t\t\t\tdisabled: this.props.disabled,\n\t\t\t};\n\t\t\treturn (\n\t\t\t\t<label key={option.value}>\n\t\t\t\t\t<input type=\"checkbox\" {...props} />\n\t\t\t\t\t{' ' + option.label}\n\t\t\t\t</label>\n\t\t\t);\n\t\t});\n\t}\n\n\tfieldID() {\n\t\tconst { id, component, prop } = this.props;\n\t\tif (!id && component && prop) {\n\t\t\treturn (component.displayName || component.constructor.name) + '__' + prop;\n\t\t}\n\t\treturn id;\n\t}\n\n\tfieldValue() {\n\t\tconst { value, component, prop } = this.props;\n\t\tif (value === undefined && component && prop) {\n\t\t\treturn component.state[prop];\n\t\t}\n\t\treturn value;\n\t}\n\n\thandleChange = (ev) => {\n\t\tif (this.props.onChange) {\n\t\t\tthis.props.onChange(ev);\n\t\t} else if (this.props.component) {\n\t\t\tconst { target } = ev;\n\t\t\tconst prop = target.dataset.prop || this.props.prop;\n\t\t\tconst value = target.type === 'checkbox' ? target.checked : target.value;\n\t\t\tthis.props.component.setState({ [prop]: value });\n\t\t}\n\t}\n}\n\nField.propTypes = {\n\tid: PropTypes.string,\n\tlabel: PropTypes.node.isRequired,\n\ttype: PropTypes.oneOf(['text', 'hex', 'radio', 'checkboxes']),\n\tcomponent: PropTypes.object,\n\tvalue: PropTypes.string,\n\tprop: PropTypes.string,\n\toptions: PropTypes.arrayOf(PropTypes.shape({\n\t\tlabel: PropTypes.string.isRequired,\n\t\tvalue: PropTypes.string.isRequired,\n\t})),\n\tdisabled: PropTypes.bool,\n\tonChange: PropTypes.func,\n\tchildren: PropTypes.node,\n};\n\nexport default Field;\n","import PropTypes from 'prop-types';\nimport classNames from 'clsx';\nimport './Form.css';\n\nfunction Form(props) {\n\t/* eslint no-script-url: \"off\" */\n\treturn (\n\t\t<form action=\"#\" className={classNames(props.className, 'Form')} onSubmit={props.onSubmit}>\n\t\t\t{props.heading ? <h2 className=\"Form__heading\">{props.heading}</h2> : null}\n\t\t\t{props.children}\n\t\t</form>\n\t);\n}\n\nForm.propTypes = {\n\tonSubmit: PropTypes.func.isRequired,\n\tclassName: PropTypes.string,\n\tchildren: PropTypes.node.isRequired,\n};\n\nForm.Buttons = function (props) {\n\tconst saveHandler = props.onSave !== true ? props.onSave : undefined;\n\tconst saveButton = props.onSave ? <button onClick={saveHandler}>Save</button> : null;\n\tconst cancelButton = props.onCancel ? <button type=\"button\" onClick={props.onCancel}>Cancel</button> : null;\n\n\treturn (\n\t\t<div className=\"Form__buttons\">\n\t\t\t{props.children}\n\t\t\t{saveButton}\n\t\t\t{cancelButton}\n\t\t</div>\n\t);\n};\n\nForm.Buttons.propTypes = {\n\tonSave: PropTypes.oneOfType([PropTypes.func, PropTypes.bool]),\n\tonCancel: PropTypes.func,\n\tchildren: PropTypes.node,\n};\n\nexport default Form;\n","export class Timeout {\n\thandle;\n\tfunc;\n\tms;\n\n\tconstructor(func, ms) {\n\t\tthis.func = func;\n\t\tthis.ms = ms;\n\t}\n\n\tstart() {\n\t\tthis.cancel();\n\t\tthis.handle = setTimeout(() => {\n\t\t\tthis.handle = null;\n\t\t\tthis.func();\n\t\t}, this.ms);\n\t}\n\n\treset(func) {\n\t\tthis.func = func;\n\t}\n\n\trunEarly() {\n\t\tif (this.handle) {\n\t\t\tthis.cancel();\n\t\t\tthis.func();\n\t\t}\n\t}\n\n\tcancel() {\n\t\tif (this.handle !== null) {\n\t\t\tclearTimeout(this.handle);\n\t\t\tthis.handle = null;\n\t\t}\n\t}\n}\n","export function toString08X(val) {\n\tconst hex = val.toString(16).toUpperCase();\n\treturn ('00000000' + hex).substr(-8);\n}\n\nexport function toString04X(val) {\n\tconst hex = val.toString(16).toUpperCase();\n\treturn ('0000' + hex).substr(-4);\n}\n\nexport function toString02X(val) {\n\tconst hex = val.toString(16).toUpperCase();\n\treturn ('00' + hex).substr(-2);\n}\n","import { PureComponent } from 'react';\nimport DebuggerContext, { DebuggerContextValues } from '../DebuggerContext';\nimport PropTypes from 'prop-types';\nimport FitModal from '../common/FitModal';\nimport Field from '../common/Field';\nimport Form from '../common/Form';\nimport { Timeout } from '../../utils/timeouts';\nimport { toString08X } from '../../utils/format';\nimport '../ext/react-modal.css';\nimport './BreakpointModal.css';\n\nconst typeOptions = [\n\t{ label: 'Memory', value: 'memory' },\n\t{ label: 'Execute', value: 'execute' },\n];\n\nconst operationOptions = [\n\t{ label: 'Read', value: 'read' },\n\t{ label: 'Write', value: 'write' },\n\t{ label: 'On change', value: 'change' },\n];\n\nconst actionOptions = [\n\t{ label: 'Break', value: 'enabled' },\n\t{ label: 'Log', value: 'log' },\n];\n\nclass BreakpointModal extends PureComponent {\n\tstate = {};\n\t/**\n\t * @type {DebuggerContextValues}\n\t */\n\tcontext;\n\tcleanState = {\n\t\tisOpen: false,\n\t\tderivedBreakpoint: null,\n\t};\n\tcleanBreakpoint = {\n\t\ttype: 'memory',\n\t\taddress: '',\n\t\tsize: '0x00000001',\n\t\tcondition: '',\n\t\tlogFormat: '',\n\t\tread: true,\n\t\twrite: true,\n\t\tchange: false,\n\t\tenabled: true,\n\t\tlog: true,\n\t};\n\tcleanTimeout;\n\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tObject.assign(this.state, { ...this.cleanState, ...this.cleanBreakpoint, ...props.breakpoint, ...props.initialOverrides });\n\n\t\tthis.cleanTimeout = new Timeout(() => {\n\t\t\tthis.setState({ ...this.cleanState, ...this.cleanBreakpoint, ...this.props.breakpoint, ...this.props.initialOverrides });\n\t\t}, 200);\n\t}\n\n\trender() {\n\t\tconst editing = !!this.props.breakpoint;\n\n\t\treturn (\n\t\t\t<FitModal\n\t\t\t\tcontentLabel=\"Breakpoint settings\"\n\t\t\t\tisOpen={this.props.isOpen}\n\t\t\t\tonClose={this.onClose}\n\t\t\t\tconfirmClose={this.hasChanges() ? 'Discard changes?' : null}\n\t\t\t>\n\t\t\t\t<Form heading={editing ? 'Edit Breakpoint' : 'Create Breakpoint'} onSubmit={this.onSave} className=\"BreakpointModal\">\n\t\t\t\t\t<Field type=\"radio\" label=\"Type\" options={typeOptions} prop=\"type\" component={this} />\n\t\t\t\t\t<Field type=\"text\" label=\"Address\" prop=\"address\" component={this} />\n\t\t\t\t\t{this.renderMemory()}\n\t\t\t\t\t{this.renderExecute()}\n\t\t\t\t\t<Field type=\"text\" label=\"Log format\" prop=\"logFormat\" component={this} disabled={!this.state.log} />\n\t\t\t\t\t<Field type=\"checkboxes\" label=\"Actions\" options={actionOptions} component={this} />\n\n\t\t\t\t\t<Form.Buttons onSave={true} onCancel={this.onClose} />\n\t\t\t\t</Form>\n\t\t\t</FitModal>\n\t\t);\n\t}\n\n\trenderMemory() {\n\t\tif (this.state.type !== 'memory') {\n\t\t\treturn null;\n\t\t}\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<Field type=\"hex\" label=\"Size\" prop=\"size\" component={this} />\n\t\t\t\t<Field type=\"checkboxes\" label=\"Operations\" options={operationOptions} component={this} />\n\t\t\t</>\n\t\t);\n\t}\n\n\trenderExecute() {\n\t\tif (this.state.type !== 'execute') {\n\t\t\treturn null;\n\t\t}\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<Field type=\"text\" label=\"Condition\" prop=\"condition\" component={this} />\n\t\t\t</>\n\t\t);\n\t}\n\n\thasChanges() {\n\t\tconst compareTo = this.state.derivedBreakpoint || this.cleanBreakpoint;\n\t\treturn Object.keys(compareTo).find(key => this.state[key] !== compareTo[key]) !== undefined;\n\t}\n\n\tcomponentDidUpdate(prevProps, prevState) {\n\t\tif (this.props.isOpen && this.cleanTimeout != null) {\n\t\t\tthis.cleanTimeout.runEarly();\n\t\t}\n\t}\n\n\tonSave = (e) => {\n\t\tlet operation = this.context.ppsspp.send({\n\t\t\tevent: 'cpu.evaluate',\n\t\t\tthread: this.context.gameStatus.currentThread,\n\t\t\texpression: this.state.address,\n\t\t});\n\n\t\tif (this.props.breakpoint) {\n\t\t\tconst { derivedBreakpoint, address, size, type } = this.state;\n\t\t\tif (type !== derivedBreakpoint.type || derivedBreakpoint.address !== address) {\n\t\t\t\toperation = operation.then(this.deleteOld).then(this.saveNew);\n\t\t\t} else if (type === 'memory' && derivedBreakpoint.size !== size) {\n\t\t\t\toperation = operation.then(this.deleteOld).then(this.saveNew);\n\t\t\t} else {\n\t\t\t\toperation = operation.then(this.updateExisting);\n\t\t\t}\n\t\t} else {\n\t\t\toperation = operation.then(this.saveNew);\n\t\t}\n\n\t\toperation.then(this.onClose, err => {\n\t\t\twindow.alert(err.message);\n\t\t});\n\n\t\te.preventDefault();\n\t}\n\n\tsaveNew = ({ uintValue }) => {\n\t\treturn this.context.ppsspp.send({\n\t\t\tevent: this.getEvent(this.state.type, 'add'),\n\t\t\t...this.state,\n\t\t\taddress: uintValue,\n\t\t});\n\t}\n\n\tdeleteOld = ({ uintValue }) => {\n\t\t// This is used when changing the breakpoint type.\n\t\treturn this.context.ppsspp.send({\n\t\t\tevent: this.getEvent(this.props.breakpoint.type, 'remove'),\n\t\t\taddress: this.props.breakpoint.address,\n\t\t}).then(() => {\n\t\t\t// Return the original new address for easy sequencing.\n\t\t\treturn { uintValue };\n\t\t});\n\t}\n\n\tupdateExisting = ({ uintValue }) => {\n\t\treturn this.context.ppsspp.send({\n\t\t\tevent: this.getEvent(this.state.type, 'update'),\n\t\t\t...this.state,\n\t\t\taddress: uintValue,\n\t\t});\n\t}\n\n\tgetEvent(type, event) {\n\t\tif (type === 'execute') {\n\t\t\treturn 'cpu.breakpoint.' + event;\n\t\t} else if (type === 'memory') {\n\t\t\treturn 'memory.breakpoint.' + event;\n\t\t} else {\n\t\t\tthrow new Error('Unexpected type: ' + type);\n\t\t}\n\t}\n\n\tonClose = () => {\n\t\tthis.cleanTimeout.start();\n\t\tthis.props.onClose();\n\t}\n\n\tstatic getDerivedStateFromProps(nextProps, prevState) {\n\t\tif (nextProps.isOpen && !prevState.isOpen) {\n\t\t\tconst derivedBreakpoint = nextProps.breakpoint;\n\t\t\tif (derivedBreakpoint) {\n\t\t\t\t// This is the \"derived\" unchanged state for the \"Discard changes?\" prompt, and initial state.\n\t\t\t\tderivedBreakpoint.address = '0x' + toString08X(derivedBreakpoint.address);\n\t\t\t\tderivedBreakpoint.condition = derivedBreakpoint.condition || '';\n\t\t\t\tderivedBreakpoint.logFormat = derivedBreakpoint.logFormat || '';\n\t\t\t}\n\t\t\tconst initialOverrides = nextProps.initialOverrides;\n\t\t\tif (initialOverrides) {\n\t\t\t\tinitialOverrides.address = '0x' + toString08X(initialOverrides.address);\n\t\t\t}\n\t\t\treturn { isOpen: true, ...derivedBreakpoint, derivedBreakpoint, ...initialOverrides };\n\t\t}\n\t\tif (!nextProps.isOpen && prevState.derivedBreakpoint) {\n\t\t\treturn { derivedBreakpoint: null };\n\t\t}\n\t\treturn null;\n\t}\n}\n\nBreakpointModal.propTypes = {\n\tisOpen: PropTypes.bool.isRequired,\n\tbreakpoint: PropTypes.shape({\n\t\ttype: PropTypes.oneOf(['execute', 'memory']),\n\t\taddress: PropTypes.number.isRequired,\n\t}),\n\tinitialOverrides: PropTypes.shape({\n\t\ttype: PropTypes.oneOf(['execute', 'memory']),\n\t\taddress: PropTypes.number.isRequired,\n\t}),\n\n\tonClose: PropTypes.func.isRequired,\n};\n\nBreakpointModal.contextType = DebuggerContext;\n\nexport default BreakpointModal;\n","// We set this to false when we trigger one.\nlet userInitiated = true;\n\nlet listeners = [];\n\nfunction createScratchpad() {\n\tconst div = document.createElement('div');\n\tdiv.id = 'clipboard-scratchpad';\n\tdiv.style.width = 1;\n\tdiv.style.height = 1;\n\tdiv.style.opacity = 0;\n\tdiv.style.position = 'absolute';\n\tdiv.style.top = 0;\n\tdiv.style.left = 0;\n\tdiv.style.pointerEvents = 'none';\n\tdiv.style.whiteSpace = 'pre';\n\tdocument.body.appendChild(div);\n\n\treturn div;\n}\n\nfunction getScratchpad() {\n\tconst div = document.getElementById('clipboard-scratchpad');\n\tif (!div) {\n\t\treturn createScratchpad();\n\t}\n\treturn div;\n}\n\nexport function copyText(text) {\n\tuserInitiated = false;\n\n\ttry {\n\t\tconst scratchpad = getScratchpad();\n\t\tscratchpad.textContent = text;\n\n\t\tconst textNode = scratchpad.firstChild;\n\t\tconst range = document.createRange();\n\t\trange.setStart(textNode, 0);\n\t\trange.setEnd(textNode, text.length);\n\n\t\tconst selection = window.getSelection();\n\t\tconst oldRange = selection.rangeCount !== 0 ? selection.getRangeAt(0) : null;\n\n\t\tselection.removeAllRanges();\n\t\tselection.addRange(range);\n\n\t\ttry {\n\t\t\tdocument.execCommand('copy');\n\t\t} catch (e) {\n\t\t\twindow.prompt('Use Ctrl-C or Command-C to copy', text);\n\t\t}\n\n\t\tselection.removeAllRanges();\n\t\tif (oldRange) {\n\t\t\tselection.addRange(oldRange);\n\t\t}\n\t} finally {\n\t\tuserInitiated = true;\n\t}\n}\n\nexport function listenCopy(selector, handler) {\n\tlisteners.push({ selector, handler });\n}\n\nexport function forgetCopy(selector, handler) {\n\tlisteners = listeners.filter(l => l.selector !== selector && l.handler !== handler);\n}\n\nif (!Element.prototype.matches) {\n\tElement.prototype.matches = Element.prototype.msMatchesSelector;\n}\n\nfunction hasClosestMatch(node, selector) {\n\twhile (node && node !== document) {\n\t\tif (node.matches(selector)) {\n\t\t\treturn true;\n\t\t}\n\t\tnode = node.parentNode;\n\t}\n\n\treturn false;\n}\n\ndocument.addEventListener('copy', (ev) => {\n\tconst range = document.getSelection().rangeCount !== 0 ? document.getSelection().getRangeAt(0) : null;\n\tif ((range && !range.collapsed) || !userInitiated) {\n\t\t// Skip if the user has anything actually selected, or if we triggered this 'copy' command.\n\t\treturn;\n\t}\n\n\tfor (let listener of listeners) {\n\t\tif (!hasClosestMatch(document.activeElement, listener.selector)) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst result = listener.handler(ev);\n\t\tif (result) {\n\t\t\t// Unfortunate, but newline conversion isn't automatic...\n\t\t\tif (/win/i.test(window.navigator.platform)) {\n\t\t\t\tev.clipboardData.setData('text/plain', result.replace(/\\n/g, '\\r\\n'));\n\t\t\t} else {\n\t\t\t\tev.clipboardData.setData('text/plain', result);\n\t\t\t}\n\t\t\tev.preventDefault();\n\t\t}\n\t}\n});\n","import { PureComponent } from 'react';\nimport DebuggerContext, { DebuggerContextValues } from '../DebuggerContext';\nimport PropTypes from 'prop-types';\nimport { ContextMenu, MenuItem, connectMenu } from 'react-contextmenu';\nimport { copyText } from '../../utils/clipboard';\nimport { toString08X } from '../../utils/format';\n\nclass DisasmContextMenu extends PureComponent {\n\t/**\n\t * @type {DebuggerContextValues}\n\t */\n\tcontext;\n\n\trender() {\n\t\tconst { id, trigger } = this.props;\n\t\tconst disabled = !this.context.gameStatus.stepping || this.context.gameStatus.paused;\n\t\tconst line = trigger && trigger.line;\n\n\t\tconst followBranch = line && (line.branch !== null || line.relevantData !== null || line.type === 'data');\n\n\t\treturn (\n\t\t\t<ContextMenu id={id}>\n\t\t\t\t<MenuItem onClick={this.handleCopyAddress}>\n\t\t\t\t\tCopy Address\n\t\t\t\t</MenuItem>\n\t\t\t\t<MenuItem onClick={this.handleCopyHex}>\n\t\t\t\t\tCopy Instruction (Hex)\n\t\t\t\t</MenuItem>\n\t\t\t\t<MenuItem onClick={this.handleCopyDisasm}>\n\t\t\t\t\tCopy Instruction (Disasm)\n\t\t\t\t</MenuItem>\n\t\t\t\t<MenuItem divider />\n\t\t\t\t<MenuItem disabled={disabled} onClick={this.handleAssemble}>\n\t\t\t\t\tAssemble Opcode...\n\t\t\t\t</MenuItem>\n\t\t\t\t<MenuItem divider />\n\t\t\t\t<MenuItem disabled={disabled} onClick={this.handleRunUntil}>\n\t\t\t\t\tRun to Cursor\n\t\t\t\t</MenuItem>\n\t\t\t\t<MenuItem disabled={disabled} onClick={this.handleJumpPC}>\n\t\t\t\t\tJump to Cursor\n\t\t\t\t</MenuItem>\n\t\t\t\t<MenuItem onClick={this.handleToggleBreakpoint}>\n\t\t\t\t\tToggle Breakpoint\n\t\t\t\t</MenuItem>\n\t\t\t\t<MenuItem divider />\n\t\t\t\t<MenuItem disabled={!followBranch} onClick={this.handleFollowBranch}>\n\t\t\t\t\tFollow Branch\n\t\t\t\t</MenuItem>\n\t\t\t\t<MenuItem data={{ action: 'goto_memory' }} onClick={this.handleTodo}>\n\t\t\t\t\tGo to in Memory View\n\t\t\t\t</MenuItem>\n\t\t\t\t<MenuItem data={{ action: 'goto_jit' }} onClick={this.handleTodo}>\n\t\t\t\t\tGo to in Jit Compare\n\t\t\t\t</MenuItem>\n\t\t\t\t<MenuItem divider />\n\t\t\t\t<MenuItem data={{ action: 'func_rename' }} onClick={this.handleTodo}>\n\t\t\t\t\tRename Function...\n\t\t\t\t</MenuItem>\n\t\t\t\t<MenuItem data={{ action: 'func_remove' }} onClick={this.handleTodo}>\n\t\t\t\t\tRemove Function\n\t\t\t\t</MenuItem>\n\t\t\t\t<MenuItem data={{ action: 'func_add' }} onClick={this.handleTodo}>\n\t\t\t\t\tAdd Function Here\n\t\t\t\t</MenuItem>\n\t\t\t</ContextMenu>\n\t\t);\n\t}\n\n\thandleCopyAddress = (ev, data) => {\n\t\tcopyText(toString08X(data.line.address));\n\t\tdata.node.focus();\n\t}\n\n\thandleCopyHex = (ev, data) => {\n\t\tconst hexLines = this.props.getSelectedLines().map(line => {\n\t\t\t// Include each opcode of a macro if it's a macro.\n\t\t\treturn line.macroEncoding ? line.macroEncoding.map(toString08X).join(\"\\n\") : toString08X(line.encoding);\n\t\t});\n\t\tcopyText(hexLines.join(\"\\n\"));\n\t\tdata.node.focus();\n\t}\n\n\thandleCopyDisasm = (ev, data) => {\n\t\tconst lines = this.props.getSelectedDisasm();\n\t\tcopyText(lines);\n\t\tdata.node.focus();\n\t}\n\n\thandleAssemble = (ev, data) => {\n\t\t// Delay so the context menu can close before the prompt.\n\t\tsetTimeout(() => {\n\t\t\tthis.props.assembleInstruction(data.line, '').catch(() => {\n\t\t\t\t// Exception logged.\n\t\t\t});\n\t\t}, 0);\n\t}\n\n\thandleRunUntil = (ev, data) => {\n\t\tthis.context.ppsspp.send({\n\t\t\tevent: 'cpu.runUntil',\n\t\t\taddress: data.line.address,\n\t\t}).catch(() => {\n\t\t\t// Already logged, let's assume the parent will have marked it disconnected/not started by now.\n\t\t});\n\t\tdata.node.focus();\n\t}\n\n\thandleJumpPC = (ev, data) => {\n\t\tthis.context.ppsspp.send({\n\t\t\tevent: 'cpu.setReg',\n\t\t\tthread: this.context.gameStatus.currentThread,\n\t\t\tname: 'pc',\n\t\t\tvalue: data.line.address,\n\t\t}).catch((err) => {\n\t\t\tthis.context.log('Failed to update PC: ' + err);\n\t\t});\n\t}\n\n\thandleToggleBreakpoint = (ev, data) => {\n\t\tthis.props.toggleBreakpoint(data.line);\n\t}\n\n\thandleFollowBranch = (ev, data) => {\n\t\tthis.props.followBranch(true, data.line);\n\t}\n\n\thandleTodo = (ev, data) => {\n\t\t// TODO\n\t\tconsole.log(data);\n\t\tdata.node.focus();\n\t}\n}\n\nDisasmContextMenu.propTypes = {\n\tid: PropTypes.string.isRequired,\n\ttrigger: PropTypes.shape({\n\t\tline: PropTypes.shape({\n\t\t\ttype: PropTypes.string,\n\t\t\tbranch: PropTypes.object,\n\t\t\trelevantData: PropTypes.object,\n\t\t}),\n\t}),\n\n\tgetSelectedLines: PropTypes.func.isRequired,\n\tgetSelectedDisasm: PropTypes.func.isRequired,\n\tfollowBranch: PropTypes.func.isRequired,\n\tassembleInstruction: PropTypes.func.isRequired,\n\ttoggleBreakpoint: PropTypes.func.isRequired,\n};\n\nDisasmContextMenu.contextType = DebuggerContext;\n\nexport default connectMenu('disasm')(DisasmContextMenu);\n","import { PureComponent } from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'clsx';\n\nclass DisasmBranchGuide extends PureComponent {\n\trender() {\n\t\tconst pos = this.calcPos();\n\t\tif (pos === null || this.props.lineHeight === 0) {\n\t\t\treturn null;\n\t\t}\n\t\tconst classes = classNames({\n\t\t\t'DisasmBranchGuide': true,\n\t\t\t'DisasmBranchGuide--selected': this.props.selected,\n\t\t});\n\n\t\treturn (\n\t\t\t<div className={classes} style={pos}>\n\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"8\" height={pos.height}>\n\t\t\t\t\t<path d={this.buildPath(pos.height)} />\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t);\n\t}\n\n\tbuildPath(height) {\n\t\tconst { guide, range, lineHeight } = this.props;\n\t\tconst yCenter = Math.floor(lineHeight / 2) + 0.5;\n\n\t\t// Parts: trailing connects to outside view.\n\t\tconst trailingEdge = `m7.5,-${yCenter} l0,${lineHeight} m-7.5,-${lineHeight - yCenter}`;\n\t\tconst sourceEdge = 'm3,0 l5,0 m-8,0';\n\t\tconst arrowEdge = 'm5.5,-4 l-4,4 l4,4 m-3.5,-4 l6,0 m-8,0';\n\n\t\t// Start at the y center so our parts are reusable for top and bottom.\n\t\tlet path = ['M0,' + yCenter];\n\n\t\tif (guide.top < range.start) {\n\t\t\tpath.push(trailingEdge);\n\t\t} else if (guide.direction === 'up') {\n\t\t\tpath.push(arrowEdge);\n\t\t} else {\n\t\t\tpath.push(sourceEdge);\n\t\t}\n\n\t\tpath.push('m7.5,0 l0,' + (height - lineHeight) + ' m-7.5,0');\n\n\t\tif (guide.bottom >= range.end) {\n\t\t\tpath.push(trailingEdge);\n\t\t} else if (guide.direction === 'down') {\n\t\t\tpath.push(arrowEdge);\n\t\t} else {\n\t\t\tpath.push(sourceEdge);\n\t\t}\n\n\t\treturn path.join(' ');\n\t}\n\n\tcalcPos() {\n\t\tconst { guide } = this.props;\n\t\tconst top = this.findAddressOffset(guide.top, false);\n\t\tconst bottom = this.findAddressOffset(guide.bottom, true);\n\t\tif (top === null || bottom === null) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst right = (16 - guide.lane) * 8;\n\t\tconst height = bottom - top;\n\t\treturn { top, right, height };\n\t}\n\n\tfindAddressOffset(address, down) {\n\t\tconst { offsets, range } = this.props;\n\t\tif (address >= range.end) {\n\t\t\tif ((range.end - 4) in offsets && down) {\n\t\t\t\treturn offsets[range.end - 4] + this.props.lineHeight;\n\t\t\t}\n\t\t\tif ((range.end - 8) in offsets && down) {\n\t\t\t\treturn offsets[range.end - 8] + this.props.lineHeight;\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\n\t\tlet off;\n\t\tif (address < range.start && !down) {\n\t\t\toff = 0;\n\t\t} else if (address in offsets) {\n\t\t\toff = offsets[address];\n\t\t} else if (address - 4 in offsets) {\n\t\t\t// Inside a macro?\n\t\t\toff = offsets[address - 4];\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn down ? off + this.props.lineHeight : off;\n\t}\n}\n\nDisasmBranchGuide.propTypes = {\n\tguide: PropTypes.shape({\n\t\tdirection: PropTypes.oneOf(['up', 'down']).isRequired,\n\t\ttop: PropTypes.number.isRequired,\n\t\tbottom: PropTypes.number.isRequired,\n\t\tlane: PropTypes.number.isRequired,\n\t}).isRequired,\n\toffsets: PropTypes.object.isRequired,\n\trange: PropTypes.shape({\n\t\tstart: PropTypes.number.isRequired,\n\t\tend: PropTypes.number.isRequired,\n\t}).isRequired,\n\tlineHeight: PropTypes.number.isRequired,\n\tselected: PropTypes.bool,\n};\n\nexport default DisasmBranchGuide;\n","function isSubsetBounds(bounds, parentBounds) {\n\tif (bounds.top < parentBounds.top || bounds.left < parentBounds.left) {\n\t\treturn false;\n\t}\n\tif (bounds.bottom > parentBounds.bottom || bounds.right > parentBounds.right) {\n\t\treturn false;\n\t}\n\treturn true;\n}\n\nexport function isInView(node) {\n\tconst windowBounds = { top: 0, left: 0, bottom: window.innerHeight, right: window.innerWidth };\n\tconst rect = node.getBoundingClientRect();\n\tif (!isSubsetBounds(rect, windowBounds)) {\n\t\treturn false;\n\t}\n\n\tlet parentNode = node;\n\twhile ((parentNode = parentNode.parentNode) !== null) {\n\t\tif (parentNode instanceof HTMLElement) {\n\t\t\tconst style = window.getComputedStyle(parentNode);\n\t\t\tconst overflows = style.overflow + style.overflowX + style.overflowY;\n\t\t\tif (style.position === 'static' && overflows.indexOf('auto') === -1 && overflows.indexOf('scroll') === -1) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (!isSubsetBounds(rect, parentNode.getBoundingClientRect())) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn true;\n}\n\nexport function ensureInView(node, options) {\n\tif (!isInView(node)) {\n\t\tnode.scrollIntoView(options);\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n\nlet contextMenuStatus = false;\n\nwindow.addEventListener('REACT_CONTEXTMENU_SHOW', (ev) => {\n\tcontextMenuStatus = true;\n});\nwindow.addEventListener('REACT_CONTEXTMENU_HIDE', (ev) => {\n\tcontextMenuStatus = false;\n});\n\nexport function hasContextMenu() {\n\treturn contextMenuStatus;\n}\n","import PropTypes from 'prop-types';\n\nexport default function BreakpointIcon(props) {\n\treturn (\n\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" className={props.className} viewBox=\"0 0 1536 1536\" width=\"12\" height=\"12\">\n\t\t\t<path d=\"M768,0 q209,0 385.5,103 t279.5,279.5 t103,385.5 t-103,385.5 t-279.5,279.5 t-385.5,103 t-385.5,-103 t-279.5,-279.5 t-103,-385.5 t103,-385.5 t279.5,-279.5 t385.5,-103 zm128,1247 v-190 q0,-14 -9,-23.5 t-22,-9.5 h-192 q-13,0 -23,10 t-10,23 v190 q0,13 10,23 t23,10 h192 q13,0 22,-9.5 t9,-23.5 zm-2,-344 l18,-621 q0,-12 -10,-18 q-10,-8 -24,-8 h-220 q-14,0 -24,8 q-10,6 -10,18 l17,621 q0,10 10,17.5 t24,7.5 h185 q14,0 23.5,-7.5 t10.5,-17.5 z\" />\n\t\t</svg>\n\t);\n}\n\nBreakpointIcon.propTypes = {\n\tclassName: PropTypes.string.isRequired,\n};\n","import { createRef, PureComponent } from 'react';\nimport PropTypes from 'prop-types';\nimport { ContextMenuTrigger } from 'react-contextmenu';\nimport { toString08X } from '../../utils/format';\nimport { ensureInView } from '../../utils/dom';\nimport classNames from 'clsx';\nimport BreakpointIcon from './BreakpointIcon';\n\nclass DisasmLine extends PureComponent {\n\tref;\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.ref = createRef();\n\t}\n\n\trender() {\n\t\tconst { line, selected, focused, cursor } = this.props;\n\n\t\tconst className = classNames({\n\t\t\t'DisasmLine': true,\n\t\t\t'DisasmLine--selected': selected && !focused,\n\t\t\t'DisasmLine--focused': focused,\n\t\t\t'DisasmLine--cursor': cursor,\n\t\t\t'DisasmLine--breakpoint': line.breakpoint && line.breakpoint.enabled,\n\t\t\t'DisasmLine--disabled-breakpoint': line.breakpoint && !line.breakpoint.enabled,\n\t\t\t'DisasmLine--current': line.isCurrentPC,\n\t\t});\n\n\t\tconst mapData = (props) => {\n\t\t\treturn { line, node: this.ref.current.parentNode };\n\t\t};\n\t\tconst attributes = {\n\t\t\tonDoubleClick: (ev) => this.onDoubleClick(ev, mapData()),\n\t\t\ttabIndex: 0,\n\t\t};\n\n\t\treturn (\n\t\t\t<ContextMenuTrigger id={this.props.contextmenu} renderTag=\"a\" collect={mapData} attributes={attributes} holdToDisplay={-1}>\n\t\t\t\t<div className={className} style={{ backgroundColor: line.backgroundColor }} ref={this.ref} data-address={line.address}>\n\t\t\t\t\t<BreakpointIcon className=\"DisasmLine__breakpoint-icon\" />\n\t\t\t\t\t{this.renderAddress(line)}\n\t\t\t\t\t<code className=\"DisasmLine__opcode\">{this.highlight(line.name, '', line.params)} </code>\n\t\t\t\t\t<code className=\"DisasmLine__params\">{this.highlightParams(line.params, line.name, '')}{this.renderConditional(line)}</code>\n\t\t\t\t</div>\n\t\t\t</ContextMenuTrigger>\n\t\t);\n\t}\n\n\trenderAddress(line) {\n\t\tconst { symbol, address, encoding } = line;\n\t\tconst addressHex = toString08X(address);\n\n\t\tif (this.props.displaySymbols) {\n\t\t\tif (symbol !== null) {\n\t\t\t\treturn <code className=\"DisasmLine__address DisasmLine__address--symbol\">{this.highlight(symbol + ':')}</code>;\n\t\t\t}\n\t\t\treturn <code className=\"DisasmLine__address DisasmLine__address--nosymbol\">{this.highlight(addressHex)}</code>;\n\t\t}\n\t\treturn (\n\t\t\t<code className=\"DisasmLine__address DisasmLine__address--hexonly\">\n\t\t\t\t{this.highlight(addressHex)} {toString08X(encoding)}\n\t\t\t</code>\n\t\t);\n\t}\n\n\trenderConditional(line) {\n\t\tif (line.isCurrentPC && line.conditionMet !== null) {\n\t\t\treturn line.conditionMet ? ' ; true' : ' ; false';\n\t\t}\n\t\treturn '';\n\t}\n\n\thighlight(text, before = '', after = '') {\n\t\tconst { highlight } = this.props;\n\t\tif (highlight !== null) {\n\t\t\tconst fullText = (before ? before + ' ' : '') + text + ' ' + after;\n\t\t\tlet pos = fullText.toLowerCase().indexOf(highlight);\n\t\t\tlet matchLength = highlight.length;\n\t\t\tif (pos !== -1) {\n\t\t\t\tconst beforeLength = before ? before.length + 1 : 0;\n\t\t\t\tif (pos < beforeLength) {\n\t\t\t\t\tmatchLength -= beforeLength - pos;\n\t\t\t\t\tpos = matchLength > 0 ? 0 : -1;\n\t\t\t\t} else {\n\t\t\t\t\tpos -= beforeLength;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (pos >= 0 && pos < text.length) {\n\t\t\t\tconst className = classNames({\n\t\t\t\t\t'DisasmLine__highlight': true,\n\t\t\t\t\t'DisasmLine__highlight--end': pos + matchLength > text.length + 1,\n\t\t\t\t});\n\t\t\t\treturn (\n\t\t\t\t\t<>\n\t\t\t\t\t\t{text.substr(0, pos)}\n\t\t\t\t\t\t<span className={className}>{text.substr(pos, matchLength)}</span>\n\t\t\t\t\t\t{text.substr(pos + matchLength)}\n\t\t\t\t\t</>\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\treturn text;\n\t}\n\n\thighlightParams(text, before = '', after = '') {\n\t\tconst { highlight, highlightParams } = this.props;\n\t\tif (highlight === null) {\n\t\t\tconst params = text.split(/([,()])/);\n\t\t\tconst toHighlight = highlightParams || [];\n\t\t\treturn params.map((param, key) => {\n\t\t\t\tlet className = 'DisasmLine__param';\n\t\t\t\tif (toHighlight.includes(param)) {\n\t\t\t\t\tclassName += ' DisasmLine__param--highlighted';\n\t\t\t\t}\n\t\t\t\treturn <span className={className} key={key}>{param}</span>;\n\t\t\t});\n\t\t}\n\t\treturn this.highlight(text, before, after);\n\t}\n\n\tonDoubleClick(ev, data) {\n\t\tif (ev.button === 0) {\n\t\t\tthis.props.onDoubleClick(ev, data);\n\t\t}\n\t}\n\n\tensureInView(needsScroll) {\n\t\tconst triggerNode = this.ref.current.parentNode;\n\t\tif (needsScroll !== false) {\n\t\t\tensureInView(triggerNode, { block: needsScroll });\n\t\t}\n\t\ttriggerNode.focus();\n\t}\n\n\tstatic addressBoundingTop(parentNode, address) {\n\t\tconst lineNode = parentNode.querySelector('.DisasmLine[data-address=\"' + address + '\"]');\n\t\tif (lineNode) {\n\t\t\tconst triggerNode = lineNode.parentNode;\n\t\t\treturn triggerNode.getBoundingClientRect().top;\n\t\t}\n\t\treturn null;\n\t}\n}\n\nDisasmLine.propTypes = {\n\tline: PropTypes.shape({\n\t\taddress: PropTypes.number.isRequired,\n\t}).isRequired,\n\tselected: PropTypes.bool,\n\tfocused: PropTypes.bool,\n\tcursor: PropTypes.bool,\n\tdisplaySymbols: PropTypes.bool,\n\thighlight: PropTypes.string,\n\thighlightParams: PropTypes.arrayOf(PropTypes.string),\n\tcontextmenu: PropTypes.string.isRequired,\n\tonDoubleClick: PropTypes.func.isRequired,\n};\n\nexport default DisasmLine;\n","import { createRef, PureComponent } from 'react';\nimport PropTypes from 'prop-types';\nimport DisasmBranchGuide from './DisasmBranchGuide';\nimport DisasmLine from './DisasmLine';\nimport { hasContextMenu } from '../../utils/dom';\nimport { listenCopy, forgetCopy } from '../../utils/clipboard';\nimport { toString08X } from '../../utils/format';\nimport { Timeout } from '../../utils/timeouts';\n\nclass DisasmList extends PureComponent {\n\tstate = {\n\t\tmouseDown: false,\n\t\tfocused: false,\n\t\tlineOffsets: {},\n\t\tpendingLineParams: [],\n\t\tselectedLineParams: [],\n\t\tprevLines: null,\n\t\tprevSelectionTop: null,\n\t\tprevSelectionBottom: null,\n\t};\n\tfocusTimeout;\n\tparamsTimeout;\n\tref;\n\tcursorRef;\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.ref = createRef();\n\t\tthis.cursorRef = createRef();\n\t\tthis.focusTimeout = new Timeout(() => null, 20);\n\t\tthis.paramsTimeout = new Timeout(() => {\n\t\t\tthis.setState({ selectedLineParams: this.state.pendingLineParams });\n\t\t}, 20);\n\t}\n\n\trender() {\n\t\tconst events = {\n\t\t\tonMouseDownCapture: ev => this.onMouseDown(ev),\n\t\t\tonMouseUpCapture: this.state.mouseDown ? (ev => this.onMouseUp(ev)) : undefined,\n\t\t\tonMouseMove: this.state.mouseDown ? (ev => this.onMouseMove(ev)) : undefined,\n\t\t\tonKeyDown: ev => this.onKeyDown(ev),\n\t\t\tonBlur: ev => this.onFocusChange(ev, false),\n\t\t\tonFocus: ev => this.onFocusChange(ev, true),\n\t\t};\n\n\t\treturn (\n\t\t\t<div className=\"Disasm__list\" ref={this.ref} {...events}>\n\t\t\t\t{this.props.lines.map((line) => this.renderLine(line))}\n\t\t\t\t{this.props.branchGuides.map((guide) => this.renderBranchGuide(guide))}\n\t\t\t</div>\n\t\t);\n\t}\n\n\trenderLine(line) {\n\t\tconst { displaySymbols, cursor } = this.props;\n\t\tlet props = {\n\t\t\tdisplaySymbols,\n\t\t\tline,\n\t\t\tselected: this.isLineSelected(line),\n\t\t\tcursor: line.address === cursor,\n\t\t\tonDoubleClick: this.props.onDoubleClick,\n\t\t\tref: line.address === cursor ? this.cursorRef : undefined,\n\t\t\t// Avoid re-rendering lines unnecessarily.\n\t\t\thighlight: this.shouldHighlight(line, this.props.highlightText) ? this.props.highlightText : null,\n\t\t\thighlightParams: this.shouldHighlightParams(line) ? this.state.selectedLineParams : null,\n\t\t};\n\t\tprops.focused = props.selected && this.state.focused;\n\n\t\treturn <DisasmLine key={line.address} contextmenu=\"disasm\" {...props} />;\n\t}\n\n\trenderBranchGuide(guide) {\n\t\tconst key = String(guide.top) + String(guide.bottom) + guide.direction;\n\t\tconst { range, lineHeight, cursor } = this.props;\n\t\tconst props = {\n\t\t\tkey,\n\t\t\tguide,\n\t\t\toffsets: this.state.lineOffsets,\n\t\t\trange,\n\t\t\tlineHeight,\n\t\t\tselected: guide.top === cursor || guide.bottom === cursor,\n\t\t};\n\n\t\treturn <DisasmBranchGuide {...props} />;\n\t}\n\n\tshouldHighlight(line, match) {\n\t\tlet parts = [];\n\t\tparts.push(toString08X(line.address));\n\t\tif (line.symbol !== null) {\n\t\t\tparts.push(line.symbol + ':');\n\t\t}\n\t\tparts.push(line.name + ' ' + line.params);\n\n\t\treturn parts.some(part => part.toLowerCase().indexOf(match) !== -1);\n\t}\n\n\tshouldHighlightParams(line, match) {\n\t\tif (this.isLineSelected(line)) {\n\t\t\treturn false;\n\t\t}\n\t\treturn this.state.selectedLineParams.some(param => line.params.indexOf(param) !== -1);\n\t}\n\n\t// Exposed to parent.\n\taddressBoundingTop(address) {\n\t\t// It seems like pointless complexity to use a ref for this.\n\t\treturn DisasmLine.addressBoundingTop(this.ref.current, address);\n\t}\n\n\t// Exposed to parent.\n\tensureCursorInView(options) {\n\t\tif (this.cursorRef.current) {\n\t\t\tthis.cursorRef.current.ensureInView(options);\n\t\t}\n\t}\n\n\tisLineSelected(line) {\n\t\treturn DisasmList.isLineSelected(this.props, line);\n\t}\n\n\tstatic isLineSelected({ selectionTop, selectionBottom }, line) {\n\t\treturn line.address + line.addressSize > selectionTop && line.address <= selectionBottom;\n\t}\n\n\tstatic calcOffsets(lines, lineHeight) {\n\t\tlet pos = 0;\n\t\tlet offsets = {};\n\t\tlines.forEach((line) => {\n\t\t\toffsets[line.address] = pos;\n\t\t\tpos += lineHeight;\n\t\t});\n\t\treturn offsets;\n\t}\n\n\tstatic getSelectedLineParams({ lines, selectionTop, selectionBottom }) {\n\t\tconst selectedLines = lines.filter(DisasmList.isLineSelected.bind(null, { selectionTop, selectionBottom }));\n\n\t\tlet params = {};\n\t\tfor (let line of selectedLines) {\n\t\t\tfor (let param of line.params.split(/[,()]/)) {\n\t\t\t\tparams[param] = param;\n\t\t\t}\n\t\t}\n\t\tdelete params[''];\n\n\t\treturn Object.values(params);\n\t}\n\n\tstatic getDerivedStateFromProps(nextProps, prevState) {\n\t\tconst linesChanged = nextProps.lines !== prevState.prevLines;\n\t\tconst selectionChanged = nextProps.selectionTop !== prevState.prevSelectionTop || nextProps.selectionBottom !== prevState.prevSelectionBottom;\n\n\t\tlet offsetsUpdate = null;\n\t\tif (linesChanged) {\n\t\t\tconst lineOffsets = DisasmList.calcOffsets(nextProps.lines, nextProps.lineHeight);\n\t\t\toffsetsUpdate = { lineOffsets, prevLines: nextProps.lines };\n\t\t}\n\n\t\tlet selectedUpdate = null;\n\t\tif (linesChanged || selectionChanged) {\n\t\t\tselectedUpdate = {\n\t\t\t\tpendingLineParams: DisasmList.getSelectedLineParams(nextProps),\n\t\t\t\tprevSelectionTop: nextProps.selectionTop,\n\t\t\t\tprevSelectionBottom: nextProps.selectionBottom,\n\t\t\t};\n\t\t}\n\n\t\tif (offsetsUpdate !== null || selectedUpdate !== null) {\n\t\t\treturn { ...offsetsUpdate, ...selectedUpdate };\n\t\t}\n\t\treturn null;\n\t}\n\n\tcomponentDidMount() {\n\t\tlistenCopy('.Disasm__list', this.onCopy);\n\t}\n\n\tcomponentWillUnmount() {\n\t\tforgetCopy('.Disasm__list', this.onCopy);\n\t\tthis.paramsTimeout.cancel();\n\t}\n\n\tcomponentDidUpdate(prevProps, prevState) {\n\t\tif (this.state.pendingLineParams !== prevState.pendingLineParams) {\n\t\t\t// Apply the line params soon after selection change - not immediately for quicker scrolling.\n\t\t\tthis.paramsTimeout.start();\n\t\t}\n\t}\n\n\tonCopy = (ev) => {\n\t\treturn this.props.getSelectedDisasm();\n\t}\n\n\tonFocusChange(ev, focused) {\n\t\tconst update = () => {\n\t\t\tif (focused !== this.state.focused) {\n\t\t\t\tthis.setState({ focused });\n\t\t\t}\n\t\t};\n\n\t\tthis.focusTimeout.cancel();\n\n\t\tif (!focused) {\n\t\t\t// We use an arbitrary short delay because a click will temporarily blur.\n\t\t\tthis.focusTimeout.reset(update);\n\t\t\tthis.focusTimeout.start();\n\t\t} else {\n\t\t\tupdate();\n\t\t}\n\t}\n\n\tonMouseDown(ev) {\n\t\tconst line = this.mouseEventToLine(ev);\n\t\t// Don't change selection if right clicking within the selection.\n\t\tif (ev.button !== 2 || !this.isLineSelected(line)) {\n\t\t\tthis.applySelection(ev, line);\n\t\t} else {\n\t\t\t// But do change the cursor.\n\t\t\tthis.props.updateCursor(line.address);\n\t\t}\n\t\tif (ev.button === 0) {\n\t\t\tthis.setState({ mouseDown: true });\n\t\t}\n\t}\n\n\tonMouseUp(ev) {\n\t\tconst line = this.mouseEventToLine(ev);\n\t\tif (line) {\n\t\t\tthis.applySelection(ev, line);\n\t\t}\n\t\tthis.setState({ mouseDown: false });\n\t}\n\n\tonMouseMove(ev) {\n\t\tif (ev.buttons === 0) {\n\t\t\tthis.setState({ mouseDown: false });\n\t\t\treturn;\n\t\t}\n\n\t\tconst line = this.mouseEventToLine(ev);\n\t\tif (line) {\n\t\t\tthis.applySelection(ev, line);\n\t\t}\n\t}\n\n\tonKeyDown(ev) {\n\t\tif (hasContextMenu()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst modifiers = (ev.ctrlKey ? 'c' : '') + (ev.metaKey ? 'm' : '') + (ev.altKey ? 'a' : '') + (ev.shiftKey ? 's' : '');\n\n\t\tif (['ArrowUp', 'ArrowDown', 'PageUp', 'PageDown'].includes(ev.key)) {\n\t\t\tlet dist = 1;\n\t\t\tif (ev.key === 'PageUp' || ev.key === 'PageDown') {\n\t\t\t\tdist = this.props.visibleLines;\n\t\t\t}\n\t\t\tif (ev.key === 'ArrowUp' || ev.key === 'PageUp') {\n\t\t\t\tdist = -dist;\n\t\t\t}\n\n\t\t\tif (modifiers === '' || modifiers === 's') {\n\t\t\t\tconst lineIndex = this.findCursorLineIndex();\n\t\t\t\tconst newIndex = Math.min(this.props.lines.length - 1, Math.max(0, lineIndex + dist));\n\t\t\t\tif (lineIndex !== newIndex) {\n\t\t\t\t\tthis.applySelection(ev, this.props.lines[newIndex]);\n\t\t\t\t\tev.preventDefault();\n\t\t\t\t}\n\t\t\t} else if (ev.ctrlKey) {\n\t\t\t\tthis.props.applyScroll(dist);\n\t\t\t\tev.preventDefault();\n\t\t\t}\n\t\t}\n\n\t\tif ((ev.key === 'ArrowLeft' || ev.key === 'ArrowRight') && modifiers === '') {\n\t\t\tthis.props.followBranch(ev.key === 'ArrowRight', this.findCursorLine());\n\t\t\tev.preventDefault();\n\t\t}\n\n\t\tif (ev.key === 'Tab' && modifiers === '') {\n\t\t\tthis.props.updateDisplaySymbols(!this.props.displaySymbols);\n\t\t\tev.preventDefault();\n\t\t}\n\n\t\tif (ev.key === 'a' && modifiers === 'c') {\n\t\t\tthis.props.assembleInstruction(this.findCursorLine(), '');\n\t\t\tev.preventDefault();\n\t\t}\n\n\t\tif ((ev.key === ' ' || ev.key === 'Spacebar') && modifiers === '') {\n\t\t\tthis.props.toggleBreakpoint(this.findCursorLine());\n\t\t\tev.preventDefault();\n\t\t}\n\t\tif (ev.key === 'd' && modifiers === 'c') {\n\t\t\tthis.props.toggleBreakpoint(this.findCursorLine(), true);\n\t\t\tev.preventDefault();\n\t\t}\n\n\t\tif ((ev.key === 's' || ev.key === 'f') && modifiers === 'c') {\n\t\t\tthis.props.searchPrompt();\n\t\t\tev.preventDefault();\n\t\t}\n\n\t\tif ((ev.key === 'F3') && modifiers === '') {\n\t\t\tthis.props.searchNext();\n\t\t\tev.preventDefault();\n\t\t}\n\n\t\tif (ev.key === 'g' && modifiers === 'c') {\n\t\t\tthis.props.promptGoto();\n\t\t\tev.preventDefault();\n\t\t}\n\n\t\tif (ev.key === 'e' && modifiers === 'c') {\n\t\t\tthis.props.editBreakpoint(this.findCursorLine());\n\t\t\tev.preventDefault();\n\t\t}\n\t}\n\n\tapplySelection(ev, line) {\n\t\tlet { selectionTop, selectionBottom } = this.props;\n\t\tif (ev.shiftKey) {\n\t\t\tselectionTop = Math.min(selectionTop, line.address);\n\t\t\tselectionBottom = Math.max(selectionBottom, line.address);\n\t\t} else {\n\t\t\tselectionTop = line.address;\n\t\t\tselectionBottom = line.address;\n\t\t}\n\n\t\tif (selectionTop !== this.props.selectionTop || selectionBottom !== this.props.selectionBottom) {\n\t\t\tthis.props.updateSelection({\n\t\t\t\tselectionTop,\n\t\t\t\tselectionBottom,\n\t\t\t});\n\t\t}\n\t\tthis.props.updateCursor(line.address);\n\t}\n\n\tmouseEventToLine(ev) {\n\t\t// Account for page and list scrolling.\n\t\tconst y = ev.pageY - this.ref.current.getBoundingClientRect().top - window.pageYOffset;\n\t\tconst index = Math.floor(y / this.props.lineHeight);\n\t\treturn this.props.lines[index];\n\t}\n\n\tfindCursorLineIndex() {\n\t\tconst { cursor, lines, selectionTop } = this.props;\n\t\tconst addr = cursor ? cursor : selectionTop;\n\t\tfor (let i = 0; i < lines.length; ++i) {\n\t\t\tif (lines[i].address === addr) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tfindCursorLine() {\n\t\tconst lineIndex = this.findCursorLineIndex();\n\t\treturn this.props.lines[lineIndex];\n\t}\n}\n\nDisasmList.propTypes = {\n\tlineHeight: PropTypes.number.isRequired,\n\tvisibleLines: PropTypes.number.isRequired,\n\tdisplaySymbols: PropTypes.bool.isRequired,\n\tcursor: PropTypes.number,\n\tselectionTop: PropTypes.number,\n\tselectionBottom: PropTypes.number,\n\thighlightText: PropTypes.string,\n\n\tonDoubleClick: PropTypes.func.isRequired,\n\tupdateCursor: PropTypes.func.isRequired,\n\tupdateSelection: PropTypes.func.isRequired,\n\tupdateDisplaySymbols: PropTypes.func.isRequired,\n\tgetSelectedDisasm: PropTypes.func.isRequired,\n\tfollowBranch: PropTypes.func.isRequired,\n\tassembleInstruction: PropTypes.func.isRequired,\n\ttoggleBreakpoint: PropTypes.func.isRequired,\n\tapplyScroll: PropTypes.func.isRequired,\n\tpromptGoto: PropTypes.func.isRequired,\n\tsearchPrompt: PropTypes.func.isRequired,\n\tsearchNext: PropTypes.func.isRequired,\n\teditBreakpoint: PropTypes.func.isRequired,\n\n\trange: PropTypes.shape({\n\t\tstart: PropTypes.number.isRequired,\n\t\tend: PropTypes.number.isRequired,\n\t}).isRequired,\n\tlines: PropTypes.arrayOf(PropTypes.shape({\n\t\taddress: PropTypes.number.isRequired,\n\t})).isRequired,\n\tbranchGuides: PropTypes.arrayOf(PropTypes.shape({\n\t\ttop: PropTypes.number.isRequired,\n\t\tbottom: PropTypes.number.isRequired,\n\t\tdirection: PropTypes.string.isRequired,\n\t})).isRequired,\n};\n\nexport default DisasmList;\n","import { createRef, PureComponent } from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'clsx';\nimport './DisasmSearch.css';\n\nclass DisasmSearch extends PureComponent {\n\tref;\n\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.ref = createRef();\n\t}\n\n\trender() {\n\t\tconst value = this.props.searchString || '';\n\t\tconst classes = classNames('DisasmSearch__field', { 'DisasmSearch__field--progress': this.props.inProgress });\n\n\t\treturn (\n\t\t\t/* eslint no-script-url: \"off\" */\n\t\t\t<form action=\"#\" className=\"DisasmSearch\" hidden={this.props.searchString === null} onSubmit={this.handleNext}>\n\t\t\t\t<div className={classes}>\n\t\t\t\t\t<input type=\"search\" value={value} placeholder=\"Find...\" onChange={this.handleChange} onKeyDown={this.handleKeyDown} ref={this.ref} />\n\t\t\t\t</div>\n\t\t\t\t<button type=\"submit\">\n\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\" width=\"15\" height=\"15\" role=\"img\">\n\t\t\t\t\t\t<title>Search / Next</title>\n\t\t\t\t\t\t<path d=\"M10,50 l80,0 l-35,-40 m35,40 l-35,40\" />\n\t\t\t\t\t</svg>\n\t\t\t\t</button>\n\t\t\t\t<button type=\"button\" onClick={this.handleCancel}>\n\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 180 180\" width=\"15\" height=\"15\" role=\"img\">\n\t\t\t\t\t\t<title>Cancel</title>\n\t\t\t\t\t\t<path d=\"M30,30 l120,120 m-120,0 l120,-120\" />\n\t\t\t\t\t</svg>\n\t\t\t\t</button>\n\t\t\t</form>\n\t\t);\n\t}\n\n\tcomponentDidUpdate(prevProps, prevState) {\n\t\tif (prevProps.searchString === null && this.props.searchString !== null) {\n\t\t\tthis.focus();\n\t\t}\n\t}\n\n\thandleChange = (ev) => {\n\t\tthis.props.updateSearchString(ev.target.value);\n\t}\n\n\thandleNext = (ev) => {\n\t\tthis.props.searchNext();\n\t\tthis.focus();\n\t\tev.preventDefault();\n\t}\n\n\thandleCancel = (ev) => {\n\t\tthis.props.updateSearchString(null);\n\t}\n\n\thandleKeyDown = (ev) => {\n\t\tif (ev.key === 'Escape') {\n\t\t\tthis.handleCancel();\n\t\t\tev.preventDefault();\n\t\t}\n\t}\n\n\tfocus() {\n\t\tthis.ref.current.focus();\n\t}\n}\n\nDisasmSearch.propTypes = {\n\tsearchString: PropTypes.string,\n\tinProgress: PropTypes.bool.isRequired,\n\tupdateSearchString: PropTypes.func.isRequired,\n\tsearchNext: PropTypes.func.isRequired,\n};\n\nexport default DisasmSearch;\n","import { PureComponent } from 'react';\nimport PropTypes from 'prop-types';\nimport { toString02X, toString04X, toString08X } from '../../utils/format';\nimport './StatusBar.css';\n\nclass StatusBar extends PureComponent {\n\trender() {\n\t\tconst { line } = this.props;\n\t\tif (!line) {\n\t\t\treturn <div className=\"StatusBar\"></div>;\n\t\t}\n\n\t\treturn (\n\t\t\t<div className=\"StatusBar\">\n\t\t\t\t<div className=\"StatusBar__left\">{this.renderLeftStatus(line)}</div>\n\t\t\t\t<div className=\"StatusBar__right\">{line.function || line.symbol || ''}</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\trenderLeftStatus(line) {\n\t\tif (line.type === 'opcode' || line.type === 'macro') {\n\t\t\tif (line.dataAccess) {\n\t\t\t\treturn this.renderDataAccess(line.dataAccess);\n\t\t\t} else if (line.branch) {\n\t\t\t\treturn this.renderBranch(line.branch);\n\t\t\t} else if (line.relevantData && typeof line.relevantData.stringValue === 'string') {\n\t\t\t\treturn this.renderString(line.relevantData);\n\t\t\t}\n\t\t} else if (line.type === 'data') {\n\t\t\treturn this.renderDataSymbol(line.dataSymbol, line.address);\n\t\t}\n\n\t\treturn '';\n\t}\n\n\trenderDataAccess(dataAccess) {\n\t\tif (dataAccess.uintValue === null) {\n\t\t\treturn 'Invalid address ' + toString08X(dataAccess.address);\n\t\t}\n\n\t\tlet status = '[' + toString08X(dataAccess.address) + '] = ';\n\t\tif (dataAccess.valueSymbol) {\n\t\t\tstatus += dataAccess.valueSymbol + ' (';\n\t\t}\n\t\tif (dataAccess.size === 1) {\n\t\t\tstatus += toString02X(dataAccess.uintValue);\n\t\t} else if (dataAccess.size === 2) {\n\t\t\tstatus += toString04X(dataAccess.uintValue);\n\t\t} else if (dataAccess.size >= 4) {\n\t\t\t// TODO: Show vectors better.\n\t\t\tstatus += toString08X(dataAccess.uintValue);\n\t\t}\n\t\tif (dataAccess.valueSymbol) {\n\t\t\tstatus += ')';\n\t\t}\n\n\t\treturn status;\n\t}\n\n\trenderBranch(branch) {\n\t\tlet status = branch.targetAddress ? toString08X(branch.targetAddress) : '';\n\t\tif (branch.symbol) {\n\t\t\tstatus += ' = ' + branch.symbol;\n\t\t}\n\t\treturn status;\n\t}\n\n\trenderString(data) {\n\t\treturn '[' + toString08X(data.address) + '] = ' + JSON.stringify(data.stringValue);\n\t}\n\n\trenderDataSymbol(dataSymbol, address) {\n\t\tlet status = toString08X(dataSymbol.start);\n\t\tif (dataSymbol.label) {\n\t\t\tstatus += ' (' + dataSymbol.label + ')';\n\t\t}\n\t\tif (address !== dataSymbol.start) {\n\t\t\tstatus += ' + ' + toString08X(dataSymbol.start - address);\n\t\t}\n\t\treturn status;\n\t}\n}\n\nStatusBar.propTypes = {\n\tline: PropTypes.object,\n};\n\nexport default StatusBar;\n","import { createRef, PureComponent } from 'react';\nimport DebuggerContext, { DebuggerContextValues } from '../DebuggerContext';\nimport PropTypes from 'prop-types';\nimport BreakpointModal from './BreakpointModal';\nimport DisasmContextMenu from './DisasmContextMenu';\nimport DisasmList from './DisasmList';\nimport DisasmSearch from './DisasmSearch';\nimport StatusBar from './StatusBar';\nimport { toString08X } from '../../utils/format';\nimport listeners from '../../utils/listeners.js';\nimport './Disasm.css';\n\nconst MIN_BUFFER = 100;\nconst MAX_BUFFER = 500;\n\nclass Disasm extends PureComponent {\n\tstate = {\n\t\tlines: [],\n\t\tbranchGuides: [],\n\t\trange: { start: 0, end: 0 },\n\t\tlineHeight: 0,\n\t\tvisibleLines: 0,\n\t\tdisplaySymbols: true,\n\t\twantDisplaySymbols: true,\n\t\tcursor: null,\n\t\tsearchString: null,\n\t\tsearchInProgress: false,\n\t\thighlightText: null,\n\t\teditingBreakpoint: null,\n\t\tcreatingBreakpoint: null,\n\t};\n\t/**\n\t * @type {DebuggerContextValues}\n\t */\n\tcontext;\n\tjumpStack = [];\n\tneedsScroll = false;\n\tneedsOffsetFix = false;\n\tupdatesCancel = false;\n\tupdatesSequence = Promise.resolve(null);\n\tlastSearch = null;\n\tref;\n\tlistRef;\n\tsearchRef;\n\tlisteners_;\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.ref = createRef();\n\t\tthis.listRef = createRef();\n\t\tthis.searchRef = createRef();\n\t}\n\n\trender() {\n\t\tconst events = {\n\t\t\tonScroll: ev => this.onScroll(ev),\n\t\t\tonDragStart: ev => ev.preventDefault(),\n\t\t};\n\n\t\tif (!this.context.gameStatus.started) {\n\t\t\treturn this.renderNotStarted();\n\t\t}\n\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<div ref={this.ref} className=\"Disasm\" {...events}>\n\t\t\t\t\t<DisasmList ref={this.listRef} {...this.state}\n\t\t\t\t\t\tonDoubleClick={this.onDoubleClick}\n\t\t\t\t\t\tupdateSelection={this.props.updateSelection}\n\t\t\t\t\t\tpromptGoto={this.props.promptGoto}\n\t\t\t\t\t\tupdateCursor={this.updateCursor}\n\t\t\t\t\t\tupdateDisplaySymbols={this.updateDisplaySymbols}\n\t\t\t\t\t\tselectionTop={this.props.selectionTop}\n\t\t\t\t\t\tselectionBottom={this.props.selectionBottom}\n\t\t\t\t\t\tgetSelectedDisasm={this.getSelectedDisasm}\n\t\t\t\t\t\tfollowBranch={this.followBranch}\n\t\t\t\t\t\tassembleInstruction={this.assembleInstruction}\n\t\t\t\t\t\ttoggleBreakpoint={this.toggleBreakpoint}\n\t\t\t\t\t\teditBreakpoint={this.editBreakpoint}\n\t\t\t\t\t\tapplyScroll={this.applyScroll}\n\t\t\t\t\t\tsearchPrompt={this.searchPrompt}\n\t\t\t\t\t\tsearchNext={this.searchNext}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<StatusBar line={this.state.lines.find(l => l.address === this.state.cursor)} />\n\n\t\t\t\t{this.renderContextMenu()}\n\t\t\t\t<DisasmSearch ref={this.searchRef}\n\t\t\t\t\tsearchString={this.state.searchString}\n\t\t\t\t\tsearchNext={this.searchNext}\n\t\t\t\t\tupdateSearchString={this.updateSearchString}\n\t\t\t\t\tinProgress={this.state.searchInProgress}\n\t\t\t\t/>\n\t\t\t\t<BreakpointModal\n\t\t\t\t\tisOpen={this.state.editingBreakpoint !== null || this.state.creatingBreakpoint !== null}\n\t\t\t\t\tonClose={this.closeEditBreakpoint}\n\t\t\t\t\tbreakpoint={this.state.editingBreakpoint}\n\t\t\t\t\tinitialOverrides={this.state.creatingBreakpoint}\n\t\t\t\t/>\n\t\t\t</>\n\t\t);\n\t}\n\n\trenderNotStarted() {\n\t\treturn (\n\t\t\t<div className=\"Disasm--not-started\">\n\t\t\t\tWaiting for a game to start...\n\t\t\t</div>\n\t\t);\n\t}\n\n\trenderContextMenu() {\n\t\treturn <DisasmContextMenu\n\t\t\tgetSelectedLines={this.getSelectedLines}\n\t\t\tgetSelectedDisasm={this.getSelectedDisasm}\n\t\t\tfollowBranch={this.followBranch}\n\t\t\tassembleInstruction={this.assembleInstruction}\n\t\t\ttoggleBreakpoint={this.toggleBreakpoint}\n\t\t/>;\n\t}\n\n\tupdateCursor = (cursor) => {\n\t\tif (this.state.cursor !== cursor) {\n\t\t\tthis.needsScroll = 'nearest';\n\t\t\tthis.setState({ cursor });\n\n\t\t\tthis.updatesSequence = this.updatesSequence.then(() => {\n\t\t\t\tif (this.updatesCancel) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tlet { start, end } = this.state.range;\n\t\t\t\tconst minBuffer = Math.max(MIN_BUFFER, this.state.visibleLines);\n\t\t\t\tconst maxBuffer = Math.max(MAX_BUFFER, this.state.visibleLines * 5);\n\n\t\t\t\t// This is here for keyboard scrolling, mainly.\n\t\t\t\tif (cursor - minBuffer * 4 < start) {\n\t\t\t\t\tstart = cursor - minBuffer * 2 * 4;\n\t\t\t\t} else if (cursor - maxBuffer * 4 > start) {\n\t\t\t\t\tstart = cursor - (maxBuffer - minBuffer) * 4;\n\t\t\t\t}\n\t\t\t\tif (cursor + minBuffer * 4 > end) {\n\t\t\t\t\tend = cursor + minBuffer * 2 * 4;\n\t\t\t\t} else if (cursor + maxBuffer * 4 < end) {\n\t\t\t\t\tend = cursor + (maxBuffer - minBuffer) * 4;\n\t\t\t\t}\n\n\t\t\t\tif (start !== this.state.range.start || end !== this.state.range.end) {\n\t\t\t\t\treturn this.updateDisasmNow('nearest', { address: start, end });\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t});\n\t\t}\n\t}\n\n\tgetSelectedLines = () => {\n\t\tconst { selectionTop, selectionBottom } = this.props;\n\t\tconst isSelected = line => line.address + line.addressSize > selectionTop && line.address <= selectionBottom;\n\t\treturn this.state.lines.filter(isSelected);\n\t}\n\n\tgetSelectedDisasm = () => {\n\t\tconst lines = this.getSelectedLines();\n\n\t\t// Gather all branch targets without labels.\n\t\tlet branchAddresses = {};\n\t\tconst unlabeledBranches = lines.map(l => l.branch).filter(b => b && !b.symbol && b.targetAddress);\n\t\tfor (const b of unlabeledBranches) {\n\t\t\tbranchAddresses[b.targetAddress] = 'pos_' + toString08X(b.targetAddress);\n\t\t}\n\n\t\tlet result = '';\n\t\tlet firstLine = true;\n\t\tfor (const l of lines) {\n\t\t\tconst label = l.symbol || branchAddresses[l.address];\n\t\t\tif (label) {\n\t\t\t\tif (!firstLine) {\n\t\t\t\t\tresult += '\\n';\n\t\t\t\t}\n\t\t\t\tresult += label + ':\\n\\n';\n\t\t\t}\n\n\t\t\tresult += '\\t' + l.name + ' ';\n\t\t\tif (l.branch && l.branch.targetAddress && !l.branch.symbol) {\n\t\t\t\t// Use the generated label.\n\t\t\t\tresult += l.params.replace(/0x[0-9A-f]+/, branchAddresses[l.branch.targetAddress]);\n\t\t\t} else {\n\t\t\t\tresult += l.params;\n\t\t\t}\n\t\t\tresult += '\\n';\n\n\t\t\tfirstLine = false;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tupdateDisplaySymbols = (flag) => {\n\t\tthis.setState({ wantDisplaySymbols: flag });\n\t}\n\n\tfollowBranch = (direction, line) => {\n\t\tif (direction) {\n\t\t\tlet target = line.branch && line.branch.targetAddress;\n\t\t\tif (target === null) {\n\t\t\t\ttarget = line.relevantData && line.relevantData.address;\n\t\t\t}\n\t\t\tif (target !== null) {\n\t\t\t\tthis.jumpStack.push(this.state.cursor);\n\t\t\t\tthis.gotoAddress(target);\n\t\t\t}\n\t\t} else {\n\t\t\tif (this.jumpStack.length !== 0) {\n\t\t\t\tthis.gotoAddress(this.jumpStack.pop());\n\t\t\t} else {\n\t\t\t\tthis.gotoAddress(this.props.pc);\n\t\t\t}\n\t\t}\n\t}\n\n\tassembleInstruction = (line, startCode) => {\n\t\tconst { address } = line;\n\t\tconst code = prompt('Assemble instruction', startCode);\n\t\tif (!code) {\n\t\t\treturn Promise.resolve(null);\n\t\t}\n\n\t\tconst writeInstruction = () => {\n\t\t\treturn this.context.ppsspp.send({\n\t\t\t\tevent: 'memory.assemble',\n\t\t\t\taddress: address,\n\t\t\t\tcode,\n\t\t\t}).then(() => {\n\t\t\t\tif (address === this.state.cursor) {\n\t\t\t\t\t// Okay, move one down so we can fire 'em off.\n\t\t\t\t\tconst lineIndex = this.state.lines.indexOf(line);\n\t\t\t\t\tif (lineIndex < this.state.lines.length - 1) {\n\t\t\t\t\t\tconst nextAddress = this.state.lines[lineIndex + 1].address;\n\t\t\t\t\t\tthis.gotoAddress(nextAddress, 'nearest');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Now, whether we moved or not, also update disasm.\n\t\t\t\tthis.updateDisasm();\n\t\t\t});\n\t\t};\n\n\t\t// Check if this is actually a register assignment.\n\t\tconst assignment = code.split(/\\s*=\\s*(.+)$/, 2);\n\t\tif (assignment.length >= 2) {\n\t\t\treturn this.context.ppsspp.send({\n\t\t\t\tevent: 'cpu.evaluate',\n\t\t\t\tthread: this.context.gameStatus.currentThread,\n\t\t\t\texpression: assignment[1],\n\t\t\t}).then((result) => {\n\t\t\t\treturn this.context.ppsspp.send({\n\t\t\t\t\tevent: 'cpu.setReg',\n\t\t\t\t\tthread: this.context.gameStatus.currentThread,\n\t\t\t\t\tname: assignment[0],\n\t\t\t\t\tvalue: result.uintValue,\n\t\t\t\t});\n\t\t\t}).then(({ uintValue }) => {\n\t\t\t\tthis.context.log('Updated ' + assignment[0] + ' to ' + toString08X(uintValue));\n\t\t\t}, writeInstruction);\n\t\t} else {\n\t\t\treturn writeInstruction();\n\t\t}\n\t}\n\n\ttoggleBreakpoint = (line, keep) => {\n\t\tif (line.breakpoint === null) {\n\t\t\tthis.context.ppsspp.send({\n\t\t\t\tevent: 'cpu.breakpoint.add',\n\t\t\t\taddress: line.address,\n\t\t\t\tenabled: true,\n\t\t\t});\n\t\t} else if (!line.breakpoint.enabled) {\n\t\t\tthis.context.ppsspp.send({\n\t\t\t\tevent: 'cpu.breakpoint.update',\n\t\t\t\taddress: line.breakpoint.address || line.address,\n\t\t\t\tenabled: true,\n\t\t\t});\n\t\t} else if (keep) {\n\t\t\tthis.context.ppsspp.send({\n\t\t\t\tevent: 'cpu.breakpoint.update',\n\t\t\t\taddress: line.breakpoint.address || line.address,\n\t\t\t\tenabled: false,\n\t\t\t});\n\t\t} else {\n\t\t\tif (line.breakpoint.condition !== null) {\n\t\t\t\tif (!window.confirm('This breakpoint has has a condition.\\n\\nAre you sure you want to remove it?')) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.context.ppsspp.send({\n\t\t\t\tevent: 'cpu.breakpoint.remove',\n\t\t\t\taddress: line.breakpoint.address || line.address,\n\t\t\t});\n\t\t}\n\t}\n\n\teditBreakpoint = (line) => {\n\t\t// In case it's actually in the middle of a macro.\n\t\tconst breakpointAddress = line.breakpoint?.address || line.address;\n\t\tthis.context.ppsspp.send({\n\t\t\tevent: 'cpu.breakpoint.list',\n\t\t\taddress: breakpointAddress,\n\t\t\tenabled: true,\n\t\t}).then(({ breakpoints }) => {\n\t\t\tconst bp = breakpoints.find(bp => bp.address === breakpointAddress);\n\t\t\tif (bp) {\n\t\t\t\tconst editingBreakpoint = { ...bp, type: 'execute' };\n\t\t\t\tthis.setState({ editingBreakpoint });\n\t\t\t} else {\n\t\t\t\tconst creatingBreakpoint = { address: breakpointAddress, type: 'execute' };\n\t\t\t\tthis.setState({ creatingBreakpoint });\n\t\t\t}\n\t\t});\n\t}\n\n\tcloseEditBreakpoint = () => {\n\t\tthis.setState({ editingBreakpoint: null, creatingBreakpoint: null });\n\t}\n\n\tgotoAddress = (addr, snap = 'center') => {\n\t\tthis.needsScroll = snap;\n\t\tthis.props.updateSelection({\n\t\t\tselectionTop: addr,\n\t\t\tselectionBottom: addr,\n\t\t});\n\t}\n\n\tsearchDisasm = (cont) => {\n\t\tconst continueLast = cont && this.lastSearch !== null;\n\t\tconst { cursor, searchString } = this.state;\n\t\tif (!continueLast && !searchString) {\n\t\t\t// Prompt for a term so we can even do this.\n\t\t\tthis.searchPrompt();\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.state.searchInProgress) {\n\t\t\tif (continueLast) {\n\t\t\t\t// Already doing that, silly.\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.searchCancel();\n\t\t}\n\n\t\tif (!continueLast) {\n\t\t\tthis.lastSearch = {\n\t\t\t\tmatch: searchString,\n\t\t\t\tend: cursor,\n\t\t\t\tlast: null,\n\t\t\t};\n\t\t}\n\n\t\t// Set a new object so we can detect cancel uniquely.\n\t\tconst cancelState = { cancel: false };\n\t\tthis.lastSearch.cancelState = cancelState;\n\t\tthis.setState({ searchInProgress: true });\n\n\t\tconst { match, end, last } = this.lastSearch;\n\t\tthis.context.ppsspp.send({\n\t\t\tevent: 'memory.searchDisasm',\n\t\t\taddress: cursor === last ? cursor + 4 : cursor,\n\t\t\tend,\n\t\t\tmatch,\n\t\t}).then(({ address }) => {\n\t\t\tif (cancelState.cancel) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this.lastSearch) {\n\t\t\t\tthis.lastSearch.last = address;\n\t\t\t}\n\n\t\t\tif (address !== null) {\n\t\t\t\tthis.gotoAddress(address);\n\t\t\t} else if (cursor !== end) {\n\t\t\t\twindow.alert('Reached the starting point of the search');\n\t\t\t\tthis.gotoAddress(end);\n\t\t\t} else {\n\t\t\t\twindow.alert('The specified text was not found:\\n\\n' + match);\n\t\t\t}\n\t\t}).finally(() => {\n\t\t\tif (!cancelState.cancel) {\n\t\t\t\tthis.setState({ searchInProgress: false });\n\t\t\t\tif (this.lastSearch) {\n\t\t\t\t\tthis.lastSearch.cancelState = null;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tupdateSearchString = (match) => {\n\t\tconst highlightText = match ? match.toLowerCase() : null;\n\t\tthis.setState({ highlightText, searchString: match });\n\t\tif (this.lastSearch && this.lastSearch.match !== match) {\n\t\t\t// Clear the search start position when changing the search.\n\t\t\tthis.searchCancel();\n\t\t\tthis.lastSearch = null;\n\t\t}\n\n\t\tif (match === null) {\n\t\t\t// Return focus to list.\n\t\t\tif (this.listRef.current) {\n\t\t\t\tthis.listRef.current.ensureCursorInView(false);\n\t\t\t}\n\t\t}\n\t}\n\n\tsearchPrompt = () => {\n\t\tthis.updateSearchString(this.state.searchString || (this.lastSearch ? this.lastSearch.match : ''));\n\t\tthis.searchRef.current.focus();\n\t}\n\n\tsearchNext = () => {\n\t\tthis.searchDisasm(true);\n\t}\n\n\tsearchCancel = () => {\n\t\tif (this.lastSearch && this.lastSearch.cancelState) {\n\t\t\tthis.lastSearch.cancelState.cancel = true;\n\t\t\tthis.setState({ searchInProgress: false });\n\t\t\tthis.lastSearch.cancelState = null;\n\t\t}\n\t}\n\n\tgetSnapshotBeforeUpdate(prevProps, prevState) {\n\t\tif (this.needsOffsetFix && this.listRef.current && this.state.lines.length !== 0) {\n\t\t\tconst { lines } = this.state;\n\t\t\tconst centerAddress = lines[Math.floor(lines.length / 2)].address;\n\t\t\tconst top = this.listRef.current.addressBoundingTop(centerAddress);\n\t\t\tif (top) {\n\t\t\t\treturn { top, centerAddress };\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.listeners_ = listeners.listen({\n\t\t\t'connection': () => {\n\t\t\t\tif (this.context.gameStatus.started) {\n\t\t\t\t\tthis.updateDisasm('center');\n\t\t\t\t}\n\t\t\t},\n\t\t\t'cpu.stepping': () => {\n\t\t\t\tconst hasRange = this.state.range.start !== 0 || this.state.range.end !== 0;\n\t\t\t\tthis.updateDisasm(hasRange ? 'nearest' : 'center');\n\t\t\t},\n\t\t\t'cpu.setReg': (result) => {\n\t\t\t\t// Need to re-render if pc is changed.\n\t\t\t\tif (result.category === 0 && result.register === 32) {\n\t\t\t\t\tthis.updateDisasm('center');\n\t\t\t\t}\n\t\t\t},\n\t\t\t'cpu.breakpoint.add': () => {\n\t\t\t\tthis.updateDisasm();\n\t\t\t},\n\t\t\t'cpu.breakpoint.update': () => {\n\t\t\t\tthis.updateDisasm();\n\t\t\t},\n\t\t\t'cpu.breakpoint.remove': () => {\n\t\t\t\tthis.updateDisasm();\n\t\t\t},\n\t\t});\n\t\tthis.updatesCancel = false;\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis.searchCancel();\n\t\tthis.updatesCancel = true;\n\t\tlisteners.forget(this.listeners_);\n\t}\n\n\tcomponentDidUpdate(prevProps, prevState, snapshot) {\n\t\tconst { selectionTop, selectionBottom } = this.props;\n\t\tconst { range, lineHeight } = this.state;\n\n\t\tlet disasmChange = null, updateDisasmRange = null;\n\t\tif (this.state.wantDisplaySymbols !== prevState.wantDisplaySymbols) {\n\t\t\t// Keep the existing range, just update.\n\t\t\tdisasmChange = false;\n\t\t}\n\t\tif (this.props.currentThread !== prevProps.currentThread) {\n\t\t\tdisasmChange = false;\n\t\t}\n\t\tif (selectionTop !== prevProps.selectionTop || selectionBottom !== prevProps.selectionBottom) {\n\t\t\tif (selectionTop < range.start || selectionBottom >= range.end) {\n\t\t\t\tdisasmChange = 'center';\n\t\t\t\tupdateDisasmRange = true;\n\t\t\t}\n\t\t}\n\t\tif (!disasmChange && !prevProps.setInitialPC && this.props.setInitialPC) {\n\t\t\tdisasmChange = 'center';\n\t\t\tupdateDisasmRange = true;\n\t\t}\n\t\tif (disasmChange !== null && this.props.setInitialPC) {\n\t\t\tthis.updateDisasm(disasmChange, updateDisasmRange);\n\t\t}\n\n\t\tif (lineHeight === 0) {\n\t\t\tconst foundLine = document.querySelector('.DisasmLine');\n\t\t\tif (foundLine) {\n\t\t\t\t// Defer for other updates.\n\t\t\t\tsetTimeout(() => this.setState({ lineHeight: foundLine.getBoundingClientRect().height }), 0);\n\t\t\t}\n\t\t} else if (this.ref.current) {\n\t\t\tconst visibleLines = Math.floor(this.ref.current.clientHeight / lineHeight);\n\t\t\tif (visibleLines !== this.state.visibleLines) {\n\t\t\t\tthis.setState({ visibleLines });\n\t\t\t}\n\t\t}\n\n\t\tif (this.props.jumpMarker !== prevProps.jumpMarker) {\n\t\t\tthis.needsScroll = 'center';\n\t\t}\n\t\t// Always associated with a state update.\n\t\tif (this.needsScroll && this.listRef.current) {\n\t\t\tconst list = this.listRef.current;\n\t\t\tsetTimeout(() => {\n\t\t\t\tlist.ensureCursorInView(this.needsScroll);\n\t\t\t\tthis.needsScroll = false;\n\t\t\t}, 0);\n\t\t}\n\n\t\tif (snapshot && this.listRef.current) {\n\t\t\tconst top = this.listRef.current.addressBoundingTop(snapshot.centerAddress);\n\t\t\tthis.ref.current.scrollTop -= snapshot.top - top;\n\t\t\tthis.needsOffsetFix = false;\n\t\t}\n\t}\n\n\tupdateDisasm(needsScroll, newRange) {\n\t\tthis.updatesSequence = this.updatesSequence.then(() => {\n\t\t\tif (this.updatesCancel) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\treturn this.updateDisasmNow(needsScroll, newRange);\n\t\t});\n\t}\n\n\tupdateDisasmNow(needsScroll, newRange = null) {\n\t\tif (!this.props.setInitialPC) {\n\t\t\treturn Promise.resolve(null);\n\t\t}\n\n\t\tconst { range, visibleLines, wantDisplaySymbols: displaySymbols } = this.state;\n\t\tlet updateRange = newRange;\n\t\tif (newRange === true || (newRange === null && range.start === 0 && range.end === 0)) {\n\t\t\tconst minBuffer = Math.max(MIN_BUFFER, visibleLines);\n\t\t\tconst defaultBuffer = Math.floor(minBuffer * 1.5);\n\t\t\tupdateRange = {\n\t\t\t\taddress: this.props.selectionTop - defaultBuffer * 4,\n\t\t\t\tcount: defaultBuffer * 2,\n\t\t\t};\n\t\t} else if (newRange === null) {\n\t\t\tupdateRange = {\n\t\t\t\taddress: range.start,\n\t\t\t\tend: range.end,\n\t\t\t};\n\t\t}\n\n\t\treturn Promise.resolve(null).then(() => {\n\t\t\treturn this.context.ppsspp.send({\n\t\t\t\tevent: 'memory.disasm',\n\t\t\t\tthread: this.context.gameStatus.currentThread,\n\t\t\t\t...updateRange,\n\t\t\t\tdisplaySymbols,\n\t\t\t}).then((data) => {\n\t\t\t\tif (this.updatesCancel) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst { range, branchGuides, lines } = data;\n\t\t\t\tif (needsScroll) {\n\t\t\t\t\tthis.needsScroll = needsScroll;\n\t\t\t\t} else {\n\t\t\t\t\tthis.needsOffsetFix = true;\n\t\t\t\t}\n\t\t\t\tthis.setState({\n\t\t\t\t\trange,\n\t\t\t\t\tbranchGuides: this.cleanupBranchGuides(branchGuides),\n\t\t\t\t\tlines,\n\t\t\t\t\tdisplaySymbols,\n\t\t\t\t});\n\t\t\t}, (err) => {\n\t\t\t\tif (!this.updatesCancel) {\n\t\t\t\t\tthis.setState({\n\t\t\t\t\t\trange: { start: 0, end: 0 },\n\t\t\t\t\t\tbranchGuides: [],\n\t\t\t\t\t\tlines: [],\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tcleanupBranchGuides(branchGuides) {\n\t\t// TODO: Temporary (?) workaround for a bug with duplicate branch guides.\n\t\tconst unique = new Map();\n\t\tbranchGuides.forEach((guide) => {\n\t\t\tconst key = String(guide.top) + String(guide.bottom) + guide.direction;\n\t\t\tunique.set(key, guide);\n\t\t});\n\t\treturn [...unique.values()];\n\t}\n\n\tonDoubleClick = (ev, data) => {\n\t\tthis.toggleBreakpoint(data.line);\n\t}\n\n\tapplyScroll = (dist) => {\n\t\tthis.ref.current.scrollTop += dist * this.state.lineHeight;\n\t}\n\n\tonScroll(ev) {\n\t\tthis.updatesSequence = this.updatesSequence.then(() => {\n\t\t\tif (this.updatesCancel) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst { bufferTop, bufferBottom } = this.bufferRange();\n\t\t\tconst minBuffer = Math.max(MIN_BUFFER, this.state.visibleLines);\n\t\t\tconst maxBuffer = Math.max(MAX_BUFFER, this.state.visibleLines * 5);\n\t\t\tlet { start, end } = this.state.range;\n\n\t\t\tif (bufferTop < minBuffer) {\n\t\t\t\tstart -= minBuffer * 4;\n\t\t\t} else if (bufferTop > maxBuffer) {\n\t\t\t\tstart += Math.max(minBuffer, bufferTop - maxBuffer) * 4;\n\t\t\t}\n\n\t\t\tif (bufferBottom < minBuffer) {\n\t\t\t\tend += minBuffer * 4;\n\t\t\t} else if (bufferBottom > maxBuffer) {\n\t\t\t\tend -= Math.max(minBuffer, bufferBottom - maxBuffer) * 4;\n\t\t\t}\n\n\t\t\tif (start !== this.state.range.start || end !== this.state.range.end) {\n\t\t\t\treturn this.updateDisasmNow(false, { address: start, end });\n\t\t\t}\n\t\t\treturn null;\n\t\t});\n\t}\n\n\tbufferRange() {\n\t\tconst { scrollHeight, scrollTop, clientHeight } = this.ref.current;\n\t\tconst bufferTop = scrollTop / this.state.lineHeight;\n\t\tconst bufferBottom = (scrollHeight - scrollTop - clientHeight) / this.state.lineHeight;\n\t\tconst visibleEachDirection = Math.floor((this.state.visibleLines - 1) / 2);\n\n\t\treturn {\n\t\t\tbufferTop: bufferTop + visibleEachDirection,\n\t\t\tbufferBottom: bufferBottom + visibleEachDirection,\n\t\t};\n\t}\n\n\tstatic getDerivedStateFromProps(nextProps, prevState) {\n\t\tconst { selectionTop, selectionBottom } = nextProps;\n\t\tif (prevState.cursor < selectionTop || prevState.cursor > selectionBottom) {\n\t\t\tlet cursor = selectionTop;\n\t\t\tif (prevState.lines.length) {\n\t\t\t\t// Snap to in case we goto an address in the middle\n\t\t\t\tconst line = prevState.lines.find(l => l.address <= selectionTop && l.address + l.addressSize > selectionTop);\n\t\t\t\tcursor = line ? line.address : cursor;\n\t\t\t}\n\t\t\treturn { cursor };\n\t\t}\n\t\treturn null;\n\t}\n}\n\nDisasm.propTypes = {\n\tselectionTop: PropTypes.number,\n\tselectionBottom: PropTypes.number,\n\tpc: PropTypes.number,\n\tsetInitialPC: PropTypes.bool.isRequired,\n\tcurrentThread: PropTypes.number,\n\n\tupdateSelection: PropTypes.func.isRequired,\n\tpromptGoto: PropTypes.func.isRequired,\n};\n\nDisasm.contextType = DebuggerContext;\n\nexport default Disasm;\n","import { PureComponent } from 'react';\nimport DebuggerContext, { DebuggerContextValues } from '../DebuggerContext';\nimport PropTypes from 'prop-types';\nimport BreakpointModal from './BreakpointModal';\nimport listeners from '../../utils/listeners.js';\nimport './DisasmButtons.css';\n\nclass DisasmButtons extends PureComponent {\n\tstate = {\n\t\tbreakpointModalOpen: false,\n\t\tconnected: false,\n\t\tlastThread: '',\n\t\tthreads: [],\n\t};\n\t/**\n\t * @type {DebuggerContextValues}\n\t */\n\tcontext;\n\tlisteners_;\n\n\trender() {\n\t\tconst { started, paused, stepping } = this.context.gameStatus;\n\t\tconst disabled = !started || !stepping || paused;\n\n\t\treturn (\n\t\t\t<div className=\"DisasmButtons\">\n\t\t\t\t<div className=\"DisasmButtons__group DisasmButtons__nav\">\n\t\t\t\t\t<button type=\"button\" onClick={this.props.showNavTray}>Nav</button>\n\t\t\t\t\t<span className=\"DisasmButtons__spacer\"></span>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"DisasmButtons__group\">\n\t\t\t\t\t<button type=\"button\" disabled={!started || paused} onClick={this.handleGoBreak}>\n\t\t\t\t\t\t{stepping || !started ? 'Go' : 'Break'}\n\t\t\t\t\t</button>\n\t\t\t\t\t<span className=\"DisasmButtons__spacer\"></span>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"DisasmButtons__group\">\n\t\t\t\t\t<button type=\"button\" disabled={disabled} onClick={this.handleStepInto}>Step Into</button>\n\t\t\t\t\t<button type=\"button\" disabled={disabled} onClick={this.handleStepOver}>Step Over</button>\n\t\t\t\t\t<button type=\"button\" disabled={disabled} onClick={this.handleStepOut}>Step Out</button>\n\t\t\t\t\t<span className=\"DisasmButtons__spacer\"></span>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"DisasmButtons__group\">\n\t\t\t\t\t<button type=\"button\" disabled={disabled} onClick={this.handleNextHLE}>Next HLE</button>\n\t\t\t\t\t<span className=\"DisasmButtons__spacer\"></span>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"DisasmButtons__group\">\n\t\t\t\t\t<button type=\"button\" onClick={this.handleBreakpointOpen} disabled={!started}>Breakpoint</button>\n\t\t\t\t\t<span className=\"DisasmButtons__spacer\"></span>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"DisasmButtons__group\">\n\t\t\t\t\t<span className=\"DisasmButtons__thread-list\">\n\t\t\t\t\t\tThread: {this.renderThreadList()}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\n\t\t\t\t<BreakpointModal\n\t\t\t\t\tisOpen={this.state.breakpointModalOpen}\n\t\t\t\t\tonClose={this.handleBreakpointClose}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t);\n\t}\n\n\trenderThreadList() {\n\t\tif (this.state.threads.length === 0) {\n\t\t\treturn '(none)';\n\t\t}\n\t\treturn (\n\t\t\t<select onChange={this.handleThreadSelect} value={this.context.gameStatus.currentThread || this.state.lastThread}>\n\t\t\t\t{this.state.threads.map(thread => this.renderThread(thread))}\n\t\t\t</select>\n\t\t);\n\t}\n\n\trenderThread(thread) {\n\t\tconst classes = 'DisasmButtons__thread' + (thread.isCurrent ? ' DisasmButtons__thread--current' : '');\n\t\treturn (\n\t\t\t<option key={thread.id} value={thread.id} className={classes}>\n\t\t\t\t{thread.name}{thread.isCurrent ? ' (current)' : ''}\n\t\t\t</option>\n\t\t);\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.listeners_ = listeners.listen({\n\t\t\t'connection.change': (connected) => this.setState({ connected }),\n\t\t\t'cpu.stepping': () => this.updateThreadList(true),\n\t\t});\n\t}\n\n\tcomponentWillUnmount() {\n\t\tlisteners.forget(this.listeners_);\n\t}\n\n\tcomponentDidUpdate(prevProps, prevState) {\n\t\tif (!prevState.connected && this.state.connected) {\n\t\t\tthis.updateThreadList(this.context.gameStatus.currentThread === undefined);\n\t\t}\n\t}\n\n\tupdateThreadList(resetCurrentThread) {\n\t\tif (!this.state.connected) {\n\t\t\t// This avoids a duplicate update during initial connect.\n\t\t\treturn;\n\t\t}\n\n\t\tthis.context.ppsspp.send({\n\t\t\tevent: 'hle.thread.list',\n\t\t}).then(({ threads }) => {\n\t\t\tthis.setState({ threads });\n\t\t\tif (resetCurrentThread) {\n\t\t\t\tconst currentThread = threads.find(th => th.isCurrent);\n\t\t\t\tif (currentThread && currentThread.id !== this.context.gameStatus.currentThread) {\n\t\t\t\t\tthis.props.updateCurrentThread(currentThread.id);\n\t\t\t\t}\n\t\t\t}\n\t\t}, () => {\n\t\t\tthis.setState({ threads: [] });\n\t\t});\n\t}\n\n\thandleGoBreak = () => {\n\t\tif (this.context.gameStatus.stepping) {\n\t\t\tthis.props.updateCurrentThread(undefined);\n\t\t}\n\t\tthis.context.ppsspp.send({\n\t\t\tevent: this.context.gameStatus.stepping ? 'cpu.resume' : 'cpu.stepping',\n\t\t}).catch(() => {\n\t\t\t// Already logged, let's assume the parent will have marked it disconnected/not started by now.\n\t\t});\n\t}\n\n\thandleStepInto = () => {\n\t\tthis.props.updateCurrentThread(undefined);\n\t\tthis.context.ppsspp.send({\n\t\t\tevent: 'cpu.stepInto',\n\t\t\tthread: this.context.gameStatus.currentThread,\n\t\t}).catch(() => {\n\t\t\t// Already logged, let's assume the parent will have marked it disconnected/not started by now.\n\t\t});\n\t}\n\n\thandleStepOver = () => {\n\t\tthis.props.updateCurrentThread(undefined);\n\t\tthis.context.ppsspp.send({\n\t\t\tevent: 'cpu.stepOver',\n\t\t\tthread: this.context.gameStatus.currentThread,\n\t\t}).catch(() => {\n\t\t\t// Already logged, let's assume the parent will have marked it disconnected/not started by now.\n\t\t});\n\t}\n\n\thandleStepOut = () => {\n\t\tconst threadID = this.context.gameStatus.currentThread;\n\t\tthis.props.updateCurrentThread(undefined);\n\t\tthis.context.ppsspp.send({\n\t\t\tevent: 'cpu.stepOut',\n\t\t\tthread: this.context.gameStatus.currentThread,\n\t\t}).catch(() => {\n\t\t\t// This might fail if they aren't inside a function call on this thread, so restore the thread.\n\t\t\tthis.props.updateCurrentThread(threadID);\n\t\t});\n\t}\n\n\thandleNextHLE = () => {\n\t\tthis.props.updateCurrentThread(undefined);\n\t\tthis.context.ppsspp.send({\n\t\t\tevent: 'cpu.nextHLE',\n\t\t}).catch(() => {\n\t\t\t// Already logged, let's assume the parent will have marked it disconnected/not started by now.\n\t\t});\n\t}\n\n\thandleThreadSelect = (ev) => {\n\t\tconst currentThread = this.state.threads.find(th => th.id === Number(ev.target.value));\n\t\tif (currentThread) {\n\t\t\tthis.props.updateCurrentThread(currentThread.id, currentThread.pc);\n\t\t}\n\t}\n\n\thandleBreakpointOpen = () => {\n\t\tthis.setState({ breakpointModalOpen: true });\n\t}\n\n\thandleBreakpointClose = () => {\n\t\tthis.setState({ breakpointModalOpen: false });\n\t}\n\n\tstatic getDerivedStateFromProps(nextProps, prevState) {\n\t\tlet update = null;\n\t\tif (nextProps.currentThread && nextProps.currentThread !== prevState.lastThread) {\n\t\t\tupdate = { ...update, lastThread: nextProps.currentThread || '' };\n\t\t}\n\t\tif (nextProps.stepping || nextProps.started) {\n\t\t\tupdate = { ...update, connected: true };\n\t\t}\n\t\tif (!nextProps.started && prevState.threads.length) {\n\t\t\tupdate = { ...update, threads: [] };\n\t\t}\n\t\treturn update;\n\t}\n}\n\nDisasmButtons.propTypes = {\n\tstarted: PropTypes.bool.isRequired,\n\tstepping: PropTypes.bool.isRequired,\n\tcurrentThread: PropTypes.number,\n\tshowNavTray: PropTypes.func.isRequired,\n\n\tupdateCurrentThread: PropTypes.func.isRequired,\n};\n\nDisasmButtons.contextType = DebuggerContext;\n\nexport default DisasmButtons;\n","import { createRef, PureComponent } from 'react';\nimport DebuggerContext, { DebuggerContextValues } from '../DebuggerContext';\nimport PropTypes from 'prop-types';\nimport './GotoBox.css';\n\nclass GotoBox extends PureComponent {\n\tstate = {\n\t\taddress: '',\n\t};\n\t/**\n\t * @type {DebuggerContextValues}\n\t */\n\tcontext;\n\tref;\n\tid;\n\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.ref = createRef();\n\t\tthis.id = 'GotoBox__address--' + Math.random().toString(36).substr(2, 9);\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<form action=\"#\" className=\"GotoBox\" onSubmit={this.handleSubmit}>\n\t\t\t\t<label className=\"GotoBox__label\" htmlFor={this.id}>Go to:</label>\n\t\t\t\t<input ref={this.ref}\n\t\t\t\t\ttype=\"text\" id={this.id}\n\t\t\t\t\tclassName=\"GotoBox__address\"\n\t\t\t\t\tvalue={this.state.address} onChange={this.handleChange}\n\t\t\t\t\ttitle=\"Hexadecimal address or expression, enter to submit\"\n\t\t\t\t\tautoComplete=\"off\"\n\t\t\t\t/>\n\t\t\t\t{this.renderPCButtons()}\n\t\t\t</form>\n\t\t);\n\t}\n\n\trenderPCButtons() {\n\t\tif (!this.includePC) {\n\t\t\treturn null;\n\t\t}\n\t\tconst disabled = !this.context.gameStatus.started;\n\t\treturn (\n\t\t\t<>\n\t\t\t\t<button type=\"button\" className=\"GotoBox__button\" onClick={this.handlePC} disabled={disabled}>PC</button>\n\t\t\t\t<button type=\"button\" className=\"GotoBox__button\" onClick={this.handleRA} disabled={disabled}>RA</button>\n\t\t\t</>\n\t\t);\n\t}\n\n\tcomponentDidUpdate(prevProps, prevState) {\n\t\tif (this.props.promptGotoMarker !== prevProps.promptGotoMarker) {\n\t\t\tthis.ref.current.focus();\n\t\t\tthis.ref.current.select();\n\t\t}\n\t}\n\n\tjumpToReg(name) {\n\t\tthis.context.ppsspp.send({\n\t\t\tevent: 'cpu.getReg',\n\t\t\tname,\n\t\t}).then((result) => {\n\t\t\tif (this.context.gameStatus.started) {\n\t\t\t\tthis.props.gotoAddress(result.uintValue);\n\t\t\t}\n\t\t});\n\t}\n\n\thandleChange = (ev) => {\n\t\tthis.setState({ address: ev.target.value });\n\t}\n\n\thandleSubmit = (ev) => {\n\t\tif (this.context.gameStatus.started) {\n\t\t\tthis.context.ppsspp.send({\n\t\t\t\tevent: 'cpu.evaluate',\n\t\t\t\tthread: this.context.gameStatus.currentThread,\n\t\t\t\texpression: this.state.address,\n\t\t\t}).then(({ uintValue }) => {\n\t\t\t\tif (this.context.gameStatus.started) {\n\t\t\t\t\tthis.props.gotoAddress(uintValue);\n\t\t\t\t}\n\t\t\t}, err => {\n\t\t\t\t// Probably a bad reference.\n\t\t\t\tthis.ref.current.focus();\n\t\t\t\tthis.ref.current.select();\n\t\t\t});\n\t\t}\n\t\tev.preventDefault();\n\t}\n\n\thandlePC = (ev) => {\n\t\tthis.jumpToReg('pc');\n\t}\n\n\thandleRA = (ev) => {\n\t\tthis.jumpToReg('ra');\n\t}\n}\n\nGotoBox.propTypes = {\n\tincludePC: PropTypes.bool.isRequired,\n\tpromptGotoMarker: PropTypes.any,\n\tgotoAddress: PropTypes.func.isRequired,\n};\n\nGotoBox.contextType = DebuggerContext;\n\nexport default GotoBox;\n","import { PureComponent } from 'react';\nimport DebuggerContext, { DebuggerContextValues } from '../DebuggerContext';\nimport PropTypes from 'prop-types';\nimport { AutoSizer, List } from 'react-virtualized';\nimport listeners from '../../utils/listeners.js';\nimport 'react-virtualized/styles.css';\nimport './FuncList.css';\n\nclass FuncList extends PureComponent {\n\tstate = {\n\t\tconnected: false,\n\t\t// Lots of functions can take a while...\n\t\tloading: true,\n\t\trowHeight: null,\n\t\tfunctions: [],\n\t\tfilter: '',\n\t\tfilteredFunctions: [],\n\t};\n\t/**\n\t * @type {DebuggerContextValues}\n\t */\n\tcontext;\n\tlisteners_;\n\n\trender() {\n\t\tconst { filter } = this.state;\n\t\treturn (\n\t\t\t<div className=\"FuncList\">\n\t\t\t\t<input type=\"search\" className=\"FuncList__search\" value={filter} onChange={this.handleFilter} />\n\t\t\t\t{this.renderList()}\n\t\t\t</div>\n\t\t);\n\t}\n\n\trenderList() {\n\t\tconst { filter, loading, rowHeight } = this.state;\n\t\tif (loading || !rowHeight) {\n\t\t\treturn <div className=\"FuncList__loading\">Loading...</div>;\n\t\t}\n\n\t\treturn (\n\t\t\t<div className=\"FuncList__listing\" onClick={this.handleClick}>\n\t\t\t\t<AutoSizer filter={filter}>{this.renderSizedList}</AutoSizer>\n\t\t\t</div>\n\t\t);\n\t}\n\n\trenderSizedList = ({ height, width }) => {\n\t\tconst { filter, filteredFunctions, rowHeight } = this.state;\n\t\treturn (\n\t\t\t<List\n\t\t\t\theight={height}\n\t\t\t\trowHeight={rowHeight}\n\t\t\t\trowRenderer={this.renderFunc}\n\t\t\t\twidth={width}\n\t\t\t\trowCount={filteredFunctions.length}\n\t\t\t\tfilter={filter}\n\t\t\t/>\n\t\t);\n\t}\n\n\trenderFunc = ({ index, key, style }) => {\n\t\tconst func = this.state.filteredFunctions[index];\n\t\treturn (\n\t\t\t<div key={key + '-' + func.address} style={style}>\n\t\t\t\t<button type=\"button\" data-address={func.address}>{func.name}</button>\n\t\t\t</div>\n\t\t);\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.listeners_ = listeners.listen({\n\t\t\t'connection.change': (connected) => this.setState({ connected }),\n\t\t\t'game.start': () => this.updateList(),\n\t\t});\n\t\tif (this.state.connected) {\n\t\t\tthis.updateList();\n\t\t}\n\t\tif (!this.state.rowHeight) {\n\t\t\tsetTimeout(() => this.measureHeight(), 0);\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tlisteners.forget(this.listeners_);\n\t}\n\n\tcomponentDidUpdate(prevProps, prevState) {\n\t\tif (!prevState.connected && this.state.connected) {\n\t\t\tthis.updateList();\n\t\t}\n\t\tif (!this.state.rowHeight) {\n\t\t\tsetTimeout(() => this.measureHeight(), 0);\n\t\t}\n\t}\n\n\tmeasureHeight() {\n\t\tconst node = document.querySelector('.FuncList__loading');\n\t\tif (node) {\n\t\t\tconst rowHeight = node.getBoundingClientRect().height;\n\t\t\tthis.setState({ rowHeight });\n\t\t}\n\t}\n\n\tupdateList() {\n\t\tif (!this.state.connected) {\n\t\t\t// This avoids a duplicate update during initial connect.\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.state.loading && this.state.functions.length === 0) {\n\t\t\tthis.setState({ loading: true });\n\t\t}\n\n\t\tthis.context.ppsspp.send({\n\t\t\tevent: 'hle.func.list',\n\t\t}).then(({ functions }) => {\n\t\t\tfunctions.sort((a, b) => a.name.localeCompare(b.name));\n\t\t\tconst filteredFunctions = this.applyFilter(functions, this.state.filter);\n\t\t\tthis.setState({ functions, filteredFunctions, loading: false });\n\t\t}, () => {\n\t\t\tthis.setState({ functions: [], filteredFunctions: [], loading: false });\n\t\t});\n\t}\n\n\tapplyFilter(functions, filter) {\n\t\tif (filter === '') {\n\t\t\treturn functions;\n\t\t}\n\t\tconst match = filter.toLowerCase();\n\t\treturn functions.filter(func => func.name.toLowerCase().indexOf(match) !== -1);\n\t}\n\n\thandleFilter = (ev) => {\n\t\tconst filter = ev.target.value;\n\t\tconst filteredFunctions = this.applyFilter(this.state.functions, filter);\n\t\tthis.setState({ filter, filteredFunctions });\n\t}\n\n\thandleClick = (ev) => {\n\t\tconst { address } = ev.target.dataset;\n\t\tthis.props.gotoDisasm(Number(address));\n\t\tev.preventDefault();\n\t}\n\n\tstatic getDerivedStateFromProps(nextProps, prevState) {\n\t\tlet update = null;\n\t\tif (nextProps.started) {\n\t\t\tupdate = { ...update, connected: true };\n\t\t}\n\t\tif (!nextProps.started && prevState.functions.length) {\n\t\t\tupdate = { ...update, functions: [], filteredFunctions: [] };\n\t\t}\n\t\treturn update;\n\t}\n}\n\nFuncList.propTypes = {\n\tstarted: PropTypes.bool,\n\tgotoDisasm: PropTypes.func.isRequired,\n};\n\nFuncList.contextType = DebuggerContext;\n\nexport default FuncList;\n","import { createRef, PureComponent } from 'react';\nimport PropTypes from 'prop-types';\nimport { ContextMenuTrigger } from 'react-contextmenu';\nimport { toString08X } from '../../utils/format';\nimport { ensureInView, hasContextMenu } from '../../utils/dom';\nimport classNames from 'clsx';\n\nclass RegList extends PureComponent {\n\tstate = {\n\t\tcursor: 0,\n\t};\n\tcursorRef;\n\tneedsScroll = false;\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.cursorRef = createRef();\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<dl>\n\t\t\t\t{this.props.registerNames.map((name, reg) => {\n\t\t\t\t\treturn this.renderReg(name, reg);\n\t\t\t\t})}\n\t\t\t</dl>\n\t\t);\n\t}\n\n\trenderReg(name, reg) {\n\t\tconst mapData = (props) => {\n\t\t\treturn { cat: this.props.id, reg, value: this.format(reg) };\n\t\t};\n\t\tconst attributes = {\n\t\t\tonDoubleClick: (ev) => this.onDoubleClick(ev, mapData()),\n\t\t\tonMouseDown: (ev) => this.setState({ cursor: reg }),\n\t\t\tonKeyDown: (ev) => this.onKeyDown(ev),\n\t\t\ttabIndex: 0,\n\t\t};\n\t\tconst ddClasses = {\n\t\t\t'RegPanel__item--changed': this.changed(reg),\n\t\t\t'RegPanel__item--selected': this.state.cursor === reg,\n\t\t};\n\t\tconst ref = this.state.cursor === reg ? this.cursorRef : undefined;\n\n\t\treturn (\n\t\t\t<ContextMenuTrigger id={this.props.contextmenu} renderTag=\"a\" attributes={attributes} collect={mapData} holdToDisplay={-1} key={reg}>\n\t\t\t\t<dt>{name}</dt>\n\t\t\t\t<dd className={classNames(ddClasses)} ref={ref}>\n\t\t\t\t\t{this.format(reg)}\n\t\t\t\t</dd>\n\t\t\t</ContextMenuTrigger>\n\t\t);\n\t}\n\n\tformat(reg) {\n\t\tif (this.props.id === 0) {\n\t\t\treturn toString08X(this.props.uintValues[reg]);\n\t\t} else {\n\t\t\treturn this.props.floatValues[reg];\n\t\t}\n\t}\n\n\tchanged(reg) {\n\t\treturn this.props.uintValues[reg] !== this.props.uintValuesLast[reg];\n\t}\n\n\tcomponentDidUpdate(prevProps, prevState) {\n\t\t// Always associated with a state update.\n\t\tif (this.needsScroll && this.cursorRef.current) {\n\t\t\tconst triggerNode = this.cursorRef.current.parentNode;\n\t\t\tensureInView(triggerNode, { block: 'nearest' });\n\t\t\ttriggerNode.focus();\n\t\t\tthis.needsScroll = false;\n\t\t}\n\t}\n\n\tonDoubleClick = (ev, data) => {\n\t\tif (ev.button === 0) {\n\t\t\tthis.props.onDoubleClick(ev, data);\n\t\t}\n\t}\n\n\tonKeyDown(ev) {\n\t\tif (hasContextMenu()) {\n\t\t\treturn;\n\t\t}\n\t\tif (ev.key === 'ArrowUp' && this.state.cursor > 0) {\n\t\t\tthis.needsScroll = true;\n\t\t\tthis.setState({ cursor: this.state.cursor - 1 });\n\t\t\tev.preventDefault();\n\t\t}\n\t\tif (ev.key === 'ArrowDown' && this.state.cursor < this.props.registerNames.length - 1) {\n\t\t\tthis.needsScroll = true;\n\t\t\tthis.setState({ cursor: this.state.cursor + 1 });\n\t\t\tev.preventDefault();\n\t\t}\n\t}\n}\n\nRegList.propTypes = {\n\tid: PropTypes.number.isRequired,\n\tcontextmenu: PropTypes.string.isRequired,\n\tonDoubleClick: PropTypes.func.isRequired,\n\tregisterNames: PropTypes.arrayOf(PropTypes.string).isRequired,\n\tuintValues: PropTypes.arrayOf(PropTypes.number).isRequired,\n\tfloatValues: PropTypes.arrayOf(PropTypes.string).isRequired,\n\tuintValuesLast: PropTypes.arrayOf(PropTypes.number).isRequired,\n\tfloatValuesLast: PropTypes.arrayOf(PropTypes.string).isRequired,\n};\n\nexport default RegList;\n","import { PureComponent } from 'react';\nimport DebuggerContext, { DebuggerContextValues } from '../DebuggerContext';\nimport PropTypes from 'prop-types';\nimport { ContextMenu, MenuItem } from 'react-contextmenu';\nimport { Tab, Tabs, TabList, TabPanel } from 'react-tabs';\nimport RegList from './RegList';\nimport listeners from '../../utils/listeners.js';\nimport { copyText } from '../../utils/clipboard';\nimport './RegPanel.css';\nimport '../ext/react-contextmenu.css';\nimport '../ext/react-tabs.css';\n\nclass RegPanel extends PureComponent {\n\tstate = {\n\t\tcategories: [],\n\t};\n\t/**\n\t * @type {DebuggerContextValues}\n\t */\n\tcontext;\n\n\trender() {\n\t\treturn (\n\t\t\t<div id=\"RegPanel\">\n\t\t\t\t{this.renderTabs()}\n\t\t\t\t{this.renderContextMenu()}\n\t\t\t</div>\n\t\t);\n\t}\n\n\trenderTabs() {\n\t\tconst { categories } = this.state;\n\t\t// Seems react-tabs is buggy when tabs are initially empty.\n\t\tif (categories.length === 0) {\n\t\t\treturn '';\n\t\t}\n\n\t\treturn (\n\t\t\t<Tabs>\n\t\t\t\t<TabList>\n\t\t\t\t\t{categories.map(c => <Tab key={c.id}>{c.name}</Tab>)}\n\t\t\t\t</TabList>\n\t\t\t\t{categories.map(c => (\n\t\t\t\t\t<TabPanel key={c.id}>\n\t\t\t\t\t\t<RegList contextmenu=\"reglist\" onDoubleClick={this.handleChangeReg} {...c} />\n\t\t\t\t\t</TabPanel>\n\t\t\t\t))}\n\t\t\t</Tabs>\n\t\t);\n\t}\n\n\trenderContextMenu() {\n\t\tconst disabled = !this.context.gameStatus.stepping;\n\t\treturn (\n\t\t\t<ContextMenu id=\"reglist\">\n\t\t\t\t<MenuItem onClick={this.handleViewMemory}>\n\t\t\t\t\tGo to in Memory View\n\t\t\t\t</MenuItem>\n\t\t\t\t<MenuItem onClick={this.handleViewDisassembly}>\n\t\t\t\t\tGo to in Disassembly\n\t\t\t\t</MenuItem>\n\t\t\t\t<MenuItem divider />\n\t\t\t\t<MenuItem onClick={this.handleCopyReg}>\n\t\t\t\t\tCopy Value\n\t\t\t\t</MenuItem>\n\t\t\t\t<MenuItem disabled={disabled} onClick={this.handleChangeReg}>\n\t\t\t\t\tChange...\n\t\t\t\t</MenuItem>\n\t\t\t</ContextMenu>\n\t\t);\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.listeners_ = listeners.listen({\n\t\t\t'connection': () => this.updateRegs(false),\n\t\t\t'cpu.stepping': () => this.updateRegs(false),\n\t\t\t'cpu.setReg': (result) => this.updateReg(result),\n\t\t});\n\t}\n\n\tcomponentWillUnmount() {\n\t\tlisteners.forget(this.listeners_);\n\t}\n\n\tcomponentDidUpdate(prevProps, prevState) {\n\t\tif (this.props.currentThread && this.props.currentThread !== prevProps.currentThread) {\n\t\t\tthis.updateRegs(true);\n\t\t}\n\t}\n\n\thandleViewMemory = (ev, data) => {\n\t\t// TODO\n\t\tconsole.log(data);\n\t}\n\n\thandleViewDisassembly = (ev, data) => {\n\t\tconst uintValue = this.state.categories[data.cat].uintValues[data.reg];\n\t\tthis.props.gotoDisasm(uintValue);\n\t}\n\n\thandleCopyReg = (ev, data, regNode) => {\n\t\tcopyText(data.value);\n\t}\n\n\thandleChangeReg = (ev, data, regNode) => {\n\t\tconst prevValue = (data.cat === 0 ? '0x' : '') + data.value;\n\t\tconst registerName = this.state.categories[data.cat].registerNames[data.reg];\n\n\t\tconst newValue = window.prompt('New value for ' + registerName, prevValue);\n\t\tif (newValue === null) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst packet = {\n\t\t\tevent: 'cpu.setReg',\n\t\t\tthread: this.context.gameStatus.currentThread,\n\t\t\tcategory: data.cat,\n\t\t\tregister: data.reg,\n\t\t\tvalue: newValue,\n\t\t};\n\n\t\t// The result is automatically listened for.\n\t\tthis.context.ppsspp.send(packet).catch((err) => {\n\t\t\twindow.alert(err);\n\t\t});\n\t}\n\n\tupdateRegs(keepLast) {\n\t\tthis.context.ppsspp.send({\n\t\t\tevent: 'cpu.getAllRegs',\n\t\t\tthread: this.context.gameStatus.currentThread,\n\t\t}).then((result) => {\n\t\t\tlet { categories } = result;\n\t\t\t// Add values for change tracking.\n\t\t\tconst hasPrev = this.state.categories.length !== 0;\n\t\t\tfor (let cat of categories) {\n\t\t\t\tconst prevCat = hasPrev ? this.state.categories[cat.id] : null;\n\t\t\t\tcat.uintValuesLast = hasPrev ? (keepLast ? prevCat.uintValuesLast : prevCat.uintValues) : cat.uintValues;\n\t\t\t\tcat.floatValuesLast = hasPrev ? (keepLast ? prevCat.floatValuesLast : prevCat.floatValues) : cat.floatValues;\n\t\t\t}\n\t\t\tthis.setState({ categories });\n\t\t}, (err) => {\n\t\t\t// Leave regs alone.\n\t\t\tconsole.error(err);\n\t\t});\n\t}\n\n\tupdateReg(result) {\n\t\tconst replaceCopy = (arr, index, item) => {\n\t\t\treturn arr.slice(0, index).concat([item]).concat(arr.slice(index + 1));\n\t\t};\n\n\t\tconst categories = this.state.categories.map((cat) => {\n\t\t\tif (cat.id === result.category) {\n\t\t\t\treturn {\n\t\t\t\t\t...cat,\n\t\t\t\t\t// Keep values from last time, until next stepping.\n\t\t\t\t\tuintValuesLast: cat.uintValuesLast,\n\t\t\t\t\tfloatValuesLast: cat.floatValuesLast,\n\t\t\t\t\tuintValues: replaceCopy(cat.uintValues, result.register, result.uintValue),\n\t\t\t\t\tfloatValues: replaceCopy(cat.floatValues, result.register, result.floatValue),\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn cat;\n\t\t});\n\n\t\tthis.setState({ categories });\n\t}\n}\n\nRegPanel.propTypes = {\n\tgotoDisasm: PropTypes.func.isRequired,\n\tcurrentThread: PropTypes.number,\n};\n\nRegPanel.contextType = DebuggerContext;\n\nexport default RegPanel;\n","import { PureComponent } from 'react';\nimport PropTypes from 'prop-types';\nimport FitModal from '../common/FitModal';\nimport listeners from '../../utils/listeners';\nimport { toString08X } from '../../utils/format';\nimport '../ext/react-modal.css';\nimport './VisualizeVFPU.css';\n\n// TODO: Consider using react-new-window for desktop?\n\nclass VisualizeVFPU extends PureComponent {\n\tstate = {\n\t\tcategories: [],\n\t\tformat: 'float',\n\t};\n\tlisteners_;\n\n\trender() {\n\t\tconst { categories, format } = this.state;\n\t\tif (categories.length < 3) {\n\t\t\treturn null;\n\t\t}\n\n\t\tlet matrices = [];\n\t\tfor (let m = 0; m < categories[2].uintValues.length / 16; ++m) {\n\t\t\tmatrices.push(this.renderMatrix(m));\n\t\t}\n\n\t\treturn (\n\t\t\t<FitModal contentLabel=\"VFPU\" isOpen={this.props.isOpen} onClose={this.props.onClose}>\n\t\t\t\t<h2>VFPU Registers</h2>\n\t\t\t\t<div className=\"VisualizeVFPU__list\">\n\t\t\t\t\t{matrices}\n\t\t\t\t</div>\n\t\t\t\t<div className=\"VisualizeVFPU__format\">\n\t\t\t\t\tDisplay as:\n\t\t\t\t\t<label><input type=\"radio\" checked={format === 'float'} value=\"float\" onChange={this.handleFormat} /> Float</label>\n\t\t\t\t\t<label><input type=\"radio\" checked={format === 'uint'} value=\"uint\" onChange={this.handleFormat} /> Hex</label>\n\t\t\t\t</div>\n\t\t\t</FitModal>\n\t\t);\n\t}\n\n\trenderMatrix(m) {\n\t\treturn (\n\t\t\t<table className=\"VisualizeVFPU__matrix\" key={m}>\n\t\t\t\t<thead>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th className=\"VisualizeVFPU__name\">M{m}00</th>\n\t\t\t\t\t\t<th className=\"VisualizeVFPU__row-header\">R{m}00</th>\n\t\t\t\t\t\t<th className=\"VisualizeVFPU__row-header\">R{m}01</th>\n\t\t\t\t\t\t<th className=\"VisualizeVFPU__row-header\">R{m}02</th>\n\t\t\t\t\t\t<th className=\"VisualizeVFPU__row-header\">R{m}03</th>\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t\t<tbody>\n\t\t\t\t\t{this.renderColumn(m, 0)}\n\t\t\t\t\t{this.renderColumn(m, 1)}\n\t\t\t\t\t{this.renderColumn(m, 2)}\n\t\t\t\t\t{this.renderColumn(m, 3)}\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t);\n\t}\n\n\trenderColumn(m, c) {\n\t\treturn (\n\t\t\t<tr key={c}>\n\t\t\t\t<th className=\"VisualizeVFPU__col-header\">C{m}{c}0</th>\n\t\t\t\t<td>{this.renderValue(m, c, 0)}</td>\n\t\t\t\t<td>{this.renderValue(m, c, 1)}</td>\n\t\t\t\t<td>{this.renderValue(m, c, 2)}</td>\n\t\t\t\t<td>{this.renderValue(m, c, 3)}</td>\n\t\t\t</tr>\n\t\t);\n\t}\n\n\trenderValue(m, c, r) {\n\t\tconst reg = m * 4 + c * 32 + r;\n\t\tconst cat = this.state.categories[2];\n\t\tif (this.state.format === 'uint') {\n\t\t\treturn toString08X(cat.uintValues[reg]);\n\t\t}\n\t\treturn cat.floatValues[reg];\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.listeners_ = listeners.listen({\n\t\t\t'cpu.getAllRegs': ({ categories }) => this.setState({ categories }),\n\t\t});\n\t}\n\n\tcomponentWillUnmount() {\n\t\tlisteners.forget(this.listeners_);\n\t}\n\n\thandleFormat = (ev) => {\n\t\tconst format = ev.target.value;\n\t\tthis.setState({ format });\n\t}\n}\n\nVisualizeVFPU.propTypes = {\n\tisOpen: PropTypes.bool.isRequired,\n\tonClose: PropTypes.func.isRequired,\n};\n\nexport default VisualizeVFPU;\n","import { PureComponent } from 'react';\nimport DebuggerContext, { DebuggerContextValues } from '../DebuggerContext';\nimport PropTypes from 'prop-types';\nimport { Tab, Tabs, TabList, TabPanel } from 'react-tabs';\nimport FuncList from './FuncList';\nimport RegPanel from './RegPanel';\nimport VisualizeVFPU from './VisualizeVFPU';\nimport './LeftPanel.css';\nimport '../ext/react-tabs.css';\n\nclass LeftPanel extends PureComponent {\n\tstate = {\n\t\tvfpuModalOpen: false,\n\t\t// These can be slow, so we want to prevent render until it's selected.\n\t\teverShownFuncs: false,\n\t};\n\t/**\n\t * @type {DebuggerContextValues}\n\t */\n\tcontext;\n\n\trender() {\n\t\treturn (\n\t\t\t<div className=\"LeftPanel\">\n\t\t\t\t<Tabs onSelect={this.handleSelect}>\n\t\t\t\t\t<TabList>\n\t\t\t\t\t\t<Tab>Regs</Tab>\n\t\t\t\t\t\t<Tab>Funcs</Tab>\n\t\t\t\t\t\t<Tab>Tools</Tab>\n\t\t\t\t\t</TabList>\n\t\t\t\t\t<TabPanel forceRender={true}>\n\t\t\t\t\t\t<RegPanel gotoDisasm={this.props.gotoDisasm} currentThread={this.context.gameStatus.currentThread} />\n\t\t\t\t\t</TabPanel>\n\t\t\t\t\t<TabPanel forceRender={this.state.everShownFuncs}>\n\t\t\t\t\t\t<FuncList gotoDisasm={this.props.gotoDisasm} started={this.context.gameStatus.started} />\n\t\t\t\t\t</TabPanel>\n\t\t\t\t\t<TabPanel className=\"react-tabs__tab-panel LeftPanel__tools\">\n\t\t\t\t\t\t<button type=\"button\" onClick={this.handleVFPUOpen}>Visualize VFPU</button>\n\t\t\t\t\t</TabPanel>\n\t\t\t\t</Tabs>\n\n\t\t\t\t<VisualizeVFPU isOpen={this.state.vfpuModalOpen} onClose={this.handleVFPUClose} />\n\t\t\t</div>\n\t\t);\n\t}\n\n\thandleSelect = (index) => {\n\t\tif (index === 1 && !this.state.everShownFuncs) {\n\t\t\tthis.setState({ everShownFuncs: true });\n\t\t}\n\t}\n\n\thandleVFPUOpen = () => {\n\t\tthis.setState({ vfpuModalOpen: true });\n\t}\n\n\thandleVFPUClose = () => {\n\t\tthis.setState({ vfpuModalOpen: false });\n\t}\n}\n\nLeftPanel.propTypes = {\n\tgotoDisasm: PropTypes.func.isRequired,\n};\n\nLeftPanel.contextType = DebuggerContext;\n\nexport default LeftPanel;\n","import { PureComponent } from 'react';\nimport DebuggerContext, { DebuggerContextValues } from './DebuggerContext';\nimport Disasm from './CPU/Disasm';\nimport DisasmButtons from './CPU/DisasmButtons';\nimport GotoBox from './common/GotoBox';\nimport LeftPanel from './CPU/LeftPanel';\nimport listeners from '../utils/listeners.js';\nimport './CPU.css';\n\nclass CPU extends PureComponent {\n\tstate = {\n\t\tsetInitialPC: false,\n\t\t// Note: these are inclusive.\n\t\tselectionTop: null,\n\t\tselectionBottom: null,\n\t\tjumpMarker: null,\n\t\tpromptGotoMarker: null,\n\t\tlastTicks: 0,\n\t\tticks: 0,\n\t\tnavTray: false,\n\t};\n\t/**\n\t * @type {DebuggerContextValues}\n\t */\n\tcontext;\n\tlisteners_;\n\n\trender() {\n\t\tconst { stepping, paused, started, pc, currentThread } = this.context.gameStatus;\n\t\tconst { selectionTop, selectionBottom, jumpMarker, setInitialPC, navTray } = this.state;\n\t\tconst disasmProps = { currentThread, selectionTop, selectionBottom, jumpMarker, pc, setInitialPC };\n\n\t\treturn (\n\t\t\t<div id=\"CPU\">\n\t\t\t\t<div className={navTray ? 'CPU__pane CPU__pane--open' : 'CPU__pane'}>\n\t\t\t\t\t<button type=\"button\" onClick={this.hideNavTray} className=\"CPU__paneClose\">Close</button>\n\t\t\t\t\t<GotoBox gotoAddress={this.gotoDisasm} includePC={true} promptGotoMarker={this.state.promptGotoMarker} />\n\t\t\t\t\t<LeftPanel gotoDisasm={this.gotoDisasm} />\n\t\t\t\t</div>\n\t\t\t\t<div className=\"Disasm__container\">\n\t\t\t\t\t<DisasmButtons stepping={stepping && !paused} started={started} currentThread={currentThread} updateCurrentThread={this.updateCurrentThread} showNavTray={this.showNavTray} />\n\t\t\t\t\t<Disasm {...disasmProps} updateSelection={this.updateSelection} promptGoto={this.promptGoto} />\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.listeners_ = listeners.listen({\n\t\t\t'connection': () => this.onConnection(),\n\t\t\t'cpu.stepping': (data) => this.onStepping(data),\n\t\t\t'game.start': () => {\n\t\t\t\t// This may often not happen if the register list is visible.\n\t\t\t\tif (!this.state.setInitialPC) {\n\t\t\t\t\tthis.updateInitialPC();\n\t\t\t\t}\n\t\t\t},\n\t\t\t'game.quit': () => {\n\t\t\t\tthis.setState({\n\t\t\t\t\tsetInitialPC: false,\n\t\t\t\t});\n\t\t\t},\n\t\t\t'cpu.setReg': (result) => {\n\t\t\t\tif (result.category === 0 && result.register === 32) {\n\t\t\t\t\tconst pc = result.uintValue;\n\t\t\t\t\tif (!this.state.setInitialPC) {\n\t\t\t\t\t\tthis.gotoDisasm(pc);\n\t\t\t\t\t}\n\t\t\t\t\tthis.setState({ setInitialPC: pc !== 0 });\n\t\t\t\t}\n\t\t\t},\n\t\t\t'cpu.getAllRegs': (result) => {\n\t\t\t\tconst pc = result.categories[0].uintValues[32];\n\t\t\t\tif (!this.state.setInitialPC) {\n\t\t\t\t\tthis.gotoDisasm(pc);\n\t\t\t\t}\n\t\t\t\tthis.setState({ setInitialPC: pc !== 0 });\n\t\t\t},\n\t\t});\n\t}\n\n\tcomponentWillUnmount() {\n\t\tlisteners.forget(this.listeners_);\n\t}\n\n\tonConnection() {\n\t\t// Update the status of this connection immediately too.\n\t\tthis.context.ppsspp.send({ event: 'cpu.status' }).then((result) => {\n\t\t\tconst { pc, ticks } = result;\n\n\t\t\tif (!this.state.setInitialPC) {\n\t\t\t\tthis.gotoDisasm(pc);\n\t\t\t}\n\t\t\tthis.setState({ setInitialPC: pc !== 0, ticks, lastTicks: ticks });\n\t\t});\n\t}\n\n\tonStepping(data) {\n\t\tthis.setState({\n\t\t\tselectionTop: data.pc,\n\t\t\tselectionBottom: data.pc,\n\t\t\tlastTicks: this.state.ticks,\n\t\t\tticks: data.ticks,\n\t\t});\n\t}\n\n\tupdateSelection = (data) => {\n\t\tthis.setState(data);\n\t}\n\n\tgotoDisasm = (pc) => {\n\t\tthis.setState({\n\t\t\tselectionTop: pc,\n\t\t\tselectionBottom: pc,\n\t\t\t// It just matters that this is a new object.\n\t\t\tjumpMarker: {},\n\t\t});\n\t}\n\n\tpromptGoto = () => {\n\t\tthis.setState({\n\t\t\tpromptGotoMarker: {},\n\t\t});\n\t}\n\n\tupdateCurrentThread = (currentThread, pc) => {\n\t\tthis.setState({ setInitialPC: pc !== 0 && pc !== undefined });\n\t\tthis.context.gameStatus.setState({ currentThread });\n\t\tif (pc !== 0 && pc !== undefined) {\n\t\t\tthis.context.gameStatus.setState({ pc });\n\t\t\tthis.gotoDisasm(pc);\n\t\t}\n\t}\n\n\tshowNavTray = () => {\n\t\tthis.setState({ navTray: true });\n\t}\n\n\thideNavTray = () => {\n\t\tthis.setState({ navTray: false });\n\t}\n\n\tupdateInitialPC = () => {\n\t\tthis.context.ppsspp.send({ event: 'cpu.getReg', name: 'pc' }).then(result => {\n\t\t\tconst pc = result.uintValue;\n\t\t\tif (!this.state.setInitialPC) {\n\t\t\t\tthis.gotoDisasm(pc);\n\t\t\t}\n\t\t\tthis.setState({ setInitialPC: pc !== 0 });\n\t\t\tthis.context.gameStatus.setState({ pc });\n\t\t});\n\t}\n}\n\nCPU.contextType = DebuggerContext;\n\nexport default CPU;\n","import { PureComponent } from 'react';\nimport DebuggerContext, { DebuggerContextValues } from './DebuggerContext';\nimport listeners from '../utils/listeners.js';\nimport './GPU.css';\n\nclass GPU extends PureComponent {\n\tstate = {\n\t\tconnected: false,\n\t\tstarted: false,\n\t\tpaused: true,\n\t\trecording: false,\n\t};\n\t/**\n\t * @type {DebuggerContextValues}\n\t */\n\tcontext;\n\n\trender() {\n\t\treturn (\n\t\t\t<div id=\"GPU\">\n\t\t\t\t<div className=\"GPU__info\">\n\t\t\t\t\t{this.state.started && !this.state.paused ? 'Click below to generate a GE dump.  It will download as a file.' : 'Waiting for a game to start...'}\n\t\t\t\t</div>\n\t\t\t\t{this.state.started && !this.state.paused ? (\n\t\t\t\t\t<form className=\"GPU__form\" onSubmit={this.beginRecord}>\n\t\t\t\t\t\t<button disabled={this.state.recording}>{this.state.recording ? 'Recording...' : 'Record'}</button>\n\t\t\t\t\t</form>\n\t\t\t\t) : null}\n\t\t\t</div>\n\t\t);\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.listeners_ = listeners.listen({\n\t\t\t'connection': () => this.onConnection(),\n\t\t\t'connection.change': (connected) => this.onConnectionChange(connected),\n\t\t\t'game.start': () => this.setState({ started: true, paused: false }),\n\t\t\t'game.quit': () => this.setState({ started: false, paused: true }),\n\t\t\t'game.pause': () => this.setState({ paused: true }),\n\t\t\t'game.resume': () => this.setState({ paused: false }),\n\t\t});\n\t}\n\n\tcomponentWillUnmount() {\n\t\tlisteners.forget(this.listeners_);\n\t}\n\n\tonConnectionChange(connected) {\n\t\t// On any reconnect, assume paused until proven otherwise.\n\t\tthis.setState({ connected, started: false, paused: true });\n\t}\n\n\tonConnection() {\n\t\t// Update the status of this connection immediately too.\n\t\tthis.context.ppsspp.send({ event: 'cpu.status' }).then((result) => {\n\t\t\tconst { stepping, paused, pc } = result;\n\t\t\tconst started = pc !== 0 || stepping;\n\n\t\t\tthis.setState({ connected: true, started, paused });\n\t\t}, (err) => {\n\t\t\tthis.setState({ paused: true });\n\t\t});\n\t}\n\n\tbeginRecord = (ev) => {\n\t\tthis.setState({ recording: true });\n\t\tthis.context.ppsspp.send({ event: 'gpu.record.dump' }).then(result => {\n\t\t\tvar a = document.createElement('a');\n\t\t\ta.setAttribute('download', 'recording.ppdmp');\n\t\t\ta.href = result.uri;\n\t\t\ta.hidden = true;\n\t\t\tdocument.body.appendChild(a);\n\t\t\ta.click();\n\t\t\tdocument.body.removeChild(a);\n\n\t\t\tthis.setState({ recording: false });\n\t\t});\n\t\tev.preventDefault();\n\t}\n}\n\nGPU.contextType = DebuggerContext;\n\nexport default GPU;\n","import { PureComponent } from 'react';\nimport PropTypes from 'prop-types';\nimport classNames from 'clsx';\n\nclass LogItem extends PureComponent {\n\trender() {\n\t\tif (this.props.item.event === 'log') {\n\t\t\treturn this.formatLogEvent();\n\t\t}\n\n\t\treturn this.renderInternal();\n\t}\n\n\trenderInternal() {\n\t\treturn (\n\t\t\t<span className={this.makeClassName()}>\n\t\t\t\t{this.props.item.message}\n\t\t\t</span>\n\t\t);\n\t}\n\n\tformatLogEvent() {\n\t\tconst { item } = this.props;\n\t\treturn (\n\t\t\t<span className={this.makeClassName()}>\n\t\t\t\t<span className=\"Log__message__header\">\n\t\t\t\t\t<span className=\"Log__message__timestamp\">{item.timestamp}</span>\n\t\t\t\t\t{' ' + item.header + ' '}\n\t\t\t\t</span>\n\t\t\t\t{item.message}\n\t\t\t</span>\n\t\t);\n\t}\n\n\tmakeClassName() {\n\t\tconst { item } = this.props;\n\n\t\treturn classNames('Log__message', {\n\t\t\t'Log__message--internal': item.event !== 'log',\n\t\t\t['Log__message--channel-' + item.channel]: item.event === 'log',\n\t\t\t['Log__message--level-' + item.level]: true,\n\t\t});\n\t}\n}\n\nLogItem.propTypes = {\n\titem: PropTypes.shape({\n\t\tevent: PropTypes.string,\n\t\tchannel: PropTypes.string,\n\t\tlevel: PropTypes.number,\n\t\ttimestamp: PropTypes.string,\n\t\theader: PropTypes.string,\n\t\tmessage: PropTypes.string.isRequired,\n\t}).isRequired,\n};\n\nexport default LogItem;\n","import { createRef, PureComponent } from 'react';\nimport DebuggerContext, { DebuggerContextValues } from './DebuggerContext';\nimport LogItem from './LogItem';\nimport listeners from '../utils/listeners.js';\nimport './Log.css';\n\nconst MAX_LINES = 5000;\n\nclass Log extends PureComponent {\n\tstate = {\n\t\tid: 0,\n\t\titems: [],\n\t};\n\t/**\n\t * @type {DebuggerContextValues}\n\t */\n\tcontext;\n\tdivRef;\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.divRef = createRef();\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<div id=\"Log\" ref={this.divRef}>\n\t\t\t\t{this.state.items.map(this.renderItem.bind(this))}\n\t\t\t</div>\n\t\t);\n\t}\n\n\trenderItem(item) {\n\t\treturn <LogItem key={item.id} item={item} />;\n\t}\n\n\taddLogItem(newItem) {\n\t\tconst id = this.state.id + 1;\n\t\tconst itemWithId = { id, ...newItem };\n\t\tconst items = this.state.items.concat([itemWithId ]).slice(-MAX_LINES);\n\t\tthis.setState({\n\t\t\tid,\n\t\t\titems,\n\t\t});\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.context.ppsspp.onError = (message, level) => {\n\t\t\tconst newItem = { message: message + '\\n', level };\n\t\t\tthis.addLogItem(newItem);\n\t\t};\n\n\t\tthis.listeners_ = listeners.listen({\n\t\t\t'log': this.onLogEvent.bind(this),\n\t\t});\n\t}\n\n\tcomponentDidUpdate(prevProps, prevState) {\n\t\tif (prevState.id !== this.state.id) {\n\t\t\tconst div = this.divRef.current;\n\t\t\tdiv.scrollTop = div.scrollHeight - div.clientHeight;\n\t\t}\n\t}\n\n\tcomponentWillUnmount() {\n\t\tlisteners.forget(this.listeners_);\n\t}\n\n\tonLogEvent(data) {\n\t\tconst newItem = { ...data };\n\t\tthis.addLogItem(newItem);\n\t}\n}\n\nLog.contextType = DebuggerContext;\n\nexport default Log;\n","import PropTypes from 'prop-types';\nimport './NotConnected.css';\n\nexport default function NotConnected(props) {\n\tconst connectManually = (ev) => {\n\t\tconst uri = ev.target.elements['debugger-uri'].value;\n\t\tprops.connect(uri);\n\t\tev.preventDefault();\n\t};\n\tconst connectAutomatically = (ev) => {\n\t\tprops.connect(null);\n\t\tev.preventDefault();\n\t};\n\n\treturn (\n\t\t<div id=\"NotConnected\">\n\t\t\t{props.connecting ? 'Connecting to PPSSPP...' : 'Not connected to PPSSPP'}\n\n\t\t\t<div className=\"NotConnected__info\">\n\t\t\t\tMake sure \"Allow remote debugger\" is enabled in Developer tools.\n\t\t\t</div>\n\t\t\t<form className=\"NotConnected__form\" onSubmit={connectManually}>\n\t\t\t\t<input type=\"text\" name=\"debugger-uri\" placeholder=\"ws://ip:port/debugger\" className=\"NotConnected__uri\" />\n\t\t\t\t<button disabled={props.connecting}>Connect Manually</button>\n\t\t\t</form>\n\t\t\t<form className=\"NotConnected__form\" onSubmit={connectAutomatically}>\n\t\t\t\t<button disabled={props.connecting}>Connect Automatically</button>\n\t\t\t</form>\n\t\t</div>\n\t);\n}\n\nNotConnected.propTypes = {\n\tconnect: PropTypes.func.isRequired,\n};\n","export default __webpack_public_path__ + \"static/media/logo.94f885ce.svg\";","import React, { Component } from 'react';\nimport { NavLink, BrowserRouter as Router, Route, Switch } from 'react-router-dom';\nimport CPU from './CPU';\nimport GPU from './GPU';\nimport Log from './Log';\nimport { DebuggerProvider } from './DebuggerContext';\nimport NotConnected from './NotConnected';\nimport PPSSPP from '../sdk/ppsspp.js';\nimport listeners from '../utils/listeners.js';\nimport GameStatus from '../utils/game.js';\nimport logo from '../assets/logo.svg';\nimport './App.css';\n\nconst versionInfo = {\n\tname: process.env.REACT_APP_NAME,\n\tversion: process.env.REACT_APP_VERSION,\n};\n\nclass App extends Component {\n\tstate = {\n\t\tconnected: false,\n\t\tconnecting: false,\n\t\tgameStatus: null,\n\t};\n\tgameStatus;\n\tlogRef;\n\tppsspp;\n\toriginalTitle;\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.logRef = React.createRef();\n\t\tthis.ppsspp = new PPSSPP();\n\t\tthis.gameStatus = new GameStatus();\n\t\tthis.originalTitle = document.title;\n\n\t\tlisteners.init(this.ppsspp);\n\t\tlisteners.listen({\n\t\t\t'connection.change': this.onConnectionChange,\n\t\t\t'game.start': this.updateTitle,\n\t\t\t'game.quit': this.updateTitle,\n\t\t});\n\t\tthis.gameStatus.init(this.ppsspp);\n\t\tthis.gameStatus.listenState(gameStatus => {\n\t\t\tthis.setState({ gameStatus });\n\t\t});\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<Router>\n\t\t\t\t<DebuggerProvider gameStatus={this.state.gameStatus} log={this.log} ppsspp={this.ppsspp}>\n\t\t\t\t\t<div className=\"App\">\n\t\t\t\t\t\t<header className=\"App-header\">\n\t\t\t\t\t\t\t<ul className=\"App-nav\">\n\t\t\t\t\t\t\t\t<NavLink to=\"/cpu\" isActive={(m, l) => m || l.pathname === '/'}>CPU</NavLink>\n\t\t\t\t\t\t\t\t<NavLink to=\"/gpu\">GPU</NavLink>\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t<img src={logo} className=\"App-logo\" alt=\"PPSSPP\" />\n\t\t\t\t\t\t\t<h1 className=\"App-title\">Debugger</h1>\n\t\t\t\t\t\t</header>\n\t\t\t\t\t\t{this.renderContent()}\n\t\t\t\t\t\t<Log ref={this.logRef} />\n\t\t\t\t\t</div>\n\t\t\t\t</DebuggerProvider>\n\t\t\t</Router>\n\t\t);\n\t}\n\n\trenderContent() {\n\t\tif (!this.state.connected) {\n\t\t\treturn <NotConnected connecting={this.state.connecting} connect={this.connect} />;\n\t\t}\n\n\t\treturn (\n\t\t\t<Switch>\n\t\t\t\t<Route path=\"/gpu\">\n\t\t\t\t\t<GPU />\n\t\t\t\t</Route>\n\t\t\t\t<Route>\n\t\t\t\t\t<CPU />\n\t\t\t\t</Route>\n\t\t\t</Switch>\n\t\t);\n\t}\n\n\tcomponentDidMount() {\n\t\t// Connect automatically on start.\n\t\tif (!this.props.testing) {\n\t\t\tthis.handleAutoConnect();\n\t\t}\n\t}\n\n\thandleAutoConnect = () => {\n\t\tthis.connect(null);\n\t}\n\n\tconnect = (uri) => {\n\t\tthis.setState({ connecting: true });\n\n\t\tthis.ppsspp.onClose = () => {\n\t\t\tthis.log('Debugger disconnected');\n\t\t\tlisteners.change(false);\n\t\t\tthis.setState({ connected: false, connecting: false });\n\t\t};\n\n\t\tlet connection;\n\t\tif (uri === null) {\n\t\t\tconnection = this.ppsspp.autoConnect();\n\t\t} else {\n\t\t\tconnection = this.ppsspp.connect(uri);\n\t\t}\n\n\t\tconnection.then(() => {\n\t\t\tthis.log('Debugger connected');\n\t\t\tlisteners.change(true);\n\t\t\tthis.setState({ connected: true, connecting: false });\n\t\t}, err => {\n\t\t\tthis.log('Debugger could not connect');\n\t\t\tlisteners.change(false);\n\t\t\tthis.setState({ connected: false, connecting: false });\n\t\t});\n\t}\n\n\thandleDisconnect = () => {\n\t\t// Should trigger the appropriate events automatically.\n\t\tthis.ppsspp.disconnect();\n\t}\n\n\tlog = (message) => {\n\t\t// Would rather keep Log managing its state, and pass this callback around.\n\t\tif (this.logRef.current) {\n\t\t\tthis.logRef.current.addLogItem({ message: message + '\\n' });\n\t\t} else {\n\t\t\tconsole.error(message);\n\t\t}\n\t}\n\n\tupdateTitle = (data) => {\n\t\tif (!document) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (data.game) {\n\t\t\tdocument.title = this.originalTitle + ' - ' + data.game.id + ': ' + data.game.title;\n\t\t} else {\n\t\t\tdocument.title = this.originalTitle;\n\t\t}\n\t}\n\n\tonConnectionChange = (status) => {\n\t\tif (status) {\n\t\t\tthis.ppsspp.send({ event: 'version', ...versionInfo }).catch((err) => {\n\t\t\t\twindow.alert('PPSSPP seems to think this debugger is out of date.  Try refreshing?\\n\\nDetails: ' + err);\n\t\t\t});\n\t\t\tthis.ppsspp.send({ event: 'game.status' }).then(this.updateTitle, (err) => this.updateTitle({}));\n\t\t} else {\n\t\t\tthis.updateTitle({});\n\t\t}\n\t}\n}\n\nexport default App;\n","// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n\twindow.location.hostname === 'localhost' ||\n\t\t// [::1] is the IPv6 localhost address.\n\t\twindow.location.hostname === '[::1]' ||\n\t\t// 127.0.0.1/8 is considered localhost for IPv4.\n\t\twindow.location.hostname.match(\n\t\t\t/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n\t\t)\n);\n\nexport default function register() {\n\tif (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n\t\t// The URL constructor is available in all browsers that support SW.\n\t\tconst publicUrl = new URL(process.env.PUBLIC_URL, window.location);\n\t\tif (publicUrl.origin !== window.location.origin) {\n\t\t\t// Our service worker won't work if PUBLIC_URL is on a different origin\n\t\t\t// from what our page is served on. This might happen if a CDN is used to\n\t\t\t// serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\n\t\t\treturn;\n\t\t}\n\n\t\twindow.addEventListener('load', () => {\n\t\t\tconst swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n\t\t\tif (isLocalhost) {\n\t\t\t\t// This is running on localhost. Lets check if a service worker still exists or not.\n\t\t\t\tcheckValidServiceWorker(swUrl);\n\n\t\t\t\t// Add some additional logging to localhost, pointing developers to the\n\t\t\t\t// service worker/PWA documentation.\n\t\t\t\tnavigator.serviceWorker.ready.then(() => {\n\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t'This web app is being served cache-first by a service ' +\n\t\t\t\t\t\t\t'worker. To learn more, visit https://goo.gl/SC7cgQ'\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// Is not local host. Just register service worker\n\t\t\t\tregisterValidSW(swUrl);\n\t\t\t}\n\t\t});\n\t}\n}\n\nfunction registerValidSW(swUrl) {\n\tnavigator.serviceWorker\n\t\t.register(swUrl)\n\t\t.then(registration => {\n\t\t\tregistration.onupdatefound = () => {\n\t\t\t\tconst installingWorker = registration.installing;\n\t\t\t\tinstallingWorker.onstatechange = () => {\n\t\t\t\t\tif (installingWorker.state === 'installed') {\n\t\t\t\t\t\tif (navigator.serviceWorker.controller) {\n\t\t\t\t\t\t\t// At this point, the old content will have been purged and\n\t\t\t\t\t\t\t// the fresh content will have been added to the cache.\n\t\t\t\t\t\t\t// It's the perfect time to display a \"New content is\n\t\t\t\t\t\t\t// available; please refresh.\" message in your web app.\n\t\t\t\t\t\t\tconsole.log('New content is available; please refresh.');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// At this point, everything has been precached.\n\t\t\t\t\t\t\t// It's the perfect time to display a\n\t\t\t\t\t\t\t// \"Content is cached for offline use.\" message.\n\t\t\t\t\t\t\tconsole.log('Content is cached for offline use.');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t};\n\t\t})\n\t\t.catch(error => {\n\t\t\tconsole.error('Error during service worker registration:', error);\n\t\t});\n}\n\nfunction checkValidServiceWorker(swUrl) {\n\t// Check if the service worker can be found. If it can't reload the page.\n\tfetch(swUrl)\n\t\t.then(response => {\n\t\t\t// Ensure service worker exists, and that we really are getting a JS file.\n\t\t\tif (\n\t\t\t\tresponse.status === 404 ||\n\t\t\t\tresponse.headers.get('content-type').indexOf('javascript') === -1\n\t\t\t) {\n\t\t\t\t// No service worker found. Probably a different app. Reload the page.\n\t\t\t\tnavigator.serviceWorker.ready.then(registration => {\n\t\t\t\t\tregistration.unregister().then(() => {\n\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// Service worker found. Proceed as normal.\n\t\t\t\tregisterValidSW(swUrl);\n\t\t\t}\n\t\t})\n\t\t.catch(() => {\n\t\t\tconsole.log(\n\t\t\t\t'No internet connection found. App is running in offline mode.'\n\t\t\t);\n\t\t});\n}\n\nexport function unregister() {\n\tif ('serviceWorker' in navigator) {\n\t\tnavigator.serviceWorker.ready.then(registration => {\n\t\t\tregistration.unregister();\n\t\t});\n\t}\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport Modal from 'react-modal';\nimport './index.css';\nimport App from './components/App';\nimport registerServiceWorker from './registerServiceWorker';\nimport 'core-js/stable';\nimport 'regenerator-runtime/runtime';\nimport 'react-app-polyfill/ie11';\nimport 'react-app-polyfill/stable';\n\nReactDOM.render(<App />, document.getElementById('root'));\nModal.setAppElement('#root');\nregisterServiceWorker();\n"],"sourceRoot":""}