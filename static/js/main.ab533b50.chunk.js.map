{"version":3,"sources":["sdk/ppsspp.js","utils/listeners.js","utils/game.js","components/DebuggerContext.js","utils/dom.js","components/common/FitModal.js","components/common/Field.js","components/common/Form.js","utils/timeouts.js","utils/format.js","components/CPU/BreakpointModal.js","components/CPU/BreakpointPanelContextMenu.js","components/CPU/BreakpointPanelItem.js","components/CPU/BreakpointPanelList.js","components/CPU/BreakpointPanel.js","utils/clipboard.js","components/CPU/DisasmContextMenu.js","components/CPU/DisasmBranchGuide.js","components/CPU/BreakpointIcon.js","components/CPU/DisasmLine.js","components/CPU/DisasmList.js","components/CPU/DisasmSearch.js","components/CPU/StatusBar.js","components/CPU/Disasm.js","components/CPU/DisasmButtons.js","components/common/GotoBox.js","components/CPU/FuncList.js","components/CPU/RegList.js","components/CPU/RegPanel.js","components/CPU/VisualizeVFPU.js","components/CPU/LeftPanel.js","components/LogItem.js","utils/logger.js","components/Log.js","components/CPU.js","components/GPU.js","components/NotConnected.js","assets/logo.svg","components/App.js","registerServiceWorker.js","index.js"],"names":["NoResponseEvents","ErrorLevels","PPSSPP","onError","onClose","socket_","pendingTickets_","listeners_","this","Promise","reject","Error","err","fetch","then","response","json","listing","tryNextEndpoint_","setupSocket_","bind","specificError","message","originalError","uri","resolve","possibleSocket","WebSocket","onopen","onclose","failAllPending_","close","eventName","handler","push","remove","list","index","indexOf","splice","data","includes","event","send","JSON","stringify","ticket","makeTicket_","result","name","originalMessage","onmessage","e","parse","handleError_","level","handled","handleTicket_","handleMessage_","length","endpoint","ip","p","connect","slice","executeHandlers_","undefined","Number","console","error","log","Math","random","toString","substr","hasOwnProperty","listeners","changeCallbacks_","ppsspp_","connected_","ppsspp","connected","callback","onConnectionChange","handlers","listener","onConnection","listen","GameStatus","state","stepping","paused","started","pc","currentThread","setState","stateListeners","values","onStepping","category","register","uintValue","categories","uintValues","forget","changed","k","defaultContext","gameStatus","DebuggerContext","createContext","displayName","useDebuggerContext","useContext","DebuggerProvider","children","Provider","value","isSubsetBounds","bounds","parentBounds","top","left","bottom","right","ensureInView","node","options","windowBounds","window","innerHeight","innerWidth","rect","getBoundingClientRect","parentNode","HTMLElement","style","getComputedStyle","overflows","overflow","overflowX","overflowY","position","isInView","scrollIntoView","contextMenuStatus","hasContextMenu","addEventListener","ev","FitModal","handleRequestClose","props","confirmClose","confirm","className","overlayClassName","onRequestClose","closeTimeoutMS","PureComponent","Field","handleChange","onChange","component","target","prop","dataset","type","checked","label","htmlFor","fieldID","renderInput","renderText","renderHex","renderRadio","renderCheckboxes","other","primary","fieldValue","id","pattern","title","map","option","disabled","constructor","Component","Form","action","classNames","onSubmit","heading","Buttons","saveHandler","onSave","saveButton","onClick","cancelButton","onCancel","propTypes","PropTypes","oneOfType","func","bool","Timeout","ms","cancel","handle","setTimeout","clearTimeout","toString08X","val","toUpperCase","typeOptions","operationOptions","actionOptions","BreakpointModal","cleanState","isOpen","derivedBreakpoint","cleanBreakpoint","address","size","condition","logFormat","read","write","change","enabled","operation","context","thread","expression","breakpoint","deleteOld","saveNew","updateExisting","alert","preventDefault","getEvent","cleanTimeout","start","Object","assign","initialOverrides","editing","contentLabel","hasChanges","renderMemory","renderExecute","compareTo","keys","find","key","prevProps","prevState","runEarly","nextProps","contextType","connectMenu","trigger","toggleBreakpoint","editBreakpoint","removeBreakpoint","divider","createBreakpoint","BreakpointPanelItem","mapData","attributes","onDoubleClick","gotoBreakpoint","onMouseDown","onSelect","selected","breakCheckbox","renderTag","holdToDisplay","collect","symbol","code","mapMemoryBreakpointType","hits","BreakpointPanelList","breakpoints","selectedRow","setSelectedRow","gotoDisasm","useState","editingBreakpoint","setEditingBreakpoint","creatingBreakpoint","setCreatingBreakpoint","handleToggleBreakpoint","handleRemoveBreakpoint","handleGotoBreakpoint","onKeyDown","selectedBreakpoint","tabIndex","BreakpointPanel","cpuBreakpoints","setCpuBreakpoints","memoryBreakpoints","setMemoryBreakpoints","fetchCpuBreakpoints","useCallback","b","fetchMemoryBreakpoints","fetchBreakpoints","clearBreakpoints","useEffect","userInitiated","getScratchpad","div","document","getElementById","createElement","width","height","opacity","pointerEvents","whiteSpace","body","appendChild","createScratchpad","copyText","text","scratchpad","textContent","textNode","firstChild","range","createRange","setStart","setEnd","selection","getSelection","oldRange","rangeCount","getRangeAt","removeAllRanges","addRange","execCommand","prompt","hasClosestMatch","selector","matches","Element","prototype","msMatchesSelector","collapsed","activeElement","test","navigator","platform","clipboardData","setData","replace","DisasmContextMenu","handleCopyAddress","line","focus","handleCopyHex","getSelectedLines","macroEncoding","join","encoding","handleCopyDisasm","getSelectedDisasm","handleAssemble","assembleInstruction","catch","handleRunUntil","handleJumpPC","handleFollowBranch","followBranch","handleTodo","branch","relevantData","DisasmBranchGuide","pos","calcPos","lineHeight","classes","xmlns","d","buildPath","guide","yCenter","floor","trailingEdge","sourceEdge","arrowEdge","path","direction","end","findAddressOffset","lane","down","off","offsets","BreakpointIcon","viewBox","DisasmLine","ref","createRef","focused","cursor","isCurrentPC","current","contextmenu","backgroundColor","data-address","renderAddress","highlight","params","highlightParams","renderConditional","addressHex","displaySymbols","conditionMet","before","after","fullText","toLowerCase","matchLength","beforeLength","split","toHighlight","param","button","needsScroll","triggerNode","block","lineNode","querySelector","DisasmList","mouseDown","lineOffsets","pendingLineParams","selectedLineParams","prevLines","prevSelectionTop","prevSelectionBottom","onCopy","cursorRef","focusTimeout","paramsTimeout","events","onMouseDownCapture","onMouseUpCapture","onMouseUp","onMouseMove","onBlur","onFocusChange","onFocus","lines","renderLine","branchGuides","renderBranchGuide","isLineSelected","shouldHighlight","highlightText","shouldHighlightParams","String","match","parts","some","part","addressBoundingTop","filter","l","update","reset","mouseEventToLine","updateCursor","applySelection","buttons","modifiers","ctrlKey","metaKey","altKey","shiftKey","dist","visibleLines","lineIndex","findCursorLineIndex","newIndex","min","max","applyScroll","findCursorLine","updateDisplaySymbols","searchPrompt","searchNext","promptGoto","selectionTop","selectionBottom","updateSelection","y","pageY","pageYOffset","addr","i","addressSize","forEach","selectedLines","linesChanged","selectionChanged","offsetsUpdate","calcOffsets","selectedUpdate","getSelectedLineParams","DisasmSearch","updateSearchString","handleNext","handleCancel","handleKeyDown","searchString","inProgress","hidden","placeholder","role","StatusBar","renderLeftStatus","function","dataAccess","renderDataAccess","renderBranch","stringValue","renderString","renderDataSymbol","dataSymbol","status","valueSymbol","toString04X","targetAddress","MIN_BUFFER","Disasm","wantDisplaySymbols","searchInProgress","jumpStack","needsOffsetFix","updatesCancel","updatesSequence","lastSearch","minBuffer","maxBuffer","updateDisasmNow","branchAddresses","unlabeledBranches","firstLine","flag","gotoAddress","pop","startCode","writeInstruction","nextAddress","updateDisasm","assignment","keep","breakpointAddress","bp","closeEditBreakpoint","snap","searchDisasm","cont","continueLast","searchCancel","last","cancelState","finally","listRef","ensureCursorInView","searchRef","scrollTop","onScroll","onDragStart","renderContextMenu","renderNotStarted","centerAddress","hasRange","snapshot","disasmChange","updateDisasmRange","setInitialPC","foundLine","clientHeight","jumpMarker","newRange","updateRange","defaultBuffer","count","cleanupBranchGuides","unique","Map","set","bufferRange","bufferTop","bufferBottom","scrollHeight","visibleEachDirection","DisasmButtons","breakpointModalOpen","lastThread","threads","handleGoBreak","updateCurrentThread","handleStepInto","handleStepOver","handleStepOut","threadID","handleNextHLE","handleThreadSelect","th","handleBreakpointOpen","handleBreakpointClose","showNavTray","renderThreadList","renderThread","isCurrent","updateThreadList","resetCurrentThread","GotoBox","handleSubmit","select","handlePC","jumpToReg","handleRA","autoComplete","renderPCButtons","includePC","promptGotoMarker","FuncList","loading","rowHeight","functions","filteredFunctions","renderSizedList","rowRenderer","renderFunc","rowCount","handleFilter","applyFilter","handleClick","renderList","updateList","measureHeight","sort","a","localeCompare","RegList","registerNames","reg","renderReg","cat","format","ddClasses","floatValues","uintValuesLast","RegPanel","handleViewMemory","handleViewDisassembly","handleCopyReg","regNode","handleChangeReg","prevValue","registerName","newValue","packet","renderTabs","c","updateRegs","updateReg","keepLast","hasPrev","prevCat","floatValuesLast","replaceCopy","arr","item","concat","floatValue","VisualizeVFPU","handleFormat","matrices","m","renderMatrix","renderColumn","renderValue","r","LeftPanel","vfpuModalOpen","everShownFuncs","handleSelect","handleVFPUOpen","handleVFPUClose","forceRender","LogItem","formatLogEvent","renderInternal","makeClassName","timestamp","header","channel","logger","id_","items_","changeListeners_","newItem","addLogItem","onLogEvent","itemWithId","Log","logItems","setLogItems","changeListener","items","useLogItems","divRef","useRef","CPU","lastTicks","ticks","navTray","hideNavTray","updateInitialPC","disasmProps","renderMain","renderUtilityPanel","GPU","recording","beginRecord","setAttribute","href","click","removeChild","NotConnected","mainDiv","connecting","elements","utilityPanelDiv","versionInfo","process","version","App","handleAutoConnect","autoConnect","handleDisconnect","disconnect","updateTitle","game","originalTitle","init","listenState","to","isActive","pathname","src","logo","alt","renderContent","testing","isLocalhost","Boolean","location","hostname","registerValidSW","swUrl","serviceWorker","registration","onupdatefound","installingWorker","installing","onstatechange","controller","ReactDOM","render","Modal","setAppElement","URL","origin","headers","get","ready","unregister","reload","checkValidServiceWorker","registerServiceWorker"],"mappings":"y/DAoCMA,EAAmB,CACxB,eACA,cAGKC,EAEE,EAWaC,E,iDA6MpBC,QAAU,K,KACVC,QAAU,K,KAEVC,QAAU,K,KACVC,gBAAkB,G,KAClBC,WAAa,G,+CAjNb,WAAe,IAAD,OACb,GAAqB,OAAjBC,KAAKH,QACR,OAAOI,QAAQC,OAAO,IAAIC,MAAM,wCAGjC,IAAIC,EAAM,IAAID,MAAM,oBAEpB,OAAOE,MAZgB,kCAYQC,MAAK,SAACC,GACpC,OAAOA,EAASC,UACdF,MAAK,SAACG,GACR,OAAO,EAAKC,iBAAiBD,MAC3BH,KAAKN,KAAKW,aAAaC,KAAKZ,OAAO,SAAAa,GAGrC,MAFAT,EAAIU,QAAUD,EAAcC,QAC5BV,EAAIW,cAAgBF,EACdT,O,qBAIR,SAAQY,GAAM,IAAD,OACZ,GAAqB,OAAjBhB,KAAKH,QACR,OAAOI,QAAQC,OAAO,IAAIC,MAAM,wCAIjC,IAAIC,EAAM,IAAID,MAAM,uBAA0Ba,GAE9C,OAAO,IAAIf,SAAQ,SAACgB,EAASf,GAC5B,IAAMgB,EAAiB,IAAIC,UAAUH,EA/BZ,uBAiCzBE,EAAeE,OAAS,WACvB,EAAKvB,QAAUqB,EACfD,KAEDC,EAAeG,QAAU,WACxBnB,EAAOE,OAENE,KAAKN,KAAKW,aAAaC,KAAKZ,S,wBAGhC,WACC,GAAqB,OAAjBA,KAAKH,QACR,MAAM,IAAIM,MAAM,iBAGjBH,KAAKsB,gBAAgB,4BAErBtB,KAAKH,QAAQ0B,MAAM,KACnBvB,KAAKH,QAAU,O,oBAGhB,SAAO2B,EAAWC,GAAU,IAAD,OAO1B,OANMD,KAAaxB,KAAKD,aACvBC,KAAKD,WAAWyB,GAAa,IAG9BxB,KAAKD,WAAWyB,GAAWE,KAAKD,GAEzB,CACNE,OAAQ,WACP,IAAMC,EAAO,EAAK7B,WAAWyB,GACvBK,EAAQD,EAAKE,QAAQL,IACZ,IAAXI,GACHD,EAAKG,OAAOF,EAAO,O,kBAMvB,SAAKG,GAAO,IAAD,OACV,GAAqB,OAAjBhC,KAAKH,QACR,OAAOI,QAAQC,OAAO,IAAIC,MAAM,kBAIjC,IAAIC,EAAM,IAAID,MAAM,4BAGpB,OAAIX,EAAiByC,SAASD,EAAKE,QAClClC,KAAKH,QAAQsC,KAAKC,KAAKC,UAAUL,IAC1B/B,QAAQgB,QAAQ,OAGjB,IAAIhB,SAAQ,SAACgB,EAASf,GAC5B,IAAMoC,EAAS,EAAKC,cAEpB,EAAKzC,gBAAgBwC,GAAU,SAAUE,GACnB,UAAjBA,EAAON,OACV9B,EAAIqC,KAAO,gBACXrC,EAAIU,QAAU0B,EAAO1B,QACrBV,EAAIsC,gBAAkBF,EACtBtC,EAAOE,IAEPa,EAAQuB,IAIV,EAAK3C,QAAQsC,KAAKC,KAAKC,UAAL,2BAAoBL,GAApB,IAA0BM,kB,0BAI9C,WAAgB,IAAD,OACdtC,KAAKH,QAAQwB,QAAU,WAClB,EAAKzB,SACR,EAAKA,UAGN,EAAK0B,gBAAgB,uBACrB,EAAKzB,QAAU,MAGhBG,KAAKH,QAAQ8C,UAAY,SAACC,GACzB,IACC,IAAMZ,EAAOI,KAAKS,MAAMD,EAAEZ,MAEP,UAAfA,EAAKE,OACR,EAAKY,aAAad,EAAKlB,QAASkB,EAAKe,OAGtC,IAAIC,GAAU,EACV,WAAYhB,IACfgB,EAAU,EAAKC,cAAcjB,EAAKM,OAAQN,IAE3C,EAAKkB,eAAelB,EAAMgB,GACzB,MAAO5C,GACR,EAAK0C,aAAa,wCAA0C1C,EAAIU,QAASrB,O,8BAK5E,SAAiBgB,GAAU,IAAD,OACzB,OAAO,IAAIR,SAAQ,SAACgB,EAASf,GAC5B,IAAKO,GAA8B,IAAnBA,EAAQ0C,OACvB,OAAOjD,EAAO,IAAIC,MAAM,8EAGzB,IAAMiD,EAAW,QAAU3C,EAAQ,GAAG4C,GAAK,IAAM5C,EAAQ,GAAG6C,EA1InC,YA2IzB,OAAO,EAAKC,QAAQH,GAAU9C,KAAKW,GAAS,SAAAb,GACvCK,EAAQ0C,OAAS,EACpBlC,EAAQ,EAAKP,iBAAiBD,EAAQ+C,MAAM,KAE5CtD,EAAOE,W,2BAMX,SAAckC,EAAQN,GACrB,GAAIM,KAAUtC,KAAKF,gBAAiB,CACnC,IAAM2B,EAAUzB,KAAKF,gBAAgBkC,EAAKM,QAI1C,cAHOtC,KAAKF,gBAAgBkC,EAAKM,QAEjCb,EAAQO,IACD,EAIR,OADAhC,KAAK8C,aAAa,+BAAiCV,KAAKC,UAAUL,GAAOvC,IAClE,I,4BAGR,SAAeuC,EAAMgB,GACpBA,EAAUhD,KAAKyD,iBAAiBzB,EAAKE,MAAOF,EAAMgB,GAClDhD,KAAKyD,iBAAiB,IAAKzB,EAAMgB,K,8BAGlC,SAAiBP,EAAMT,EAAMgB,GAC5B,GAAIP,KAAQzC,KAAKD,WAAY,CAAC,IAAD,gBACRC,KAAKD,WAAW0C,IADR,IAC5B,2BAA2C,EACtChB,EADsC,SAC9BO,EAAMgB,KACjBA,GAAU,IAHgB,+BAO7B,OAAOA,I,0BAGR,SAAalC,EAASiC,GACjB/C,KAAKL,QACRK,KAAKL,QAAQmB,EAASiC,QACFW,IAAVX,GAAuBY,OAAOZ,KAAWtD,EACnDmE,QAAQC,MAAM/C,GAEd8C,QAAQE,IAAIhD,K,yBAId,WACC,IAAIwB,EAASyB,KAAKC,SAASC,SAAS,IAAIC,OAAO,GAC/C,OAAI5B,KAAUtC,KAAKF,gBACXE,KAAKuC,cAEND,I,6BAGR,SAAgBxB,GACf,IAAMkB,EAAO,CAAEE,MAAO,QAASpB,UAASiC,MAAOtD,GAE/C,IAAK,IAAI6C,KAAUtC,KAAKF,gBACnBE,KAAKF,gBAAgBqE,eAAe7B,IACvCtC,KAAKF,gBAAgBwC,GAAQN,GAG/BhC,KAAKF,gBAAkB,O,KCzLVsE,EADG,I,WArEjB,aAAe,oBACdpE,KAAKqE,iBAAmB,GACxBrE,KAAKsE,QAAU,KACftE,KAAKuE,YAAa,E,wCAGnB,SAAKC,GACJxE,KAAKsE,QAAUE,I,oBAIhB,SAAOC,GACNzE,KAAKuE,WAAaE,EADD,oBAEIzE,KAAKqE,kBAFT,IAEjB,2BAA4C,EAC3CK,EAD2C,SAClCD,IAHO,iC,gCAOlB,SAAmBC,GAAW,IAAD,OAE5B,OADA1E,KAAKqE,iBAAiB3C,KAAKgD,GACpB,CACN/C,OAAQ,WACP,IAAME,EAAQ,EAAKwC,iBAAiBvC,QAAQ4C,IAC7B,IAAX7C,GACH,EAAKwC,iBAAiBtC,OAAOF,EAAO,O,0BAMxC,SAAa6C,GAUZ,OAJI1E,KAAKuE,YACRG,GAAS,GAGH1E,KAAK2E,oBATW,SAACF,GACnBA,GACHC,GAAS,Q,oBAWZ,SAAOE,GACN,IAAIpC,EAAS,GACb,IAAK,IAAIC,KAAQmC,EAChB,GAAIA,EAAST,eAAe1B,GAAO,CAClC,IAAIoC,OAAQ,EAEXA,EADY,eAATpC,EACQzC,KAAK8E,aAAaF,EAASnC,IACnB,sBAATA,EACCzC,KAAK2E,mBAAmBC,EAASnC,IAEjCzC,KAAKsE,QAAQS,OAAOtC,EAAMmC,EAASnC,IAE/CD,EAAOd,KAAKmD,GAGd,OAAOrC,I,oBAGR,SAAO4B,GAAY,IAAD,gBACIA,GADJ,IACjB,2BAAgC,SACtBzC,UAFO,mC,MCyDJqD,E,iDAvGdC,MAAQ,CACPR,WAAW,EACXS,UAAU,EACVC,QAAQ,EACRC,SAAS,EACTC,GAAI,EACJC,mBAAe5B,EACf6B,cAAU7B,G,KAEX8B,eAAiB,G,wCAIjB,SAAKhB,GAAS,IAAD,OACZxE,KAAKiF,MAAMM,SAAW,SAAAE,GACrB,EAAKF,SAASE,IAGfzF,KAAKsE,QAAUE,EACfxE,KAAKD,WAAaqE,EAAUW,OAAO,CAClC,WAAc,kBAAM,EAAKD,gBACzB,oBAAqB,SAACL,GAAD,OAAe,EAAKE,mBAAmBF,IAC5D,eAAgB,SAACzC,GAAD,OAAU,EAAK0D,WAAW1D,IAC1C,aAAc,kBAAM,EAAKuD,SAAS,CAAEL,UAAU,KAC9C,aAAc,WACb,EAAKK,SAAS,CAAEH,SAAS,EAAMD,QAAQ,KAExC,YAAa,WACZ,EAAKI,SAAS,CACbH,SAAS,EACTF,UAAU,EACVC,QAAQ,EACRE,GAAI,EACJC,mBAAe5B,KAGjB,aAAc,kBAAM,EAAK6B,SAAS,CAAEJ,QAAQ,KAC5C,cAAe,kBAAM,EAAKI,SAAS,CAAEJ,QAAQ,KAC7C,aAAc,SAAC3C,GACU,IAApBA,EAAOmD,UAAsC,KAApBnD,EAAOoD,UACnC,EAAKL,SAAS,CAAEF,GAAI7C,EAAOqD,aAG7B,iBAAkB,SAACrD,GAClB,IAAM6C,EAAK7C,EAAOsD,WAAW,GAAGC,WAAW,IAC3C,EAAKR,SAAS,CAAEF,Y,sBAKnB,WACCjB,EAAU4B,OAAOhG,KAAKD,YACtBC,KAAKD,WAAa,O,gCAGnB,SAAmB0E,GAElBzE,KAAKuF,SAAS,CAAEd,YAAWW,SAAS,EAAOF,UAAU,EAAOC,QAAQ,IAC/DV,GACJzE,KAAKuF,SAAS,CAAED,mBAAe5B,M,0BAIjC,WAAgB,IAAD,OAEd1D,KAAKsE,QAAQnC,KAAK,CAAED,MAAO,eAAgB5B,MAAK,SAACkC,GAChD,IAAQ0C,EAAyB1C,EAAzB0C,SAAUC,EAAe3C,EAAf2C,OAAQE,EAAO7C,EAAP6C,GACpBD,EAAiB,IAAPC,GAAYH,EAE5B,EAAKK,SAAS,CAAEd,WAAW,EAAMW,UAASF,WAAUC,SAAQE,UAC1D,SAACjF,GACH,EAAKmF,SAAS,CAAEL,UAAU,EAAOC,QAAQ,S,wBAI3C,SAAWnD,GACVhC,KAAKuF,SAAS,CACbL,UAAU,EACVG,GAAIrD,EAAKqD,O,yBAIX,SAAYX,GACX1E,KAAKwF,eAAe9D,KAAKgD,K,sBAG1B,SAASe,GACR,IAAIQ,GAAU,EACd,IAAK,IAAIC,KAAKT,EACTA,EAAOS,KAAOlG,KAAKiF,MAAMiB,KAC5BD,GAAU,GAIZ,GAAIA,EAAS,CACZjG,KAAKiF,MAAL,2BAAkBjF,KAAKiF,OAAUQ,GADrB,oBAESzF,KAAKwF,gBAFd,IAEZ,2BAA0C,EACzCd,EADyC,SAChC1E,KAAKiF,QAHH,oC,YC5FTkB,EAAiB,CACtB3B,OAAQ,KACR4B,WAAY,KACZtC,IAAK,SAAChD,GAAD,OAAa8C,QAAQC,MAAM/C,KAG3BuF,EAAkBC,wBAAcH,GACtCE,EAAgBE,YAAc,kBACfF,QAER,SAASG,IACf,OAAOC,qBAAWJ,GAGZ,SAASK,EAAT,GAAkE,IAAtCC,EAAqC,EAArCA,SAAUP,EAA2B,EAA3BA,WAAYtC,EAAe,EAAfA,IAAKU,EAAU,EAAVA,OAC7D,OACC,cAAC6B,EAAgBO,SAAjB,CAA0BC,MAAO,CAAET,aAAYtC,MAAKU,UAApD,SACEmC,I,YCpCJ,SAASG,EAAeC,EAAQC,GAC/B,QAAID,EAAOE,IAAMD,EAAaC,KAAOF,EAAOG,KAAOF,EAAaE,SAG5DH,EAAOI,OAASH,EAAaG,QAAUJ,EAAOK,MAAQJ,EAAaI,OA+BjE,SAASC,EAAaC,EAAMC,GAClC,OA1BM,SAAkBD,GACxB,IAAME,EAAe,CAAEP,IAAK,EAAGC,KAAM,EAAGC,OAAQM,OAAOC,YAAaN,MAAOK,OAAOE,YAC5EC,EAAON,EAAKO,wBAClB,IAAKf,EAAec,EAAMJ,GACzB,OAAO,EAIR,IADA,IAAIM,EAAaR,EAC+B,QAAxCQ,EAAaA,EAAWA,aAC/B,GAAIA,aAAsBC,YAAa,CACtC,IAAMC,EAAQP,OAAOQ,iBAAiBH,GAChCI,EAAYF,EAAMG,SAAWH,EAAMI,UAAYJ,EAAMK,UAC3D,GAAuB,WAAnBL,EAAMM,WAAwD,IAA/BJ,EAAUpG,QAAQ,UAAmD,IAAjCoG,EAAUpG,QAAQ,UACxF,SAGD,IAAKgF,EAAec,EAAME,EAAWD,yBACpC,OAAO,EAKV,OAAO,EAIFU,CAASjB,KACbA,EAAKkB,eAAejB,IACb,GAMT,IAAIkB,GAAoB,EASjB,SAASC,IACf,OAAOD,EARRhB,OAAOkB,iBAAiB,0BAA0B,SAACC,GAClDH,GAAoB,KAErBhB,OAAOkB,iBAAiB,0BAA0B,SAACC,GAClDH,GAAoB,K,WCdNI,E,4MAnBdC,mBAAqB,WAChB,EAAKC,MAAMC,eACTvB,OAAOwB,QAAQ,EAAKF,MAAMC,eAMhC,EAAKD,MAAMnJ,W,4CAnBZ,WACC,OACC,cAAC,IAAD,aACCsJ,UAAU,yBAAyBC,iBAAiB,yBACpDC,eAAgBpJ,KAAK8I,mBACrBO,eAAgB,KACZrJ,KAAK+I,Y,GAPUO,iB,6ECkHRC,E,4MA5BdC,aAAe,SAACZ,GACf,GAAI,EAAKG,MAAMU,SACd,EAAKV,MAAMU,SAASb,QACd,GAAI,EAAKG,MAAMW,UAAW,CAChC,IAAQC,EAAWf,EAAXe,OACFC,EAAOD,EAAOE,QAAQD,MAAQ,EAAKb,MAAMa,KACzC/C,EAAwB,aAAhB8C,EAAOG,KAAsBH,EAAOI,QAAUJ,EAAO9C,MACnE,EAAKkC,MAAMW,UAAUnE,SAArB,eAAiCqE,EAAO/C,M,4CA9F1C,WACC,MAA4B7G,KAAK+I,MAAzBiB,EAAR,EAAQA,MAAOrD,EAAf,EAAeA,SACf,OACC,sBAAKuC,UAAU,QAAf,UACC,uBAAOA,UAAU,eAAee,QAASjK,KAAKkK,UAA9C,SAA0DF,IACzDhK,KAAKmK,cACLxD,O,yBAKJ,WACC,MAAwB,SAApB3G,KAAK+I,MAAMe,KACP9J,KAAKoK,aACkB,QAApBpK,KAAK+I,MAAMe,KACd9J,KAAKqK,YACkB,UAApBrK,KAAK+I,MAAMe,KACd9J,KAAKsK,cACkB,eAApBtK,KAAK+I,MAAMe,KACd9J,KAAKuK,mBAEL,O,wBAIT,WAAwB,IAAbC,EAAY,uDAAJ,GAClB,EAAuExK,KAAK+I,MAAjB0B,GAA3D,EAAMT,MAAN,EAAaF,KAAb,EAAmBnD,SAAnB,EAA6B8C,SAA7B,EAAuCC,UAAvC,EAAkDE,KAAlD,kBAEA,OADAa,EAAQ5D,MAAQ7G,KAAK0K,aACd,+CAAOZ,KAAK,OAAOa,GAAI3K,KAAKkK,UAAWT,SAAUzJ,KAAKwJ,cAAkBiB,GAAaD,M,uBAG7F,WACC,OAAOxK,KAAKoK,WAAW,CAAEQ,QAAS,oBAAqBC,MAAO,wB,yBAG/D,WAAe,IAAD,OACPhE,EAAQ7G,KAAK0K,aACnB,OAAO1K,KAAK+I,MAAMxB,QAAQuD,KAAI,SAAAC,GAC7B,IAAMhC,EAAQ,CACbtG,KAAM,EAAKyH,UACXrD,MAAOkE,EAAOlE,MACdkD,QAASlD,IAAUkE,EAAOlE,MAC1B4C,SAAU,EAAKD,aACfwB,SAAU,EAAKjC,MAAMiC,UAEtB,OACC,kCACC,mCAAOlB,KAAK,SAAYf,IACvB,IAAMgC,EAAOf,QAFHe,EAAOlE,Y,8BAQtB,WAAoB,IAAD,OAClB,OAAO7G,KAAK+I,MAAMxB,QAAQuD,KAAI,SAAAC,GAC7B,IAAMhC,EAAQ,CACb,YAAagC,EAAOlE,MACpBkD,QAAS,EAAKhB,MAAMW,UAAUzE,MAAM8F,EAAOlE,OAC3C4C,SAAU,EAAKD,aACfwB,SAAU,EAAKjC,MAAMiC,UAEtB,OACC,kCACC,mCAAOlB,KAAK,YAAef,IAC1B,IAAMgC,EAAOf,QAFHe,EAAOlE,Y,qBAQtB,WACC,MAAgC7G,KAAK+I,MAA7B4B,EAAR,EAAQA,GAAIjB,EAAZ,EAAYA,UAAWE,EAAvB,EAAuBA,KACvB,OAAKe,GAAMjB,GAAaE,GACfF,EAAUnD,aAAemD,EAAUuB,YAAYxI,MAAQ,KAAOmH,EAEhEe,I,wBAGR,WACC,MAAmC3K,KAAK+I,MAAhClC,EAAR,EAAQA,MAAO6C,EAAf,EAAeA,UAAWE,EAA1B,EAA0BA,KAC1B,YAAclG,IAAVmD,GAAuB6C,GAAaE,EAChCF,EAAUzE,MAAM2E,GAEjB/C,M,GArFWqE,a,+BCCpB,SAASC,EAAKpC,GAEb,OACC,uBAAMqC,OAAO,IAAIlC,UAAWmC,YAAWtC,EAAMG,UAAW,QAASoC,SAAUvC,EAAMuC,SAAjF,UACEvC,EAAMwC,QAAU,oBAAIrC,UAAU,gBAAd,SAA+BH,EAAMwC,UAAgB,KACrExC,EAAMpC,YAWVwE,EAAKK,QAAU,SAAUzC,GACxB,IAAM0C,GAA+B,IAAjB1C,EAAM2C,OAAkB3C,EAAM2C,YAAShI,EACrDiI,EAAa5C,EAAM2C,OAAS,wBAAQ5B,KAAK,SAAS8B,QAASH,EAA/B,kBAA4D,KACxFI,EAAe9C,EAAM+C,SAAW,wBAAQhC,KAAK,SAAS8B,QAAS7C,EAAM+C,SAArC,oBAAiE,KAEvG,OACC,sBAAK5C,UAAU,gBAAf,UACEH,EAAMpC,SACNgF,EACAE,MAKJV,EAAKK,QAAQO,UAAY,CACxBL,OAAQM,IAAUC,UAAU,CAACD,IAAUE,KAAMF,IAAUG,OACvDL,SAAUE,IAAUE,KACpBvF,SAAUqF,IAAU1E,MAGN6D,QCxCFiB,EAAb,WAKC,WAAYF,EAAMG,GAAK,oBACtBrM,KAAKkM,KAAOA,EACZlM,KAAKqM,GAAKA,EAPZ,yCAUC,WAAS,IAAD,OACPrM,KAAKsM,SACLtM,KAAKuM,OAASC,YAAW,WACxB,EAAKD,OAAS,KACd,EAAKL,SACHlM,KAAKqM,MAfV,mBAkBC,SAAMH,GACLlM,KAAKkM,KAAOA,IAnBd,sBAsBC,WACKlM,KAAKuM,SACRvM,KAAKsM,SACLtM,KAAKkM,UAzBR,oBA6BC,WACqB,OAAhBlM,KAAKuM,SACRE,aAAazM,KAAKuM,QAClBvM,KAAKuM,OAAS,UAhCjB,KCAO,SAASG,EAAYC,GAE3B,OAAQ,WADIA,EAAI1I,SAAS,IAAI2I,eACH1I,QAAQ,G,WCS7B2I,EAAc,CACnB,CAAE7C,MAAO,SAAUnD,MAAO,UAC1B,CAAEmD,MAAO,UAAWnD,MAAO,YAGtBiG,EAAmB,CACxB,CAAE9C,MAAO,OAAQnD,MAAO,QACxB,CAAEmD,MAAO,QAASnD,MAAO,SACzB,CAAEmD,MAAO,YAAanD,MAAO,WAGxBkG,EAAgB,CACrB,CAAE/C,MAAO,QAASnD,MAAO,WACzB,CAAEmD,MAAO,MAAOnD,MAAO,QAGlBmG,E,kDAwBL,WAAYjE,GAAQ,IAAD,8BAClB,cAAMA,IAxBP9D,MAAQ,GAuBW,EAlBnBgI,WAAa,CACZC,QAAQ,EACRC,kBAAmB,MAgBD,EAdnBC,gBAAkB,CACjBtD,KAAM,SACNuD,QAAS,GACTC,KAAM,aACNC,UAAW,GACXC,UAAW,GACXC,MAAM,EACNC,OAAO,EACPC,QAAQ,EACRC,SAAS,EACT9J,KAAK,GAIa,EAiEnB4H,OAAS,SAAC9I,GACT,IAAIiL,EAAY,EAAKC,QAAQtJ,OAAOrC,KAAK,CACxCD,MAAO,eACP6L,OAAQ,EAAKD,QAAQ1H,WAAWd,cAChC0I,WAAY,EAAK/I,MAAMoI,UAGxB,GAAI,EAAKtE,MAAMkF,WAAY,CAC1B,MAAmD,EAAKhJ,MAAhDkI,EAAR,EAAQA,kBAAmBE,EAA3B,EAA2BA,QAASC,EAApC,EAAoCA,KAAMxD,EAA1C,EAA0CA,KAEzC+D,EADG/D,IAASqD,EAAkBrD,MAAQqD,EAAkBE,UAAYA,GAEjD,WAATvD,GAAqBqD,EAAkBG,OAASA,EAD9CO,EAAUvN,KAAK,EAAK4N,WAAW5N,KAAK,EAAK6N,SAIzCN,EAAUvN,KAAK,EAAK8N,qBAGjCP,EAAYA,EAAUvN,KAAK,EAAK6N,SAGjCN,EAAUvN,KAAK,EAAKV,SAAS,SAAAQ,GAC5BqH,OAAO4G,MAAMjO,EAAIU,YAGlB8B,EAAE0L,kBAzFgB,EA4FnBH,QAAU,YAAoB,IAAjBtI,EAAgB,EAAhBA,UACZ,OAAO,EAAKiI,QAAQtJ,OAAOrC,KAApB,yBACND,MAAO,EAAKqM,SAAS,EAAKtJ,MAAM6E,KAAM,QACnC,EAAK7E,OAFF,IAGNoI,QAASxH,MAhGQ,EAoGnBqI,UAAY,YAAoB,IAAjBrI,EAAgB,EAAhBA,UAEd,OAAO,EAAKiI,QAAQtJ,OAAOrC,KAAK,CAC/BD,MAAO,EAAKqM,SAAS,EAAKxF,MAAMkF,WAAWnE,KAAM,UACjDuD,QAAS,EAAKtE,MAAMkF,WAAWZ,QAC/BC,KAAM,EAAKvE,MAAMkF,WAAWX,OAC1BhN,MAAK,WAEP,MAAO,CAAEuF,iBA5GQ,EAgHnBuI,eAAiB,YAAoB,IAAjBvI,EAAgB,EAAhBA,UACnB,OAAO,EAAKiI,QAAQtJ,OAAOrC,KAApB,yBACND,MAAO,EAAKqM,SAAS,EAAKtJ,MAAM6E,KAAM,WACnC,EAAK7E,OAFF,IAGNoI,QAASxH,MApHQ,EAkInBjG,QAAU,WACT,EAAK4O,aAAaC,QAClB,EAAK1F,MAAMnJ,WAlIX8O,OAAOC,OAAO,EAAK1J,MAAnByJ,OAAA,IAAAA,QAAA,IAAAA,QAAA,IAAAA,QAAA,IAAAA,CAAA,GAA+B,EAAKzB,YAAe,EAAKG,iBAAoBrE,EAAMkF,YAAelF,EAAM6F,mBAEvG,EAAKJ,aAAe,IAAIpC,GAAQ,WAC/B,EAAK7G,SAAL,mDAAmB,EAAK0H,YAAe,EAAKG,iBAAoB,EAAKrE,MAAMkF,YAAe,EAAKlF,MAAM6F,qBACnG,KANe,E,0CASnB,WACC,IAAMC,IAAY7O,KAAK+I,MAAMkF,WAE7B,OACC,cAAC,EAAD,CACCa,aAAa,sBACb5B,OAAQlN,KAAK+I,MAAMmE,OACnBtN,QAASI,KAAKJ,QACdoJ,aAAchJ,KAAK+O,aAAe,mBAAqB,KAJxD,SAMC,eAAC,EAAD,CAAMxD,QAASsD,EAAU,kBAAoB,oBAAqBvD,SAAUtL,KAAK0L,OAAQxC,UAAU,kBAAnG,UACC,cAAC,EAAD,CAAOY,KAAK,QAAQE,MAAM,OAAOzC,QAASsF,EAAajD,KAAK,OAAOF,UAAW1J,OAC9E,cAAC,EAAD,CAAO8J,KAAK,OAAOE,MAAM,UAAUJ,KAAK,UAAUF,UAAW1J,OAC5DA,KAAKgP,eACLhP,KAAKiP,gBACN,cAAC,EAAD,CAAOnF,KAAK,OAAOE,MAAM,aAAaJ,KAAK,YAAYF,UAAW1J,KAAMgL,UAAWhL,KAAKiF,MAAMnB,MAC9F,cAAC,EAAD,CAAOgG,KAAK,aAAaE,MAAM,UAAUzC,QAASwF,EAAerD,UAAW1J,OAE5E,cAAC,EAAKwL,QAAN,CAAcE,QAAQ,EAAMI,SAAU9L,KAAKJ,iB,0BAM/C,WACC,MAAwB,WAApBI,KAAKiF,MAAM6E,KACP,KAGP,qCACC,cAAC,EAAD,CAAOA,KAAK,MAAME,MAAM,OAAOJ,KAAK,OAAOF,UAAW1J,OACtD,cAAC,EAAD,CAAO8J,KAAK,aAAaE,MAAM,aAAazC,QAASuF,EAAkBpD,UAAW1J,Y,2BAKrF,WACC,MAAwB,YAApBA,KAAKiF,MAAM6E,KACP,KAGP,cAAC,EAAD,CAAOA,KAAK,OAAOE,MAAM,YAAYJ,KAAK,YAAYF,UAAW1J,S,wBAInE,WAAc,IAAD,OACNkP,EAAYlP,KAAKiF,MAAMkI,mBAAqBnN,KAAKoN,gBACvD,YAAkF1J,IAA3EgL,OAAOS,KAAKD,GAAWE,MAAK,SAAAC,GAAG,OAAI,EAAKpK,MAAMoK,KAASH,EAAUG,Q,gCAGzE,SAAmBC,EAAWC,GACzBvP,KAAK+I,MAAMmE,QAA+B,MAArBlN,KAAKwO,cAC7BxO,KAAKwO,aAAagB,a,sBA2DpB,SAAS1F,EAAM5H,GACd,GAAa,YAAT4H,EACH,MAAO,kBAAoB5H,EACrB,GAAa,WAAT4H,EACV,MAAO,qBAAuB5H,EAE9B,MAAM,IAAI/B,MAAM,oBAAsB2J,M,uCASxC,SAAgC2F,EAAWF,GAC1C,GAAIE,EAAUvC,SAAWqC,EAAUrC,OAAQ,CAC1C,IAAMC,EAAoBsC,EAAUxB,WAChCd,IAEHA,EAAkBE,QAAU,KAAOX,EAAYS,EAAkBE,SAC7DF,EAAkBG,OACrBH,EAAkBG,KAAO,KAAOZ,EAAYS,EAAkBG,OAE/DH,EAAkBI,UAAYJ,EAAkBI,WAAa,GAC7DJ,EAAkBK,UAAYL,EAAkBK,WAAa,IAE9D,IAAMoB,EAAmBa,EAAUb,iBAOnC,OANIA,IACHA,EAAiBvB,QAAU,KAAOX,EAAYkC,EAAiBvB,SAC3DuB,EAAiBtB,OACpBsB,EAAiBtB,KAAO,KAAOZ,EAAYkC,EAAiBtB,QAGvD,yBAAEJ,QAAQ,GAASC,GAA1B,IAA6CA,qBAAsByB,GAEpE,OAAKa,EAAUvC,QAAUqC,EAAUpC,kBAC3B,CAAEA,kBAAmB,MAEtB,S,GAvLqB7D,iBAyM9B0D,EAAgB0C,YAAcrJ,EAEf2G,QC/LA2C,kBAAY,kBAAZA,EApCf,SAAoC5G,GACnC,IAAQ4B,EAAgB5B,EAAhB4B,GAAIiF,EAAY7G,EAAZ6G,QAEZ,OACC,eAAC,IAAD,CAAajF,GAAIA,EAAjB,WACS,OAAPiF,QAAO,IAAPA,OAAA,EAAAA,EAAS3B,YAAc,qCACvB,cAAC,IAAD,CAAUrC,QAAS,kBAAM7C,EAAM8G,iBAAiBD,EAAQ3B,aAAxD,0BAGA,cAAC,IAAD,CAAUrC,QAAS,kBAAM7C,EAAM+G,eAAeF,EAAQ3B,aAAtD,wBAGA,cAAC,IAAD,CAAUrC,QAAS,kBAAM7C,EAAMgH,iBAAiBH,EAAQ3B,aAAxD,oBAGA,cAAC,IAAD,CAAU+B,SAAO,OACX,KACP,cAAC,IAAD,CAAUpE,QAAS,kBAAM7C,EAAMkH,oBAA/B,iC,OCdY,SAASC,EAAoBnH,GAC3C,IAAM+E,EAAUtH,IAERyH,EAAyBlF,EAAzBkF,WAEFkC,EAAU,SAACpH,GAChB,MAAO,CAAEkF,WAAYA,IAEhBmC,EAAa,CAClBC,cAAe,WAEd,OADAtH,EAAMuH,eAAerC,IACd,GAERsC,YAAa,WAEZ,OADAxH,EAAMyH,YACC,GAERtH,UAdgCH,EAAb0H,SAcG,gCAAkC,MAGnDC,EACL,oBAAIxH,UAAU,wCAAd,SACC,uBAAOY,KAAK,WAAWC,QAASkE,EAAWL,QAAS1E,UAAU,mCAAmCO,SAAU,kBAAMV,EAAM8G,iBAAiB5B,QAI1I,MAAwB,YAApBA,EAAWnE,KAEb,eAAC,IAAD,CAAoBa,GAAG,kBAAkBgG,UAAU,KAAKC,eAAgB,EAAGR,WAAYA,EAAYS,QAASV,EAA5G,UACEO,EACD,yCACA,oCAAOhE,EAAYuB,EAAWZ,YAC9B,6BAAKY,EAAW6C,QAAU,MAC1B,6BAAK7C,EAAW8C,MAAQ,MACxB,6BAAK9C,EAAWV,WAAa,MAC7B,sCAG4B,WAApBU,EAAWnE,KAEpB,eAAC,IAAD,CAAoBa,GAAG,kBAAkBgG,UAAU,KAAKC,eAAgB,EAAGR,WAAYA,EAAYS,QAASV,EAA5G,UACEO,EACD,6BAAKM,GAAwB/C,KAC7B,oCAAOvB,EAAYuB,EAAWZ,YAC9B,oCAAOX,EAAYuB,EAAWX,SAC9B,6BAAKW,EAAW8C,MAAQ,MACxB,6BAAK9C,EAAWV,WAAa,MAC7B,6BAAKU,EAAWgD,WAIlBnD,EAAQhK,IAAI,8BAAgCmK,EAAWnE,MAChD,MAIT,SAASkH,GAAwB/C,GAChC,IAMInE,EANI4D,EAAwBO,EAAxBP,MAAOD,EAAiBQ,EAAjBR,KAAME,EAAWM,EAAXN,OAErB,OAAMF,IAASC,IAAYA,GAASD,GAAQE,EACpC,WAIJF,GAAQC,EACX5D,EAAO,aACG2D,EACV3D,EAAO,OACG4D,IACV5D,EAAO,SAGJ6D,EACI7D,EAAO,UAEPA,G,OCvEM,SAASoH,GAAoBnI,GAC3C,IAAM+E,EAAUtH,IAER2K,EAAyDpI,EAAzDoI,YAAaC,EAA4CrI,EAA5CqI,YAAaC,EAA+BtI,EAA/BsI,eAAgBC,EAAevI,EAAfuI,WAElD,EAAkDC,mBAAS,MAA3D,mBAAOC,EAAP,KAA0BC,EAA1B,KACA,EAAoDF,oBAAS,GAA7D,mBAAOG,EAAP,KAA2BC,EAA3B,KAEMC,EAAyB,SAAC3D,GACP,YAApBA,EAAWnE,KACdgE,EAAQtJ,OAAOrC,KAAK,CACnBD,MAAO,wBACPmL,QAASY,EAAWZ,QACpBO,SAAUK,EAAWL,UAEQ,WAApBK,EAAWnE,MACrBgE,EAAQtJ,OAAOrC,KAAK,CACnBD,MAAO,2BACPmL,QAASY,EAAWZ,QACpBC,KAAMW,EAAWX,KACjBM,SAAUK,EAAWL,WAKlBiE,EAAyB,SAAC5D,GACP,YAApBA,EAAWnE,KACdgE,EAAQtJ,OAAOrC,KAAK,CACnBD,MAAO,wBACPmL,QAASY,EAAWZ,UAES,WAApBY,EAAWnE,MACrBgE,EAAQtJ,OAAOrC,KAAK,CACnBD,MAAO,2BACPmL,QAASY,EAAWZ,QACpBC,KAAMW,EAAWX,QAKdwE,EAAuB,SAAC7D,GACL,YAApBA,EAAWnE,KACdwH,EAAWrD,EAAWZ,SACZY,EAAWnE,MA8CvB,OACC,qCACC,eAAC,IAAD,CAAoBa,GAAG,kBAAkBgG,UAAU,MAAMC,eAAgB,EAAGR,WAAY,CAAEzF,GAAI,uBAA9F,UACC,wBAAOzB,UAAU,6BAA6B6I,UAvC/B,SAACnJ,GAClB,IAAIF,IAAJ,CAIe,YAAXE,EAAGyG,KAAqB+B,EAAc,IACzCC,EAAeD,EAAc,GAC7BxI,EAAG0F,kBAEW,cAAX1F,EAAGyG,KAAuB+B,EAAcD,EAAYhO,OAAS,IAChEkO,EAAeD,EAAc,GAC7BxI,EAAG0F,kBAGJ,IAAM0D,EAAqBb,EAAYC,GAClCY,IAGU,eAAXpJ,EAAGyG,MACNyC,EAAqBE,GACrBpJ,EAAG0F,kBAEW,MAAX1F,EAAGyG,MACNuC,EAAuBI,GACvBpJ,EAAG0F,kBAEW,UAAX1F,EAAGyG,MACNoC,EAAqBO,GACrBpJ,EAAG0F,kBAEW,WAAX1F,EAAGyG,MACNwC,EAAuBG,GACvBpJ,EAAG0F,qBAOkE2D,SAAU,EAA9E,UACC,gCACC,+BACC,uCACA,sCACA,wCACA,4CACA,wCACA,2CACA,2CAGF,qCACC,qBAAK/I,UAAU,4CACf,qBAAKA,UAAU,sCACf,qBAAKA,UAAU,sCACf,qBAAKA,UAAU,sCACf,qBAAKA,UAAU,sCACf,qBAAKA,UAAU,sCACf,qBAAKA,UAAU,8CAEhB,gCACEiI,EAAYrG,KAAI,SAACmD,EAAYpM,GAAb,OAChB,cAAC,EAAD,CAECoM,WAAYA,EACZwC,SAAU5O,IAAUuP,EACpBd,eAAgBwB,EAChBjC,iBAAkB+B,EAClBpB,SAAU,kBAAMa,EAAexP,KANhC,UACSoM,EAAWZ,QADpB,YAC+BY,EAAWX,MAAQ,YAS7B,IAAvB6D,EAAYhO,OACZ,qBAAK+F,UAAU,sCAAf,gCACE,QAEJ,cAAC,EAAD,CACCgE,UAAWsE,IAAqBE,GAChC9R,QAnFgC,WAClC6R,EAAqB,MACrBE,GAAsB,IAkFpB1D,WAAYuD,IAEb,cAAC,EAAD,CACC3B,iBAAkB+B,EAClB9B,eAAgB,SAAC7B,GAAD,OAAgBwD,EAAqBxD,IACrD8B,iBAAkB8B,EAClB5B,iBAAkB,kBAAM0B,GAAsB,SC9InC,SAASO,GAAgBnJ,GACvC,IAAM+E,EAAUtH,IAEhB,EAA4C+K,mBAAS,IAArD,mBAAOY,EAAP,KAAuBC,EAAvB,KACA,EAAkDb,mBAAS,IAA3D,mBAAOc,EAAP,KAA0BC,EAA1B,KACA,EAAsCf,oBAAU,GAAhD,mBAAOH,EAAP,KAAoBC,EAApB,KAEMF,EAAW,sBAAOkB,GAAP,YAA6BF,IAExCI,EAAsBC,uBAAY,WAClC1E,EAAQ1H,WAAWhB,SAGxB0I,EAAQtJ,OAAOrC,KAAK,CACnBD,MAAO,wBACL5B,MAAK,YAAsB,IAAnB6Q,EAAkB,EAAlBA,YACViB,EAAkBjB,EAAYrG,KAAI,SAAA2H,GAAC,kCAAUA,GAAV,IAAa3I,KAAM,mBACpD,WACFsI,EAAkB,SAEjB,CAACtE,EAAQtJ,OAAQsJ,EAAQ1H,WAAWhB,UAEjCsN,EAAyBF,uBAAY,WACrC1E,EAAQ1H,WAAWhB,SAGxB0I,EAAQtJ,OAAOrC,KAAK,CACnBD,MAAO,2BACL5B,MAAK,YAAsB,IAAnB6Q,EAAkB,EAAlBA,YACVmB,EAAqBnB,EAAYrG,KAAI,SAAA2H,GAAC,kCAAUA,GAAV,IAAa3I,KAAM,kBACvD,WACFwI,EAAqB,SAEpB,CAACxE,EAAQtJ,OAAQsJ,EAAQ1H,WAAWhB,UAEjCuN,EAAmBH,uBAAY,WACpCD,IACAG,MACE,CAACH,EAAqBG,IAEnBE,EAAmBJ,uBAAY,WACpCJ,EAAkB,IAClBE,EAAqB,IACrBjB,GAAgB,KACd,IAkBH,OAhBAwB,qBAAU,WACT,IAAM9S,EAAaqE,EAAUW,OAAO,CACnC,aAAc,kBAAM4N,KACpB,YAAa,kBAAMC,KACnB,WAAc,kBAAMD,KACpB,eAAgB,kBAAMA,KACtB,qBAAsB,kBAAMJ,KAC5B,wBAAyB,kBAAMA,KAC/B,wBAAyB,kBAAMA,KAC/B,wBAAyB,kBAAMG,KAC/B,2BAA4B,kBAAMA,KAClC,2BAA4B,kBAAMA,OAEnC,OAAO,kBAAMtO,EAAU4B,OAAOjG,MAC5B,CAAC4S,EAAkBJ,EAAqBG,EAAwBE,IAGlE,cAAC,GAAD,CAAqBzB,YAAaA,EAAaC,YAAaA,EAAaC,eAAgBA,EAAgBC,WAAYvI,EAAMuI,aCpE7H,IAAIwB,IAAgB,EAEhB1O,GAAY,GAkBhB,SAAS2O,KACR,IAAMC,EAAMC,SAASC,eAAe,wBACpC,OAAKF,GAlBN,WACC,IAAMA,EAAMC,SAASE,cAAc,OAYnC,OAXAH,EAAIrI,GAAK,uBACTqI,EAAIhL,MAAMoL,MAAQ,EAClBJ,EAAIhL,MAAMqL,OAAS,EACnBL,EAAIhL,MAAMsL,QAAU,EACpBN,EAAIhL,MAAMM,SAAW,WACrB0K,EAAIhL,MAAMf,IAAM,EAChB+L,EAAIhL,MAAMd,KAAO,EACjB8L,EAAIhL,MAAMuL,cAAgB,OAC1BP,EAAIhL,MAAMwL,WAAa,MACvBP,SAASQ,KAAKC,YAAYV,GAEnBA,EAMCW,GAKF,SAASC,GAASC,GACxBf,IAAgB,EAEhB,IACC,IAAMgB,EAAaf,KACnBe,EAAWC,YAAcF,EAEzB,IAAMG,EAAWF,EAAWG,WACtBC,EAAQjB,SAASkB,cACvBD,EAAME,SAASJ,EAAU,GACzBE,EAAMG,OAAOL,EAAUH,EAAK1Q,QAE5B,IAAMmR,EAAY7M,OAAO8M,eACnBC,EAAoC,IAAzBF,EAAUG,WAAmBH,EAAUI,WAAW,GAAK,KAExEJ,EAAUK,kBACVL,EAAUM,SAASV,GAEnB,IACCjB,SAAS4B,YAAY,QACpB,MAAOjS,GACR6E,OAAOqN,OAAO,kCAAmCjB,GAGlDS,EAAUK,kBACNH,GACHF,EAAUM,SAASJ,GAvBrB,QA0BC1B,IAAgB,GAgBlB,SAASiC,GAAgBzN,EAAM0N,GAC9B,KAAO1N,GAAQA,IAAS2L,UAAU,CACjC,GAAI3L,EAAK2N,QAAQD,GAChB,OAAO,EAER1N,EAAOA,EAAKQ,WAGb,OAAO,EAZHoN,QAAQC,UAAUF,UACtBC,QAAQC,UAAUF,QAAUC,QAAQC,UAAUC,mBAc/CnC,SAAStK,iBAAiB,QAAQ,SAACC,GAClC,IAAMsL,EAA+C,IAAvCjB,SAASsB,eAAeE,WAAmBxB,SAASsB,eAAeG,WAAW,GAAK,KACjG,KAAKR,GAAUA,EAAMmB,YAAevC,GAApC,CAFyC,oBAOpB1O,IAPoB,IAOzC,2BAAgC,CAAC,IAAxBS,EAAuB,QAC/B,GAAKkQ,GAAgB9B,SAASqC,cAAezQ,EAASmQ,UAAtD,CAIA,IAAMxS,EAASqC,EAASpD,QAAQmH,GAC5BpG,IAEC,OAAO+S,KAAK9N,OAAO+N,UAAUC,UAChC7M,EAAG8M,cAAcC,QAAQ,aAAcnT,EAAOoT,QAAQ,MAAO,SAE7DhN,EAAG8M,cAAcC,QAAQ,aAAcnT,GAExCoG,EAAG0F,oBApBoC,mC,IC9EpCuH,G,4MA8DLC,kBAAoB,SAAClN,EAAI5G,GACxB4R,GAASlH,EAAY1K,EAAK+T,KAAK1I,UAC/BrL,EAAKsF,KAAK0O,S,EAGXC,cAAgB,SAACrN,EAAI5G,GAKpB4R,GAJiB,EAAK7K,MAAMmN,mBAAmBpL,KAAI,SAAAiL,GAElD,OAAOA,EAAKI,cAAgBJ,EAAKI,cAAcrL,IAAI4B,GAAa0J,KAAK,MAAQ1J,EAAYqJ,EAAKM,aAE7ED,KAAK,OACvBpU,EAAKsF,KAAK0O,S,EAGXM,iBAAmB,SAAC1N,EAAI5G,GAEvB4R,GADc,EAAK7K,MAAMwN,qBAEzBvU,EAAKsF,KAAK0O,S,EAGXQ,eAAiB,SAAC5N,EAAI5G,GAErBwK,YAAW,WACV,EAAKzD,MAAM0N,oBAAoBzU,EAAK+T,KAAM,IAAIW,OAAM,iBAGlD,I,EAGJC,eAAiB,SAAC/N,EAAI5G,GACrB,EAAK8L,QAAQtJ,OAAOrC,KAAK,CACxBD,MAAO,eACPmL,QAASrL,EAAK+T,KAAK1I,UACjBqJ,OAAM,eAGT1U,EAAKsF,KAAK0O,S,EAGXY,aAAe,SAAChO,EAAI5G,GACnB,EAAK8L,QAAQtJ,OAAOrC,KAAK,CACxBD,MAAO,aACP6L,OAAQ,EAAKD,QAAQ1H,WAAWd,cAChC7C,KAAM,KACNoE,MAAO7E,EAAK+T,KAAK1I,UACfqJ,OAAM,SAACtW,GACT,EAAK0N,QAAQhK,IAAI,wBAA0B1D,O,EAI7CwR,uBAAyB,SAAChJ,EAAI5G,GAC7B,EAAK+G,MAAM8G,iBAAiB7N,EAAK+T,O,EAGlCc,mBAAqB,SAACjO,EAAI5G,GACzB,EAAK+G,MAAM+N,cAAa,EAAM9U,EAAK+T,O,EAGpCgB,WAAa,SAACnO,EAAI5G,GAEjB4B,QAAQE,IAAI9B,GACZA,EAAKsF,KAAK0O,S,4CArHX,WACC,MAAwBhW,KAAK+I,MAArB4B,EAAR,EAAQA,GAAIiF,EAAZ,EAAYA,QACN5E,GAAYhL,KAAK8N,QAAQ1H,WAAWlB,UAAYlF,KAAK8N,QAAQ1H,WAAWjB,OACxE4Q,EAAOnG,GAAWA,EAAQmG,KAE1Be,EAAef,IAAyB,OAAhBA,EAAKiB,QAAyC,OAAtBjB,EAAKkB,cAAuC,SAAdlB,EAAKjM,MAEzF,OACC,eAAC,IAAD,CAAaa,GAAIA,EAAjB,UACC,cAAC,IAAD,CAAUiB,QAAS5L,KAAK8V,kBAAxB,0BAGA,cAAC,IAAD,CAAUlK,QAAS5L,KAAKiW,cAAxB,oCAGA,cAAC,IAAD,CAAUrK,QAAS5L,KAAKsW,iBAAxB,uCAGA,cAAC,IAAD,CAAUtG,SAAO,IACjB,cAAC,IAAD,CAAUhF,SAAUA,EAAUY,QAAS5L,KAAKwW,eAA5C,gCAGA,cAAC,IAAD,CAAUxG,SAAO,IACjB,cAAC,IAAD,CAAUhF,SAAUA,EAAUY,QAAS5L,KAAK2W,eAA5C,2BAGA,cAAC,IAAD,CAAU3L,SAAUA,EAAUY,QAAS5L,KAAK4W,aAA5C,4BAGA,cAAC,IAAD,CAAUhL,QAAS5L,KAAK4R,uBAAxB,+BAGA,cAAC,IAAD,CAAU5B,SAAO,IACjB,cAAC,IAAD,CAAUhF,UAAW8L,EAAclL,QAAS5L,KAAK6W,mBAAjD,2BAGA,cAAC,IAAD,CAAU7U,KAAM,CAAEoJ,OAAQ,eAAiBQ,QAAS5L,KAAK+W,WAAzD,kCAGA,cAAC,IAAD,CAAU/U,KAAM,CAAEoJ,OAAQ,YAAcQ,QAAS5L,KAAK+W,WAAtD,kCAGA,cAAC,IAAD,CAAU/G,SAAO,IACjB,cAAC,IAAD,CAAUhO,KAAM,CAAEoJ,OAAQ,eAAiBQ,QAAS5L,KAAK+W,WAAzD,gCAGA,cAAC,IAAD,CAAU/U,KAAM,CAAEoJ,OAAQ,eAAiBQ,QAAS5L,KAAK+W,WAAzD,6BAGA,cAAC,IAAD,CAAU/U,KAAM,CAAEoJ,OAAQ,YAAcQ,QAAS5L,KAAK+W,WAAtD,sC,GAvD4BzN,iBAgJhCuM,GAAkBnG,YAAcrJ,EAEjBsJ,mBAAY,SAAZA,CAAsBkG,ICvCtBqB,G,4JA7Gd,WACC,IAAMC,EAAMnX,KAAKoX,UACjB,GAAY,OAARD,GAA0C,IAA1BnX,KAAK+I,MAAMsO,WAC9B,OAAO,KAER,IAAMC,EAAUjM,YAAW,CAC1B,mBAAqB,EACrB,8BAA+BrL,KAAK+I,MAAM0H,WAG3C,OACC,qBAAKvH,UAAWoO,EAAStP,MAAOmP,EAAhC,SACC,qBAAKI,MAAM,6BAA6BnE,MAAM,IAAIC,OAAQ8D,EAAI9D,OAA9D,SACC,sBAAMmE,EAAGxX,KAAKyX,UAAUN,EAAI9D,gB,uBAMhC,SAAUA,GACT,MAAqCrT,KAAK+I,MAAlC2O,EAAR,EAAQA,MAAOxD,EAAf,EAAeA,MAAOmD,EAAtB,EAAsBA,WAChBM,EAAU5T,KAAK6T,MAAMP,EAAa,GAAK,GAGvCQ,EAAY,gBAAYF,EAAZ,eAA0BN,EAA1B,mBAA+CA,EAAaM,GACxEG,EAAa,kBACbC,EAAY,yCAGdC,EAAO,CAAC,MAAQL,GAoBpB,OAlBID,EAAMzQ,IAAMiN,EAAMzF,MACrBuJ,EAAKtW,KAAKmW,GACoB,OAApBH,EAAMO,UAChBD,EAAKtW,KAAKqW,GAEVC,EAAKtW,KAAKoW,GAGXE,EAAKtW,KAAK,cAAgB2R,EAASgE,GAAc,YAE7CK,EAAMvQ,QAAU+M,EAAMgE,IACzBF,EAAKtW,KAAKmW,GACoB,SAApBH,EAAMO,UAChBD,EAAKtW,KAAKqW,GAEVC,EAAKtW,KAAKoW,GAGJE,EAAK5B,KAAK,O,qBAGlB,WACC,IAAQsB,EAAU1X,KAAK+I,MAAf2O,MACFzQ,EAAMjH,KAAKmY,kBAAkBT,EAAMzQ,KAAK,GACxCE,EAASnH,KAAKmY,kBAAkBT,EAAMvQ,QAAQ,GACpD,OAAY,OAARF,GAA2B,OAAXE,EACZ,KAKD,CAAEF,MAAKG,MAFoB,GAAnB,GAAKsQ,EAAMU,MAEL/E,OADNlM,EAASF,K,+BAIzB,SAAkBoG,EAASgL,GAC1B,IAWIC,EAXJ,EAA2BtY,KAAK+I,MAAxBwP,EAAR,EAAQA,QAASrE,EAAjB,EAAiBA,MACjB,GAAI7G,GAAW6G,EAAMgE,IACpB,OAAKhE,EAAMgE,IAAM,KAAMK,GAAWF,EAC1BE,EAAQrE,EAAMgE,IAAM,GAAKlY,KAAK+I,MAAMsO,WAEvCnD,EAAMgE,IAAM,KAAMK,GAAWF,EAC1BE,EAAQrE,EAAMgE,IAAM,GAAKlY,KAAK+I,MAAMsO,WAErC,KAIR,GAAIhK,EAAU6G,EAAMzF,QAAU4J,EAC7BC,EAAM,OACA,GAAIjL,KAAWkL,EACrBD,EAAMC,EAAQlL,OACR,MAAIA,EAAU,KAAKkL,GAIzB,OAAO,KAFPD,EAAMC,EAAQlL,EAAU,GAKzB,OAAOgL,EAAOC,EAAMtY,KAAK+I,MAAMsO,WAAaiB,M,GA1FdhP,iBCFjB,SAASkP,GAAezP,GACtC,OACC,qBAAKwO,MAAM,6BAA6BrO,UAAWH,EAAMG,UAAWuP,QAAQ,gBAAgBrF,MAAM,KAAKC,OAAO,KAA9G,SACC,sBAAMmE,EAAE,yb,IC4JIkB,G,kDAtJd,WAAY3P,GAAQ,IAAD,8BAClB,cAAMA,IAED4P,IAAMC,sBAHO,E,0CAMnB,WAAU,IAAD,OACR,EAA4C5Y,KAAK+I,MAAzCgN,EAAR,EAAQA,KAAMtF,EAAd,EAAcA,SAAUoI,EAAxB,EAAwBA,QAASC,EAAjC,EAAiCA,OAE3B5P,EAAYmC,YAAW,CAC5B,YAAc,EACd,uBAAwBoF,IAAaoI,EACrC,sBAAuBA,EACvB,qBAAsBC,EACtB,yBAA0B/C,EAAK9H,YAAc8H,EAAK9H,WAAWL,QAC7D,kCAAmCmI,EAAK9H,aAAe8H,EAAK9H,WAAWL,QACvE,sBAAuBmI,EAAKgD,cAGvB5I,EAAU,SAACpH,GAChB,MAAO,CAAEgN,OAAMzO,KAAM,EAAKqR,IAAIK,QAAQlR,aAEjCsI,EAAa,CAClBC,cAAe,SAACzH,GAAD,OAAQ,EAAKyH,cAAczH,EAAIuH,MAC9C8B,SAAU,GAGX,OACC,cAAC,IAAD,CAAoBtH,GAAI3K,KAAK+I,MAAMkQ,YAAatI,UAAU,IAAIE,QAASV,EAASC,WAAYA,EAAYQ,eAAgB,EAAxH,SACC,sBAAK1H,UAAWA,EAAWlB,MAAO,CAAEkR,gBAAiBnD,EAAKmD,iBAAmBP,IAAK3Y,KAAK2Y,IAAKQ,eAAcpD,EAAK1I,QAA/G,UACC,cAACmL,GAAD,CAAgBtP,UAAU,gCACzBlJ,KAAKoZ,cAAcrD,GACpB,uBAAM7M,UAAU,qBAAhB,UAAsClJ,KAAKqZ,UAAUtD,EAAKtT,KAAM,GAAIsT,EAAKuD,QAAzE,OACA,uBAAMpQ,UAAU,qBAAhB,UAAsClJ,KAAKuZ,gBAAgBxD,EAAKuD,OAAQvD,EAAKtT,KAAM,IAAKzC,KAAKwZ,kBAAkBzD,a,2BAMnH,SAAcA,GACb,IAAQjF,EAA8BiF,EAA9BjF,OAAQzD,EAAsB0I,EAAtB1I,QAASgJ,EAAaN,EAAbM,SACnBoD,EAAa/M,EAAYW,GAE/B,OAAIrN,KAAK+I,MAAM2Q,eACC,OAAX5I,EACI,sBAAM5H,UAAU,kDAAhB,SAAmElJ,KAAKqZ,UAAUvI,EAAS,OAE5F,sBAAM5H,UAAU,oDAAhB,SAAqElJ,KAAKqZ,UAAUI,KAG3F,uBAAMvQ,UAAU,mDAAhB,UACElJ,KAAKqZ,UAAUI,GADjB,IAC+B/M,EAAY2J,Q,+BAK7C,SAAkBN,GACjB,OAAIA,EAAKgD,aAAqC,OAAtBhD,EAAK4D,aACrB5D,EAAK4D,aAAe,UAAY,WAEjC,K,uBAGR,SAAU9F,GAAgC,IAA1B+F,EAAyB,uDAAhB,GAAIC,EAAY,uDAAJ,GAC5BR,EAAcrZ,KAAK+I,MAAnBsQ,UACR,GAAkB,OAAdA,EAAoB,CACvB,IAAMS,GAAYF,EAASA,EAAS,IAAM,IAAM/F,EAAO,IAAMgG,EACzD1C,EAAM2C,EAASC,cAAcjY,QAAQuX,GACrCW,EAAcX,EAAUlW,OAC5B,IAAa,IAATgU,EAAY,CACf,IAAM8C,EAAeL,EAASA,EAAOzW,OAAS,EAAI,EAC9CgU,EAAM8C,EAET9C,GADA6C,GAAeC,EAAe9C,GACV,EAAI,GAAK,EAE7BA,GAAO8C,EAIT,GAAI9C,GAAO,GAAKA,EAAMtD,EAAK1Q,OAAQ,CAClC,IAAM+F,EAAYmC,YAAW,CAC5B,uBAAyB,EACzB,6BAA8B8L,EAAM6C,EAAcnG,EAAK1Q,OAAS,IAEjE,OACC,qCACE0Q,EAAK3P,OAAO,EAAGiT,GAChB,sBAAMjO,UAAWA,EAAjB,SAA6B2K,EAAK3P,OAAOiT,EAAK6C,KAC7CnG,EAAK3P,OAAOiT,EAAM6C,OAKvB,OAAOnG,I,6BAGR,SAAgBA,GAAgC,IAA1B+F,EAAyB,uDAAhB,GAAIC,EAAY,uDAAJ,GAC1C,EAAuC7Z,KAAK+I,MAApCsQ,EAAR,EAAQA,UAAWE,EAAnB,EAAmBA,gBACnB,GAAkB,OAAdF,EAAoB,CACvB,IAAMC,EAASzF,EAAKqG,MAAM,WACpBC,EAAcZ,GAAmB,GACvC,OAAOD,EAAOxO,KAAI,SAACsP,EAAO/K,GACzB,IAAInG,EAAY,oBAIhB,OAHIiR,EAAYlY,SAASmY,KACxBlR,GAAa,mCAEP,sBAAMA,UAAWA,EAAjB,SAAuCkR,GAAN/K,MAG1C,OAAOrP,KAAKqZ,UAAUxF,EAAM+F,EAAQC,K,2BAGrC,SAAcjR,EAAI5G,GACC,IAAd4G,EAAGyR,QACNra,KAAK+I,MAAMsH,cAAczH,EAAI5G,K,0BAI/B,SAAasY,GACZ,IAAMC,EAAcva,KAAK2Y,IAAIK,QAAQlR,YACjB,IAAhBwS,GACHjT,EAAakT,EAAa,CAAEC,MAAOF,IAEpCC,EAAYvE,W,iCAGb,SAA0BlO,EAAYuF,GACrC,IAAMoN,EAAW3S,EAAW4S,cAAc,6BAA+BrN,EAAU,MACnF,OAAIoN,EACiBA,EAAS3S,WACVD,wBAAwBZ,IAErC,S,GAvIgBqC,iBC0YVqR,G,kDAzXd,WAAY5R,GAAQ,IAAD,8BAClB,cAAMA,IAhBP9D,MAAQ,CACP2V,WAAW,EACX/B,SAAS,EACTgC,YAAa,GACbC,kBAAmB,GACnBC,mBAAoB,GACpBC,UAAW,KACXC,iBAAkB,KAClBC,oBAAqB,MAOH,EAsKnBC,OAAS,SAACvS,GACT,OAAO,EAAKG,MAAMwN,qBApKlB,EAAKoC,IAAMC,sBACX,EAAKwC,UAAYxC,sBACjB,EAAKyC,aAAe,IAAIjP,GAAQ,kBAAM,OAAM,IAC5C,EAAKkP,cAAgB,IAAIlP,GAAQ,WAChC,EAAK7G,UAAS,SAAAgK,GAAS,MAAK,CAAEwL,mBAAoBxL,EAAUuL,wBAC1D,IARe,E,0CAWnB,WAAU,IAAD,OACFS,EAAS,CACdC,mBAAoB,SAAA5S,GAAE,OAAI,EAAK2H,YAAY3H,IAC3C6S,iBAAkBzb,KAAKiF,MAAM2V,UAAa,SAAAhS,GAAE,OAAI,EAAK8S,UAAU9S,SAAOlF,EACtEiY,YAAa3b,KAAKiF,MAAM2V,UAAa,SAAAhS,GAAE,OAAI,EAAK+S,YAAY/S,SAAOlF,EACnEqO,UAAW,SAAAnJ,GAAE,OAAI,EAAKmJ,UAAUnJ,IAChCgT,OAAQ,SAAAhT,GAAE,OAAI,EAAKiT,cAAcjT,GAAI,IACrCkT,QAAS,SAAAlT,GAAE,OAAI,EAAKiT,cAAcjT,GAAI,KAGvC,OACC,8CAAKM,UAAU,eAAeyP,IAAK3Y,KAAK2Y,KAAS4C,GAAjD,cACEvb,KAAK+I,MAAMgT,MAAMjR,KAAI,SAACiL,GAAD,OAAU,EAAKiG,WAAWjG,MAC/C/V,KAAK+I,MAAMkT,aAAanR,KAAI,SAAC4M,GAAD,OAAW,EAAKwE,kBAAkBxE,Y,wBAKlE,SAAW3B,GACV,MAAmC/V,KAAK+I,MAAhC2Q,EAAR,EAAQA,eAAgBZ,EAAxB,EAAwBA,OACpB/P,EAAQ,CACX2Q,iBACA3D,OACAtF,SAAUzQ,KAAKmc,eAAepG,GAC9B+C,OAAQ/C,EAAK1I,UAAYyL,EACzBzI,cAAerQ,KAAK+I,MAAMsH,cAC1BsI,IAAK5C,EAAK1I,UAAYyL,EAAS9Y,KAAKob,eAAY1X,EAEhD2V,UAAWrZ,KAAKoc,gBAAgBrG,EAAM/V,KAAK+I,MAAMsT,eAAiBrc,KAAK+I,MAAMsT,cAAgB,KAC7F9C,gBAAiBvZ,KAAKsc,sBAAsBvG,GAAQ/V,KAAKiF,MAAM8V,mBAAqB,MAIrF,OAFAhS,EAAM8P,QAAU9P,EAAM0H,UAAYzQ,KAAKiF,MAAM4T,QAEtC,cAAC,GAAD,aAA+BI,YAAY,UAAalQ,GAAvCgN,EAAK1I,W,+BAG9B,SAAkBqK,GACjB,IAAMrI,EAAMkN,OAAO7E,EAAMzQ,KAAOsV,OAAO7E,EAAMvQ,QAAUuQ,EAAMO,UAC7D,EAAsCjY,KAAK+I,MAAnCmL,EAAR,EAAQA,MAAOmD,EAAf,EAAeA,WAAYyB,EAA3B,EAA2BA,OACrB/P,EAAQ,CACbsG,MACAqI,QACAa,QAASvY,KAAKiF,MAAM4V,YACpB3G,QACAmD,aACA5G,SAAUiH,EAAMzQ,MAAQ6R,GAAUpB,EAAMvQ,SAAW2R,GAGpD,OAAO,cAAC,GAAD,eAAuB/P,M,6BAG/B,SAAgBgN,EAAMyG,GACrB,IAAIC,EAAQ,GAOZ,OANAA,EAAM/a,KAAKgL,EAAYqJ,EAAK1I,UACR,OAAhB0I,EAAKjF,QACR2L,EAAM/a,KAAKqU,EAAKjF,OAAS,KAE1B2L,EAAM/a,KAAKqU,EAAKtT,KAAO,IAAMsT,EAAKuD,QAE3BmD,EAAMC,MAAK,SAAAC,GAAI,OAA2C,IAAvCA,EAAK5C,cAAcjY,QAAQ0a,Q,mCAGtD,SAAsBzG,EAAMyG,GAC3B,OAAIxc,KAAKmc,eAAepG,IAGjB/V,KAAKiF,MAAM8V,mBAAmB2B,MAAK,SAAAtC,GAAK,OAAoC,IAAhCrE,EAAKuD,OAAOxX,QAAQsY,Q,gCAIxE,SAAmB/M,GAElB,OAAOqL,GAAWkE,mBAAmB5c,KAAK2Y,IAAIK,QAAS3L,K,gCAIxD,SAAmB9F,GACdvH,KAAKob,UAAUpC,SAClBhZ,KAAKob,UAAUpC,QAAQ3R,aAAaE,K,4BAItC,SAAewO,GACd,OAAO4E,EAAWwB,eAAenc,KAAK+I,MAAOgN,K,+BAwD9C,WLjHM,IAAoBf,EAAUvT,EAAVuT,EKkHd,gBLlHwBvT,EKkHPzB,KAAKmb,OLjHlC/W,GAAU1C,KAAK,CAAEsT,WAAUvT,c,kCKoH3B,WLjHM,IAAoBuT,EAAUvT,EAAVuT,EKkHd,gBLlHwBvT,EKkHPzB,KAAKmb,OLjHlC/W,GAAYA,GAAUyY,QAAO,SAAAC,GAAC,OAAIA,EAAE9H,WAAaA,GAAY8H,EAAErb,UAAYA,KKkH1EzB,KAAKsb,cAAchP,W,gCAGpB,SAAmBgD,EAAWC,GACzBvP,KAAKiF,MAAM6V,oBAAsBvL,EAAUuL,mBAE9C9a,KAAKsb,cAAc7M,U,2BAQrB,SAAc7F,EAAIiQ,GAAU,IAAD,OACpBkE,EAAS,WACVlE,IAAY,EAAK5T,MAAM4T,SAC1B,EAAKtT,SAAS,CAAEsT,aAIlB7Y,KAAKqb,aAAa/O,SAEbuM,EAKJkE,KAHA/c,KAAKqb,aAAa2B,MAAMD,GACxB/c,KAAKqb,aAAa5M,W,yBAMpB,SAAY7F,GACX,IAAMmN,EAAO/V,KAAKid,iBAAiBrU,GAEjB,IAAdA,EAAGyR,QAAiBra,KAAKmc,eAAepG,GAI3C/V,KAAK+I,MAAMmU,aAAanH,EAAK1I,SAH7BrN,KAAKmd,eAAevU,EAAImN,GAKP,IAAdnN,EAAGyR,QACNra,KAAKuF,SAAS,CAAEqV,WAAW,M,uBAI7B,SAAUhS,GACT,IAAMmN,EAAO/V,KAAKid,iBAAiBrU,GAC/BmN,GACH/V,KAAKmd,eAAevU,EAAImN,GAEzB/V,KAAKuF,SAAS,CAAEqV,WAAW,M,yBAG5B,SAAYhS,GACX,GAAmB,IAAfA,EAAGwU,QAAP,CAKA,IAAMrH,EAAO/V,KAAKid,iBAAiBrU,GAC/BmN,GACH/V,KAAKmd,eAAevU,EAAImN,QANxB/V,KAAKuF,SAAS,CAAEqV,WAAW,M,uBAU7B,SAAUhS,GACT,IAAIF,IAAJ,CAIA,IAAM2U,GAAazU,EAAG0U,QAAU,IAAM,KAAO1U,EAAG2U,QAAU,IAAM,KAAO3U,EAAG4U,OAAS,IAAM,KAAO5U,EAAG6U,SAAW,IAAM,IAEpH,GAAI,CAAC,UAAW,YAAa,SAAU,YAAYxb,SAAS2G,EAAGyG,KAAM,CACpE,IAAIqO,EAAO,EAQX,GAPe,WAAX9U,EAAGyG,KAA+B,aAAXzG,EAAGyG,MAC7BqO,EAAO1d,KAAK+I,MAAM4U,cAEJ,YAAX/U,EAAGyG,KAAgC,WAAXzG,EAAGyG,MAC9BqO,GAAQA,GAGS,KAAdL,GAAkC,MAAdA,EAAmB,CAC1C,IAAMO,EAAY5d,KAAK6d,sBACjBC,EAAW/Z,KAAKga,IAAI/d,KAAK+I,MAAMgT,MAAM5Y,OAAS,EAAGY,KAAKia,IAAI,EAAGJ,EAAYF,IAC3EE,IAAcE,IACjB9d,KAAKmd,eAAevU,EAAI5I,KAAK+I,MAAMgT,MAAM+B,IACzClV,EAAG0F,uBAEM1F,EAAG0U,UACbtd,KAAK+I,MAAMkV,YAAYP,GACvB9U,EAAG0F,kBAIW,cAAX1F,EAAGyG,KAAkC,eAAXzG,EAAGyG,KAAuC,KAAdgO,IAC1Drd,KAAK+I,MAAM+N,aAAwB,eAAXlO,EAAGyG,IAAsBrP,KAAKke,kBACtDtV,EAAG0F,kBAGW,QAAX1F,EAAGyG,KAA+B,KAAdgO,IACvBrd,KAAK+I,MAAMoV,sBAAsBne,KAAK+I,MAAM2Q,gBAC5C9Q,EAAG0F,kBAGW,MAAX1F,EAAGyG,KAA6B,MAAdgO,IACrBrd,KAAK+I,MAAM0N,oBAAoBzW,KAAKke,iBAAkB,IACtDtV,EAAG0F,kBAGY,MAAX1F,EAAGyG,KAA0B,aAAXzG,EAAGyG,KAAqC,KAAdgO,IAChDrd,KAAK+I,MAAM8G,iBAAiB7P,KAAKke,kBACjCtV,EAAG0F,kBAEW,MAAX1F,EAAGyG,KAA6B,MAAdgO,IACrBrd,KAAK+I,MAAM8G,iBAAiB7P,KAAKke,kBAAkB,GACnDtV,EAAG0F,kBAGY,MAAX1F,EAAGyG,KAA0B,MAAXzG,EAAGyG,KAA8B,MAAdgO,IACzCrd,KAAK+I,MAAMqV,eACXxV,EAAG0F,kBAGY,OAAX1F,EAAGyG,KAA+B,KAAdgO,IACxBrd,KAAK+I,MAAMsV,aACXzV,EAAG0F,kBAGW,MAAX1F,EAAGyG,KAA6B,MAAdgO,IACrBrd,KAAK+I,MAAMuV,aACX1V,EAAG0F,kBAGW,MAAX1F,EAAGyG,KAA6B,MAAdgO,IACrBrd,KAAK+I,MAAM+G,eAAe9P,KAAKke,kBAC/BtV,EAAG0F,qB,4BAIL,SAAe1F,EAAImN,GAClB,MAAwC/V,KAAK+I,MAAvCwV,EAAN,EAAMA,aAAcC,EAApB,EAAoBA,gBAChB5V,EAAG6U,UACNc,EAAexa,KAAKga,IAAIQ,EAAcxI,EAAK1I,SAC3CmR,EAAkBza,KAAKia,IAAIQ,EAAiBzI,EAAK1I,WAEjDkR,EAAexI,EAAK1I,QACpBmR,EAAkBzI,EAAK1I,SAGpBkR,IAAiBve,KAAK+I,MAAMwV,cAAgBC,IAAoBxe,KAAK+I,MAAMyV,iBAC9Exe,KAAK+I,MAAM0V,gBAAgB,CAC1BF,eACAC,oBAGFxe,KAAK+I,MAAMmU,aAAanH,EAAK1I,W,8BAG9B,SAAiBzE,GAEhB,IAAM8V,EAAI9V,EAAG+V,MAAQ3e,KAAK2Y,IAAIK,QAAQnR,wBAAwBZ,IAAMQ,OAAOmX,YACrE/c,EAAQkC,KAAK6T,MAAM8G,EAAI1e,KAAK+I,MAAMsO,YACxC,OAAOrX,KAAK+I,MAAMgT,MAAMla,K,iCAGzB,WAGC,IAFA,MAAwC7B,KAAK+I,MAArC+P,EAAR,EAAQA,OAAQiD,EAAhB,EAAgBA,MAAOwC,EAAvB,EAAuBA,aACjBM,EAAO/F,GAAkByF,EACtBO,EAAI,EAAGA,EAAI/C,EAAM5Y,SAAU2b,EACnC,GAAI/C,EAAM+C,GAAGzR,UAAYwR,EACxB,OAAOC,I,4BAOV,WACC,IAAMlB,EAAY5d,KAAK6d,sBACvB,OAAO7d,KAAK+I,MAAMgT,MAAM6B,M,6BA/OzB,WAAyD7H,GAAO,IAAxCwI,EAAuC,EAAvCA,aAAcC,EAAyB,EAAzBA,gBACrC,OAAOzI,EAAK1I,QAAU0I,EAAKgJ,YAAcR,GAAgBxI,EAAK1I,SAAWmR,I,yBAG1E,SAAmBzC,EAAO1E,GACzB,IAAIF,EAAM,EACNoB,EAAU,GAKd,OAJAwD,EAAMiD,SAAQ,SAACjJ,GACdwC,EAAQxC,EAAK1I,SAAW8J,EACxBA,GAAOE,KAEDkB,I,mCAGR,YAAwE,IAAD,EAAxCwD,EAAwC,EAAxCA,MAAOwC,EAAiC,EAAjCA,aAAcC,EAAmB,EAAnBA,gBAC7CS,EAAgBlD,EAAMc,OAAOlC,EAAWwB,eAAevb,KAAK,KAAM,CAAE2d,eAAcC,qBAEpFlF,EAAS,GAHyD,cAIrD2F,GAJqD,IAItE,2BAAgC,CAAC,IAAD,EAAvBlJ,EAAuB,sBACbA,EAAKuD,OAAOY,MAAM,UADL,IAC/B,2BAA8C,CAAC,IAAtCE,EAAqC,QAC7Cd,EAAOc,GAASA,GAFc,gCAJsC,8BAWtE,cAFOd,EAAO,IAEP5K,OAAOjJ,OAAO6T,K,sCAGtB,SAAgC7J,EAAWF,GAC1C,IAAM2P,EAAezP,EAAUsM,QAAUxM,EAAUyL,UAC7CmE,EAAmB1P,EAAU8O,eAAiBhP,EAAU0L,kBAAoBxL,EAAU+O,kBAAoBjP,EAAU2L,oBAEtHkE,EAAgB,KAChBF,IAEHE,EAAgB,CAAEvE,YADEF,EAAW0E,YAAY5P,EAAUsM,MAAOtM,EAAU4H,YACvC2D,UAAWvL,EAAUsM,QAGrD,IAAIuD,EAAiB,KASrB,OARIJ,GAAgBC,KACnBG,EAAiB,CAChBxE,kBAAmBH,EAAW4E,sBAAsB9P,GACpDwL,iBAAkBxL,EAAU8O,aAC5BrD,oBAAqBzL,EAAU+O,kBAIX,OAAlBY,GAA6C,OAAnBE,EACtB,2BAAKF,GAAkBE,GAExB,S,GAnKgBhW,iBCqEVkW,I,yDAtEd,WAAYzW,GAAQ,IAAD,8BAClB,cAAMA,IAoCPS,aAAe,SAACZ,GACf,EAAKG,MAAM0W,mBAAmB7W,EAAGe,OAAO9C,QAtCtB,EAyCnB6Y,WAAa,SAAC9W,GACb,EAAKG,MAAMsV,aACX,EAAKrI,QACLpN,EAAG0F,kBA5Ce,EA+CnBqR,aAAe,SAAC/W,GACf,EAAKG,MAAM0W,mBAAmB,OAhDZ,EAmDnBG,cAAgB,SAAChX,GACD,WAAXA,EAAGyG,MACN,EAAKsQ,eACL/W,EAAG0F,mBApDJ,EAAKqK,IAAMC,sBAFO,E,0CAKnB,WACC,IAAM/R,EAAQ7G,KAAK+I,MAAM8W,cAAgB,GACnCvI,EAAUjM,YAAW,sBAAuB,CAAE,gCAAiCrL,KAAK+I,MAAM+W,aAEhG,OAEC,cADA,CACA,QAAM1U,OAAO,IAAIlC,UAAU,eAAe6W,OAAoC,OAA5B/f,KAAK+I,MAAM8W,aAAuBvU,SAAUtL,KAAK0f,WAAnG,UACC,qBAAKxW,UAAWoO,EAAhB,SACC,uBAAOxN,KAAK,SAASjD,MAAOA,EAAOmZ,YAAY,UAAUvW,SAAUzJ,KAAKwJ,aAAcuI,UAAW/R,KAAK4f,cAAejH,IAAK3Y,KAAK2Y,QAEhI,wBAAQ7O,KAAK,SAAb,SACC,sBAAKyN,MAAM,6BAA6BkB,QAAQ,cAAcrF,MAAM,KAAKC,OAAO,KAAK4M,KAAK,MAA1F,UACC,kDACA,sBAAMzI,EAAE,8CAGV,wBAAQ1N,KAAK,SAAS8B,QAAS5L,KAAK2f,aAApC,SACC,sBAAKpI,MAAM,6BAA6BkB,QAAQ,cAAcrF,MAAM,KAAKC,OAAO,KAAK4M,KAAK,MAA1F,UACC,2CACA,sBAAMzI,EAAE,gD,gCAOb,SAAmBlI,EAAWC,GACE,OAA3BD,EAAUuQ,cAAqD,OAA5B7f,KAAK+I,MAAM8W,cACjD7f,KAAKgW,U,mBAyBP,WACChW,KAAK2Y,IAAIK,QAAQhD,Y,GA9DQ1M,kBCmFZ4W,I,mKAlFd,WACC,IAAQnK,EAAS/V,KAAK+I,MAAdgN,KACR,OAAKA,EAKJ,sBAAK7M,UAAU,YAAf,UACC,qBAAKA,UAAU,kBAAf,SAAkClJ,KAAKmgB,iBAAiBpK,KACxD,qBAAK7M,UAAU,mBAAf,SAAmC6M,EAAKqK,UAAYrK,EAAKjF,QAAU,QAN7D,qBAAK5H,UAAU,gB,8BAWxB,SAAiB6M,GAChB,GAAkB,WAAdA,EAAKjM,MAAmC,UAAdiM,EAAKjM,KAAkB,CACpD,GAAIiM,EAAKsK,WACR,OAAOrgB,KAAKsgB,iBAAiBvK,EAAKsK,YAC5B,GAAItK,EAAKiB,OACf,OAAOhX,KAAKugB,aAAaxK,EAAKiB,QACxB,GAAIjB,EAAKkB,cAAyD,kBAAlClB,EAAKkB,aAAauJ,YACxD,OAAOxgB,KAAKygB,aAAa1K,EAAKkB,mBAEzB,GAAkB,SAAdlB,EAAKjM,KACf,OAAO9J,KAAK0gB,iBAAiB3K,EAAK4K,WAAY5K,EAAK1I,SAGpD,MAAO,K,8BAGR,SAAiBgT,GAChB,GAA6B,OAAzBA,EAAWxa,UACd,MAAO,mBAAqB6G,EAAY2T,EAAWhT,SAGpD,IAAIuT,EAAS,IAAMlU,EAAY2T,EAAWhT,SAAW,OAgBrD,OAfIgT,EAAWQ,cACdD,GAAUP,EAAWQ,YAAc,MAEZ,IAApBR,EAAW/S,KACdsT,IblCM,KakCgBP,EAAWxa,UbnCnB5B,SAAS,IAAI2I,eACT1I,QAAQ,GamCI,IAApBmc,EAAW/S,KACrBsT,Gb3CI,SAAqBjU,GAE3B,OAAQ,OADIA,EAAI1I,SAAS,IAAI2I,eACP1I,QAAQ,GayClB4c,CAAYT,EAAWxa,WACvBwa,EAAW/S,MAAQ,IAE7BsT,GAAUlU,EAAY2T,EAAWxa,YAE9Bwa,EAAWQ,cACdD,GAAU,KAGJA,I,0BAGR,SAAa5J,GACZ,IAAI4J,EAAS5J,EAAO+J,cAAgBrU,EAAYsK,EAAO+J,eAAiB,GAIxE,OAHI/J,EAAOlG,SACV8P,GAAU,MAAQ5J,EAAOlG,QAEnB8P,I,0BAGR,SAAa5e,GACZ,MAAO,IAAM0K,EAAY1K,EAAKqL,SAAW,OAASjL,KAAKC,UAAUL,EAAKwe,e,8BAGvE,SAAiBG,EAAYtT,GAC5B,IAAIuT,EAASlU,EAAYiU,EAAWlS,OAOpC,OANIkS,EAAW3W,QACd4W,GAAU,KAAOD,EAAW3W,MAAQ,KAEjCqD,IAAYsT,EAAWlS,QAC1BmS,GAAU,MAAQlU,EAAYiU,EAAWlS,MAAQpB,IAE3CuT,M,GA3EetX,kBCOlB0X,I,OAAa,KAGbC,G,kDA+BL,WAAYlY,GAAQ,IAAD,8BAClB,cAAMA,IA/BP9D,MAAQ,CACP8W,MAAO,GACPE,aAAc,GACd/H,MAAO,CAAEzF,MAAO,EAAGyJ,IAAK,GACxBb,WAAY,EACZsG,aAAc,EACdjE,gBAAgB,EAChBwH,oBAAoB,EACpBpI,OAAQ,KACR+G,aAAc,KACdsB,kBAAkB,EAClB9E,cAAe,KACf7K,kBAAmB,KACnBE,mBAAoB,MAiBF,EAXnB0P,UAAY,GAWO,EAVnB9G,aAAc,EAUK,EATnB+G,gBAAiB,EASE,EARnBC,eAAgB,EAQG,EAPnBC,gBAAkBthB,QAAQgB,QAAQ,MAOf,EANnBugB,WAAa,KAMM,EA4EnBtE,aAAe,SAACpE,GACX,EAAK7T,MAAM6T,SAAWA,IACzB,EAAKwB,YAAc,UACnB,EAAK/U,SAAS,CAAEuT,WAEhB,EAAKyI,gBAAkB,EAAKA,gBAAgBjhB,MAAK,WAChD,GAAI,EAAKghB,cACR,OAAO,KAGR,MAAqB,EAAKrc,MAAMiP,MAA1BzF,EAAN,EAAMA,MAAOyJ,EAAb,EAAaA,IACPuJ,EAAY1d,KAAKia,IAAIgD,GAAY,EAAK/b,MAAM0Y,cAC5C+D,EAAY3d,KAAKia,IAzHR,IAyHkD,EAA1B,EAAK/Y,MAAM0Y,cAclD,OAXI7E,EAAqB,EAAZ2I,EAAgBhT,EAC5BA,EAAQqK,EAAqB,EAAZ2I,EAAgB,EACvB3I,EAAqB,EAAZ4I,EAAgBjT,IACnCA,EAAQqK,EAAmC,GAAzB4I,EAAYD,IAE3B3I,EAAqB,EAAZ2I,EAAgBvJ,EAC5BA,EAAMY,EAAqB,EAAZ2I,EAAgB,EACrB3I,EAAqB,EAAZ4I,EAAgBxJ,IACnCA,EAAMY,EAAmC,GAAzB4I,EAAYD,IAGzBhT,IAAU,EAAKxJ,MAAMiP,MAAMzF,OAASyJ,IAAQ,EAAKjT,MAAMiP,MAAMgE,IACzD,EAAKyJ,gBAAgB,UAAW,CAAEtU,QAASoB,EAAOyJ,QAEnD,UAzGS,EA8GnBhC,iBAAmB,WAClB,MAA0C,EAAKnN,MAAvCwV,EAAR,EAAQA,aAAcC,EAAtB,EAAsBA,gBAEtB,OAAO,EAAKvZ,MAAM8W,MAAMc,QADL,SAAA9G,GAAI,OAAIA,EAAK1I,QAAU0I,EAAKgJ,YAAcR,GAAgBxI,EAAK1I,SAAWmR,MAhH3E,EAoHnBjI,kBAAoB,WACnB,IADyB,EACnBwF,EAAQ,EAAK7F,mBAGf0L,EAAkB,GAChBC,EAAoB9F,EAAMjR,KAAI,SAAAgS,GAAC,OAAIA,EAAE9F,UAAQ6F,QAAO,SAAApK,GAAC,OAAIA,IAAMA,EAAE3B,QAAU2B,EAAEsO,iBAL1D,cAMTc,GANS,IAMzB,2BAAmC,CAAC,IAAzBpP,EAAwB,QAClCmP,EAAgBnP,EAAEsO,eAAiB,OAASrU,EAAY+F,EAAEsO,gBAPlC,8BAUzB,IAVyB,EAUrBve,EAAS,GACTsf,GAAY,EAXS,cAYT/F,GAZS,IAYzB,2BAAuB,CAAC,IAAbe,EAAY,QAChB9S,EAAQ8S,EAAEhM,QAAU8Q,EAAgB9E,EAAEzP,SACxCrD,IACE8X,IACJtf,GAAU,MAEXA,GAAUwH,EAAQ,SAGnBxH,GAAU,KAAOsa,EAAEra,KAAO,IACtBqa,EAAE9F,QAAU8F,EAAE9F,OAAO+J,gBAAkBjE,EAAE9F,OAAOlG,OAEnDtO,GAAUsa,EAAExD,OAAO1D,QAAQ,cAAegM,EAAgB9E,EAAE9F,OAAO+J,gBAEnEve,GAAUsa,EAAExD,OAEb9W,GAAU,KAEVsf,GAAY,GA9BY,8BAiCzB,OAAOtf,GArJW,EAwJnB2b,qBAAuB,SAAC4D,GACvB,EAAKxc,SAAS,CAAE2b,mBAAoBa,KAzJlB,EA4JnBjL,aAAe,SAACmB,EAAWlC,GAC1B,GAAIkC,EAAW,CACd,IAAItO,EAASoM,EAAKiB,QAAUjB,EAAKiB,OAAO+J,cACzB,OAAXpX,IACHA,EAASoM,EAAKkB,cAAgBlB,EAAKkB,aAAa5J,SAElC,OAAX1D,IACH,EAAKyX,UAAU1f,KAAK,EAAKuD,MAAM6T,QAC/B,EAAKkJ,YAAYrY,SAGY,IAA1B,EAAKyX,UAAUje,OAClB,EAAK6e,YAAY,EAAKZ,UAAUa,OAEhC,EAAKD,YAAY,EAAKjZ,MAAM1D,KA1KZ,EA+KnBoR,oBAAsB,SAACV,EAAMmM,GAC5B,IAAQ7U,EAAY0I,EAAZ1I,QACF0D,EAAO+D,OAAO,uBAAwBoN,GAC5C,IAAKnR,EACJ,OAAO9Q,QAAQgB,QAAQ,MAGxB,IAAMkhB,EAAmB,WACxB,OAAO,EAAKrU,QAAQtJ,OAAOrC,KAAK,CAC/BD,MAAO,kBACPmL,QAASA,EACT0D,SACEzQ,MAAK,WACP,GAAI+M,IAAY,EAAKpI,MAAM6T,OAAQ,CAElC,IAAM8E,EAAY,EAAK3Y,MAAM8W,MAAMja,QAAQiU,GAC3C,GAAI6H,EAAY,EAAK3Y,MAAM8W,MAAM5Y,OAAS,EAAG,CAC5C,IAAMif,EAAc,EAAKnd,MAAM8W,MAAM6B,EAAY,GAAGvQ,QACpD,EAAK2U,YAAYI,EAAa,YAKhC,EAAKC,mBAKDC,EAAavR,EAAKmJ,MAAM,eAAgB,GAC9C,OAAIoI,EAAWnf,QAAU,EACjB,EAAK2K,QAAQtJ,OAAOrC,KAAK,CAC/BD,MAAO,eACP6L,OAAQ,EAAKD,QAAQ1H,WAAWd,cAChC0I,WAAYsU,EAAW,KACrBhiB,MAAK,SAACkC,GACR,OAAO,EAAKsL,QAAQtJ,OAAOrC,KAAK,CAC/BD,MAAO,aACP6L,OAAQ,EAAKD,QAAQ1H,WAAWd,cAChC7C,KAAM6f,EAAW,GACjBzb,MAAOrE,EAAOqD,eAEbvF,MAAK,YAAoB,IAAjBuF,EAAgB,EAAhBA,UACV,EAAKiI,QAAQhK,IAAI,WAAawe,EAAW,GAAK,OAAS5V,EAAY7G,MACjEsc,GAEIA,KA5NU,EAgOnBtS,iBAAmB,SAACkG,EAAMwM,GACzB,GAAwB,OAApBxM,EAAK9H,WACR,EAAKH,QAAQtJ,OAAOrC,KAAK,CACxBD,MAAO,qBACPmL,QAAS0I,EAAK1I,QACdO,SAAS,SAEJ,GAAKmI,EAAK9H,WAAWL,QAMrB,GAAI2U,EACV,EAAKzU,QAAQtJ,OAAOrC,KAAK,CACxBD,MAAO,wBACPmL,QAAS0I,EAAK9H,WAAWZ,SAAW0I,EAAK1I,QACzCO,SAAS,QAEJ,CACN,GAAkC,OAA9BmI,EAAK9H,WAAWV,YACd9F,OAAOwB,QAAQ,+EACnB,OAIF,EAAK6E,QAAQtJ,OAAOrC,KAAK,CACxBD,MAAO,wBACPmL,QAAS0I,EAAK9H,WAAWZ,SAAW0I,EAAK1I,eApB1C,EAAKS,QAAQtJ,OAAOrC,KAAK,CACxBD,MAAO,wBACPmL,QAAS0I,EAAK9H,WAAWZ,SAAW0I,EAAK1I,QACzCO,SAAS,KA3OO,EAiQnBkC,eAAiB,SAACiG,GAAU,IAAD,EAEpByM,GAAoB,UAAAzM,EAAK9H,kBAAL,eAAiBZ,UAAW0I,EAAK1I,QAC3D,EAAKS,QAAQtJ,OAAOrC,KAAK,CACxBD,MAAO,sBACPmL,QAASmV,EACT5U,SAAS,IACPtN,MAAK,YAAsB,IACvBmiB,EADsB,EAAlBtR,YACa/B,MAAK,SAAAqT,GAAE,OAAIA,EAAGpV,UAAYmV,KACjD,GAAIC,EAAI,CACP,IAAMjR,EAAiB,2BAAQiR,GAAR,IAAY3Y,KAAM,YACzC,EAAKvE,SAAS,CAAEiM,0BACV,CACN,IAAME,EAAqB,CAAErE,QAASmV,EAAmB1Y,KAAM,WAC/D,EAAKvE,SAAS,CAAEmM,4BA/QA,EAoRnBgR,oBAAsB,WACrB,EAAKnd,SAAS,CAAEiM,kBAAmB,KAAME,mBAAoB,QArR3C,EAwRnBsQ,YAAc,SAACnD,GAA2B,IAArB8D,EAAoB,uDAAb,SAC3B,EAAKrI,YAAcqI,EACnB,EAAK5Z,MAAM0V,gBAAgB,CAC1BF,aAAcM,EACdL,gBAAiBK,KA5RA,EAgSnB+D,aAAe,SAACC,GACf,IAAMC,EAAeD,GAA4B,OAApB,EAAKrB,WAClC,EAAiC,EAAKvc,MAA9B6T,EAAR,EAAQA,OAAQ+G,EAAhB,EAAgBA,aAChB,GAAKiD,GAAiBjD,EAAtB,CAMA,GAAI,EAAK5a,MAAMkc,iBAAkB,CAChC,GAAI2B,EAEH,OAGD,EAAKC,eAGDD,IACJ,EAAKtB,WAAa,CACjBhF,MAAOqD,EACP3H,IAAKY,EACLkK,KAAM,OAKR,IAAMC,EAAc,CAAE3W,QAAQ,GAC9B,EAAKkV,WAAWyB,YAAcA,EAC9B,EAAK1d,SAAS,CAAE4b,kBAAkB,IAElC,MAA6B,EAAKK,WAA1BhF,EAAR,EAAQA,MAAOtE,EAAf,EAAeA,IAAK8K,EAApB,EAAoBA,KACpB,EAAKlV,QAAQtJ,OAAOrC,KAAK,CACxBD,MAAO,sBACPmL,QAASyL,IAAWkK,EAAOlK,EAAS,EAAIA,EACxCZ,MACAsE,UACElc,MAAK,YAAkB,IAAf+M,EAAc,EAAdA,QACN4V,EAAY3W,SAGZ,EAAKkV,aACR,EAAKA,WAAWwB,KAAO3V,GAGR,OAAZA,EACH,EAAK2U,YAAY3U,GACPyL,IAAWZ,GACrBzQ,OAAO4G,MAAM,4CACb,EAAK2T,YAAY9J,IAEjBzQ,OAAO4G,MAAM,wCAA0CmO,OAEtD0G,SAAQ,WACLD,EAAY3W,SAChB,EAAK/G,SAAS,CAAE4b,kBAAkB,IAC9B,EAAKK,aACR,EAAKA,WAAWyB,YAAc,eApDhC,EAAK7E,gBArSY,EA+VnBqB,mBAAqB,SAACjD,GACrB,IAAMH,EAAgBG,EAAQA,EAAMzC,cAAgB,KACpD,EAAKxU,SAAS,CAAE8W,gBAAewD,aAAcrD,IACzC,EAAKgF,YAAc,EAAKA,WAAWhF,QAAUA,IAEhD,EAAKuG,eACL,EAAKvB,WAAa,MAGL,OAAVhF,GAEC,EAAK2G,QAAQnK,SAChB,EAAKmK,QAAQnK,QAAQoK,oBAAmB,IA3WxB,EAgXnBhF,aAAe,WACd,EAAKqB,mBAAmB,EAAKxa,MAAM4a,eAAiB,EAAK2B,WAAa,EAAKA,WAAWhF,MAAQ,KAC9F,EAAK6G,UAAUrK,QAAQhD,SAlXL,EAqXnBqI,WAAa,WACZ,EAAKuE,cAAa,IAtXA,EAyXnBG,aAAe,WACV,EAAKvB,YAAc,EAAKA,WAAWyB,cACtC,EAAKzB,WAAWyB,YAAY3W,QAAS,EACrC,EAAK/G,SAAS,CAAE4b,kBAAkB,IAClC,EAAKK,WAAWyB,YAAc,OA7Xb,EAsjBnB5S,cAAgB,SAACzH,EAAI5G,GACpB,EAAK6N,iBAAiB7N,EAAK+T,OAvjBT,EA0jBnBkI,YAAc,SAACP,GACd,EAAK/E,IAAIK,QAAQsK,WAAa5F,EAAO,EAAKzY,MAAMoS,YAxjBhD,EAAKsB,IAAMC,sBACX,EAAKuK,QAAUvK,sBACf,EAAKyK,UAAYzK,sBALC,E,0CAQnB,WAAU,IAAD,OACF2C,EAAS,CACdgI,SAAU,SAAA3a,GAAE,OAAI,EAAK2a,SAAS3a,IAC9B4a,YAAa,SAAA5a,GAAE,OAAIA,EAAG0F,mBAGvB,OAAKtO,KAAK8N,QAAQ1H,WAAWhB,QAK5B,qCACC,6CAAKuT,IAAK3Y,KAAK2Y,IAAKzP,UAAU,UAAaqS,GAA3C,aACC,cAAC,GAAD,yBAAY5C,IAAK3Y,KAAKmjB,SAAanjB,KAAKiF,OAAxC,IACCoL,cAAerQ,KAAKqQ,cACpBoO,gBAAiBze,KAAK+I,MAAM0V,gBAC5BH,WAAYte,KAAK+I,MAAMuV,WACvBpB,aAAcld,KAAKkd,aACnBiB,qBAAsBne,KAAKme,qBAC3BI,aAAcve,KAAK+I,MAAMwV,aACzBC,gBAAiBxe,KAAK+I,MAAMyV,gBAC5BjI,kBAAmBvW,KAAKuW,kBACxBO,aAAc9W,KAAK8W,aACnBL,oBAAqBzW,KAAKyW,oBAC1B5G,iBAAkB7P,KAAK6P,iBACvBC,eAAgB9P,KAAK8P,eACrBmO,YAAaje,KAAKie,YAClBG,aAAcpe,KAAKoe,aACnBC,WAAYre,KAAKqe,iBAGnB,cAAC,GAAD,CAAWtI,KAAM/V,KAAKiF,MAAM8W,MAAM3M,MAAK,SAAA0N,GAAC,OAAIA,EAAEzP,UAAY,EAAKpI,MAAM6T,YAEpE9Y,KAAKyjB,oBACN,cAAC,GAAD,CAAc9K,IAAK3Y,KAAKqjB,UACvBxD,aAAc7f,KAAKiF,MAAM4a,aACzBxB,WAAYre,KAAKqe,WACjBoB,mBAAoBzf,KAAKyf,mBACzBK,WAAY9f,KAAKiF,MAAMkc,mBAExB,cAAC,EAAD,CACCjU,OAAyC,OAAjClN,KAAKiF,MAAMuM,mBAAgE,OAAlCxR,KAAKiF,MAAMyM,mBAC5D9R,QAASI,KAAK0iB,oBACdzU,WAAYjO,KAAKiF,MAAMuM,kBACvB5C,iBAAkB5O,KAAKiF,MAAMyM,wBArCxB1R,KAAK0jB,qB,8BA2Cd,WACC,OACC,qBAAKxa,UAAU,sBAAf,8C,+BAMF,WACC,OAAO,cAAC,GAAD,CACNgN,iBAAkBlW,KAAKkW,iBACvBK,kBAAmBvW,KAAKuW,kBACxBO,aAAc9W,KAAK8W,aACnBL,oBAAqBzW,KAAKyW,oBAC1B5G,iBAAkB7P,KAAK6P,qB,qCAyTzB,SAAwBP,EAAWC,GAClC,GAAIvP,KAAKqhB,gBAAkBrhB,KAAKmjB,QAAQnK,SAAuC,IAA5BhZ,KAAKiF,MAAM8W,MAAM5Y,OAAc,CACjF,IAAQ4Y,EAAU/b,KAAKiF,MAAf8W,MACF4H,EAAgB5H,EAAMhY,KAAK6T,MAAMmE,EAAM5Y,OAAS,IAAIkK,QACpDpG,EAAMjH,KAAKmjB,QAAQnK,QAAQ4D,mBAAmB+G,GACpD,GAAI1c,EACH,MAAO,CAAEA,MAAK0c,iBAGhB,OAAO,O,+BAGR,WAAqB,IAAD,OACnB3jB,KAAKD,WAAaqE,EAAUW,OAAO,CAClC,WAAc,WACT,EAAK+I,QAAQ1H,WAAWhB,SAC3B,EAAKid,aAAa,WAGpB,eAAgB,WACf,IAAMuB,EAAsC,IAA3B,EAAK3e,MAAMiP,MAAMzF,OAAwC,IAAzB,EAAKxJ,MAAMiP,MAAMgE,IAClE,EAAKmK,aAAauB,EAAW,UAAY,WAE1C,aAAc,SAACphB,GAEU,IAApBA,EAAOmD,UAAsC,KAApBnD,EAAOoD,UACnC,EAAKyc,aAAa,WAGpB,qBAAsB,WACrB,EAAKA,gBAEN,wBAAyB,WACxB,EAAKA,gBAEN,wBAAyB,WACxB,EAAKA,kBAGPriB,KAAKshB,eAAgB,I,kCAGtB,WACCthB,KAAK+iB,eACL/iB,KAAKshB,eAAgB,EACrBld,EAAU4B,OAAOhG,KAAKD,c,gCAGvB,SAAmBuP,EAAWC,EAAWsU,GAAW,IAAD,OAClD,EAA0C7jB,KAAK+I,MAAvCwV,EAAR,EAAQA,aAAcC,EAAtB,EAAsBA,gBACtB,EAA8Bxe,KAAKiF,MAA3BiP,EAAR,EAAQA,MAAOmD,EAAf,EAAeA,WAEXyM,EAAe,KAAMC,EAAoB,KAsB7C,GArBI/jB,KAAKiF,MAAMic,qBAAuB3R,EAAU2R,qBAE/C4C,GAAe,GAEZ9jB,KAAK+I,MAAMzD,gBAAkBgK,EAAUhK,gBAC1Cwe,GAAe,GAEZvF,IAAiBjP,EAAUiP,cAAgBC,IAAoBlP,EAAUkP,kBACxED,EAAerK,EAAMzF,OAAS+P,GAAmBtK,EAAMgE,OAC1D4L,EAAe,SACfC,GAAoB,GAGjBD,GAAiBxU,EAAU0U,eAAgBhkB,KAAK+I,MAAMib,eAC1DF,EAAe,SACfC,GAAoB,GAEA,OAAjBD,GAAyB9jB,KAAK+I,MAAMib,cACvChkB,KAAKqiB,aAAayB,EAAcC,GAGd,IAAf1M,EAAkB,CACrB,IAAM4M,EAAYhR,SAASyH,cAAc,eACrCuJ,GAEHzX,YAAW,kBAAM,EAAKjH,SAAS,CAAE8R,WAAY4M,EAAUpc,wBAAwBwL,WAAW,QAErF,GAAIrT,KAAK2Y,IAAIK,QAAS,CAC5B,IAAM2E,EAAe5Z,KAAK6T,MAAM5X,KAAK2Y,IAAIK,QAAQkL,aAAe7M,GAC5DsG,IAAiB3d,KAAKiF,MAAM0Y,cAC/B3d,KAAKuF,SAAS,CAAEoY,iBAQlB,GAJI3d,KAAK+I,MAAMob,aAAe7U,EAAU6U,aACvCnkB,KAAKsa,YAAc,UAGhBta,KAAKsa,aAAeta,KAAKmjB,QAAQnK,QAAS,CAC7C,IAAMpX,EAAO5B,KAAKmjB,QAAQnK,QAC1BxM,YAAW,WACV5K,EAAKwhB,mBAAmB,EAAK9I,aAC7B,EAAKA,aAAc,IACjB,GAGJ,GAAIuJ,GAAY7jB,KAAKmjB,QAAQnK,QAAS,CACrC,IAAM/R,EAAMjH,KAAKmjB,QAAQnK,QAAQ4D,mBAAmBiH,EAASF,eAC7D3jB,KAAK2Y,IAAIK,QAAQsK,WAAaO,EAAS5c,IAAMA,EAC7CjH,KAAKqhB,gBAAiB,K,0BAIxB,SAAa/G,EAAa8J,GAAW,IAAD,OACnCpkB,KAAKuhB,gBAAkBvhB,KAAKuhB,gBAAgBjhB,MAAK,WAChD,OAAI,EAAKghB,cACD,KAED,EAAKK,gBAAgBrH,EAAa8J,Q,6BAI3C,SAAgB9J,GAA+B,IAAD,OAAjB8J,EAAiB,uDAAN,KACvC,IAAKpkB,KAAK+I,MAAMib,aACf,OAAO/jB,QAAQgB,QAAQ,MAGxB,MAAoEjB,KAAKiF,MAAjEiP,EAAR,EAAQA,MAAOyJ,EAAf,EAAeA,aAAkCjE,EAAjD,EAA6BwH,mBACzBmD,EAAcD,EAClB,IAAiB,IAAbA,GAAmC,OAAbA,GAAqC,IAAhBlQ,EAAMzF,OAA6B,IAAdyF,EAAMgE,IAAY,CACrF,IAAMuJ,EAAY1d,KAAKia,IAAIgD,GAAYrD,GACjC2G,EAAgBvgB,KAAK6T,MAAkB,IAAZ6J,GACjC4C,EAAc,CACbhX,QAASrN,KAAK+I,MAAMwV,aAA+B,EAAhB+F,EACnCC,MAAuB,EAAhBD,QAEe,OAAbF,IACVC,EAAc,CACbhX,QAAS6G,EAAMzF,MACfyJ,IAAKhE,EAAMgE,MAIb,OAAOjY,QAAQgB,QAAQ,MAAMX,MAAK,WACjC,OAAO,EAAKwN,QAAQtJ,OAAOrC,KAApB,yBACND,MAAO,gBACP6L,OAAQ,EAAKD,QAAQ1H,WAAWd,eAC7B+e,GAHG,IAIN3K,oBACEpZ,MAAK,SAAC0B,GACR,IAAI,EAAKsf,cAAT,CAIA,IAAQpN,EAA+BlS,EAA/BkS,MAAO+H,EAAwBja,EAAxBia,aAAcF,EAAU/Z,EAAV+Z,MACzBzB,EACH,EAAKA,YAAcA,EAEnB,EAAK+G,gBAAiB,EAEvB,EAAK9b,SAAS,CACb2O,QACA+H,aAAc,EAAKuI,oBAAoBvI,GACvCF,QACArC,uBAEC,SAACtZ,GACE,EAAKkhB,eACT,EAAK/b,SAAS,CACb2O,MAAO,CAAEzF,MAAO,EAAGyJ,IAAK,GACxB+D,aAAc,GACdF,MAAO,a,iCAOZ,SAAoBE,GAEnB,IAAMwI,EAAS,IAAIC,IAKnB,OAJAzI,EAAa+C,SAAQ,SAACtH,GACrB,IAAMrI,EAAMkN,OAAO7E,EAAMzQ,KAAOsV,OAAO7E,EAAMvQ,QAAUuQ,EAAMO,UAC7DwM,EAAOE,IAAItV,EAAKqI,MAEV,YAAI+M,EAAOhf,Y,sBAWnB,SAASmD,GAAK,IAAD,OACZ5I,KAAKuhB,gBAAkBvhB,KAAKuhB,gBAAgBjhB,MAAK,WAChD,GAAI,EAAKghB,cACR,OAAO,KAGR,MAAoC,EAAKsD,cAAjCC,EAAR,EAAQA,UAAWC,EAAnB,EAAmBA,aACbrD,EAAY1d,KAAKia,IAAIgD,GAAY,EAAK/b,MAAM0Y,cAC5C+D,EAAY3d,KAAKia,IAvmBP,IAumBiD,EAA1B,EAAK/Y,MAAM0Y,cAClD,EAAqB,EAAK1Y,MAAMiP,MAA1BzF,EAAN,EAAMA,MAAOyJ,EAAb,EAAaA,IAcb,OAZI2M,EAAYpD,EACfhT,GAAqB,EAAZgT,EACCoD,EAAYnD,IACtBjT,GAAsD,EAA7C1K,KAAKia,IAAIyD,EAAWoD,EAAYnD,IAGtCoD,EAAerD,EAClBvJ,GAAmB,EAAZuJ,EACGqD,EAAepD,IACzBxJ,GAAuD,EAAhDnU,KAAKia,IAAIyD,EAAWqD,EAAepD,IAGvCjT,IAAU,EAAKxJ,MAAMiP,MAAMzF,OAASyJ,IAAQ,EAAKjT,MAAMiP,MAAMgE,IACzD,EAAKyJ,iBAAgB,EAAO,CAAEtU,QAASoB,EAAOyJ,QAE/C,U,yBAIT,WACC,MAAkDlY,KAAK2Y,IAAIK,QAAnD+L,EAAR,EAAQA,aAAczB,EAAtB,EAAsBA,UAAWY,EAAjC,EAAiCA,aAC3BW,EAAYvB,EAAYtjB,KAAKiF,MAAMoS,WACnCyN,GAAgBC,EAAezB,EAAYY,GAAgBlkB,KAAKiF,MAAMoS,WACtE2N,EAAuBjhB,KAAK6T,OAAO5X,KAAKiF,MAAM0Y,aAAe,GAAK,GAExE,MAAO,CACNkH,UAAWA,EAAYG,EACvBF,aAAcA,EAAeE,M,uCAI/B,SAAgCvV,EAAWF,GAC1C,IAAQgP,EAAkC9O,EAAlC8O,aAAcC,EAAoB/O,EAApB+O,gBACtB,GAAIjP,EAAUuJ,OAASyF,GAAgBhP,EAAUuJ,OAAS0F,EAAiB,CAC1E,IAAI1F,EAASyF,EACb,GAAIhP,EAAUwM,MAAM5Y,OAAQ,CAE3B,IAAM4S,EAAOxG,EAAUwM,MAAM3M,MAAK,SAAA0N,GAAC,OAAIA,EAAEzP,SAAWkR,GAAgBzB,EAAEzP,QAAUyP,EAAEiC,YAAcR,KAChGzF,EAAS/C,EAAOA,EAAK1I,QAAUyL,EAEhC,MAAO,CAAEA,UAEV,OAAO,S,GAlpBYxP,iBAiqBrB2X,GAAOvR,YAAcrJ,EAEN4a,UC3qBTgE,I,mNACLhgB,MAAQ,CACPigB,qBAAqB,EACrBzgB,WAAW,EACX0gB,WAAY,GACZC,QAAS,I,EA8GVC,cAAgB,WACX,EAAKvX,QAAQ1H,WAAWlB,UAC3B,EAAK6D,MAAMuc,yBAAoB5hB,GAEhC,EAAKoK,QAAQtJ,OAAOrC,KAAK,CACxBD,MAAO,EAAK4L,QAAQ1H,WAAWlB,SAAW,aAAe,iBACvDwR,OAAM,gB,EAKV6O,eAAiB,WAChB,EAAKxc,MAAMuc,yBAAoB5hB,GAC/B,EAAKoK,QAAQtJ,OAAOrC,KAAK,CACxBD,MAAO,eACP6L,OAAQ,EAAKD,QAAQ1H,WAAWd,gBAC9BoR,OAAM,gB,EAKV8O,eAAiB,WAChB,EAAKzc,MAAMuc,yBAAoB5hB,GAC/B,EAAKoK,QAAQtJ,OAAOrC,KAAK,CACxBD,MAAO,eACP6L,OAAQ,EAAKD,QAAQ1H,WAAWd,gBAC9BoR,OAAM,gB,EAKV+O,cAAgB,WACf,IAAMC,EAAW,EAAK5X,QAAQ1H,WAAWd,cACzC,EAAKyD,MAAMuc,yBAAoB5hB,GAC/B,EAAKoK,QAAQtJ,OAAOrC,KAAK,CACxBD,MAAO,cACP6L,OAAQ,EAAKD,QAAQ1H,WAAWd,gBAC9BoR,OAAM,WAER,EAAK3N,MAAMuc,oBAAoBI,O,EAIjCC,cAAgB,WACf,EAAK5c,MAAMuc,yBAAoB5hB,GAC/B,EAAKoK,QAAQtJ,OAAOrC,KAAK,CACxBD,MAAO,gBACLwU,OAAM,gB,EAKVkP,mBAAqB,SAAChd,GACrB,IAAMtD,EAAgB,EAAKL,MAAMmgB,QAAQhW,MAAK,SAAAyW,GAAE,OAAIA,EAAGlb,KAAOhH,OAAOiF,EAAGe,OAAO9C,UAC3EvB,GACH,EAAKyD,MAAMuc,oBAAoBhgB,EAAcqF,GAAIrF,EAAcD,K,EAIjEygB,qBAAuB,WACtB,EAAKvgB,SAAS,CAAE2f,qBAAqB,K,EAGtCa,sBAAwB,WACvB,EAAKxgB,SAAS,CAAE2f,qBAAqB,K,4CAtKtC,WACC,MAAsCllB,KAAK8N,QAAQ1H,WAA3ChB,EAAR,EAAQA,QAASD,EAAjB,EAAiBA,OAAQD,EAAzB,EAAyBA,SACnB8F,GAAY5F,IAAYF,GAAYC,EAE1C,OACC,sBAAK+D,UAAU,gBAAf,UACC,sBAAKA,UAAU,0CAAf,UACC,wBAAQY,KAAK,SAAS8B,QAAS5L,KAAK+I,MAAMid,YAA1C,iBACA,sBAAM9c,UAAU,6BAEjB,sBAAKA,UAAU,uBAAf,UACC,wBAAQY,KAAK,SAASkB,UAAW5F,GAAWD,EAAQyG,QAAS5L,KAAKqlB,cAAlE,SACEngB,IAAaE,EAAU,KAAO,UAEhC,sBAAM8D,UAAU,6BAEjB,sBAAKA,UAAU,uBAAf,UACC,wBAAQY,KAAK,SAASkB,SAAUA,EAAUY,QAAS5L,KAAKulB,eAAxD,uBACA,wBAAQzb,KAAK,SAASkB,SAAUA,EAAUY,QAAS5L,KAAKwlB,eAAxD,uBACA,wBAAQ1b,KAAK,SAASkB,SAAUA,EAAUY,QAAS5L,KAAKylB,cAAxD,sBACA,sBAAMvc,UAAU,6BAEjB,sBAAKA,UAAU,uBAAf,UACC,wBAAQY,KAAK,SAASkB,SAAUA,EAAUY,QAAS5L,KAAK2lB,cAAxD,sBACA,sBAAMzc,UAAU,6BAEjB,sBAAKA,UAAU,uBAAf,UACC,wBAAQY,KAAK,SAAS8B,QAAS5L,KAAK8lB,qBAAsB9a,UAAW5F,EAArE,wBACA,sBAAM8D,UAAU,6BAEjB,qBAAKA,UAAU,uBAAf,SACC,uBAAMA,UAAU,6BAAhB,qBACUlJ,KAAKimB,wBAIhB,cAAC,EAAD,CACC/Y,OAAQlN,KAAKiF,MAAMigB,oBACnBtlB,QAASI,KAAK+lB,6B,8BAMlB,WAAoB,IAAD,OAClB,OAAkC,IAA9B/lB,KAAKiF,MAAMmgB,QAAQjiB,OACf,SAGP,wBAAQsG,SAAUzJ,KAAK4lB,mBAAoB/e,MAAO7G,KAAK8N,QAAQ1H,WAAWd,eAAiBtF,KAAKiF,MAAMkgB,WAAtG,SACEnlB,KAAKiF,MAAMmgB,QAAQta,KAAI,SAAAiD,GAAM,OAAI,EAAKmY,aAAanY,U,0BAKvD,SAAaA,GACZ,IAAMuJ,EAAU,yBAA2BvJ,EAAOoY,UAAY,kCAAoC,IAClG,OACC,yBAAwBtf,MAAOkH,EAAOpD,GAAIzB,UAAWoO,EAArD,UACEvJ,EAAOtL,KAAMsL,EAAOoY,UAAY,aAAe,KADpCpY,EAAOpD,M,+BAMtB,WAAqB,IAAD,OACnB3K,KAAKD,WAAaqE,EAAUW,OAAO,CAClC,oBAAqB,SAACN,GAAD,OAAe,EAAKc,SAAS,CAAEd,eACpD,eAAgB,kBAAM,EAAK2hB,kBAAiB,Q,kCAI9C,WACChiB,EAAU4B,OAAOhG,KAAKD,c,gCAGvB,SAAmBuP,EAAWC,IACxBA,EAAU9K,WAAazE,KAAKiF,MAAMR,WACtCzE,KAAKomB,sBAA2D1iB,IAA1C1D,KAAK8N,QAAQ1H,WAAWd,iB,8BAIhD,SAAiB+gB,GAAqB,IAAD,OAC/BrmB,KAAKiF,MAAMR,WAKhBzE,KAAK8N,QAAQtJ,OAAOrC,KAAK,CACxBD,MAAO,oBACL5B,MAAK,YAAkB,IAAf8kB,EAAc,EAAdA,QAEV,GADA,EAAK7f,SAAS,CAAE6f,YACZiB,EAAoB,CACvB,IAAM/gB,EAAgB8f,EAAQhW,MAAK,SAAAyW,GAAE,OAAIA,EAAGM,aACxC7gB,GAAiBA,EAAcqF,KAAO,EAAKmD,QAAQ1H,WAAWd,eACjE,EAAKyD,MAAMuc,oBAAoBhgB,EAAcqF,QAG7C,WACF,EAAKpF,SAAS,CAAE6f,QAAS,W,uCAuE3B,SAAgC3V,EAAWF,GAC1C,IAAIwN,EAAS,KAUb,OATItN,EAAUnK,eAAiBmK,EAAUnK,gBAAkBiK,EAAU4V,aACpEpI,EAAM,2BAAQA,GAAR,IAAgBoI,WAAY1V,EAAUnK,eAAiB,OAE1DmK,EAAUvK,UAAYuK,EAAUrK,WACnC2X,EAAM,2BAAQA,GAAR,IAAgBtY,WAAW,MAE7BgL,EAAUrK,SAAWmK,EAAU6V,QAAQjiB,SAC3C4Z,EAAM,2BAAQA,GAAR,IAAgBqI,QAAS,MAEzBrI,M,GAjMmBzT,kBA8M5B2b,GAAcvV,YAAcrJ,EAEb4e,UClNTqB,I,yDAWL,WAAYvd,GAAQ,IAAD,8BAClB,cAAMA,IAXP9D,MAAQ,CACPoI,QAAS,IASS,EAqDnB7D,aAAe,SAACZ,GACf,EAAKrD,SAAS,CAAE8H,QAASzE,EAAGe,OAAO9C,SAtDjB,EAyDnB0f,aAAe,SAAC3d,GACX,EAAKkF,QAAQ1H,WAAWhB,SAC3B,EAAK0I,QAAQtJ,OAAOrC,KAAK,CACxBD,MAAO,eACP6L,OAAQ,EAAKD,QAAQ1H,WAAWd,cAChC0I,WAAY,EAAK/I,MAAMoI,UACrB/M,MAAK,YAAoB,IAAjBuF,EAAgB,EAAhBA,UACN,EAAKiI,QAAQ1H,WAAWhB,SAC3B,EAAK2D,MAAMiZ,YAAYnc,MAEtB,SAAAzF,GAEF,EAAKuY,IAAIK,QAAQhD,QACjB,EAAK2C,IAAIK,QAAQwN,YAGnB5d,EAAG0F,kBAzEe,EA4EnBmY,SAAW,SAAC7d,GACX,EAAK8d,UAAU,OA7EG,EAgFnBC,SAAW,SAAC/d,GACX,EAAK8d,UAAU,OA/Ef,EAAK/N,IAAMC,sBACX,EAAKjO,GAAK,qBAAuB5G,KAAKC,SAASC,SAAS,IAAIC,OAAO,EAAG,GAHpD,E,0CAMnB,WACC,OACC,uBAAMkH,OAAO,IAAIlC,UAAU,UAAUoC,SAAUtL,KAAKumB,aAApD,UACC,uBAAOrd,UAAU,iBAAiBe,QAASjK,KAAK2K,GAAhD,oBACA,uBAAOgO,IAAK3Y,KAAK2Y,IAChB7O,KAAK,OAAOa,GAAI3K,KAAK2K,GACrBzB,UAAU,mBACVrC,MAAO7G,KAAKiF,MAAMoI,QAAS5D,SAAUzJ,KAAKwJ,aAC1CqB,MAAM,qDACN+b,aAAa,QAEb5mB,KAAK6mB,uB,6BAKT,WACC,IAAK7mB,KAAK8mB,UACT,OAAO,KAER,IAAM9b,GAAYhL,KAAK8N,QAAQ1H,WAAWhB,QAC1C,OACC,qCACC,wBAAQ0E,KAAK,SAASZ,UAAU,kBAAkB0C,QAAS5L,KAAKymB,SAAUzb,SAAUA,EAApF,gBACA,wBAAQlB,KAAK,SAASZ,UAAU,kBAAkB0C,QAAS5L,KAAK2mB,SAAU3b,SAAUA,EAApF,qB,gCAKH,SAAmBsE,EAAWC,GACzBvP,KAAK+I,MAAMge,mBAAqBzX,EAAUyX,mBAC7C/mB,KAAK2Y,IAAIK,QAAQhD,QACjBhW,KAAK2Y,IAAIK,QAAQwN,Y,uBAInB,SAAU/jB,GAAO,IAAD,OACfzC,KAAK8N,QAAQtJ,OAAOrC,KAAK,CACxBD,MAAO,aACPO,SACEnC,MAAK,SAACkC,GACJ,EAAKsL,QAAQ1H,WAAWhB,SAC3B,EAAK2D,MAAMiZ,YAAYxf,EAAOqD,kB,GA3DZyD,kBAsGtBgd,GAAQ5W,YAAcrJ,EAEPigB,U,UCrGTU,I,0NACL/hB,MAAQ,CACPR,WAAW,EAEXwiB,SAAS,EACTC,UAAW,KACXC,UAAW,GACXtK,OAAQ,GACRuK,kBAAmB,I,EA+BpBC,gBAAkB,YAAwB,IAArBhU,EAAoB,EAApBA,OAAQD,EAAY,EAAZA,MAC5B,EAAiD,EAAKnO,MAA9C4X,EAAR,EAAQA,OAAQuK,EAAhB,EAAgBA,kBAAmBF,EAAnC,EAAmCA,UACnC,OACC,cAAC,KAAD,CACC7T,OAAQA,EACR6T,UAAWA,EACXI,YAAa,EAAKC,WAClBnU,MAAOA,EACPoU,SAAUJ,EAAkBjkB,OAC5B0Z,OAAQA,K,EAKX0K,WAAa,YAA4B,IAAzB1lB,EAAwB,EAAxBA,MAAOwN,EAAiB,EAAjBA,IAAKrH,EAAY,EAAZA,MACrBkE,EAAO,EAAKjH,MAAMmiB,kBAAkBvlB,GAC1C,OACC,qBAAoCmG,MAAOA,EAA3C,SACC,wBAAQ8B,KAAK,SAASqP,eAAcjN,EAAKmB,QAAzC,SAAmDnB,EAAKzJ,QAD/C4M,EAAM,IAAMnD,EAAKmB,U,EAwE7Boa,aAAe,SAAC7e,GACf,IAAMiU,EAASjU,EAAGe,OAAO9C,MACzB,EAAKtB,UAAS,SAAAgK,GAAS,MAAK,CAC3BsN,SACAuK,kBAAmB,EAAKM,YAAYnY,EAAU4X,UAAWtK,Q,EAI3D8K,YAAc,SAAC/e,GACd,IAAQyE,EAAYzE,EAAGe,OAAOE,QAAtBwD,QACR,EAAKtE,MAAMuI,WAAW3N,OAAO0J,IAC7BzE,EAAG0F,kB,4CA3HJ,WACC,IAAQuO,EAAW7c,KAAKiF,MAAhB4X,OACR,OACC,sBAAK3T,UAAU,WAAf,UACC,uBAAOY,KAAK,SAASZ,UAAU,mBAAmBrC,MAAOgW,EAAQpT,SAAUzJ,KAAKynB,eAC/EznB,KAAK4nB,kB,wBAKT,WACC,MAAuC5nB,KAAKiF,MAApC4X,EAAR,EAAQA,OAAQoK,EAAhB,EAAgBA,QAASC,EAAzB,EAAyBA,UACzB,OAAID,IAAYC,EACR,qBAAKhe,UAAU,oBAAf,wBAIP,qBAAKA,UAAU,oBAAoB0C,QAAS5L,KAAK2nB,YAAjD,SACC,cAAC,KAAD,CAAW9K,OAAQA,EAAnB,SAA4B7c,KAAKqnB,sB,+BA4BpC,WAAqB,IAAD,OACnBrnB,KAAKD,WAAaqE,EAAUW,OAAO,CAClC,oBAAqB,SAACN,GAAD,OAAe,EAAKc,SAAS,CAAEd,eACpD,aAAc,kBAAM,EAAKojB,gBAEtB7nB,KAAKiF,MAAMR,WACdzE,KAAK6nB,aAED7nB,KAAKiF,MAAMiiB,WACf1a,YAAW,kBAAM,EAAKsb,kBAAiB,K,kCAIzC,WACC1jB,EAAU4B,OAAOhG,KAAKD,c,gCAGvB,SAAmBuP,EAAWC,GAAY,IAAD,QACnCA,EAAU9K,WAAazE,KAAKiF,MAAMR,WACtCzE,KAAK6nB,aAED7nB,KAAKiF,MAAMiiB,WACf1a,YAAW,kBAAM,EAAKsb,kBAAiB,K,2BAIzC,WACC,IAAMxgB,EAAO2L,SAASyH,cAAc,sBACpC,GAAIpT,EAAM,CACT,IAAM4f,EAAY5f,EAAKO,wBAAwBwL,OAC/CrT,KAAKuF,SAAS,CAAE2hB,iB,wBAIlB,WAAc,IAAD,OACPlnB,KAAKiF,MAAMR,YAKXzE,KAAKiF,MAAMgiB,SAA2C,IAAhCjnB,KAAKiF,MAAMkiB,UAAUhkB,QAC/CnD,KAAKuF,SAAS,CAAE0hB,SAAS,IAG1BjnB,KAAK8N,QAAQtJ,OAAOrC,KAAK,CACxBD,MAAO,kBACL5B,MAAK,YAAoB,IAAjB6mB,EAAgB,EAAhBA,UACVA,EAAUY,MAAK,SAACC,EAAGvV,GAAJ,OAAUuV,EAAEvlB,KAAKwlB,cAAcxV,EAAEhQ,SAChD,EAAK8C,UAAS,SAAAgK,GAAS,MAAK,CAC3B4X,YACAC,kBAAmB,EAAKM,YAAYP,EAAW5X,EAAUsN,QACzDoK,SAAS,SAER,WACF,EAAK1hB,SAAS,CAAE4hB,UAAW,GAAIC,kBAAmB,GAAIH,SAAS,U,yBAIjE,SAAYE,EAAWtK,GACtB,GAAe,KAAXA,EACH,OAAOsK,EAER,IAAM3K,EAAQK,EAAO9C,cACrB,OAAOoN,EAAUtK,QAAO,SAAA3Q,GAAI,OAAgD,IAA5CA,EAAKzJ,KAAKsX,cAAcjY,QAAQ0a,S,uCAiBjE,SAAgC/M,EAAWF,GAC1C,IAAIwN,EAAS,KAOb,OANItN,EAAUrK,UACb2X,EAAM,2BAAQA,GAAR,IAAgBtY,WAAW,MAE7BgL,EAAUrK,SAAWmK,EAAU4X,UAAUhkB,SAC7C4Z,EAAM,2BAAQA,GAAR,IAAgBoK,UAAW,GAAIC,kBAAmB,MAElDrK,M,GAtJczT,kBA+JvB0d,GAAStX,YAAcrJ,EAER2gB,UCzDAkB,G,kDAlGd,WAAYnf,GAAQ,IAAD,8BAClB,cAAMA,IAPP9D,MAAQ,CACP6T,OAAQ,GAKU,EAFnBwB,aAAc,EAEK,EAgEnBjK,cAAgB,SAACzH,EAAI5G,GACF,IAAd4G,EAAGyR,QACN,EAAKtR,MAAMsH,cAAczH,EAAI5G,IA/D9B,EAAKoZ,UAAYxC,sBAHC,E,0CAMnB,WAAU,IAAD,OACR,OACC,6BACE5Y,KAAK+I,MAAMof,cAAcrd,KAAI,SAACrI,EAAM2lB,GACpC,OAAO,EAAKC,UAAU5lB,EAAM2lB,U,uBAMhC,SAAU3lB,EAAM2lB,GAAM,IAAD,OACdjY,EAAU,SAACpH,GAChB,MAAO,CAAEuf,IAAK,EAAKvf,MAAM4B,GAAIyd,MAAKvhB,MAAO,EAAK0hB,OAAOH,KAEhDhY,EAAa,CAClBC,cAAe,SAACzH,GAAD,OAAQ,EAAKyH,cAAczH,EAAIuH,MAC9CI,YAAa,SAAC3H,GAAD,OAAQ,EAAKrD,SAAS,CAAEuT,OAAQsP,KAC7CrW,UAAW,SAACnJ,GAAD,OAAQ,EAAKmJ,UAAUnJ,IAClCqJ,SAAU,GAELuW,EAAY,CACjB,0BAA2BxoB,KAAKiG,QAAQmiB,GACxC,2BAA4BpoB,KAAKiF,MAAM6T,SAAWsP,GAE7CzP,EAAM3Y,KAAKiF,MAAM6T,SAAWsP,EAAMpoB,KAAKob,eAAY1X,EAEzD,OACC,eAAC,IAAD,CAAoBiH,GAAI3K,KAAK+I,MAAMkQ,YAAatI,UAAU,IAAIP,WAAYA,EAAYS,QAASV,EAASS,eAAgB,EAAxH,UACC,6BAAKnO,IACL,oBAAIyG,UAAWmC,YAAWmd,GAAY7P,IAAKA,EAA3C,SACE3Y,KAAKuoB,OAAOH,OAHiHA,K,oBASlI,SAAOA,GACN,OAAsB,IAAlBpoB,KAAK+I,MAAM4B,GACP+B,EAAY1M,KAAK+I,MAAMhD,WAAWqiB,IAElCpoB,KAAK+I,MAAM0f,YAAYL,K,qBAIhC,SAAQA,GACP,OAAOpoB,KAAK+I,MAAMhD,WAAWqiB,KAASpoB,KAAK+I,MAAM2f,eAAeN,K,gCAGjE,SAAmB9Y,EAAWC,GAE7B,GAAIvP,KAAKsa,aAAeta,KAAKob,UAAUpC,QAAS,CAC/C,IAAMuB,EAAcva,KAAKob,UAAUpC,QAAQlR,WAC3CT,EAAakT,EAAa,CAAEC,MAAO,YACnCD,EAAYvE,QACZhW,KAAKsa,aAAc,K,uBAUrB,SAAU1R,GACLF,MAGW,YAAXE,EAAGyG,KAAqBrP,KAAKiF,MAAM6T,OAAS,IAC/C9Y,KAAKsa,aAAc,EACnBta,KAAKuF,UAAS,SAAAgK,GAAS,MAAK,CAAEuJ,OAAQvJ,EAAUuJ,OAAS,MACzDlQ,EAAG0F,kBAEW,cAAX1F,EAAGyG,KAAuBrP,KAAKiF,MAAM6T,OAAS9Y,KAAK+I,MAAMof,cAAchlB,OAAS,IACnFnD,KAAKsa,aAAc,EACnBta,KAAKuF,UAAS,SAAAgK,GAAS,MAAK,CAAEuJ,OAAQvJ,EAAUuJ,OAAS,MACzDlQ,EAAG0F,uB,GAzFgBhF,iBCKhBqf,I,iOACL1jB,MAAQ,CACPa,WAAY,I,EA4Eb8iB,iBAAmB,SAAChgB,EAAI5G,GAEvB4B,QAAQE,IAAI9B,I,EAGb6mB,sBAAwB,SAACjgB,EAAI5G,GAC5B,IAAM6D,EAAY,EAAKZ,MAAMa,WAAW9D,EAAKsmB,KAAKviB,WAAW/D,EAAKomB,KAClE,EAAKrf,MAAMuI,WAAWzL,I,EAGvBijB,cAAgB,SAAClgB,EAAI5G,EAAM+mB,GAC1BnV,GAAS5R,EAAK6E,Q,EAGfmiB,gBAAkB,SAACpgB,EAAI5G,EAAM+mB,GAC5B,IAAME,GAA0B,IAAbjnB,EAAKsmB,IAAY,KAAO,IAAMtmB,EAAK6E,MAChDqiB,EAAe,EAAKjkB,MAAMa,WAAW9D,EAAKsmB,KAAKH,cAAcnmB,EAAKomB,KAElEe,EAAW1hB,OAAOqN,OAAO,iBAAmBoU,EAAcD,GAChE,GAAiB,OAAbE,EAAJ,CAIA,IAAMC,EAAS,CACdlnB,MAAO,aACP6L,OAAQ,EAAKD,QAAQ1H,WAAWd,cAChCK,SAAU3D,EAAKsmB,IACf1iB,SAAU5D,EAAKomB,IACfvhB,MAAOsiB,GAIR,EAAKrb,QAAQtJ,OAAOrC,KAAKinB,GAAQ1S,OAAM,SAACtW,GACvCqH,OAAO4G,MAAMjO,Q,4CAtGf,WACC,OACC,sBAAKuK,GAAG,WAAR,UACE3K,KAAKqpB,aACLrpB,KAAKyjB,yB,wBAKT,WAAc,IAAD,OACJ3d,EAAe9F,KAAKiF,MAApBa,WAER,OAA0B,IAAtBA,EAAW3C,OACP,GAIP,eAAC,IAAD,WACC,cAAC,IAAD,UACE2C,EAAWgF,KAAI,SAAAwe,GAAC,OAAI,cAAC,IAAD,UAAiBA,EAAE7mB,MAAT6mB,EAAE3e,SAEjC7E,EAAWgF,KAAI,SAAAwe,GAAC,OAChB,cAAC,IAAD,UACC,cAAC,GAAD,aAASrQ,YAAY,UAAU5I,cAAe,EAAK2Y,iBAAqBM,KAD1DA,EAAE3e,Y,+BAQrB,WACC,IAAMK,GAAYhL,KAAK8N,QAAQ1H,WAAWlB,SAC1C,OACC,eAAC,IAAD,CAAayF,GAAG,UAAhB,UACC,cAAC,IAAD,CAAUiB,QAAS5L,KAAK4oB,iBAAxB,kCAGA,cAAC,IAAD,CAAUhd,QAAS5L,KAAK6oB,sBAAxB,kCAGA,cAAC,IAAD,CAAU7Y,SAAO,IACjB,cAAC,IAAD,CAAUpE,QAAS5L,KAAK8oB,cAAxB,wBAGA,cAAC,IAAD,CAAU9d,SAAUA,EAAUY,QAAS5L,KAAKgpB,gBAA5C,4B,+BAOH,WAAqB,IAAD,OACnBhpB,KAAKD,WAAaqE,EAAUW,OAAO,CAClC,WAAc,kBAAM,EAAKwkB,YAAW,IACpC,eAAgB,kBAAM,EAAKA,YAAW,IACtC,aAAc,SAAC/mB,GAAD,OAAY,EAAKgnB,UAAUhnB,Q,kCAI3C,WACC4B,EAAU4B,OAAOhG,KAAKD,c,gCAGvB,SAAmBuP,EAAWC,GACzBvP,KAAK+I,MAAMzD,eAAiBtF,KAAK+I,MAAMzD,gBAAkBgK,EAAUhK,eACtEtF,KAAKupB,YAAW,K,wBAyClB,SAAWE,GAAW,IAAD,OACpBzpB,KAAK8N,QAAQtJ,OAAOrC,KAAK,CACxBD,MAAO,iBACP6L,OAAQ/N,KAAK8N,QAAQ1H,WAAWd,gBAC9BhF,MAAK,SAACkC,GACR,IADmB,EACbsD,EAAetD,EAAfsD,WAEA4jB,EAA2C,IAAjC,EAAKzkB,MAAMa,WAAW3C,OAHnB,cAIH2C,GAJG,IAInB,2BAA4B,CAAC,IAApBwiB,EAAmB,QACrBqB,EAAUD,EAAU,EAAKzkB,MAAMa,WAAWwiB,EAAI3d,IAAM,KAC1D2d,EAAII,eAAiBgB,EAAWD,EAAWE,EAAQjB,eAAiBiB,EAAQ5jB,WAAcuiB,EAAIviB,WAC9FuiB,EAAIsB,gBAAkBF,EAAWD,EAAWE,EAAQC,gBAAkBD,EAAQlB,YAAeH,EAAIG,aAP/E,8BASnB,EAAKljB,SAAS,CAAEO,kBACd,SAAC1F,GAEHwD,QAAQC,MAAMzD,Q,uBAIhB,SAAUoC,GACT,IAAMqnB,EAAc,SAACC,EAAKjoB,EAAOkoB,GAChC,OAAOD,EAAItmB,MAAM,EAAG3B,GAAOmoB,OAAO,CAACD,IAAOC,OAAOF,EAAItmB,MAAM3B,EAAQ,KAGpE7B,KAAKuF,UAAS,SAAAgK,GAAS,MAAK,CAC3BzJ,WAAYyJ,EAAUzJ,WAAWgF,KAAI,SAACwd,GACrC,OAAIA,EAAI3d,KAAOnI,EAAOmD,SACd,2BACH2iB,GADJ,IAGCI,eAAgBJ,EAAII,eACpBkB,gBAAiBtB,EAAIsB,gBACrB7jB,WAAY8jB,EAAYvB,EAAIviB,WAAYvD,EAAOoD,SAAUpD,EAAOqD,WAChE4iB,YAAaoB,EAAYvB,EAAIG,YAAajmB,EAAOoD,SAAUpD,EAAOynB,cAG7D3B,a,GAxJYhf,kBAmKvBqf,GAASjZ,YAAcrJ,EAERsiB,UCtEAuB,I,mNAhGdjlB,MAAQ,CACPa,WAAY,GACZyiB,OAAQ,S,EAmFT4B,aAAe,SAACvhB,GACf,IAAM2f,EAAS3f,EAAGe,OAAO9C,MACzB,EAAKtB,SAAS,CAAEgjB,Y,4CAjFjB,WACC,MAA+BvoB,KAAKiF,MAA5Ba,EAAR,EAAQA,WAAYyiB,EAApB,EAAoBA,OACpB,GAAIziB,EAAW3C,OAAS,EACvB,OAAO,KAIR,IADA,IAAIinB,EAAW,GACNC,EAAI,EAAGA,EAAIvkB,EAAW,GAAGC,WAAW5C,OAAS,KAAMknB,EAC3DD,EAAS1oB,KAAK1B,KAAKsqB,aAAaD,IAGjC,OACC,eAAC,EAAD,CAAUvb,aAAa,OAAO5B,OAAQlN,KAAK+I,MAAMmE,OAAQtN,QAASI,KAAK+I,MAAMnJ,QAA7E,UACC,gDACA,qBAAKsJ,UAAU,sBAAf,SACEkhB,IAEF,sBAAKlhB,UAAU,wBAAf,wBAEC,kCAAO,uBAAOY,KAAK,QAAQC,QAAoB,UAAXwe,EAAoB1hB,MAAM,QAAQ4C,SAAUzJ,KAAKmqB,eAArF,YACA,kCAAO,uBAAOrgB,KAAK,QAAQC,QAAoB,SAAXwe,EAAmB1hB,MAAM,OAAO4C,SAAUzJ,KAAKmqB,eAAnF,kB,0BAMJ,SAAaE,GACZ,OACC,wBAAOnhB,UAAU,wBAAjB,UACC,gCACC,+BACC,qBAAIA,UAAU,sBAAd,cAAsCmhB,EAAtC,QACA,qBAAInhB,UAAU,4BAAd,cAA4CmhB,EAA5C,QACA,qBAAInhB,UAAU,4BAAd,cAA4CmhB,EAA5C,QACA,qBAAInhB,UAAU,4BAAd,cAA4CmhB,EAA5C,QACA,qBAAInhB,UAAU,4BAAd,cAA4CmhB,EAA5C,aAGF,kCACErqB,KAAKuqB,aAAaF,EAAG,GACrBrqB,KAAKuqB,aAAaF,EAAG,GACrBrqB,KAAKuqB,aAAaF,EAAG,GACrBrqB,KAAKuqB,aAAaF,EAAG,QAdsBA,K,0BAoBhD,SAAaA,EAAGf,GACf,OACC,+BACC,qBAAIpgB,UAAU,4BAAd,cAA4CmhB,EAAGf,EAA/C,OACA,6BAAKtpB,KAAKwqB,YAAYH,EAAGf,EAAG,KAC5B,6BAAKtpB,KAAKwqB,YAAYH,EAAGf,EAAG,KAC5B,6BAAKtpB,KAAKwqB,YAAYH,EAAGf,EAAG,KAC5B,6BAAKtpB,KAAKwqB,YAAYH,EAAGf,EAAG,OALpBA,K,yBAUX,SAAYe,EAAGf,EAAGmB,GACjB,IAAMrC,EAAU,EAAJiC,EAAY,GAAJf,EAASmB,EACvBnC,EAAMtoB,KAAKiF,MAAMa,WAAW,GAClC,MAA0B,SAAtB9F,KAAKiF,MAAMsjB,OACP7b,EAAY4b,EAAIviB,WAAWqiB,IAE5BE,EAAIG,YAAYL,K,+BAGxB,WAAqB,IAAD,OACnBpoB,KAAKD,WAAaqE,EAAUW,OAAO,CAClC,iBAAkB,gBAAGe,EAAH,EAAGA,WAAH,OAAoB,EAAKP,SAAS,CAAEO,oB,kCAIxD,WACC1B,EAAU4B,OAAOhG,KAAKD,gB,GAnFIuJ,kBCAtBohB,I,mNACLzlB,MAAQ,CACP0lB,eAAe,EAEfC,gBAAgB,G,EAgCjBC,aAAe,SAAChpB,GACD,IAAVA,GAAgB,EAAKoD,MAAM2lB,gBAC9B,EAAKrlB,SAAS,CAAEqlB,gBAAgB,K,EAIlCE,eAAiB,WAChB,EAAKvlB,SAAS,CAAEolB,eAAe,K,EAGhCI,gBAAkB,WACjB,EAAKxlB,SAAS,CAAEolB,eAAe,K,4CApChC,WACC,OACC,sBAAKzhB,UAAU,YAAf,UACC,eAAC,IAAD,CAAMsH,SAAUxQ,KAAK6qB,aAArB,UACC,eAAC,IAAD,WACC,cAAC,IAAD,mBACA,cAAC,IAAD,oBACA,cAAC,IAAD,uBAED,cAAC,IAAD,CAAUG,aAAa,EAAvB,SACC,cAAC,GAAD,CAAU1Z,WAAYtR,KAAK+I,MAAMuI,WAAYhM,cAAetF,KAAK8N,QAAQ1H,WAAWd,kBAErF,cAAC,IAAD,CAAU0lB,YAAahrB,KAAKiF,MAAM2lB,eAAlC,SACC,cAAC,GAAD,CAAUtZ,WAAYtR,KAAK+I,MAAMuI,WAAYlM,QAASpF,KAAK8N,QAAQ1H,WAAWhB,YAE/E,cAAC,IAAD,CAAU8D,UAAU,yCAApB,SACC,wBAAQY,KAAK,SAAS8B,QAAS5L,KAAK8qB,eAApC,iCAIF,cAAC,GAAD,CAAe5d,OAAQlN,KAAKiF,MAAM0lB,cAAe/qB,QAASI,KAAK+qB,yB,GA/B3CzhB,kBAuDxBohB,GAAUhb,YAAcrJ,EAETqkB,UCXAO,G,4JAnDd,WACC,MAA8B,QAA1BjrB,KAAK+I,MAAMghB,KAAK7nB,MACZlC,KAAKkrB,iBAGNlrB,KAAKmrB,mB,4BAGb,WACC,OACC,sBAAMjiB,UAAWlJ,KAAKorB,gBAAtB,SACEprB,KAAK+I,MAAMghB,KAAKjpB,Y,4BAKpB,WACC,IAAQipB,EAAS/pB,KAAK+I,MAAdghB,KACR,OACC,uBAAM7gB,UAAWlJ,KAAKorB,gBAAtB,UACC,uBAAMliB,UAAU,uBAAhB,UACC,sBAAMA,UAAU,0BAAhB,SAA2C6gB,EAAKsB,YAC/C,IAAMtB,EAAKuB,OAAS,OAErBvB,EAAKjpB,a,2BAKT,WAAiB,IAAD,EACPipB,EAAS/pB,KAAK+I,MAAdghB,KAER,OAAO1e,YAAW,gBAAD,GAChB,yBAAyC,QAAf0e,EAAK7nB,OADf,cAEf,yBAA2B6nB,EAAKwB,QAAyB,QAAfxB,EAAK7nB,OAFhC,cAGf,uBAAyB6nB,EAAKhnB,OAAQ,GAHvB,Q,GAjCGuG,iBC6ChBkiB,GAAS,I,WA3Cd,aAAe,oBACdxrB,KAAKyrB,IAAM,EACXzrB,KAAK0rB,OAAS,GACd1rB,KAAK2rB,iBAAmB,G,wCAGzB,SAAKnnB,GAAS,IAAD,OACZA,EAAO7E,QAAU,SAACmB,EAASiC,GAC1B,IAAM6oB,EAAU,CAAE9qB,QAASA,EAAU,KAAMiC,SAC3C,EAAK8oB,WAAWD,IAGjBxnB,EAAUW,OAAO,CAChB,IAAO/E,KAAK8rB,WAAWlrB,KAAKZ,U,wBAI9B,SAAWgC,GACV,IAAM4pB,EAAO,eAAQ5pB,GACrBhC,KAAK6rB,WAAWD,K,wBAGjB,SAAWA,GACV,IAAMjhB,IAAO3K,KAAKyrB,IACZM,EAAU,aAAKphB,MAAOihB,GAC5B5rB,KAAK0rB,OAAS1rB,KAAK0rB,OAAO1B,OAAO,CAAC+B,IAAcvoB,OA5BhC,KAyBG,oBAIExD,KAAK2rB,kBAJP,IAInB,2BAA4C,EAC3C9mB,EAD2C,SAClC7E,KAAK0rB,SALI,iC,oBASpB,SAAO7mB,GACD7E,KAAK2rB,iBAAiB1pB,SAAS4C,KACnC7E,KAAK2rB,iBAAiBjqB,KAAKmD,GAC3BA,EAAS7E,KAAK0rB,W,oBAIhB,SAAO7mB,GACN7E,KAAK2rB,iBAAmB3rB,KAAK2rB,iBAAiB9O,QAAO,SAAAja,GAAC,OAAIA,IAAMiC,S,MAKnD2mB,M,OC7CA,SAASQ,GAAIjjB,GAC3B,IAAMkjB,ED8CA,WACN,MAAgC1a,mBAAS,IAAzC,mBAAO0a,EAAP,KAAiBC,EAAjB,KAWA,OATArZ,qBAAU,WACT,SAASsZ,EAAeC,GACvBF,EAAYE,GAIb,OADAZ,GAAOzmB,OAAOonB,GACP,kBAAMX,GAAOxlB,OAAOmmB,MACzB,IAEIF,EC1DUI,GAEXC,EAASC,mBAOf,OALA1Z,qBAAU,WACT,IAAMG,EAAMsZ,EAAOtT,QACnBhG,EAAIsQ,UAAYtQ,EAAI+R,aAAe/R,EAAIkR,eACrC,CAACoI,EAAQL,IAGX,qBAAKthB,GAAG,MAAMgO,IAAK2T,EAAnB,SACEL,EAASnhB,KAAI,SAAAif,GAAI,OAAI,cAAC,GAAD,CAAuBA,KAAMA,GAAfA,EAAKpf,S,WCLtC6hB,G,4MACLvnB,MAAQ,CACP+e,cAAc,EAEdzF,aAAc,KACdC,gBAAiB,KACjB2F,WAAY,KACZ4C,iBAAkB,KAClB0F,UAAW,EACXC,MAAO,EACPC,SAAS,G,EAqHVlO,gBAAkB,SAACzc,GAClB,EAAKuD,SAASvD,I,EAGfsP,WAAa,SAACjM,GACb,EAAKE,SAAS,CACbgZ,aAAclZ,EACdmZ,gBAAiBnZ,EAEjB8e,WAAY,M,EAId7F,WAAa,WACZ,EAAK/Y,SAAS,CACbwhB,iBAAkB,M,EAIpBzB,oBAAsB,SAAChgB,EAAeD,GACrC,EAAKE,SAAS,CAAEye,aAAqB,IAAP3e,QAAmB3B,IAAP2B,IAC1C,EAAKyI,QAAQ1H,WAAWb,SAAS,CAAED,kBACxB,IAAPD,QAAmB3B,IAAP2B,IACf,EAAKyI,QAAQ1H,WAAWb,SAAS,CAAEF,OACnC,EAAKiM,WAAWjM,K,EAIlB2gB,YAAc,WACb,EAAKzgB,SAAS,CAAEonB,SAAS,K,EAG1BC,YAAc,WACb,EAAKrnB,SAAS,CAAEonB,SAAS,K,EAG1BE,gBAAkB,WACjB,EAAK/e,QAAQtJ,OAAOrC,KAAK,CAAED,MAAO,aAAcO,KAAM,OAAQnC,MAAK,SAAAkC,GAClE,IAAM6C,EAAK7C,EAAOqD,UACb,EAAKZ,MAAM+e,cACf,EAAK1S,WAAWjM,GAEjB,EAAKE,SAAS,CAAEye,aAAqB,IAAP3e,IAC9B,EAAKyI,QAAQ1H,WAAWb,SAAS,CAAEF,W,4CAxJrC,WACC,MAA8BrF,KAAK8N,QAAQ1H,WAAnCf,EAAR,EAAQA,GAAIC,EAAZ,EAAYA,cACZ,EAA6EtF,KAAKiF,MAA1EsZ,EAAR,EAAQA,aAAcC,EAAtB,EAAsBA,gBAAiB2F,EAAvC,EAAuCA,WAAYH,EAAnD,EAAmDA,aAAc2I,EAAjE,EAAiEA,QAC3DG,EAAc,CAAExnB,gBAAeiZ,eAAcC,kBAAiB2F,aAAY9e,KAAI2e,gBAEpF,OACC,sBAAKrZ,GAAG,MAAR,UACE3K,KAAK+sB,WAAWJ,EAASG,GACzB9sB,KAAKgtB,0B,wBAKT,SAAWL,EAASG,GACnB,MAAqD9sB,KAAK8N,QAAQ1H,WAA1DlB,EAAR,EAAQA,SAAUC,EAAlB,EAAkBA,OAAQC,EAA1B,EAA0BA,QAASE,EAAnC,EAAmCA,cAEnC,OACC,sBAAK4D,UAAU,YAAf,UACC,sBAAKA,UAAWyjB,EAAU,4BAA8B,YAAxD,UACC,wBAAQ7iB,KAAK,SAAS8B,QAAS5L,KAAK4sB,YAAa1jB,UAAU,iBAA3D,mBACA,cAAC,GAAD,CAAS8Y,YAAahiB,KAAKsR,WAAYwV,WAAW,EAAMC,iBAAkB/mB,KAAKiF,MAAM8hB,mBACrF,cAAC,GAAD,CAAWzV,WAAYtR,KAAKsR,gBAE7B,sBAAKpI,UAAU,oBAAf,UACC,cAAC,GAAD,CAAehE,SAAUA,IAAaC,EAAQC,QAASA,EAASE,cAAeA,EAAeggB,oBAAqBtlB,KAAKslB,oBAAqBU,YAAahmB,KAAKgmB,cAC/J,cAAC,GAAD,2BAAY8G,GAAZ,IAAyBrO,gBAAiBze,KAAKye,gBAAiBH,WAAYte,KAAKse,sB,gCAMrF,WACC,OACC,qBAAKpV,UAAU,qCAAf,SACC,eAAC,IAAD,CAAMsH,SAAUxQ,KAAK6qB,aAArB,UACC,eAAC,IAAD,WACC,cAAC,IAAD,kBACA,cAAC,IAAD,6BAED,cAAC,IAAD,CAAUG,aAAa,EAAvB,SACC,cAAC,GAAD,MAED,cAAC,IAAD,UACC,cAAC9Y,GAAD,CAAiBZ,WAAYtR,KAAKsR,sB,+BAOvC,WAAqB,IAAD,OACnBtR,KAAKD,WAAaqE,EAAUW,OAAO,CAClC,WAAc,kBAAM,EAAKD,gBACzB,eAAgB,SAAC9C,GAAD,OAAU,EAAK0D,WAAW1D,IAC1C,aAAc,WAER,EAAKiD,MAAM+e,cACf,EAAK6I,mBAGP,YAAa,WACZ,EAAKtnB,SAAS,CACbye,cAAc,KAGhB,aAAc,SAACxhB,GACd,GAAwB,IAApBA,EAAOmD,UAAsC,KAApBnD,EAAOoD,SAAiB,CACpD,IAAMP,EAAK7C,EAAOqD,UACb,EAAKZ,MAAM+e,cACf,EAAK1S,WAAWjM,GAEjB,EAAKE,SAAS,CAAEye,aAAqB,IAAP3e,MAGhC,iBAAkB,SAAC7C,GAClB,IAAM6C,EAAK7C,EAAOsD,WAAW,GAAGC,WAAW,IACtC,EAAKd,MAAM+e,cACf,EAAK1S,WAAWjM,GAEjB,EAAKE,SAAS,CAAEye,aAAqB,IAAP3e,S,kCAKjC,WACCjB,EAAU4B,OAAOhG,KAAKD,c,0BAGvB,WAAgB,IAAD,OAEdC,KAAK8N,QAAQtJ,OAAOrC,KAAK,CAAED,MAAO,eAAgB5B,MAAK,SAACkC,GACvD,IAAQ6C,EAAc7C,EAAd6C,GAAIqnB,EAAUlqB,EAAVkqB,MAEP,EAAKznB,MAAM+e,cACf,EAAK1S,WAAWjM,GAEjB,EAAKE,SAAS,CAAEye,aAAqB,IAAP3e,EAAUqnB,QAAOD,UAAWC,S,wBAI5D,SAAW1qB,GACVhC,KAAKuF,UAAS,SAAAgK,GAAS,MAAK,CAC3BgP,aAAcvc,EAAKqD,GACnBmZ,gBAAiBxc,EAAKqD,GACtBonB,UAAWld,EAAUmd,MACrBA,MAAO1qB,EAAK0qB,c,GA3HGpjB,iBA+KlBkjB,GAAI9c,YAAcrJ,EAEHmmB,UCvLTS,I,mNACLhoB,MAAQ,CACPR,WAAW,EACXW,SAAS,EACTD,QAAQ,EACR+nB,WAAW,G,EAuEZC,YAAc,SAACvkB,GACd,EAAKrD,SAAS,CAAE2nB,WAAW,IAC3B,EAAKpf,QAAQtJ,OAAOrC,KAAK,CAAED,MAAO,oBAAqB5B,MAAK,SAAAkC,GAC3D,IAAIwlB,EAAI/U,SAASE,cAAc,KAC/B6U,EAAEoF,aAAa,WAAY,mBAC3BpF,EAAEqF,KAAO7qB,EAAOxB,IAChBgnB,EAAEjI,QAAS,EACX9M,SAASQ,KAAKC,YAAYsU,GAC1BA,EAAEsF,QACFra,SAASQ,KAAK8Z,YAAYvF,GAE1B,EAAKziB,SAAS,CAAE2nB,WAAW,OAE5BtkB,EAAG0F,kB,4CA7EJ,WACC,OACC,sBAAK3D,GAAG,MAAR,UACE3K,KAAK+sB,aACL/sB,KAAKgtB,0B,wBAKT,WACC,OACC,sBAAK9jB,UAAU,YAAf,UACC,qBAAKA,UAAU,YAAf,SACElJ,KAAKiF,MAAMG,UAAYpF,KAAKiF,MAAME,OAAS,kEAAoE,mCAEhHnF,KAAKiF,MAAMG,UAAYpF,KAAKiF,MAAME,OAClC,sBAAM+D,UAAU,YAAYoC,SAAUtL,KAAKmtB,YAA3C,SACC,wBAAQrjB,KAAK,SAASkB,SAAUhL,KAAKiF,MAAMioB,UAA3C,SAAuDltB,KAAKiF,MAAMioB,UAAY,eAAiB,aAE7F,U,gCAKP,WACC,OACC,qBAAKhkB,UAAU,qCAAf,SACC,cAAC,GAAD,Q,+BAKH,WAAqB,IAAD,OACnBlJ,KAAKD,WAAaqE,EAAUW,OAAO,CAClC,WAAc,kBAAM,EAAKD,gBACzB,oBAAqB,SAACL,GAAD,OAAe,EAAKE,mBAAmBF,IAC5D,aAAc,kBAAM,EAAKc,SAAS,CAAEH,SAAS,EAAMD,QAAQ,KAC3D,YAAa,kBAAM,EAAKI,SAAS,CAAEH,SAAS,EAAOD,QAAQ,KAC3D,aAAc,kBAAM,EAAKI,SAAS,CAAEJ,QAAQ,KAC5C,cAAe,kBAAM,EAAKI,SAAS,CAAEJ,QAAQ,S,kCAI/C,WACCf,EAAU4B,OAAOhG,KAAKD,c,gCAGvB,SAAmB0E,GAElBzE,KAAKuF,SAAS,CAAEd,YAAWW,SAAS,EAAOD,QAAQ,M,0BAGpD,WAAgB,IAAD,OAEdnF,KAAK8N,QAAQtJ,OAAOrC,KAAK,CAAED,MAAO,eAAgB5B,MAAK,SAACkC,GACvD,IAAQ0C,EAAyB1C,EAAzB0C,SAAUC,EAAe3C,EAAf2C,OACZC,EAAiB,IADU5C,EAAP6C,IACEH,EAE5B,EAAKK,SAAS,CAAEd,WAAW,EAAMW,UAASD,cACxC,SAAC/E,GACH,EAAKmF,SAAS,CAAEJ,QAAQ,W,GAxETmE,kBA6FlB2jB,GAAIvd,YAAcrJ,EAEH4mB,U,OCjGA,SAASO,GAAazkB,GACpC,IAUM0kB,EACL,sBAAKvkB,UAAU,qBAAf,UACEH,EAAM2kB,WAAa,0BAA4B,0BAEhD,qBAAKxkB,UAAU,qBAAf,8EAGA,uBAAMA,UAAU,qBAAqBoC,SAjBf,SAAC1C,GACxB,IAAM5H,EAAM4H,EAAGe,OAAOgkB,SAAS,gBAAgB9mB,MAC/CkC,EAAMxF,QAAQvC,GACd4H,EAAG0F,kBAcF,UACC,uBAAOxE,KAAK,OAAOrH,KAAK,eAAeud,YAAY,wBAAwB9W,UAAU,sBACrF,wBAAQY,KAAK,SAASkB,SAAUjC,EAAM2kB,WAAtC,iCAED,sBAAMxkB,UAAU,qBAAqBoC,SAhBV,SAAC1C,GAC7BG,EAAMxF,QAAQ,MACdqF,EAAG0F,kBAcF,SACC,wBAAQxE,KAAK,SAASkB,SAAUjC,EAAM2kB,WAAtC,wCAKGE,EACL,qBAAK1kB,UAAU,8CAAf,SACC,cAAC,GAAD,MAIF,OACC,sBAAKyB,GAAG,eAAR,UACE8iB,EACAG,KCzCW,WAA0B,iCCanCC,I,OAAc,CACnBprB,KAAMqrB,kBACNC,QAASD,UA8IKE,G,kDAjId,WAAYjlB,GAAQ,IAAD,8BAClB,cAAMA,IAVP9D,MAAQ,CACPR,WAAW,EACXipB,YAAY,EACZtnB,WAAY,MAMM,EAgEnB6nB,kBAAoB,WACnB,EAAK1qB,QAAQ,OAjEK,EAoEnBA,QAAU,SAACvC,GACV,EAAKuE,SAAS,CAAEmoB,YAAY,IAE5B,EAAKlpB,OAAO5E,QAAU,WACrB,EAAKkE,IAAI,yBACTM,EAAUuJ,QAAO,GACjB,EAAKpI,SAAS,CAAEd,WAAW,EAAOipB,YAAY,MAInC,OAAR1sB,EACU,EAAKwD,OAAO0pB,cAEZ,EAAK1pB,OAAOjB,QAAQvC,IAGvBV,MAAK,WACf,EAAKwD,IAAI,sBACTM,EAAUuJ,QAAO,GACjB,EAAKpI,SAAS,CAAEd,WAAW,EAAMipB,YAAY,OAC3C,SAAAttB,GACF,EAAK0D,IAAI,8BACTM,EAAUuJ,QAAO,GACjB,EAAKpI,SAAS,CAAEd,WAAW,EAAOipB,YAAY,QA3F7B,EA+FnBS,iBAAmB,WAElB,EAAK3pB,OAAO4pB,cAjGM,EAoGnBtqB,IAAM,SAAChD,GAEN0qB,GAAOK,WAAW,CAAE/qB,QAASA,EAAU,QAtGrB,EAyGnButB,YAAc,SAACrsB,GACTiR,WAIDjR,EAAKssB,KACRrb,SAASpI,MAAQ,EAAK0jB,cAAgB,MAAQvsB,EAAKssB,KAAK3jB,GAAK,KAAO3I,EAAKssB,KAAKzjB,MAE9EoI,SAASpI,MAAQ,EAAK0jB,gBAjHL,EAqHnB5pB,mBAAqB,SAACic,GACjBA,GACH,EAAKpc,OAAOrC,KAAZ,aAAmBD,MAAO,WAAc2rB,KAAenX,OAAM,SAACtW,GAC7DqH,OAAO4G,MAAM,oFAAsFjO,MAEpG,EAAKoE,OAAOrC,KAAK,CAAED,MAAO,gBAAiB5B,KAAK,EAAK+tB,aAAa,SAACjuB,GAAD,OAAS,EAAKiuB,YAAY,QAE5F,EAAKA,YAAY,KAzHlB,EAAK7pB,OAAS,IAAI9E,EAClB,EAAK0G,WAAa,IAAIpB,EACtB,EAAKupB,cAAgBtb,SAASpI,MAE9BzG,EAAUoqB,KAAK,EAAKhqB,QACpBJ,EAAUW,OAAO,CAChB,oBAAqB,EAAKJ,mBAC1B,aAAc,EAAK0pB,YACnB,YAAa,EAAKA,cAEnB7C,GAAOgD,KAAK,EAAKhqB,QACjB,EAAK4B,WAAWooB,KAAK,EAAKhqB,QAC1B,EAAK4B,WAAWqoB,aAAY,SAAAroB,GAC3B,EAAKb,SAAS,CAAEa,kBAhBC,E,0CAoBnB,WACC,OACC,cAAC,IAAD,UACC,cAACM,EAAD,CAAkBN,WAAYpG,KAAKiF,MAAMmB,WAAYtC,IAAK9D,KAAK8D,IAAKU,OAAQxE,KAAKwE,OAAjF,SACC,sBAAK0E,UAAU,MAAf,UACC,yBAAQA,UAAU,aAAlB,UACC,qBAAIA,UAAU,UAAd,UACC,cAAC,IAAD,CAASwlB,GAAG,OAAOC,SAAU,SAACtE,EAAGvN,GAAJ,OAAUuN,GAAoB,MAAfvN,EAAE8R,UAA9C,iBACA,cAAC,IAAD,CAASF,GAAG,OAAZ,oBAED,qBAAKG,IAAKC,GAAM5lB,UAAU,WAAW6lB,IAAI,WACzC,oBAAI7lB,UAAU,YAAd,yBAEAlJ,KAAKgvB,yB,2BAOX,WACC,OAAKhvB,KAAKiF,MAAMR,UAKf,eAAC,IAAD,WACC,cAAC,IAAD,CAAOuT,KAAK,OAAZ,SACC,cAAC,GAAD,MAED,cAAC,IAAD,UACC,cAAC,GAAD,SATK,cAAC,GAAD,CAAc0V,WAAY1tB,KAAKiF,MAAMyoB,WAAYnqB,QAASvD,KAAKuD,Y,+BAexE,WAEMvD,KAAK+I,MAAMkmB,SACfjvB,KAAKiuB,wB,GAtEU/iB,aCRZgkB,GAAcC,QACU,cAA7B1nB,OAAO2nB,SAASC,UAEc,UAA7B5nB,OAAO2nB,SAASC,UAEhB5nB,OAAO2nB,SAASC,SAAS7S,MACxB,2DAsCH,SAAS8S,GAAgBC,GACxB/Z,UAAUga,cACR5pB,SAAS2pB,GACTjvB,MAAK,SAAAmvB,GACLA,EAAaC,cAAgB,WAC5B,IAAMC,EAAmBF,EAAaG,WACtCD,EAAiBE,cAAgB,WACD,cAA3BF,EAAiB1qB,QAChBuQ,UAAUga,cAAcM,WAK3BlsB,QAAQE,IAAI,6CAKZF,QAAQE,IAAI,4CAMhB4S,OAAM,SAAA7S,GACND,QAAQC,MAAM,4CAA6CA,M,qBCpE9DksB,IAASC,OAAO,cAAC,GAAD,IAAS/c,SAASC,eAAe,SACjD+c,IAAMC,cAAc,SDQL,WACd,GAA6C,kBAAmB1a,UAAW,CAG1E,GADkB,IAAI2a,IAAIrC,IAAwBrmB,OAAO2nB,UAC3CgB,SAAW3oB,OAAO2nB,SAASgB,OAIxC,OAGD3oB,OAAOkB,iBAAiB,QAAQ,WAC/B,IAAM4mB,EAAK,UAAMzB,IAAN,sBAEPoB,KAiDP,SAAiCK,GAEhClvB,MAAMkvB,GACJjvB,MAAK,SAAAC,GAGgB,MAApBA,EAASqgB,SACuD,IAAhErgB,EAAS8vB,QAAQC,IAAI,gBAAgBxuB,QAAQ,cAG7C0T,UAAUga,cAAce,MAAMjwB,MAAK,SAAAmvB,GAClCA,EAAae,aAAalwB,MAAK,WAC9BmH,OAAO2nB,SAASqB,eAKlBnB,GAAgBC,MAGjB7Y,OAAM,WACN9S,QAAQE,IACP,oEArEA4sB,CAAwBnB,GAIxB/Z,UAAUga,cAAce,MAAMjwB,MAAK,WAClCsD,QAAQE,IACP,gHAMFwrB,GAAgBC,OCnCpBoB,K","file":"static/js/main.ab533b50.chunk.js","sourcesContent":["// PPSSPP debugger API client\r\n//\r\n// Most operations use promises and are asynchronous.\r\n//\r\n// Example usage:\r\n//\r\n//    let ppsspp = new PPSSPP();\r\n//    ppsspp.listen('cpu.stepping', function () {\r\n//        console.log('Hit a breakpoint');\r\n//    });\r\n//    ppsspp.autoConnect().then(function () {\r\n//        return ppsspp.send({ event: 'cpu.getReg', name: 'pc' });\r\n//    }).then(function (result) {\r\n//        console.log('pc: ', result.uintValue);\r\n//    }).catch(function (err) {\r\n//        console.log('Something went wrong', err);\r\n//    });\r\n//\r\n// Methods:\r\n//  - autoConnect(): Find and connect to PPSSPP automatically.  Returns a promise.\r\n//  - connect(uri): Connect to a specific WebSocket URI (begins with ws://.)  Returns a promise.\r\n//  - disconnect(): Disconnect from PPSSPP.  No return.\r\n//  - listen(name, handler): Adds a listener for unsolicited events (e.g. 'log') or '*' for all.  No return.\r\n//      The handler takes two parameter, the data object, and whether any previous handler returned true.\r\n//  - send(object): Send an event to PPSSPP.  Returns a promise resolving to the data object.\r\n//      Note that not all PPSSPP events have a response.  You may receive null or it may never resolve.\r\n//\r\n// Properties:\r\n//  - onError: Set this to a function receiving (message, level) for errors.\r\n//  - onClose: Set this to a function with no parameters called when on disconnect.\r\n//\r\n// For documentation on the actual events for send() and listen(), look in PPSSPP's source code.\r\n// Start with the comment in Core/Debugger/WebSocket.cpp.\r\n// Individual files in Core/Debugger/WebSocket/ also have comments describing the events and parameters.\r\n\r\n// We fast-resolve these to avoid confusion.\r\nconst NoResponseEvents = [\r\n\t'cpu.stepping',\r\n\t'cpu.resume',\r\n];\r\n\r\nconst ErrorLevels = {\r\n\tNOTICE: 1,\r\n\tERROR: 2,\r\n\tWARN: 3,\r\n\tINFO: 4,\r\n\tDEBUG: 5,\r\n\tVERBOSE: 6,\r\n};\r\n\r\nconst PPSSPP_MATCH_API = '//report.ppsspp.org/match/list';\r\nconst PPSSPP_SUB_PROTOCOL = 'debugger.ppsspp.org';\r\nconst PPSSPP_DEFAULT_PATH = '/debugger';\r\n\r\nexport default class PPSSPP {\r\n\tautoConnect() {\r\n\t\tif (this.socket_ !== null) {\r\n\t\t\treturn Promise.reject(new Error('Already connected, disconnect first'));\r\n\t\t}\r\n\r\n\t\tlet err = new Error('Couldn\\'t connect');\r\n\r\n\t\treturn fetch(PPSSPP_MATCH_API).then((response) => {\r\n\t\t\treturn response.json();\r\n\t\t}).then((listing) => {\r\n\t\t\treturn this.tryNextEndpoint_(listing);\r\n\t\t}).then(this.setupSocket_.bind(this), specificError => {\r\n\t\t\terr.message = specificError.message;\r\n\t\t\terr.originalError = specificError;\r\n\t\t\tthrow err;\r\n\t\t});\r\n\t}\r\n\r\n\tconnect(uri) {\r\n\t\tif (this.socket_ !== null) {\r\n\t\t\treturn Promise.reject(new Error('Already connected, disconnect first'));\r\n\t\t}\r\n\r\n\t\t// In case it fails, prepare the error (and stack trace) now.\r\n\t\tlet err = new Error('Couldn\\'t connect to ' + uri);\r\n\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst possibleSocket = new WebSocket(uri, PPSSPP_SUB_PROTOCOL);\r\n\r\n\t\t\tpossibleSocket.onopen = () => {\r\n\t\t\t\tthis.socket_ = possibleSocket;\r\n\t\t\t\tresolve();\r\n\t\t\t};\r\n\t\t\tpossibleSocket.onclose = () => {\r\n\t\t\t\treject(err);\r\n\t\t\t};\r\n\t\t}).then(this.setupSocket_.bind(this));\r\n\t}\r\n\r\n\tdisconnect() {\r\n\t\tif (this.socket_ === null) {\r\n\t\t\tthrow new Error('Not connected');\r\n\t\t}\r\n\r\n\t\tthis.failAllPending_('Disconnected from PPSSPP');\r\n\r\n\t\tthis.socket_.close(1000);\r\n\t\tthis.socket_ = null;\r\n\t}\r\n\r\n\tlisten(eventName, handler) {\r\n\t\tif (!(eventName in this.listeners_)) {\r\n\t\t\tthis.listeners_[eventName] = [];\r\n\t\t}\r\n\r\n\t\tthis.listeners_[eventName].push(handler);\r\n\r\n\t\treturn {\r\n\t\t\tremove: () => {\r\n\t\t\t\tconst list = this.listeners_[eventName];\r\n\t\t\t\tconst index = list.indexOf(handler);\r\n\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\tlist.splice(index, 1);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n\r\n\tsend(data) {\r\n\t\tif (this.socket_ === null) {\r\n\t\t\treturn Promise.reject(new Error('Not connected'));\r\n\t\t}\r\n\r\n\t\t// Prepare a stack trace now, not when resolving (since that will trace to the onmessage.)\r\n\t\tlet err = new Error('PPSSPP returned an error');\r\n\r\n\t\t// Avoid confusion by resolving immediately for known no-response events.\r\n\t\tif (NoResponseEvents.includes(data.event)) {\r\n\t\t\tthis.socket_.send(JSON.stringify(data));\r\n\t\t\treturn Promise.resolve(null);\r\n\t\t}\r\n\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst ticket = this.makeTicket_();\r\n\r\n\t\t\tthis.pendingTickets_[ticket] = function (result) {\r\n\t\t\t\tif (result.event === 'error') {\r\n\t\t\t\t\terr.name = 'DebuggerError';\r\n\t\t\t\t\terr.message = result.message;\r\n\t\t\t\t\terr.originalMessage = result;\r\n\t\t\t\t\treject(err);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresolve(result);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tthis.socket_.send(JSON.stringify({ ...data, ticket }));\r\n\t\t});\r\n\t}\r\n\r\n\tsetupSocket_() {\r\n\t\tthis.socket_.onclose = () => {\r\n\t\t\tif (this.onClose) {\r\n\t\t\t\tthis.onClose();\r\n\t\t\t}\r\n\r\n\t\t\tthis.failAllPending_('PPSSPP disconnected');\r\n\t\t\tthis.socket_ = null;\r\n\t\t};\r\n\r\n\t\tthis.socket_.onmessage = (e) => {\r\n\t\t\ttry {\r\n\t\t\t\tconst data = JSON.parse(e.data);\r\n\r\n\t\t\t\tif (data.event === 'error') {\r\n\t\t\t\t\tthis.handleError_(data.message, data.level);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet handled = false;\r\n\t\t\t\tif ('ticket' in data) {\r\n\t\t\t\t\thandled = this.handleTicket_(data.ticket, data);\r\n\t\t\t\t}\r\n\t\t\t\tthis.handleMessage_(data, handled);\r\n\t\t\t} catch (err) {\r\n\t\t\t\tthis.handleError_('Failed to parse message from PPSSPP: ' + err.message, ErrorLevels.ERROR);\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\ttryNextEndpoint_(listing) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tif (!listing || listing.length === 0) {\r\n\t\t\t\treturn reject(new Error('Couldn\\'t connect automatically.  Is PPSSPP connected to the same network?'));\r\n\t\t\t}\r\n\r\n\t\t\tconst endpoint = 'ws://' + listing[0].ip + ':' + listing[0].p + PPSSPP_DEFAULT_PATH;\r\n\t\t\treturn this.connect(endpoint).then(resolve, err => {\r\n\t\t\t\tif (listing.length > 1) {\r\n\t\t\t\t\tresolve(this.tryNextEndpoint_(listing.slice(1)));\r\n\t\t\t\t} else {\r\n\t\t\t\t\treject(err);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\thandleTicket_(ticket, data) {\r\n\t\tif (ticket in this.pendingTickets_) {\r\n\t\t\tconst handler = this.pendingTickets_[data.ticket];\r\n\t\t\tdelete this.pendingTickets_[data.ticket];\r\n\r\n\t\t\thandler(data);\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\tthis.handleError_('Received mismatched ticket: ' + JSON.stringify(data), ErrorLevels.ERROR);\r\n\t\treturn false;\r\n\t}\r\n\r\n\thandleMessage_(data, handled) {\r\n\t\thandled = this.executeHandlers_(data.event, data, handled);\r\n\t\tthis.executeHandlers_('*', data, handled);\r\n\t}\r\n\r\n\texecuteHandlers_(name, data, handled) {\r\n\t\tif (name in this.listeners_) {\r\n\t\t\tfor (let handler of this.listeners_[name]) {\r\n\t\t\t\tif (handler(data, handled)) {\r\n\t\t\t\t\thandled = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn handled;\r\n\t}\r\n\r\n\thandleError_(message, level) {\r\n\t\tif (this.onError) {\r\n\t\t\tthis.onError(message, level);\r\n\t\t} else if (level === undefined || Number(level) === ErrorLevels.ERROR) {\r\n\t\t\tconsole.error(message);\r\n\t\t} else {\r\n\t\t\tconsole.log(message);\r\n\t\t}\r\n\t}\r\n\r\n\tmakeTicket_() {\r\n\t\tlet ticket = Math.random().toString(36).substr(2);\r\n\t\tif (ticket in this.pendingTickets_) {\r\n\t\t\treturn this.makeTicket_();\r\n\t\t}\r\n\t\treturn ticket;\r\n\t}\r\n\r\n\tfailAllPending_(message) {\r\n\t\tconst data = { event: 'error', message, level: ErrorLevels.ERROR };\r\n\r\n\t\tfor (let ticket in this.pendingTickets_) {\r\n\t\t\tif (this.pendingTickets_.hasOwnProperty(ticket)) {\r\n\t\t\t\tthis.pendingTickets_[ticket](data);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.pendingTickets_ = {};\r\n\t}\r\n\r\n\tonError = null;\r\n\tonClose = null;\r\n\r\n\tsocket_ = null;\r\n\tpendingTickets_ = {};\r\n\tlisteners_ = {};\r\n}\r\n\r\nexport { ErrorLevels };\r\n","class Listeners {\r\n\tconstructor() {\r\n\t\tthis.changeCallbacks_ = [];\r\n\t\tthis.ppsspp_ = null;\r\n\t\tthis.connected_ = false;\r\n\t}\r\n\r\n\tinit(ppsspp) {\r\n\t\tthis.ppsspp_ = ppsspp;\r\n\t}\r\n\r\n\t// Change the active connection.\r\n\tchange(connected) {\r\n\t\tthis.connected_ = connected;\r\n\t\tfor (let callback of this.changeCallbacks_) {\r\n\t\t\tcallback(connected);\r\n\t\t}\r\n\t}\r\n\r\n\tonConnectionChange(callback) {\r\n\t\tthis.changeCallbacks_.push(callback);\r\n\t\treturn {\r\n\t\t\tremove: () => {\r\n\t\t\t\tconst index = this.changeCallbacks_.indexOf(callback);\r\n\t\t\t\tif (index !== -1) {\r\n\t\t\t\t\tthis.changeCallbacks_.splice(index, 1);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n\r\n\tonConnection(callback) {\r\n\t\tconst changeCallback = (connected) => {\r\n\t\t\tif (connected) {\r\n\t\t\t\tcallback(true);\r\n\t\t\t}\r\n\t\t};\r\n\t\tif (this.connected_) {\r\n\t\t\tcallback(true);\r\n\t\t}\r\n\r\n\t\treturn this.onConnectionChange(changeCallback);\r\n\t}\r\n\r\n\t// Listen for events (and re-register as necessary.)\r\n\tlisten(handlers) {\r\n\t\tlet result = [];\r\n\t\tfor (let name in handlers) {\r\n\t\t\tif (handlers.hasOwnProperty(name)) {\r\n\t\t\t\tlet listener;\r\n\t\t\t\tif (name === 'connection') {\r\n\t\t\t\t\tlistener = this.onConnection(handlers[name]);\r\n\t\t\t\t} else if (name === 'connection.change') {\r\n\t\t\t\t\tlistener = this.onConnectionChange(handlers[name]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlistener = this.ppsspp_.listen(name, handlers[name]);\r\n\t\t\t\t}\r\n\t\t\t\tresult.push(listener);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\tforget(listeners) {\r\n\t\tfor (let listener of listeners) {\r\n\t\t\tlistener.remove();\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst listeners = new Listeners();\r\nexport default listeners;\r\n","import listeners from '../utils/listeners.js';\r\n\r\n/**\r\n * @typedef GameStatusValues\r\n * @property {boolean} connected Whether a connection to PPSSPP is active.\r\n * @property {boolean} stepping Whether CPU is in stepping / break mode.\r\n * @property {boolean} paused Whether game emulation is paused.\r\n * @property {boolean} started Whether game emulation has been started yet.\r\n * @property {number} pc Integer PC value, or 0.\r\n * @property {number} currentThread Thread ID of active thread or undefined.\r\n * @property {Function} setState Method to update state.\r\n */\r\n\r\nclass GameStatus {\r\n\t/**\r\n\t * @type {GameStatusValues}\r\n\t */\r\n\tstate = {\r\n\t\tconnected: false,\r\n\t\tstepping: false,\r\n\t\tpaused: true,\r\n\t\tstarted: false,\r\n\t\tpc: 0,\r\n\t\tcurrentThread: undefined,\r\n\t\tsetState: undefined,\r\n\t};\r\n\tstateListeners = [];\r\n\tlisteners_;\r\n\tppsspp_;\r\n\r\n\tinit(ppsspp) {\r\n\t\tthis.state.setState = values => {\r\n\t\t\tthis.setState(values);\r\n\t\t};\r\n\r\n\t\tthis.ppsspp_ = ppsspp;\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'connection': () => this.onConnection(),\r\n\t\t\t'connection.change': (connected) => this.onConnectionChange(connected),\r\n\t\t\t'cpu.stepping': (data) => this.onStepping(data),\r\n\t\t\t'cpu.resume': () => this.setState({ stepping: false }),\r\n\t\t\t'game.start': () => {\r\n\t\t\t\tthis.setState({ started: true, paused: false });\r\n\t\t\t},\r\n\t\t\t'game.quit': () => {\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\tstarted: false,\r\n\t\t\t\t\tstepping: false,\r\n\t\t\t\t\tpaused: true,\r\n\t\t\t\t\tpc: 0,\r\n\t\t\t\t\tcurrentThread: undefined,\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t'game.pause': () => this.setState({ paused: true }),\r\n\t\t\t'game.resume': () => this.setState({ paused: false }),\r\n\t\t\t'cpu.setReg': (result) => {\r\n\t\t\t\tif (result.category === 0 && result.register === 32) {\r\n\t\t\t\t\tthis.setState({ pc: result.uintValue });\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'cpu.getAllRegs': (result) => {\r\n\t\t\t\tconst pc = result.categories[0].uintValues[32];\r\n\t\t\t\tthis.setState({ pc });\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\tshutdown() {\r\n\t\tlisteners.forget(this.listeners_);\r\n\t\tthis.listeners_ = null;\r\n\t}\r\n\r\n\tonConnectionChange(connected) {\r\n\t\t// On any reconnect, assume paused until proven otherwise.\r\n\t\tthis.setState({ connected, started: false, stepping: false, paused: true });\r\n\t\tif (!connected) {\r\n\t\t\tthis.setState({ currentThread: undefined });\r\n\t\t}\r\n\t}\r\n\r\n\tonConnection() {\r\n\t\t// Update the status of this connection immediately too.\r\n\t\tthis.ppsspp_.send({ event: 'cpu.status' }).then((result) => {\r\n\t\t\tconst { stepping, paused, pc } = result;\r\n\t\t\tconst started = pc !== 0 || stepping;\r\n\r\n\t\t\tthis.setState({ connected: true, started, stepping, paused, pc });\r\n\t\t}, (err) => {\r\n\t\t\tthis.setState({ stepping: false, paused: true });\r\n\t\t});\r\n\t}\r\n\r\n\tonStepping(data) {\r\n\t\tthis.setState({\r\n\t\t\tstepping: true,\r\n\t\t\tpc: data.pc,\r\n\t\t});\r\n\t}\r\n\r\n\tlistenState(callback) {\r\n\t\tthis.stateListeners.push(callback);\r\n\t}\r\n\r\n\tsetState(values) {\r\n\t\tlet changed = false;\r\n\t\tfor (let k in values) {\r\n\t\t\tif (values[k] !== this.state[k]) {\r\n\t\t\t\tchanged = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (changed) {\r\n\t\t\tthis.state = { ...this.state, ...values };\r\n\t\t\tfor (let callback of this.stateListeners) {\r\n\t\t\t\tcallback(this.state);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport default GameStatus;\r\n","import { createContext, useContext } from 'react';\r\nimport PPSSPP from '../sdk/ppsspp.js';\r\nimport { GameStatusValues } from '../utils/game.js';\r\n\r\n/**\r\n * @callback LogCallback\r\n * @param {string} message Message to log.\r\n */\r\n\r\n/**\r\n * @typedef {object} DebuggerContextValues\r\n * @property {PPSSPP|null} ppsspp PPSSPP SDK instance.\r\n * @property {GameStatusValues|null} gameStatus Basic thread/stepping information.\r\n * @property {LogCallback} log Function to display a log message.\r\n */\r\n\r\n/**\r\n * @type {DebuggerContextValues}\r\n */\r\nconst defaultContext = {\r\n\tppsspp: null,\r\n\tgameStatus: null,\r\n\tlog: (message) => console.error(message),\r\n};\r\n\r\nconst DebuggerContext = createContext(defaultContext);\r\nDebuggerContext.displayName = 'DebuggerContext';\r\nexport default DebuggerContext;\r\n\r\nexport function useDebuggerContext() {\r\n\treturn useContext(DebuggerContext);\r\n}\r\n\r\nexport function DebuggerProvider({ children, gameStatus, log, ppsspp }) {\r\n\treturn (\r\n\t\t<DebuggerContext.Provider value={{ gameStatus, log, ppsspp }}>\r\n\t\t\t{children}\r\n\t\t</DebuggerContext.Provider>\r\n\t);\r\n}\r\n","function isSubsetBounds(bounds, parentBounds) {\r\n\tif (bounds.top < parentBounds.top || bounds.left < parentBounds.left) {\r\n\t\treturn false;\r\n\t}\r\n\tif (bounds.bottom > parentBounds.bottom || bounds.right > parentBounds.right) {\r\n\t\treturn false;\r\n\t}\r\n\treturn true;\r\n}\r\n\r\nexport function isInView(node) {\r\n\tconst windowBounds = { top: 0, left: 0, bottom: window.innerHeight, right: window.innerWidth };\r\n\tconst rect = node.getBoundingClientRect();\r\n\tif (!isSubsetBounds(rect, windowBounds)) {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tlet parentNode = node;\r\n\twhile ((parentNode = parentNode.parentNode) !== null) {\r\n\t\tif (parentNode instanceof HTMLElement) {\r\n\t\t\tconst style = window.getComputedStyle(parentNode);\r\n\t\t\tconst overflows = style.overflow + style.overflowX + style.overflowY;\r\n\t\t\tif (style.position === 'static' && overflows.indexOf('auto') === -1 && overflows.indexOf('scroll') === -1) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tif (!isSubsetBounds(rect, parentNode.getBoundingClientRect())) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn true;\r\n}\r\n\r\nexport function ensureInView(node, options) {\r\n\tif (!isInView(node)) {\r\n\t\tnode.scrollIntoView(options);\r\n\t\treturn true;\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\nlet contextMenuStatus = false;\r\n\r\nwindow.addEventListener('REACT_CONTEXTMENU_SHOW', (ev) => {\r\n\tcontextMenuStatus = true;\r\n});\r\nwindow.addEventListener('REACT_CONTEXTMENU_HIDE', (ev) => {\r\n\tcontextMenuStatus = false;\r\n});\r\n\r\nexport function hasContextMenu() {\r\n\treturn contextMenuStatus;\r\n}\r\n","import { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Modal from 'react-modal';\r\nimport '../ext/react-modal.css';\r\n\r\nclass FitModal extends PureComponent {\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<Modal\r\n\t\t\t\tclassName=\"ReactModal__FitContent\" overlayClassName=\"ReactModal__FitOverlay\"\r\n\t\t\t\tonRequestClose={this.handleRequestClose}\r\n\t\t\t\tcloseTimeoutMS={150}\r\n\t\t\t\t{...this.props}\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n\r\n\thandleRequestClose = () => {\r\n\t\tif (this.props.confirmClose) {\r\n\t\t\tif (!window.confirm(this.props.confirmClose)) {\r\n\t\t\t\t// Don't close.\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.props.onClose();\r\n\t}\r\n}\r\n\r\nFitModal.propTypes = {\r\n\tisOpen: PropTypes.bool.isRequired,\r\n\tonClose: PropTypes.func.isRequired,\r\n\tconfirmClose: PropTypes.string,\r\n\tchildren: PropTypes.node,\r\n};\r\n\r\nexport default FitModal;\r\n","import { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nclass Field extends Component {\r\n\trender() {\r\n\t\tconst { label, children } = this.props;\r\n\t\treturn (\r\n\t\t\t<div className=\"Field\">\r\n\t\t\t\t<label className=\"Field__label\" htmlFor={this.fieldID()}>{label}</label>\r\n\t\t\t\t{this.renderInput()}\r\n\t\t\t\t{children}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderInput() {\r\n\t\tif (this.props.type === 'text') {\r\n\t\t\treturn this.renderText();\r\n\t\t} else if (this.props.type === 'hex') {\r\n\t\t\treturn this.renderHex();\r\n\t\t} else if (this.props.type === 'radio') {\r\n\t\t\treturn this.renderRadio();\r\n\t\t} else if (this.props.type === 'checkboxes') {\r\n\t\t\treturn this.renderCheckboxes();\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\trenderText(other = {}) {\r\n\t\tlet { label, type, children, onChange, component, prop, ...primary } = this.props;\r\n\t\tprimary.value = this.fieldValue();\r\n\t\treturn <input type=\"text\" id={this.fieldID()} onChange={this.handleChange} {...primary} {...other} />;\r\n\t}\r\n\r\n\trenderHex() {\r\n\t\treturn this.renderText({ pattern: '(0x)?[0-9A-Fa-f]+', title: 'Hexadecimal value' });\r\n\t}\r\n\r\n\trenderRadio() {\r\n\t\tconst value = this.fieldValue();\r\n\t\treturn this.props.options.map(option => {\r\n\t\t\tconst props = {\r\n\t\t\t\tname: this.fieldID(),\r\n\t\t\t\tvalue: option.value,\r\n\t\t\t\tchecked: value === option.value,\r\n\t\t\t\tonChange: this.handleChange,\r\n\t\t\t\tdisabled: this.props.disabled,\r\n\t\t\t};\r\n\t\t\treturn (\r\n\t\t\t\t<label key={option.value}>\r\n\t\t\t\t\t<input type=\"radio\" {...props} />\r\n\t\t\t\t\t{' ' + option.label}\r\n\t\t\t\t</label>\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\trenderCheckboxes() {\r\n\t\treturn this.props.options.map(option => {\r\n\t\t\tconst props = {\r\n\t\t\t\t'data-prop': option.value,\r\n\t\t\t\tchecked: this.props.component.state[option.value],\r\n\t\t\t\tonChange: this.handleChange,\r\n\t\t\t\tdisabled: this.props.disabled,\r\n\t\t\t};\r\n\t\t\treturn (\r\n\t\t\t\t<label key={option.value}>\r\n\t\t\t\t\t<input type=\"checkbox\" {...props} />\r\n\t\t\t\t\t{' ' + option.label}\r\n\t\t\t\t</label>\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\tfieldID() {\r\n\t\tconst { id, component, prop } = this.props;\r\n\t\tif (!id && component && prop) {\r\n\t\t\treturn (component.displayName || component.constructor.name) + '__' + prop;\r\n\t\t}\r\n\t\treturn id;\r\n\t}\r\n\r\n\tfieldValue() {\r\n\t\tconst { value, component, prop } = this.props;\r\n\t\tif (value === undefined && component && prop) {\r\n\t\t\treturn component.state[prop];\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\thandleChange = (ev) => {\r\n\t\tif (this.props.onChange) {\r\n\t\t\tthis.props.onChange(ev);\r\n\t\t} else if (this.props.component) {\r\n\t\t\tconst { target } = ev;\r\n\t\t\tconst prop = target.dataset.prop || this.props.prop;\r\n\t\t\tconst value = target.type === 'checkbox' ? target.checked : target.value;\r\n\t\t\tthis.props.component.setState({ [prop]: value });\r\n\t\t}\r\n\t}\r\n}\r\n\r\nField.propTypes = {\r\n\tid: PropTypes.string,\r\n\tlabel: PropTypes.node.isRequired,\r\n\ttype: PropTypes.oneOf(['text', 'hex', 'radio', 'checkboxes']),\r\n\tcomponent: PropTypes.object,\r\n\tvalue: PropTypes.string,\r\n\tprop: PropTypes.string,\r\n\toptions: PropTypes.arrayOf(PropTypes.shape({\r\n\t\tlabel: PropTypes.string.isRequired,\r\n\t\tvalue: PropTypes.string.isRequired,\r\n\t})),\r\n\tdisabled: PropTypes.bool,\r\n\tonChange: PropTypes.func,\r\n\tchildren: PropTypes.node,\r\n};\r\n\r\nexport default Field;\r\n","import PropTypes from 'prop-types';\r\nimport classNames from 'clsx';\r\nimport './Form.css';\r\n\r\nfunction Form(props) {\r\n\t/* eslint no-script-url: \"off\" */\r\n\treturn (\r\n\t\t<form action=\"#\" className={classNames(props.className, 'Form')} onSubmit={props.onSubmit}>\r\n\t\t\t{props.heading ? <h2 className=\"Form__heading\">{props.heading}</h2> : null}\r\n\t\t\t{props.children}\r\n\t\t</form>\r\n\t);\r\n}\r\n\r\nForm.propTypes = {\r\n\tonSubmit: PropTypes.func.isRequired,\r\n\tclassName: PropTypes.string,\r\n\tchildren: PropTypes.node.isRequired,\r\n};\r\n\r\nForm.Buttons = function (props) {\r\n\tconst saveHandler = props.onSave !== true ? props.onSave : undefined;\r\n\tconst saveButton = props.onSave ? <button type=\"submit\" onClick={saveHandler}>Save</button> : null;\r\n\tconst cancelButton = props.onCancel ? <button type=\"button\" onClick={props.onCancel}>Cancel</button> : null;\r\n\r\n\treturn (\r\n\t\t<div className=\"Form__buttons\">\r\n\t\t\t{props.children}\r\n\t\t\t{saveButton}\r\n\t\t\t{cancelButton}\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nForm.Buttons.propTypes = {\r\n\tonSave: PropTypes.oneOfType([PropTypes.func, PropTypes.bool]),\r\n\tonCancel: PropTypes.func,\r\n\tchildren: PropTypes.node,\r\n};\r\n\r\nexport default Form;\r\n","export class Timeout {\r\n\thandle;\r\n\tfunc;\r\n\tms;\r\n\r\n\tconstructor(func, ms) {\r\n\t\tthis.func = func;\r\n\t\tthis.ms = ms;\r\n\t}\r\n\r\n\tstart() {\r\n\t\tthis.cancel();\r\n\t\tthis.handle = setTimeout(() => {\r\n\t\t\tthis.handle = null;\r\n\t\t\tthis.func();\r\n\t\t}, this.ms);\r\n\t}\r\n\r\n\treset(func) {\r\n\t\tthis.func = func;\r\n\t}\r\n\r\n\trunEarly() {\r\n\t\tif (this.handle) {\r\n\t\t\tthis.cancel();\r\n\t\t\tthis.func();\r\n\t\t}\r\n\t}\r\n\r\n\tcancel() {\r\n\t\tif (this.handle !== null) {\r\n\t\t\tclearTimeout(this.handle);\r\n\t\t\tthis.handle = null;\r\n\t\t}\r\n\t}\r\n}\r\n","export function toString08X(val) {\r\n\tconst hex = val.toString(16).toUpperCase();\r\n\treturn ('00000000' + hex).substr(-8);\r\n}\r\n\r\nexport function toString04X(val) {\r\n\tconst hex = val.toString(16).toUpperCase();\r\n\treturn ('0000' + hex).substr(-4);\r\n}\r\n\r\nexport function toString02X(val) {\r\n\tconst hex = val.toString(16).toUpperCase();\r\n\treturn ('00' + hex).substr(-2);\r\n}\r\n","import { PureComponent } from 'react';\r\nimport DebuggerContext, { DebuggerContextValues } from '../DebuggerContext';\r\nimport PropTypes from 'prop-types';\r\nimport FitModal from '../common/FitModal';\r\nimport Field from '../common/Field';\r\nimport Form from '../common/Form';\r\nimport { Timeout } from '../../utils/timeouts';\r\nimport { toString08X } from '../../utils/format';\r\nimport '../ext/react-modal.css';\r\nimport './BreakpointModal.css';\r\n\r\nconst typeOptions = [\r\n\t{ label: 'Memory', value: 'memory' },\r\n\t{ label: 'Execute', value: 'execute' },\r\n];\r\n\r\nconst operationOptions = [\r\n\t{ label: 'Read', value: 'read' },\r\n\t{ label: 'Write', value: 'write' },\r\n\t{ label: 'On change', value: 'change' },\r\n];\r\n\r\nconst actionOptions = [\r\n\t{ label: 'Break', value: 'enabled' },\r\n\t{ label: 'Log', value: 'log' },\r\n];\r\n\r\nclass BreakpointModal extends PureComponent {\r\n\tstate = {};\r\n\t/**\r\n\t * @type {DebuggerContextValues}\r\n\t */\r\n\tcontext;\r\n\tcleanState = {\r\n\t\tisOpen: false,\r\n\t\tderivedBreakpoint: null,\r\n\t};\r\n\tcleanBreakpoint = {\r\n\t\ttype: 'memory',\r\n\t\taddress: '',\r\n\t\tsize: '0x00000001',\r\n\t\tcondition: '',\r\n\t\tlogFormat: '',\r\n\t\tread: true,\r\n\t\twrite: true,\r\n\t\tchange: false,\r\n\t\tenabled: true,\r\n\t\tlog: true,\r\n\t};\r\n\tcleanTimeout;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tObject.assign(this.state, { ...this.cleanState, ...this.cleanBreakpoint, ...props.breakpoint, ...props.initialOverrides });\r\n\r\n\t\tthis.cleanTimeout = new Timeout(() => {\r\n\t\t\tthis.setState({ ...this.cleanState, ...this.cleanBreakpoint, ...this.props.breakpoint, ...this.props.initialOverrides });\r\n\t\t}, 200);\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst editing = !!this.props.breakpoint;\r\n\r\n\t\treturn (\r\n\t\t\t<FitModal\r\n\t\t\t\tcontentLabel=\"Breakpoint settings\"\r\n\t\t\t\tisOpen={this.props.isOpen}\r\n\t\t\t\tonClose={this.onClose}\r\n\t\t\t\tconfirmClose={this.hasChanges() ? 'Discard changes?' : null}\r\n\t\t\t>\r\n\t\t\t\t<Form heading={editing ? 'Edit Breakpoint' : 'Create Breakpoint'} onSubmit={this.onSave} className=\"BreakpointModal\">\r\n\t\t\t\t\t<Field type=\"radio\" label=\"Type\" options={typeOptions} prop=\"type\" component={this} />\r\n\t\t\t\t\t<Field type=\"text\" label=\"Address\" prop=\"address\" component={this} />\r\n\t\t\t\t\t{this.renderMemory()}\r\n\t\t\t\t\t{this.renderExecute()}\r\n\t\t\t\t\t<Field type=\"text\" label=\"Log format\" prop=\"logFormat\" component={this} disabled={!this.state.log} />\r\n\t\t\t\t\t<Field type=\"checkboxes\" label=\"Actions\" options={actionOptions} component={this} />\r\n\r\n\t\t\t\t\t<Form.Buttons onSave={true} onCancel={this.onClose} />\r\n\t\t\t\t</Form>\r\n\t\t\t</FitModal>\r\n\t\t);\r\n\t}\r\n\r\n\trenderMemory() {\r\n\t\tif (this.state.type !== 'memory') {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn (\r\n\t\t\t<>\r\n\t\t\t\t<Field type=\"hex\" label=\"Size\" prop=\"size\" component={this} />\r\n\t\t\t\t<Field type=\"checkboxes\" label=\"Operations\" options={operationOptions} component={this} />\r\n\t\t\t</>\r\n\t\t);\r\n\t}\r\n\r\n\trenderExecute() {\r\n\t\tif (this.state.type !== 'execute') {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn (\r\n\t\t\t<Field type=\"text\" label=\"Condition\" prop=\"condition\" component={this} />\r\n\t\t);\r\n\t}\r\n\r\n\thasChanges() {\r\n\t\tconst compareTo = this.state.derivedBreakpoint || this.cleanBreakpoint;\r\n\t\treturn Object.keys(compareTo).find(key => this.state[key] !== compareTo[key]) !== undefined;\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (this.props.isOpen && this.cleanTimeout != null) {\r\n\t\t\tthis.cleanTimeout.runEarly();\r\n\t\t}\r\n\t}\r\n\r\n\tonSave = (e) => {\r\n\t\tlet operation = this.context.ppsspp.send({\r\n\t\t\tevent: 'cpu.evaluate',\r\n\t\t\tthread: this.context.gameStatus.currentThread,\r\n\t\t\texpression: this.state.address,\r\n\t\t});\r\n\r\n\t\tif (this.props.breakpoint) {\r\n\t\t\tconst { derivedBreakpoint, address, size, type } = this.state;\r\n\t\t\tif (type !== derivedBreakpoint.type || derivedBreakpoint.address !== address) {\r\n\t\t\t\toperation = operation.then(this.deleteOld).then(this.saveNew);\r\n\t\t\t} else if (type === 'memory' && derivedBreakpoint.size !== size) {\r\n\t\t\t\toperation = operation.then(this.deleteOld).then(this.saveNew);\r\n\t\t\t} else {\r\n\t\t\t\toperation = operation.then(this.updateExisting);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\toperation = operation.then(this.saveNew);\r\n\t\t}\r\n\r\n\t\toperation.then(this.onClose, err => {\r\n\t\t\twindow.alert(err.message);\r\n\t\t});\r\n\r\n\t\te.preventDefault();\r\n\t}\r\n\r\n\tsaveNew = ({ uintValue }) => {\r\n\t\treturn this.context.ppsspp.send({\r\n\t\t\tevent: this.getEvent(this.state.type, 'add'),\r\n\t\t\t...this.state,\r\n\t\t\taddress: uintValue,\r\n\t\t});\r\n\t}\r\n\r\n\tdeleteOld = ({ uintValue }) => {\r\n\t\t// This is used when changing the breakpoint type.\r\n\t\treturn this.context.ppsspp.send({\r\n\t\t\tevent: this.getEvent(this.props.breakpoint.type, 'remove'),\r\n\t\t\taddress: this.props.breakpoint.address,\r\n\t\t\tsize: this.props.breakpoint.size,\r\n\t\t}).then(() => {\r\n\t\t\t// Return the original new address for easy sequencing.\r\n\t\t\treturn { uintValue };\r\n\t\t});\r\n\t}\r\n\r\n\tupdateExisting = ({ uintValue }) => {\r\n\t\treturn this.context.ppsspp.send({\r\n\t\t\tevent: this.getEvent(this.state.type, 'update'),\r\n\t\t\t...this.state,\r\n\t\t\taddress: uintValue,\r\n\t\t});\r\n\t}\r\n\r\n\tgetEvent(type, event) {\r\n\t\tif (type === 'execute') {\r\n\t\t\treturn 'cpu.breakpoint.' + event;\r\n\t\t} else if (type === 'memory') {\r\n\t\t\treturn 'memory.breakpoint.' + event;\r\n\t\t} else {\r\n\t\t\tthrow new Error('Unexpected type: ' + type);\r\n\t\t}\r\n\t}\r\n\r\n\tonClose = () => {\r\n\t\tthis.cleanTimeout.start();\r\n\t\tthis.props.onClose();\r\n\t}\r\n\r\n\tstatic getDerivedStateFromProps(nextProps, prevState) {\r\n\t\tif (nextProps.isOpen && !prevState.isOpen) {\r\n\t\t\tconst derivedBreakpoint = nextProps.breakpoint;\r\n\t\t\tif (derivedBreakpoint) {\r\n\t\t\t\t// This is the \"derived\" unchanged state for the \"Discard changes?\" prompt, and initial state.\r\n\t\t\t\tderivedBreakpoint.address = '0x' + toString08X(derivedBreakpoint.address);\r\n\t\t\t\tif (derivedBreakpoint.size) {\r\n\t\t\t\t\tderivedBreakpoint.size = '0x' + toString08X(derivedBreakpoint.size);\r\n\t\t\t\t}\r\n\t\t\t\tderivedBreakpoint.condition = derivedBreakpoint.condition || '';\r\n\t\t\t\tderivedBreakpoint.logFormat = derivedBreakpoint.logFormat || '';\r\n\t\t\t}\r\n\t\t\tconst initialOverrides = nextProps.initialOverrides;\r\n\t\t\tif (initialOverrides) {\r\n\t\t\t\tinitialOverrides.address = '0x' + toString08X(initialOverrides.address);\r\n\t\t\t\tif (initialOverrides.size) {\r\n\t\t\t\t\tinitialOverrides.size = '0x' + toString08X(initialOverrides.size);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn { isOpen: true, ...derivedBreakpoint, derivedBreakpoint, ...initialOverrides };\r\n\t\t}\r\n\t\tif (!nextProps.isOpen && prevState.derivedBreakpoint) {\r\n\t\t\treturn { derivedBreakpoint: null };\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\nBreakpointModal.propTypes = {\r\n\tisOpen: PropTypes.bool.isRequired,\r\n\tbreakpoint: PropTypes.shape({\r\n\t\ttype: PropTypes.oneOf(['execute', 'memory']),\r\n\t\taddress: PropTypes.number.isRequired,\r\n\t}),\r\n\tinitialOverrides: PropTypes.shape({\r\n\t\ttype: PropTypes.oneOf(['execute', 'memory']),\r\n\t\taddress: PropTypes.number.isRequired,\r\n\t}),\r\n\r\n\tonClose: PropTypes.func.isRequired,\r\n};\r\n\r\nBreakpointModal.contextType = DebuggerContext;\r\n\r\nexport default BreakpointModal;\r\n","import { connectMenu, ContextMenu, MenuItem } from 'react-contextmenu';\r\nimport PropTypes from 'prop-types';\r\n\r\nfunction BreakpointPanelContextMenu(props) {\r\n\tconst { id, trigger } = props;\r\n\r\n\treturn (\r\n\t\t<ContextMenu id={id}>\r\n\t\t\t{trigger?.breakpoint ? (<>\r\n\t\t\t\t<MenuItem onClick={() => props.toggleBreakpoint(trigger.breakpoint)}>\r\n\t\t\t\t\tToggle Break\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem onClick={() => props.editBreakpoint(trigger.breakpoint)}>\r\n\t\t\t\t\tEdit&hellip;\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem onClick={() => props.removeBreakpoint(trigger.breakpoint)}>\r\n\t\t\t\t\tRemove\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem divider />\r\n\t\t\t</>) : null}\r\n\t\t\t<MenuItem onClick={() => props.createBreakpoint()}>\r\n\t\t\t\tAdd New&hellip;\r\n\t\t\t</MenuItem>\r\n\t\t</ContextMenu>\r\n\t);\r\n}\r\n\r\nBreakpointPanelContextMenu.propTypes = {\r\n\tid: PropTypes.string.isRequired,\r\n\ttrigger: PropTypes.shape({\r\n\t\tbreakpoint: PropTypes.object,\r\n\t}),\r\n\r\n\ttoggleBreakpoint: PropTypes.func.isRequired,\r\n\teditBreakpoint: PropTypes.func.isRequired,\r\n\tremoveBreakpoint: PropTypes.func.isRequired,\r\n\tcreateBreakpoint: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default connectMenu('breakpointPanel')(BreakpointPanelContextMenu);\r\n","import { ContextMenuTrigger } from 'react-contextmenu';\r\nimport PropTypes from 'prop-types';\r\nimport { useDebuggerContext } from '../DebuggerContext';\r\nimport { toString08X } from '../../utils/format';\r\nimport './BreakpointPanelItem.css';\r\n\r\nexport default function BreakpointPanelItem(props) {\r\n\tconst context = useDebuggerContext();\r\n\r\n\tconst { breakpoint, selected } = props;\r\n\r\n\tconst mapData = (props) => {\r\n\t\treturn { breakpoint: breakpoint };\r\n\t};\r\n\tconst attributes = {\r\n\t\tonDoubleClick: () => {\r\n\t\t\tprops.gotoBreakpoint(breakpoint);\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\tonMouseDown: () => {\r\n\t\t\tprops.onSelect();\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\tclassName: selected ? 'BreakpointPanelItem--selected' : null,\r\n\t};\r\n\r\n\tconst breakCheckbox = (\r\n\t\t<td className=\"BreakpointPanelItem__break-check-cell\">\r\n\t\t\t<input type=\"checkbox\" checked={breakpoint.enabled} className=\"BreakpointPanelItem__break-check\" onChange={() => props.toggleBreakpoint(breakpoint)} />\r\n\t\t</td>\r\n\t);\r\n\r\n\tif (breakpoint.type === 'execute') {\r\n\t\treturn (\r\n\t\t\t<ContextMenuTrigger id=\"breakpointPanel\" renderTag=\"tr\" holdToDisplay={-1} attributes={attributes} collect={mapData}>\r\n\t\t\t\t{breakCheckbox}\r\n\t\t\t\t<td>Execute</td>\r\n\t\t\t\t<td>0x{toString08X(breakpoint.address)}</td>\r\n\t\t\t\t<td>{breakpoint.symbol || '-'}</td>\r\n\t\t\t\t<td>{breakpoint.code || '-'}</td>\r\n\t\t\t\t<td>{breakpoint.condition || '-'}</td>\r\n\t\t\t\t<td>-</td>\r\n\t\t\t</ContextMenuTrigger>\r\n\t\t);\r\n\t} else if (breakpoint.type === 'memory') {\r\n\t\treturn (\r\n\t\t\t<ContextMenuTrigger id=\"breakpointPanel\" renderTag=\"tr\" holdToDisplay={-1} attributes={attributes} collect={mapData}>\r\n\t\t\t\t{breakCheckbox}\r\n\t\t\t\t<td>{mapMemoryBreakpointType(breakpoint)}</td>\r\n\t\t\t\t<td>0x{toString08X(breakpoint.address)}</td>\r\n\t\t\t\t<td>0x{toString08X(breakpoint.size)}</td>\r\n\t\t\t\t<td>{breakpoint.code || '-'}</td>\r\n\t\t\t\t<td>{breakpoint.condition || '-'}</td>\r\n\t\t\t\t<td>{breakpoint.hits}</td>\r\n\t\t\t</ContextMenuTrigger>\r\n\t\t);\r\n\t} else {\r\n\t\tcontext.log('Unhandled breakpoint type: ' + breakpoint.type);\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\nfunction mapMemoryBreakpointType(breakpoint) {\r\n\tconst { write, read, change } = breakpoint;\r\n\r\n\tif ((!read && !write) || (!write && read && change)) {\r\n\t\treturn 'Invalid';\r\n\t}\r\n\r\n\tlet type;\r\n\tif (read && write) {\r\n\t\ttype = 'Read/Write';\r\n\t} else if (read) {\r\n\t\ttype = 'Read';\r\n\t} else if (write) {\r\n\t\ttype = 'Write';\r\n\t}\r\n\r\n\tif (change) {\r\n\t\treturn type + ' Change';\r\n\t} else {\r\n\t\treturn type;\r\n\t}\r\n}\r\n\r\nBreakpointPanelItem.propTypes = {\r\n\tbreakpoint: PropTypes.object.isRequired,\r\n\tselected: PropTypes.bool.isRequired,\r\n\tgotoBreakpoint: PropTypes.func.isRequired,\r\n\r\n\ttoggleBreakpoint: PropTypes.func.isRequired,\r\n\tonSelect: PropTypes.func.isRequired,\r\n};\r\n","import { useState } from 'react';\r\nimport { ContextMenuTrigger } from 'react-contextmenu';\r\nimport PropTypes from 'prop-types';\r\nimport { useDebuggerContext } from '../DebuggerContext';\r\nimport { hasContextMenu } from '../../utils/dom';\r\nimport BreakpointModal from './BreakpointModal';\r\nimport BreakpointPanelContextMenu from './BreakpointPanelContextMenu';\r\nimport BreakpointPanelItem from './BreakpointPanelItem';\r\nimport './BreakpointPanelList.css';\r\n\r\nexport default function BreakpointPanelList(props) {\r\n\tconst context = useDebuggerContext();\r\n\r\n\tconst { breakpoints, selectedRow, setSelectedRow, gotoDisasm } = props;\r\n\r\n\tconst [editingBreakpoint, setEditingBreakpoint] = useState(null);\r\n\tconst [creatingBreakpoint, setCreatingBreakpoint] = useState(false);\r\n\r\n\tconst handleToggleBreakpoint = (breakpoint) => {\r\n\t\tif (breakpoint.type === 'execute') {\r\n\t\t\tcontext.ppsspp.send({\r\n\t\t\t\tevent: 'cpu.breakpoint.update',\r\n\t\t\t\taddress: breakpoint.address,\r\n\t\t\t\tenabled: !breakpoint.enabled,\r\n\t\t\t});\r\n\t\t} else if (breakpoint.type === 'memory') {\r\n\t\t\tcontext.ppsspp.send({\r\n\t\t\t\tevent: 'memory.breakpoint.update',\r\n\t\t\t\taddress: breakpoint.address,\r\n\t\t\t\tsize: breakpoint.size,\r\n\t\t\t\tenabled: !breakpoint.enabled,\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tconst handleRemoveBreakpoint = (breakpoint) => {\r\n\t\tif (breakpoint.type === 'execute') {\r\n\t\t\tcontext.ppsspp.send({\r\n\t\t\t\tevent: 'cpu.breakpoint.remove',\r\n\t\t\t\taddress: breakpoint.address,\r\n\t\t\t});\r\n\t\t} else if (breakpoint.type === 'memory') {\r\n\t\t\tcontext.ppsspp.send({\r\n\t\t\t\tevent: 'memory.breakpoint.remove',\r\n\t\t\t\taddress: breakpoint.address,\r\n\t\t\t\tsize: breakpoint.size,\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tconst handleGotoBreakpoint = (breakpoint) => {\r\n\t\tif (breakpoint.type === 'execute') {\r\n\t\t\tgotoDisasm(breakpoint.address);\r\n\t\t} else if (breakpoint.type === 'memory') {\r\n\t\t\t// TODO: Go to address in memory view (whenever it's implemented)\r\n\t\t}\r\n\t};\r\n\r\n\tconst handleCloseBreakpointModal = () => {\r\n\t\tsetEditingBreakpoint(null);\r\n\t\tsetCreatingBreakpoint(false);\r\n\t};\r\n\r\n\tconst onKeyDown = (ev) => {\r\n\t\tif (hasContextMenu()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (ev.key === 'ArrowUp' && selectedRow > 0) {\r\n\t\t\tsetSelectedRow(selectedRow - 1);\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t\tif (ev.key === 'ArrowDown' && selectedRow < breakpoints.length - 1) {\r\n\t\t\tsetSelectedRow(selectedRow + 1);\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tconst selectedBreakpoint = breakpoints[selectedRow];\r\n\t\tif (!selectedBreakpoint) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (ev.key === 'ArrowRight') {\r\n\t\t\thandleGotoBreakpoint(selectedBreakpoint);\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t\tif (ev.key === ' ') {\r\n\t\t\thandleToggleBreakpoint(selectedBreakpoint);\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t\tif (ev.key === 'Enter') {\r\n\t\t\tsetEditingBreakpoint(selectedBreakpoint);\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t\tif (ev.key === 'Delete') {\r\n\t\t\thandleRemoveBreakpoint(selectedBreakpoint);\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t};\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<ContextMenuTrigger id=\"breakpointPanel\" renderTag=\"div\" holdToDisplay={-1} attributes={{ id: 'BreakpointPanelList' }}>\r\n\t\t\t\t<table className=\"BreakpointPanelList__table\" onKeyDown={onKeyDown} tabIndex={0}>\r\n\t\t\t\t\t<thead>\r\n\t\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t\t<th>Break</th>\r\n\t\t\t\t\t\t\t<th>Type</th>\r\n\t\t\t\t\t\t\t<th>Offset</th>\r\n\t\t\t\t\t\t\t<th>Size/Label</th>\r\n\t\t\t\t\t\t\t<th>Opcode</th>\r\n\t\t\t\t\t\t\t<th>Condition</th>\r\n\t\t\t\t\t\t\t<th>Hits</th>\r\n\t\t\t\t\t\t</tr>\r\n\t\t\t\t\t</thead>\r\n\t\t\t\t\t<colgroup>\r\n\t\t\t\t\t\t<col className=\"BreakpointPanelList__table-column-break\" />\r\n\t\t\t\t\t\t<col className=\"BreakpointPanelList__table-column\" />\r\n\t\t\t\t\t\t<col className=\"BreakpointPanelList__table-column\" />\r\n\t\t\t\t\t\t<col className=\"BreakpointPanelList__table-column\" />\r\n\t\t\t\t\t\t<col className=\"BreakpointPanelList__table-column\" />\r\n\t\t\t\t\t\t<col className=\"BreakpointPanelList__table-column\" />\r\n\t\t\t\t\t\t<col className=\"BreakpointPanelList__table-column-hits\" />\r\n\t\t\t\t\t</colgroup>\r\n\t\t\t\t\t<tbody>\r\n\t\t\t\t\t\t{breakpoints.map((breakpoint, index) =>\r\n\t\t\t\t\t\t\t<BreakpointPanelItem\r\n\t\t\t\t\t\t\t\tkey={`${breakpoint.address}-${breakpoint.size || 0}`}\r\n\t\t\t\t\t\t\t\tbreakpoint={breakpoint}\r\n\t\t\t\t\t\t\t\tselected={index === selectedRow}\r\n\t\t\t\t\t\t\t\tgotoBreakpoint={handleGotoBreakpoint}\r\n\t\t\t\t\t\t\t\ttoggleBreakpoint={handleToggleBreakpoint}\r\n\t\t\t\t\t\t\t\tonSelect={() => setSelectedRow(index)} />\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</tbody>\r\n\t\t\t\t</table>\r\n\t\t\t\t{breakpoints.length === 0 ?\r\n\t\t\t\t\t<div className=\"BreakpointPanelList__no-breakpoints\">No breakpoints set</div>\r\n\t\t\t\t\t: null}\r\n\t\t\t</ContextMenuTrigger>\r\n\t\t\t<BreakpointModal\r\n\t\t\t\tisOpen={!!(editingBreakpoint || creatingBreakpoint)}\r\n\t\t\t\tonClose={handleCloseBreakpointModal}\r\n\t\t\t\tbreakpoint={editingBreakpoint}\r\n\t\t\t/>\r\n\t\t\t<BreakpointPanelContextMenu\r\n\t\t\t\ttoggleBreakpoint={handleToggleBreakpoint}\r\n\t\t\t\teditBreakpoint={(breakpoint) => setEditingBreakpoint(breakpoint)}\r\n\t\t\t\tremoveBreakpoint={handleRemoveBreakpoint}\r\n\t\t\t\tcreateBreakpoint={() => setCreatingBreakpoint(true)} />\r\n\t\t</>\r\n\t);\r\n}\r\n\r\nBreakpointPanelList.propTypes = {\r\n\tbreakpoints: PropTypes.arrayOf(PropTypes.object).isRequired,\r\n\tselectedRow: PropTypes.number.isRequired,\r\n\tsetSelectedRow: PropTypes.func.isRequired,\r\n\tgotoDisasm: PropTypes.func.isRequired,\r\n};\r\n","import { useCallback, useEffect, useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { useDebuggerContext } from '../DebuggerContext';\r\nimport BreakpointPanelList from './BreakpointPanelList';\r\nimport listeners from '../../utils/listeners';\r\n\r\nexport default function BreakpointPanel(props) {\r\n\tconst context = useDebuggerContext();\r\n\r\n\tconst [cpuBreakpoints, setCpuBreakpoints] = useState([]);\r\n\tconst [memoryBreakpoints, setMemoryBreakpoints] = useState([]);\r\n\tconst [selectedRow, setSelectedRow] = useState(-1);\r\n\r\n\tconst breakpoints = [...memoryBreakpoints, ...cpuBreakpoints];\r\n\r\n\tconst fetchCpuBreakpoints = useCallback(() => {\r\n\t\tif (!context.gameStatus.started) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcontext.ppsspp.send({\r\n\t\t\tevent: 'cpu.breakpoint.list',\r\n\t\t}).then(({ breakpoints }) => {\r\n\t\t\tsetCpuBreakpoints(breakpoints.map(b => ({ ...b, type: 'execute' })));\r\n\t\t}, () => {\r\n\t\t\tsetCpuBreakpoints([]);\r\n\t\t});\r\n\t}, [context.ppsspp, context.gameStatus.started]);\r\n\r\n\tconst fetchMemoryBreakpoints = useCallback(() => {\r\n\t\tif (!context.gameStatus.started) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcontext.ppsspp.send({\r\n\t\t\tevent: 'memory.breakpoint.list',\r\n\t\t}).then(({ breakpoints }) => {\r\n\t\t\tsetMemoryBreakpoints(breakpoints.map(b => ({ ...b, type: 'memory' })));\r\n\t\t}, () => {\r\n\t\t\tsetMemoryBreakpoints([]);\r\n\t\t});\r\n\t}, [context.ppsspp, context.gameStatus.started]);\r\n\r\n\tconst fetchBreakpoints = useCallback(() => {\r\n\t\tfetchCpuBreakpoints();\r\n\t\tfetchMemoryBreakpoints();\r\n\t}, [fetchCpuBreakpoints, fetchMemoryBreakpoints]);\r\n\r\n\tconst clearBreakpoints = useCallback(() => {\r\n\t\tsetCpuBreakpoints([]);\r\n\t\tsetMemoryBreakpoints([]);\r\n\t\tsetSelectedRow(-1);\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tconst listeners_ = listeners.listen({\r\n\t\t\t'game.start': () => fetchBreakpoints(),\r\n\t\t\t'game.quit': () => clearBreakpoints(),\r\n\t\t\t'connection': () => fetchBreakpoints(),\r\n\t\t\t'cpu.stepping': () => fetchBreakpoints(),\r\n\t\t\t'cpu.breakpoint.add': () => fetchCpuBreakpoints(),\r\n\t\t\t'cpu.breakpoint.update': () => fetchCpuBreakpoints(),\r\n\t\t\t'cpu.breakpoint.remove': () => fetchCpuBreakpoints(),\r\n\t\t\t'memory.breakpoint.add': () => fetchMemoryBreakpoints(),\r\n\t\t\t'memory.breakpoint.update': () => fetchMemoryBreakpoints(),\r\n\t\t\t'memory.breakpoint.remove': () => fetchMemoryBreakpoints(),\r\n\t\t});\r\n\t\treturn () => listeners.forget(listeners_);\r\n\t}, [fetchBreakpoints, fetchCpuBreakpoints, fetchMemoryBreakpoints, clearBreakpoints]);\r\n\r\n\treturn (\r\n\t\t<BreakpointPanelList breakpoints={breakpoints} selectedRow={selectedRow} setSelectedRow={setSelectedRow} gotoDisasm={props.gotoDisasm} />\r\n\t);\r\n}\r\n\r\nBreakpointPanel.propTypes = {\r\n\tgotoDisasm: PropTypes.func.isRequired,\r\n};\r\n","// We set this to false when we trigger one.\r\nlet userInitiated = true;\r\n\r\nlet listeners = [];\r\n\r\nfunction createScratchpad() {\r\n\tconst div = document.createElement('div');\r\n\tdiv.id = 'clipboard-scratchpad';\r\n\tdiv.style.width = 1;\r\n\tdiv.style.height = 1;\r\n\tdiv.style.opacity = 0;\r\n\tdiv.style.position = 'absolute';\r\n\tdiv.style.top = 0;\r\n\tdiv.style.left = 0;\r\n\tdiv.style.pointerEvents = 'none';\r\n\tdiv.style.whiteSpace = 'pre';\r\n\tdocument.body.appendChild(div);\r\n\r\n\treturn div;\r\n}\r\n\r\nfunction getScratchpad() {\r\n\tconst div = document.getElementById('clipboard-scratchpad');\r\n\tif (!div) {\r\n\t\treturn createScratchpad();\r\n\t}\r\n\treturn div;\r\n}\r\n\r\nexport function copyText(text) {\r\n\tuserInitiated = false;\r\n\r\n\ttry {\r\n\t\tconst scratchpad = getScratchpad();\r\n\t\tscratchpad.textContent = text;\r\n\r\n\t\tconst textNode = scratchpad.firstChild;\r\n\t\tconst range = document.createRange();\r\n\t\trange.setStart(textNode, 0);\r\n\t\trange.setEnd(textNode, text.length);\r\n\r\n\t\tconst selection = window.getSelection();\r\n\t\tconst oldRange = selection.rangeCount !== 0 ? selection.getRangeAt(0) : null;\r\n\r\n\t\tselection.removeAllRanges();\r\n\t\tselection.addRange(range);\r\n\r\n\t\ttry {\r\n\t\t\tdocument.execCommand('copy');\r\n\t\t} catch (e) {\r\n\t\t\twindow.prompt('Use Ctrl-C or Command-C to copy', text);\r\n\t\t}\r\n\r\n\t\tselection.removeAllRanges();\r\n\t\tif (oldRange) {\r\n\t\t\tselection.addRange(oldRange);\r\n\t\t}\r\n\t} finally {\r\n\t\tuserInitiated = true;\r\n\t}\r\n}\r\n\r\nexport function listenCopy(selector, handler) {\r\n\tlisteners.push({ selector, handler });\r\n}\r\n\r\nexport function forgetCopy(selector, handler) {\r\n\tlisteners = listeners.filter(l => l.selector !== selector && l.handler !== handler);\r\n}\r\n\r\nif (!Element.prototype.matches) {\r\n\tElement.prototype.matches = Element.prototype.msMatchesSelector;\r\n}\r\n\r\nfunction hasClosestMatch(node, selector) {\r\n\twhile (node && node !== document) {\r\n\t\tif (node.matches(selector)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tnode = node.parentNode;\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\ndocument.addEventListener('copy', (ev) => {\r\n\tconst range = document.getSelection().rangeCount !== 0 ? document.getSelection().getRangeAt(0) : null;\r\n\tif ((range && !range.collapsed) || !userInitiated) {\r\n\t\t// Skip if the user has anything actually selected, or if we triggered this 'copy' command.\r\n\t\treturn;\r\n\t}\r\n\r\n\tfor (let listener of listeners) {\r\n\t\tif (!hasClosestMatch(document.activeElement, listener.selector)) {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\r\n\t\tconst result = listener.handler(ev);\r\n\t\tif (result) {\r\n\t\t\t// Unfortunate, but newline conversion isn't automatic...\r\n\t\t\tif (/win/i.test(window.navigator.platform)) {\r\n\t\t\t\tev.clipboardData.setData('text/plain', result.replace(/\\n/g, '\\r\\n'));\r\n\t\t\t} else {\r\n\t\t\t\tev.clipboardData.setData('text/plain', result);\r\n\t\t\t}\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t}\r\n});\r\n","import { PureComponent } from 'react';\r\nimport DebuggerContext, { DebuggerContextValues } from '../DebuggerContext';\r\nimport PropTypes from 'prop-types';\r\nimport { ContextMenu, MenuItem, connectMenu } from 'react-contextmenu';\r\nimport { copyText } from '../../utils/clipboard';\r\nimport { toString08X } from '../../utils/format';\r\n\r\nclass DisasmContextMenu extends PureComponent {\r\n\t/**\r\n\t * @type {DebuggerContextValues}\r\n\t */\r\n\tcontext;\r\n\r\n\trender() {\r\n\t\tconst { id, trigger } = this.props;\r\n\t\tconst disabled = !this.context.gameStatus.stepping || this.context.gameStatus.paused;\r\n\t\tconst line = trigger && trigger.line;\r\n\r\n\t\tconst followBranch = line && (line.branch !== null || line.relevantData !== null || line.type === 'data');\r\n\r\n\t\treturn (\r\n\t\t\t<ContextMenu id={id}>\r\n\t\t\t\t<MenuItem onClick={this.handleCopyAddress}>\r\n\t\t\t\t\tCopy Address\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem onClick={this.handleCopyHex}>\r\n\t\t\t\t\tCopy Instruction (Hex)\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem onClick={this.handleCopyDisasm}>\r\n\t\t\t\t\tCopy Instruction (Disasm)\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem divider />\r\n\t\t\t\t<MenuItem disabled={disabled} onClick={this.handleAssemble}>\r\n\t\t\t\t\tAssemble Opcode...\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem divider />\r\n\t\t\t\t<MenuItem disabled={disabled} onClick={this.handleRunUntil}>\r\n\t\t\t\t\tRun to Cursor\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem disabled={disabled} onClick={this.handleJumpPC}>\r\n\t\t\t\t\tJump to Cursor\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem onClick={this.handleToggleBreakpoint}>\r\n\t\t\t\t\tToggle Breakpoint\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem divider />\r\n\t\t\t\t<MenuItem disabled={!followBranch} onClick={this.handleFollowBranch}>\r\n\t\t\t\t\tFollow Branch\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem data={{ action: 'goto_memory' }} onClick={this.handleTodo}>\r\n\t\t\t\t\tGo to in Memory View\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem data={{ action: 'goto_jit' }} onClick={this.handleTodo}>\r\n\t\t\t\t\tGo to in Jit Compare\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem divider />\r\n\t\t\t\t<MenuItem data={{ action: 'func_rename' }} onClick={this.handleTodo}>\r\n\t\t\t\t\tRename Function...\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem data={{ action: 'func_remove' }} onClick={this.handleTodo}>\r\n\t\t\t\t\tRemove Function\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem data={{ action: 'func_add' }} onClick={this.handleTodo}>\r\n\t\t\t\t\tAdd Function Here\r\n\t\t\t\t</MenuItem>\r\n\t\t\t</ContextMenu>\r\n\t\t);\r\n\t}\r\n\r\n\thandleCopyAddress = (ev, data) => {\r\n\t\tcopyText(toString08X(data.line.address));\r\n\t\tdata.node.focus();\r\n\t}\r\n\r\n\thandleCopyHex = (ev, data) => {\r\n\t\tconst hexLines = this.props.getSelectedLines().map(line => {\r\n\t\t\t// Include each opcode of a macro if it's a macro.\r\n\t\t\treturn line.macroEncoding ? line.macroEncoding.map(toString08X).join('\\n') : toString08X(line.encoding);\r\n\t\t});\r\n\t\tcopyText(hexLines.join('\\n'));\r\n\t\tdata.node.focus();\r\n\t}\r\n\r\n\thandleCopyDisasm = (ev, data) => {\r\n\t\tconst lines = this.props.getSelectedDisasm();\r\n\t\tcopyText(lines);\r\n\t\tdata.node.focus();\r\n\t}\r\n\r\n\thandleAssemble = (ev, data) => {\r\n\t\t// Delay so the context menu can close before the prompt.\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.props.assembleInstruction(data.line, '').catch(() => {\r\n\t\t\t\t// Exception logged.\r\n\t\t\t});\r\n\t\t}, 0);\r\n\t}\r\n\r\n\thandleRunUntil = (ev, data) => {\r\n\t\tthis.context.ppsspp.send({\r\n\t\t\tevent: 'cpu.runUntil',\r\n\t\t\taddress: data.line.address,\r\n\t\t}).catch(() => {\r\n\t\t\t// Already logged, let's assume the parent will have marked it disconnected/not started by now.\r\n\t\t});\r\n\t\tdata.node.focus();\r\n\t}\r\n\r\n\thandleJumpPC = (ev, data) => {\r\n\t\tthis.context.ppsspp.send({\r\n\t\t\tevent: 'cpu.setReg',\r\n\t\t\tthread: this.context.gameStatus.currentThread,\r\n\t\t\tname: 'pc',\r\n\t\t\tvalue: data.line.address,\r\n\t\t}).catch((err) => {\r\n\t\t\tthis.context.log('Failed to update PC: ' + err);\r\n\t\t});\r\n\t}\r\n\r\n\thandleToggleBreakpoint = (ev, data) => {\r\n\t\tthis.props.toggleBreakpoint(data.line);\r\n\t}\r\n\r\n\thandleFollowBranch = (ev, data) => {\r\n\t\tthis.props.followBranch(true, data.line);\r\n\t}\r\n\r\n\thandleTodo = (ev, data) => {\r\n\t\t// TODO\r\n\t\tconsole.log(data);\r\n\t\tdata.node.focus();\r\n\t}\r\n}\r\n\r\nDisasmContextMenu.propTypes = {\r\n\tid: PropTypes.string.isRequired,\r\n\ttrigger: PropTypes.shape({\r\n\t\tline: PropTypes.shape({\r\n\t\t\ttype: PropTypes.string,\r\n\t\t\tbranch: PropTypes.object,\r\n\t\t\trelevantData: PropTypes.object,\r\n\t\t}),\r\n\t}),\r\n\r\n\tgetSelectedLines: PropTypes.func.isRequired,\r\n\tgetSelectedDisasm: PropTypes.func.isRequired,\r\n\tfollowBranch: PropTypes.func.isRequired,\r\n\tassembleInstruction: PropTypes.func.isRequired,\r\n\ttoggleBreakpoint: PropTypes.func.isRequired,\r\n};\r\n\r\nDisasmContextMenu.contextType = DebuggerContext;\r\n\r\nexport default connectMenu('disasm')(DisasmContextMenu);\r\n","import { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classNames from 'clsx';\r\n\r\nclass DisasmBranchGuide extends PureComponent {\r\n\trender() {\r\n\t\tconst pos = this.calcPos();\r\n\t\tif (pos === null || this.props.lineHeight === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tconst classes = classNames({\r\n\t\t\t'DisasmBranchGuide': true,\r\n\t\t\t'DisasmBranchGuide--selected': this.props.selected,\r\n\t\t});\r\n\r\n\t\treturn (\r\n\t\t\t<div className={classes} style={pos}>\r\n\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"8\" height={pos.height}>\r\n\t\t\t\t\t<path d={this.buildPath(pos.height)} />\r\n\t\t\t\t</svg>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tbuildPath(height) {\r\n\t\tconst { guide, range, lineHeight } = this.props;\r\n\t\tconst yCenter = Math.floor(lineHeight / 2) + 0.5;\r\n\r\n\t\t// Parts: trailing connects to outside view.\r\n\t\tconst trailingEdge = `m7.5,-${yCenter} l0,${lineHeight} m-7.5,-${lineHeight - yCenter}`;\r\n\t\tconst sourceEdge = 'm3,0 l5,0 m-8,0';\r\n\t\tconst arrowEdge = 'm5.5,-4 l-4,4 l4,4 m-3.5,-4 l6,0 m-8,0';\r\n\r\n\t\t// Start at the y center so our parts are reusable for top and bottom.\r\n\t\tlet path = ['M0,' + yCenter];\r\n\r\n\t\tif (guide.top < range.start) {\r\n\t\t\tpath.push(trailingEdge);\r\n\t\t} else if (guide.direction === 'up') {\r\n\t\t\tpath.push(arrowEdge);\r\n\t\t} else {\r\n\t\t\tpath.push(sourceEdge);\r\n\t\t}\r\n\r\n\t\tpath.push('m7.5,0 l0,' + (height - lineHeight) + ' m-7.5,0');\r\n\r\n\t\tif (guide.bottom >= range.end) {\r\n\t\t\tpath.push(trailingEdge);\r\n\t\t} else if (guide.direction === 'down') {\r\n\t\t\tpath.push(arrowEdge);\r\n\t\t} else {\r\n\t\t\tpath.push(sourceEdge);\r\n\t\t}\r\n\r\n\t\treturn path.join(' ');\r\n\t}\r\n\r\n\tcalcPos() {\r\n\t\tconst { guide } = this.props;\r\n\t\tconst top = this.findAddressOffset(guide.top, false);\r\n\t\tconst bottom = this.findAddressOffset(guide.bottom, true);\r\n\t\tif (top === null || bottom === null) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tconst right = (16 - guide.lane) * 8;\r\n\t\tconst height = bottom - top;\r\n\t\treturn { top, right, height };\r\n\t}\r\n\r\n\tfindAddressOffset(address, down) {\r\n\t\tconst { offsets, range } = this.props;\r\n\t\tif (address >= range.end) {\r\n\t\t\tif ((range.end - 4) in offsets && down) {\r\n\t\t\t\treturn offsets[range.end - 4] + this.props.lineHeight;\r\n\t\t\t}\r\n\t\t\tif ((range.end - 8) in offsets && down) {\r\n\t\t\t\treturn offsets[range.end - 8] + this.props.lineHeight;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tlet off;\r\n\t\tif (address < range.start && !down) {\r\n\t\t\toff = 0;\r\n\t\t} else if (address in offsets) {\r\n\t\t\toff = offsets[address];\r\n\t\t} else if (address - 4 in offsets) {\r\n\t\t\t// Inside a macro?\r\n\t\t\toff = offsets[address - 4];\r\n\t\t} else {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn down ? off + this.props.lineHeight : off;\r\n\t}\r\n}\r\n\r\nDisasmBranchGuide.propTypes = {\r\n\tguide: PropTypes.shape({\r\n\t\tdirection: PropTypes.oneOf(['up', 'down']).isRequired,\r\n\t\ttop: PropTypes.number.isRequired,\r\n\t\tbottom: PropTypes.number.isRequired,\r\n\t\tlane: PropTypes.number.isRequired,\r\n\t}).isRequired,\r\n\toffsets: PropTypes.object.isRequired,\r\n\trange: PropTypes.shape({\r\n\t\tstart: PropTypes.number.isRequired,\r\n\t\tend: PropTypes.number.isRequired,\r\n\t}).isRequired,\r\n\tlineHeight: PropTypes.number.isRequired,\r\n\tselected: PropTypes.bool,\r\n};\r\n\r\nexport default DisasmBranchGuide;\r\n","import PropTypes from 'prop-types';\r\n\r\nexport default function BreakpointIcon(props) {\r\n\treturn (\r\n\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" className={props.className} viewBox=\"0 0 1536 1536\" width=\"12\" height=\"12\">\r\n\t\t\t<path d=\"M768,0 q209,0 385.5,103 t279.5,279.5 t103,385.5 t-103,385.5 t-279.5,279.5 t-385.5,103 t-385.5,-103 t-279.5,-279.5 t-103,-385.5 t103,-385.5 t279.5,-279.5 t385.5,-103 zm128,1247 v-190 q0,-14 -9,-23.5 t-22,-9.5 h-192 q-13,0 -23,10 t-10,23 v190 q0,13 10,23 t23,10 h192 q13,0 22,-9.5 t9,-23.5 zm-2,-344 l18,-621 q0,-12 -10,-18 q-10,-8 -24,-8 h-220 q-14,0 -24,8 q-10,6 -10,18 l17,621 q0,10 10,17.5 t24,7.5 h185 q14,0 23.5,-7.5 t10.5,-17.5 z\" />\r\n\t\t</svg>\r\n\t);\r\n}\r\n\r\nBreakpointIcon.propTypes = {\r\n\tclassName: PropTypes.string.isRequired,\r\n};\r\n","import { createRef, PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { ContextMenuTrigger } from 'react-contextmenu';\r\nimport { toString08X } from '../../utils/format';\r\nimport { ensureInView } from '../../utils/dom';\r\nimport classNames from 'clsx';\r\nimport BreakpointIcon from './BreakpointIcon';\r\n\r\nclass DisasmLine extends PureComponent {\r\n\tref;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.ref = createRef();\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst { line, selected, focused, cursor } = this.props;\r\n\r\n\t\tconst className = classNames({\r\n\t\t\t'DisasmLine': true,\r\n\t\t\t'DisasmLine--selected': selected && !focused,\r\n\t\t\t'DisasmLine--focused': focused,\r\n\t\t\t'DisasmLine--cursor': cursor,\r\n\t\t\t'DisasmLine--breakpoint': line.breakpoint && line.breakpoint.enabled,\r\n\t\t\t'DisasmLine--disabled-breakpoint': line.breakpoint && !line.breakpoint.enabled,\r\n\t\t\t'DisasmLine--current': line.isCurrentPC,\r\n\t\t});\r\n\r\n\t\tconst mapData = (props) => {\r\n\t\t\treturn { line, node: this.ref.current.parentNode };\r\n\t\t};\r\n\t\tconst attributes = {\r\n\t\t\tonDoubleClick: (ev) => this.onDoubleClick(ev, mapData()),\r\n\t\t\ttabIndex: 0,\r\n\t\t};\r\n\r\n\t\treturn (\r\n\t\t\t<ContextMenuTrigger id={this.props.contextmenu} renderTag=\"a\" collect={mapData} attributes={attributes} holdToDisplay={-1}>\r\n\t\t\t\t<div className={className} style={{ backgroundColor: line.backgroundColor }} ref={this.ref} data-address={line.address}>\r\n\t\t\t\t\t<BreakpointIcon className=\"DisasmLine__breakpoint-icon\" />\r\n\t\t\t\t\t{this.renderAddress(line)}\r\n\t\t\t\t\t<code className=\"DisasmLine__opcode\">{this.highlight(line.name, '', line.params)} </code>\r\n\t\t\t\t\t<code className=\"DisasmLine__params\">{this.highlightParams(line.params, line.name, '')}{this.renderConditional(line)}</code>\r\n\t\t\t\t</div>\r\n\t\t\t</ContextMenuTrigger>\r\n\t\t);\r\n\t}\r\n\r\n\trenderAddress(line) {\r\n\t\tconst { symbol, address, encoding } = line;\r\n\t\tconst addressHex = toString08X(address);\r\n\r\n\t\tif (this.props.displaySymbols) {\r\n\t\t\tif (symbol !== null) {\r\n\t\t\t\treturn <code className=\"DisasmLine__address DisasmLine__address--symbol\">{this.highlight(symbol + ':')}</code>;\r\n\t\t\t}\r\n\t\t\treturn <code className=\"DisasmLine__address DisasmLine__address--nosymbol\">{this.highlight(addressHex)}</code>;\r\n\t\t}\r\n\t\treturn (\r\n\t\t\t<code className=\"DisasmLine__address DisasmLine__address--hexonly\">\r\n\t\t\t\t{this.highlight(addressHex)} {toString08X(encoding)}\r\n\t\t\t</code>\r\n\t\t);\r\n\t}\r\n\r\n\trenderConditional(line) {\r\n\t\tif (line.isCurrentPC && line.conditionMet !== null) {\r\n\t\t\treturn line.conditionMet ? ' ; true' : ' ; false';\r\n\t\t}\r\n\t\treturn '';\r\n\t}\r\n\r\n\thighlight(text, before = '', after = '') {\r\n\t\tconst { highlight } = this.props;\r\n\t\tif (highlight !== null) {\r\n\t\t\tconst fullText = (before ? before + ' ' : '') + text + ' ' + after;\r\n\t\t\tlet pos = fullText.toLowerCase().indexOf(highlight);\r\n\t\t\tlet matchLength = highlight.length;\r\n\t\t\tif (pos !== -1) {\r\n\t\t\t\tconst beforeLength = before ? before.length + 1 : 0;\r\n\t\t\t\tif (pos < beforeLength) {\r\n\t\t\t\t\tmatchLength -= beforeLength - pos;\r\n\t\t\t\t\tpos = matchLength > 0 ? 0 : -1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpos -= beforeLength;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (pos >= 0 && pos < text.length) {\r\n\t\t\t\tconst className = classNames({\r\n\t\t\t\t\t'DisasmLine__highlight': true,\r\n\t\t\t\t\t'DisasmLine__highlight--end': pos + matchLength > text.length + 1,\r\n\t\t\t\t});\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t{text.substr(0, pos)}\r\n\t\t\t\t\t\t<span className={className}>{text.substr(pos, matchLength)}</span>\r\n\t\t\t\t\t\t{text.substr(pos + matchLength)}\r\n\t\t\t\t\t</>\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn text;\r\n\t}\r\n\r\n\thighlightParams(text, before = '', after = '') {\r\n\t\tconst { highlight, highlightParams } = this.props;\r\n\t\tif (highlight === null) {\r\n\t\t\tconst params = text.split(/([,()])/);\r\n\t\t\tconst toHighlight = highlightParams || [];\r\n\t\t\treturn params.map((param, key) => {\r\n\t\t\t\tlet className = 'DisasmLine__param';\r\n\t\t\t\tif (toHighlight.includes(param)) {\r\n\t\t\t\t\tclassName += ' DisasmLine__param--highlighted';\r\n\t\t\t\t}\r\n\t\t\t\treturn <span className={className} key={key}>{param}</span>;\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn this.highlight(text, before, after);\r\n\t}\r\n\r\n\tonDoubleClick(ev, data) {\r\n\t\tif (ev.button === 0) {\r\n\t\t\tthis.props.onDoubleClick(ev, data);\r\n\t\t}\r\n\t}\r\n\r\n\tensureInView(needsScroll) {\r\n\t\tconst triggerNode = this.ref.current.parentNode;\r\n\t\tif (needsScroll !== false) {\r\n\t\t\tensureInView(triggerNode, { block: needsScroll });\r\n\t\t}\r\n\t\ttriggerNode.focus();\r\n\t}\r\n\r\n\tstatic addressBoundingTop(parentNode, address) {\r\n\t\tconst lineNode = parentNode.querySelector('.DisasmLine[data-address=\"' + address + '\"]');\r\n\t\tif (lineNode) {\r\n\t\t\tconst triggerNode = lineNode.parentNode;\r\n\t\t\treturn triggerNode.getBoundingClientRect().top;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\nDisasmLine.propTypes = {\r\n\tline: PropTypes.shape({\r\n\t\taddress: PropTypes.number.isRequired,\r\n\t}).isRequired,\r\n\tselected: PropTypes.bool,\r\n\tfocused: PropTypes.bool,\r\n\tcursor: PropTypes.bool,\r\n\tdisplaySymbols: PropTypes.bool,\r\n\thighlight: PropTypes.string,\r\n\thighlightParams: PropTypes.arrayOf(PropTypes.string),\r\n\tcontextmenu: PropTypes.string.isRequired,\r\n\tonDoubleClick: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default DisasmLine;\r\n","import { createRef, PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport DisasmBranchGuide from './DisasmBranchGuide';\r\nimport DisasmLine from './DisasmLine';\r\nimport { hasContextMenu } from '../../utils/dom';\r\nimport { listenCopy, forgetCopy } from '../../utils/clipboard';\r\nimport { toString08X } from '../../utils/format';\r\nimport { Timeout } from '../../utils/timeouts';\r\n\r\nclass DisasmList extends PureComponent {\r\n\tstate = {\r\n\t\tmouseDown: false,\r\n\t\tfocused: false,\r\n\t\tlineOffsets: {},\r\n\t\tpendingLineParams: [],\r\n\t\tselectedLineParams: [],\r\n\t\tprevLines: null,\r\n\t\tprevSelectionTop: null,\r\n\t\tprevSelectionBottom: null,\r\n\t};\r\n\tfocusTimeout;\r\n\tparamsTimeout;\r\n\tref;\r\n\tcursorRef;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.ref = createRef();\r\n\t\tthis.cursorRef = createRef();\r\n\t\tthis.focusTimeout = new Timeout(() => null, 20);\r\n\t\tthis.paramsTimeout = new Timeout(() => {\r\n\t\t\tthis.setState(prevState => ({ selectedLineParams: prevState.pendingLineParams }));\r\n\t\t}, 20);\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst events = {\r\n\t\t\tonMouseDownCapture: ev => this.onMouseDown(ev),\r\n\t\t\tonMouseUpCapture: this.state.mouseDown ? (ev => this.onMouseUp(ev)) : undefined,\r\n\t\t\tonMouseMove: this.state.mouseDown ? (ev => this.onMouseMove(ev)) : undefined,\r\n\t\t\tonKeyDown: ev => this.onKeyDown(ev),\r\n\t\t\tonBlur: ev => this.onFocusChange(ev, false),\r\n\t\t\tonFocus: ev => this.onFocusChange(ev, true),\r\n\t\t};\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"Disasm__list\" ref={this.ref} {...events}>\r\n\t\t\t\t{this.props.lines.map((line) => this.renderLine(line))}\r\n\t\t\t\t{this.props.branchGuides.map((guide) => this.renderBranchGuide(guide))}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderLine(line) {\r\n\t\tconst { displaySymbols, cursor } = this.props;\r\n\t\tlet props = {\r\n\t\t\tdisplaySymbols,\r\n\t\t\tline,\r\n\t\t\tselected: this.isLineSelected(line),\r\n\t\t\tcursor: line.address === cursor,\r\n\t\t\tonDoubleClick: this.props.onDoubleClick,\r\n\t\t\tref: line.address === cursor ? this.cursorRef : undefined,\r\n\t\t\t// Avoid re-rendering lines unnecessarily.\r\n\t\t\thighlight: this.shouldHighlight(line, this.props.highlightText) ? this.props.highlightText : null,\r\n\t\t\thighlightParams: this.shouldHighlightParams(line) ? this.state.selectedLineParams : null,\r\n\t\t};\r\n\t\tprops.focused = props.selected && this.state.focused;\r\n\r\n\t\treturn <DisasmLine key={line.address} contextmenu=\"disasm\" {...props} />;\r\n\t}\r\n\r\n\trenderBranchGuide(guide) {\r\n\t\tconst key = String(guide.top) + String(guide.bottom) + guide.direction;\r\n\t\tconst { range, lineHeight, cursor } = this.props;\r\n\t\tconst props = {\r\n\t\t\tkey,\r\n\t\t\tguide,\r\n\t\t\toffsets: this.state.lineOffsets,\r\n\t\t\trange,\r\n\t\t\tlineHeight,\r\n\t\t\tselected: guide.top === cursor || guide.bottom === cursor,\r\n\t\t};\r\n\r\n\t\treturn <DisasmBranchGuide {...props} />;\r\n\t}\r\n\r\n\tshouldHighlight(line, match) {\r\n\t\tlet parts = [];\r\n\t\tparts.push(toString08X(line.address));\r\n\t\tif (line.symbol !== null) {\r\n\t\t\tparts.push(line.symbol + ':');\r\n\t\t}\r\n\t\tparts.push(line.name + ' ' + line.params);\r\n\r\n\t\treturn parts.some(part => part.toLowerCase().indexOf(match) !== -1);\r\n\t}\r\n\r\n\tshouldHighlightParams(line, match) {\r\n\t\tif (this.isLineSelected(line)) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn this.state.selectedLineParams.some(param => line.params.indexOf(param) !== -1);\r\n\t}\r\n\r\n\t// Exposed to parent.\r\n\taddressBoundingTop(address) {\r\n\t\t// It seems like pointless complexity to use a ref for this.\r\n\t\treturn DisasmLine.addressBoundingTop(this.ref.current, address);\r\n\t}\r\n\r\n\t// Exposed to parent.\r\n\tensureCursorInView(options) {\r\n\t\tif (this.cursorRef.current) {\r\n\t\t\tthis.cursorRef.current.ensureInView(options);\r\n\t\t}\r\n\t}\r\n\r\n\tisLineSelected(line) {\r\n\t\treturn DisasmList.isLineSelected(this.props, line);\r\n\t}\r\n\r\n\tstatic isLineSelected({ selectionTop, selectionBottom }, line) {\r\n\t\treturn line.address + line.addressSize > selectionTop && line.address <= selectionBottom;\r\n\t}\r\n\r\n\tstatic calcOffsets(lines, lineHeight) {\r\n\t\tlet pos = 0;\r\n\t\tlet offsets = {};\r\n\t\tlines.forEach((line) => {\r\n\t\t\toffsets[line.address] = pos;\r\n\t\t\tpos += lineHeight;\r\n\t\t});\r\n\t\treturn offsets;\r\n\t}\r\n\r\n\tstatic getSelectedLineParams({ lines, selectionTop, selectionBottom }) {\r\n\t\tconst selectedLines = lines.filter(DisasmList.isLineSelected.bind(null, { selectionTop, selectionBottom }));\r\n\r\n\t\tlet params = {};\r\n\t\tfor (let line of selectedLines) {\r\n\t\t\tfor (let param of line.params.split(/[,()]/)) {\r\n\t\t\t\tparams[param] = param;\r\n\t\t\t}\r\n\t\t}\r\n\t\tdelete params[''];\r\n\r\n\t\treturn Object.values(params);\r\n\t}\r\n\r\n\tstatic getDerivedStateFromProps(nextProps, prevState) {\r\n\t\tconst linesChanged = nextProps.lines !== prevState.prevLines;\r\n\t\tconst selectionChanged = nextProps.selectionTop !== prevState.prevSelectionTop || nextProps.selectionBottom !== prevState.prevSelectionBottom;\r\n\r\n\t\tlet offsetsUpdate = null;\r\n\t\tif (linesChanged) {\r\n\t\t\tconst lineOffsets = DisasmList.calcOffsets(nextProps.lines, nextProps.lineHeight);\r\n\t\t\toffsetsUpdate = { lineOffsets, prevLines: nextProps.lines };\r\n\t\t}\r\n\r\n\t\tlet selectedUpdate = null;\r\n\t\tif (linesChanged || selectionChanged) {\r\n\t\t\tselectedUpdate = {\r\n\t\t\t\tpendingLineParams: DisasmList.getSelectedLineParams(nextProps),\r\n\t\t\t\tprevSelectionTop: nextProps.selectionTop,\r\n\t\t\t\tprevSelectionBottom: nextProps.selectionBottom,\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif (offsetsUpdate !== null || selectedUpdate !== null) {\r\n\t\t\treturn { ...offsetsUpdate, ...selectedUpdate };\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tlistenCopy('.Disasm__list', this.onCopy);\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tforgetCopy('.Disasm__list', this.onCopy);\r\n\t\tthis.paramsTimeout.cancel();\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (this.state.pendingLineParams !== prevState.pendingLineParams) {\r\n\t\t\t// Apply the line params soon after selection change - not immediately for quicker scrolling.\r\n\t\t\tthis.paramsTimeout.start();\r\n\t\t}\r\n\t}\r\n\r\n\tonCopy = (ev) => {\r\n\t\treturn this.props.getSelectedDisasm();\r\n\t}\r\n\r\n\tonFocusChange(ev, focused) {\r\n\t\tconst update = () => {\r\n\t\t\tif (focused !== this.state.focused) {\r\n\t\t\t\tthis.setState({ focused });\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.focusTimeout.cancel();\r\n\r\n\t\tif (!focused) {\r\n\t\t\t// We use an arbitrary short delay because a click will temporarily blur.\r\n\t\t\tthis.focusTimeout.reset(update);\r\n\t\t\tthis.focusTimeout.start();\r\n\t\t} else {\r\n\t\t\tupdate();\r\n\t\t}\r\n\t}\r\n\r\n\tonMouseDown(ev) {\r\n\t\tconst line = this.mouseEventToLine(ev);\r\n\t\t// Don't change selection if right clicking within the selection.\r\n\t\tif (ev.button !== 2 || !this.isLineSelected(line)) {\r\n\t\t\tthis.applySelection(ev, line);\r\n\t\t} else {\r\n\t\t\t// But do change the cursor.\r\n\t\t\tthis.props.updateCursor(line.address);\r\n\t\t}\r\n\t\tif (ev.button === 0) {\r\n\t\t\tthis.setState({ mouseDown: true });\r\n\t\t}\r\n\t}\r\n\r\n\tonMouseUp(ev) {\r\n\t\tconst line = this.mouseEventToLine(ev);\r\n\t\tif (line) {\r\n\t\t\tthis.applySelection(ev, line);\r\n\t\t}\r\n\t\tthis.setState({ mouseDown: false });\r\n\t}\r\n\r\n\tonMouseMove(ev) {\r\n\t\tif (ev.buttons === 0) {\r\n\t\t\tthis.setState({ mouseDown: false });\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst line = this.mouseEventToLine(ev);\r\n\t\tif (line) {\r\n\t\t\tthis.applySelection(ev, line);\r\n\t\t}\r\n\t}\r\n\r\n\tonKeyDown(ev) {\r\n\t\tif (hasContextMenu()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst modifiers = (ev.ctrlKey ? 'c' : '') + (ev.metaKey ? 'm' : '') + (ev.altKey ? 'a' : '') + (ev.shiftKey ? 's' : '');\r\n\r\n\t\tif (['ArrowUp', 'ArrowDown', 'PageUp', 'PageDown'].includes(ev.key)) {\r\n\t\t\tlet dist = 1;\r\n\t\t\tif (ev.key === 'PageUp' || ev.key === 'PageDown') {\r\n\t\t\t\tdist = this.props.visibleLines;\r\n\t\t\t}\r\n\t\t\tif (ev.key === 'ArrowUp' || ev.key === 'PageUp') {\r\n\t\t\t\tdist = -dist;\r\n\t\t\t}\r\n\r\n\t\t\tif (modifiers === '' || modifiers === 's') {\r\n\t\t\t\tconst lineIndex = this.findCursorLineIndex();\r\n\t\t\t\tconst newIndex = Math.min(this.props.lines.length - 1, Math.max(0, lineIndex + dist));\r\n\t\t\t\tif (lineIndex !== newIndex) {\r\n\t\t\t\t\tthis.applySelection(ev, this.props.lines[newIndex]);\r\n\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t} else if (ev.ctrlKey) {\r\n\t\t\t\tthis.props.applyScroll(dist);\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ((ev.key === 'ArrowLeft' || ev.key === 'ArrowRight') && modifiers === '') {\r\n\t\t\tthis.props.followBranch(ev.key === 'ArrowRight', this.findCursorLine());\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tif (ev.key === 'Tab' && modifiers === '') {\r\n\t\t\tthis.props.updateDisplaySymbols(!this.props.displaySymbols);\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tif (ev.key === 'a' && modifiers === 'c') {\r\n\t\t\tthis.props.assembleInstruction(this.findCursorLine(), '');\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tif ((ev.key === ' ' || ev.key === 'Spacebar') && modifiers === '') {\r\n\t\t\tthis.props.toggleBreakpoint(this.findCursorLine());\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t\tif (ev.key === 'd' && modifiers === 'c') {\r\n\t\t\tthis.props.toggleBreakpoint(this.findCursorLine(), true);\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tif ((ev.key === 's' || ev.key === 'f') && modifiers === 'c') {\r\n\t\t\tthis.props.searchPrompt();\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tif ((ev.key === 'F3') && modifiers === '') {\r\n\t\t\tthis.props.searchNext();\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tif (ev.key === 'g' && modifiers === 'c') {\r\n\t\t\tthis.props.promptGoto();\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\r\n\t\tif (ev.key === 'e' && modifiers === 'c') {\r\n\t\t\tthis.props.editBreakpoint(this.findCursorLine());\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t}\r\n\r\n\tapplySelection(ev, line) {\r\n\t\tlet { selectionTop, selectionBottom } = this.props;\r\n\t\tif (ev.shiftKey) {\r\n\t\t\tselectionTop = Math.min(selectionTop, line.address);\r\n\t\t\tselectionBottom = Math.max(selectionBottom, line.address);\r\n\t\t} else {\r\n\t\t\tselectionTop = line.address;\r\n\t\t\tselectionBottom = line.address;\r\n\t\t}\r\n\r\n\t\tif (selectionTop !== this.props.selectionTop || selectionBottom !== this.props.selectionBottom) {\r\n\t\t\tthis.props.updateSelection({\r\n\t\t\t\tselectionTop,\r\n\t\t\t\tselectionBottom,\r\n\t\t\t});\r\n\t\t}\r\n\t\tthis.props.updateCursor(line.address);\r\n\t}\r\n\r\n\tmouseEventToLine(ev) {\r\n\t\t// Account for page and list scrolling.\r\n\t\tconst y = ev.pageY - this.ref.current.getBoundingClientRect().top - window.pageYOffset;\r\n\t\tconst index = Math.floor(y / this.props.lineHeight);\r\n\t\treturn this.props.lines[index];\r\n\t}\r\n\r\n\tfindCursorLineIndex() {\r\n\t\tconst { cursor, lines, selectionTop } = this.props;\r\n\t\tconst addr = cursor ? cursor : selectionTop;\r\n\t\tfor (let i = 0; i < lines.length; ++i) {\r\n\t\t\tif (lines[i].address === addr) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tfindCursorLine() {\r\n\t\tconst lineIndex = this.findCursorLineIndex();\r\n\t\treturn this.props.lines[lineIndex];\r\n\t}\r\n}\r\n\r\nDisasmList.propTypes = {\r\n\tlineHeight: PropTypes.number.isRequired,\r\n\tvisibleLines: PropTypes.number.isRequired,\r\n\tdisplaySymbols: PropTypes.bool.isRequired,\r\n\tcursor: PropTypes.number,\r\n\tselectionTop: PropTypes.number,\r\n\tselectionBottom: PropTypes.number,\r\n\thighlightText: PropTypes.string,\r\n\r\n\tonDoubleClick: PropTypes.func.isRequired,\r\n\tupdateCursor: PropTypes.func.isRequired,\r\n\tupdateSelection: PropTypes.func.isRequired,\r\n\tupdateDisplaySymbols: PropTypes.func.isRequired,\r\n\tgetSelectedDisasm: PropTypes.func.isRequired,\r\n\tfollowBranch: PropTypes.func.isRequired,\r\n\tassembleInstruction: PropTypes.func.isRequired,\r\n\ttoggleBreakpoint: PropTypes.func.isRequired,\r\n\tapplyScroll: PropTypes.func.isRequired,\r\n\tpromptGoto: PropTypes.func.isRequired,\r\n\tsearchPrompt: PropTypes.func.isRequired,\r\n\tsearchNext: PropTypes.func.isRequired,\r\n\teditBreakpoint: PropTypes.func.isRequired,\r\n\r\n\trange: PropTypes.shape({\r\n\t\tstart: PropTypes.number.isRequired,\r\n\t\tend: PropTypes.number.isRequired,\r\n\t}).isRequired,\r\n\tlines: PropTypes.arrayOf(PropTypes.shape({\r\n\t\taddress: PropTypes.number.isRequired,\r\n\t})).isRequired,\r\n\tbranchGuides: PropTypes.arrayOf(PropTypes.shape({\r\n\t\ttop: PropTypes.number.isRequired,\r\n\t\tbottom: PropTypes.number.isRequired,\r\n\t\tdirection: PropTypes.string.isRequired,\r\n\t})).isRequired,\r\n};\r\n\r\nexport default DisasmList;\r\n","import { createRef, PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classNames from 'clsx';\r\nimport './DisasmSearch.css';\r\n\r\nclass DisasmSearch extends PureComponent {\r\n\tref;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.ref = createRef();\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst value = this.props.searchString || '';\r\n\t\tconst classes = classNames('DisasmSearch__field', { 'DisasmSearch__field--progress': this.props.inProgress });\r\n\r\n\t\treturn (\r\n\t\t\t/* eslint no-script-url: \"off\" */\r\n\t\t\t<form action=\"#\" className=\"DisasmSearch\" hidden={this.props.searchString === null} onSubmit={this.handleNext}>\r\n\t\t\t\t<div className={classes}>\r\n\t\t\t\t\t<input type=\"search\" value={value} placeholder=\"Find...\" onChange={this.handleChange} onKeyDown={this.handleKeyDown} ref={this.ref} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<button type=\"submit\">\r\n\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\" width=\"15\" height=\"15\" role=\"img\">\r\n\t\t\t\t\t\t<title>Search / Next</title>\r\n\t\t\t\t\t\t<path d=\"M10,50 l80,0 l-35,-40 m35,40 l-35,40\" />\r\n\t\t\t\t\t</svg>\r\n\t\t\t\t</button>\r\n\t\t\t\t<button type=\"button\" onClick={this.handleCancel}>\r\n\t\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 180 180\" width=\"15\" height=\"15\" role=\"img\">\r\n\t\t\t\t\t\t<title>Cancel</title>\r\n\t\t\t\t\t\t<path d=\"M30,30 l120,120 m-120,0 l120,-120\" />\r\n\t\t\t\t\t</svg>\r\n\t\t\t\t</button>\r\n\t\t\t</form>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (prevProps.searchString === null && this.props.searchString !== null) {\r\n\t\t\tthis.focus();\r\n\t\t}\r\n\t}\r\n\r\n\thandleChange = (ev) => {\r\n\t\tthis.props.updateSearchString(ev.target.value);\r\n\t}\r\n\r\n\thandleNext = (ev) => {\r\n\t\tthis.props.searchNext();\r\n\t\tthis.focus();\r\n\t\tev.preventDefault();\r\n\t}\r\n\r\n\thandleCancel = (ev) => {\r\n\t\tthis.props.updateSearchString(null);\r\n\t}\r\n\r\n\thandleKeyDown = (ev) => {\r\n\t\tif (ev.key === 'Escape') {\r\n\t\t\tthis.handleCancel();\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t}\r\n\r\n\tfocus() {\r\n\t\tthis.ref.current.focus();\r\n\t}\r\n}\r\n\r\nDisasmSearch.propTypes = {\r\n\tsearchString: PropTypes.string,\r\n\tinProgress: PropTypes.bool.isRequired,\r\n\tupdateSearchString: PropTypes.func.isRequired,\r\n\tsearchNext: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default DisasmSearch;\r\n","import { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { toString02X, toString04X, toString08X } from '../../utils/format';\r\nimport './StatusBar.css';\r\n\r\nclass StatusBar extends PureComponent {\r\n\trender() {\r\n\t\tconst { line } = this.props;\r\n\t\tif (!line) {\r\n\t\t\treturn <div className=\"StatusBar\"></div>;\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"StatusBar\">\r\n\t\t\t\t<div className=\"StatusBar__left\">{this.renderLeftStatus(line)}</div>\r\n\t\t\t\t<div className=\"StatusBar__right\">{line.function || line.symbol || ''}</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderLeftStatus(line) {\r\n\t\tif (line.type === 'opcode' || line.type === 'macro') {\r\n\t\t\tif (line.dataAccess) {\r\n\t\t\t\treturn this.renderDataAccess(line.dataAccess);\r\n\t\t\t} else if (line.branch) {\r\n\t\t\t\treturn this.renderBranch(line.branch);\r\n\t\t\t} else if (line.relevantData && typeof line.relevantData.stringValue === 'string') {\r\n\t\t\t\treturn this.renderString(line.relevantData);\r\n\t\t\t}\r\n\t\t} else if (line.type === 'data') {\r\n\t\t\treturn this.renderDataSymbol(line.dataSymbol, line.address);\r\n\t\t}\r\n\r\n\t\treturn '';\r\n\t}\r\n\r\n\trenderDataAccess(dataAccess) {\r\n\t\tif (dataAccess.uintValue === null) {\r\n\t\t\treturn 'Invalid address ' + toString08X(dataAccess.address);\r\n\t\t}\r\n\r\n\t\tlet status = '[' + toString08X(dataAccess.address) + '] = ';\r\n\t\tif (dataAccess.valueSymbol) {\r\n\t\t\tstatus += dataAccess.valueSymbol + ' (';\r\n\t\t}\r\n\t\tif (dataAccess.size === 1) {\r\n\t\t\tstatus += toString02X(dataAccess.uintValue);\r\n\t\t} else if (dataAccess.size === 2) {\r\n\t\t\tstatus += toString04X(dataAccess.uintValue);\r\n\t\t} else if (dataAccess.size >= 4) {\r\n\t\t\t// TODO: Show vectors better.\r\n\t\t\tstatus += toString08X(dataAccess.uintValue);\r\n\t\t}\r\n\t\tif (dataAccess.valueSymbol) {\r\n\t\t\tstatus += ')';\r\n\t\t}\r\n\r\n\t\treturn status;\r\n\t}\r\n\r\n\trenderBranch(branch) {\r\n\t\tlet status = branch.targetAddress ? toString08X(branch.targetAddress) : '';\r\n\t\tif (branch.symbol) {\r\n\t\t\tstatus += ' = ' + branch.symbol;\r\n\t\t}\r\n\t\treturn status;\r\n\t}\r\n\r\n\trenderString(data) {\r\n\t\treturn '[' + toString08X(data.address) + '] = ' + JSON.stringify(data.stringValue);\r\n\t}\r\n\r\n\trenderDataSymbol(dataSymbol, address) {\r\n\t\tlet status = toString08X(dataSymbol.start);\r\n\t\tif (dataSymbol.label) {\r\n\t\t\tstatus += ' (' + dataSymbol.label + ')';\r\n\t\t}\r\n\t\tif (address !== dataSymbol.start) {\r\n\t\t\tstatus += ' + ' + toString08X(dataSymbol.start - address);\r\n\t\t}\r\n\t\treturn status;\r\n\t}\r\n}\r\n\r\nStatusBar.propTypes = {\r\n\tline: PropTypes.object,\r\n};\r\n\r\nexport default StatusBar;\r\n","import { createRef, PureComponent } from 'react';\r\nimport DebuggerContext, { DebuggerContextValues } from '../DebuggerContext';\r\nimport PropTypes from 'prop-types';\r\nimport BreakpointModal from './BreakpointModal';\r\nimport DisasmContextMenu from './DisasmContextMenu';\r\nimport DisasmList from './DisasmList';\r\nimport DisasmSearch from './DisasmSearch';\r\nimport StatusBar from './StatusBar';\r\nimport { toString08X } from '../../utils/format';\r\nimport listeners from '../../utils/listeners.js';\r\nimport './Disasm.css';\r\n\r\nconst MIN_BUFFER = 100;\r\nconst MAX_BUFFER = 500;\r\n\r\nclass Disasm extends PureComponent {\r\n\tstate = {\r\n\t\tlines: [],\r\n\t\tbranchGuides: [],\r\n\t\trange: { start: 0, end: 0 },\r\n\t\tlineHeight: 0,\r\n\t\tvisibleLines: 0,\r\n\t\tdisplaySymbols: true,\r\n\t\twantDisplaySymbols: true,\r\n\t\tcursor: null,\r\n\t\tsearchString: null,\r\n\t\tsearchInProgress: false,\r\n\t\thighlightText: null,\r\n\t\teditingBreakpoint: null,\r\n\t\tcreatingBreakpoint: null,\r\n\t};\r\n\t/**\r\n\t * @type {DebuggerContextValues}\r\n\t */\r\n\tcontext;\r\n\tjumpStack = [];\r\n\tneedsScroll = false;\r\n\tneedsOffsetFix = false;\r\n\tupdatesCancel = false;\r\n\tupdatesSequence = Promise.resolve(null);\r\n\tlastSearch = null;\r\n\tref;\r\n\tlistRef;\r\n\tsearchRef;\r\n\tlisteners_;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.ref = createRef();\r\n\t\tthis.listRef = createRef();\r\n\t\tthis.searchRef = createRef();\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst events = {\r\n\t\t\tonScroll: ev => this.onScroll(ev),\r\n\t\t\tonDragStart: ev => ev.preventDefault(),\r\n\t\t};\r\n\r\n\t\tif (!this.context.gameStatus.started) {\r\n\t\t\treturn this.renderNotStarted();\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<>\r\n\t\t\t\t<div ref={this.ref} className=\"Disasm\" {...events}>\r\n\t\t\t\t\t<DisasmList ref={this.listRef} {...this.state}\r\n\t\t\t\t\t\tonDoubleClick={this.onDoubleClick}\r\n\t\t\t\t\t\tupdateSelection={this.props.updateSelection}\r\n\t\t\t\t\t\tpromptGoto={this.props.promptGoto}\r\n\t\t\t\t\t\tupdateCursor={this.updateCursor}\r\n\t\t\t\t\t\tupdateDisplaySymbols={this.updateDisplaySymbols}\r\n\t\t\t\t\t\tselectionTop={this.props.selectionTop}\r\n\t\t\t\t\t\tselectionBottom={this.props.selectionBottom}\r\n\t\t\t\t\t\tgetSelectedDisasm={this.getSelectedDisasm}\r\n\t\t\t\t\t\tfollowBranch={this.followBranch}\r\n\t\t\t\t\t\tassembleInstruction={this.assembleInstruction}\r\n\t\t\t\t\t\ttoggleBreakpoint={this.toggleBreakpoint}\r\n\t\t\t\t\t\teditBreakpoint={this.editBreakpoint}\r\n\t\t\t\t\t\tapplyScroll={this.applyScroll}\r\n\t\t\t\t\t\tsearchPrompt={this.searchPrompt}\r\n\t\t\t\t\t\tsearchNext={this.searchNext}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t\t<StatusBar line={this.state.lines.find(l => l.address === this.state.cursor)} />\r\n\r\n\t\t\t\t{this.renderContextMenu()}\r\n\t\t\t\t<DisasmSearch ref={this.searchRef}\r\n\t\t\t\t\tsearchString={this.state.searchString}\r\n\t\t\t\t\tsearchNext={this.searchNext}\r\n\t\t\t\t\tupdateSearchString={this.updateSearchString}\r\n\t\t\t\t\tinProgress={this.state.searchInProgress}\r\n\t\t\t\t/>\r\n\t\t\t\t<BreakpointModal\r\n\t\t\t\t\tisOpen={this.state.editingBreakpoint !== null || this.state.creatingBreakpoint !== null}\r\n\t\t\t\t\tonClose={this.closeEditBreakpoint}\r\n\t\t\t\t\tbreakpoint={this.state.editingBreakpoint}\r\n\t\t\t\t\tinitialOverrides={this.state.creatingBreakpoint}\r\n\t\t\t\t/>\r\n\t\t\t</>\r\n\t\t);\r\n\t}\r\n\r\n\trenderNotStarted() {\r\n\t\treturn (\r\n\t\t\t<div className=\"Disasm--not-started\">\r\n\t\t\t\tWaiting for a game to start...\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderContextMenu() {\r\n\t\treturn <DisasmContextMenu\r\n\t\t\tgetSelectedLines={this.getSelectedLines}\r\n\t\t\tgetSelectedDisasm={this.getSelectedDisasm}\r\n\t\t\tfollowBranch={this.followBranch}\r\n\t\t\tassembleInstruction={this.assembleInstruction}\r\n\t\t\ttoggleBreakpoint={this.toggleBreakpoint}\r\n\t\t/>;\r\n\t}\r\n\r\n\tupdateCursor = (cursor) => {\r\n\t\tif (this.state.cursor !== cursor) {\r\n\t\t\tthis.needsScroll = 'nearest';\r\n\t\t\tthis.setState({ cursor });\r\n\r\n\t\t\tthis.updatesSequence = this.updatesSequence.then(() => {\r\n\t\t\t\tif (this.updatesCancel) {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet { start, end } = this.state.range;\r\n\t\t\t\tconst minBuffer = Math.max(MIN_BUFFER, this.state.visibleLines);\r\n\t\t\t\tconst maxBuffer = Math.max(MAX_BUFFER, this.state.visibleLines * 5);\r\n\r\n\t\t\t\t// This is here for keyboard scrolling, mainly.\r\n\t\t\t\tif (cursor - minBuffer * 4 < start) {\r\n\t\t\t\t\tstart = cursor - minBuffer * 2 * 4;\r\n\t\t\t\t} else if (cursor - maxBuffer * 4 > start) {\r\n\t\t\t\t\tstart = cursor - (maxBuffer - minBuffer) * 4;\r\n\t\t\t\t}\r\n\t\t\t\tif (cursor + minBuffer * 4 > end) {\r\n\t\t\t\t\tend = cursor + minBuffer * 2 * 4;\r\n\t\t\t\t} else if (cursor + maxBuffer * 4 < end) {\r\n\t\t\t\t\tend = cursor + (maxBuffer - minBuffer) * 4;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (start !== this.state.range.start || end !== this.state.range.end) {\r\n\t\t\t\t\treturn this.updateDisasmNow('nearest', { address: start, end });\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tgetSelectedLines = () => {\r\n\t\tconst { selectionTop, selectionBottom } = this.props;\r\n\t\tconst isSelected = line => line.address + line.addressSize > selectionTop && line.address <= selectionBottom;\r\n\t\treturn this.state.lines.filter(isSelected);\r\n\t}\r\n\r\n\tgetSelectedDisasm = () => {\r\n\t\tconst lines = this.getSelectedLines();\r\n\r\n\t\t// Gather all branch targets without labels.\r\n\t\tlet branchAddresses = {};\r\n\t\tconst unlabeledBranches = lines.map(l => l.branch).filter(b => b && !b.symbol && b.targetAddress);\r\n\t\tfor (const b of unlabeledBranches) {\r\n\t\t\tbranchAddresses[b.targetAddress] = 'pos_' + toString08X(b.targetAddress);\r\n\t\t}\r\n\r\n\t\tlet result = '';\r\n\t\tlet firstLine = true;\r\n\t\tfor (const l of lines) {\r\n\t\t\tconst label = l.symbol || branchAddresses[l.address];\r\n\t\t\tif (label) {\r\n\t\t\t\tif (!firstLine) {\r\n\t\t\t\t\tresult += '\\n';\r\n\t\t\t\t}\r\n\t\t\t\tresult += label + ':\\n\\n';\r\n\t\t\t}\r\n\r\n\t\t\tresult += '\\t' + l.name + ' ';\r\n\t\t\tif (l.branch && l.branch.targetAddress && !l.branch.symbol) {\r\n\t\t\t\t// Use the generated label.\r\n\t\t\t\tresult += l.params.replace(/0x[0-9A-f]+/, branchAddresses[l.branch.targetAddress]);\r\n\t\t\t} else {\r\n\t\t\t\tresult += l.params;\r\n\t\t\t}\r\n\t\t\tresult += '\\n';\r\n\r\n\t\t\tfirstLine = false;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tupdateDisplaySymbols = (flag) => {\r\n\t\tthis.setState({ wantDisplaySymbols: flag });\r\n\t}\r\n\r\n\tfollowBranch = (direction, line) => {\r\n\t\tif (direction) {\r\n\t\t\tlet target = line.branch && line.branch.targetAddress;\r\n\t\t\tif (target === null) {\r\n\t\t\t\ttarget = line.relevantData && line.relevantData.address;\r\n\t\t\t}\r\n\t\t\tif (target !== null) {\r\n\t\t\t\tthis.jumpStack.push(this.state.cursor);\r\n\t\t\t\tthis.gotoAddress(target);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (this.jumpStack.length !== 0) {\r\n\t\t\t\tthis.gotoAddress(this.jumpStack.pop());\r\n\t\t\t} else {\r\n\t\t\t\tthis.gotoAddress(this.props.pc);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tassembleInstruction = (line, startCode) => {\r\n\t\tconst { address } = line;\r\n\t\tconst code = prompt('Assemble instruction', startCode);\r\n\t\tif (!code) {\r\n\t\t\treturn Promise.resolve(null);\r\n\t\t}\r\n\r\n\t\tconst writeInstruction = () => {\r\n\t\t\treturn this.context.ppsspp.send({\r\n\t\t\t\tevent: 'memory.assemble',\r\n\t\t\t\taddress: address,\r\n\t\t\t\tcode,\r\n\t\t\t}).then(() => {\r\n\t\t\t\tif (address === this.state.cursor) {\r\n\t\t\t\t\t// Okay, move one down so we can fire 'em off.\r\n\t\t\t\t\tconst lineIndex = this.state.lines.indexOf(line);\r\n\t\t\t\t\tif (lineIndex < this.state.lines.length - 1) {\r\n\t\t\t\t\t\tconst nextAddress = this.state.lines[lineIndex + 1].address;\r\n\t\t\t\t\t\tthis.gotoAddress(nextAddress, 'nearest');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Now, whether we moved or not, also update disasm.\r\n\t\t\t\tthis.updateDisasm();\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\t// Check if this is actually a register assignment.\r\n\t\tconst assignment = code.split(/\\s*=\\s*(.+)$/, 2);\r\n\t\tif (assignment.length >= 2) {\r\n\t\t\treturn this.context.ppsspp.send({\r\n\t\t\t\tevent: 'cpu.evaluate',\r\n\t\t\t\tthread: this.context.gameStatus.currentThread,\r\n\t\t\t\texpression: assignment[1],\r\n\t\t\t}).then((result) => {\r\n\t\t\t\treturn this.context.ppsspp.send({\r\n\t\t\t\t\tevent: 'cpu.setReg',\r\n\t\t\t\t\tthread: this.context.gameStatus.currentThread,\r\n\t\t\t\t\tname: assignment[0],\r\n\t\t\t\t\tvalue: result.uintValue,\r\n\t\t\t\t});\r\n\t\t\t}).then(({ uintValue }) => {\r\n\t\t\t\tthis.context.log('Updated ' + assignment[0] + ' to ' + toString08X(uintValue));\r\n\t\t\t}, writeInstruction);\r\n\t\t} else {\r\n\t\t\treturn writeInstruction();\r\n\t\t}\r\n\t}\r\n\r\n\ttoggleBreakpoint = (line, keep) => {\r\n\t\tif (line.breakpoint === null) {\r\n\t\t\tthis.context.ppsspp.send({\r\n\t\t\t\tevent: 'cpu.breakpoint.add',\r\n\t\t\t\taddress: line.address,\r\n\t\t\t\tenabled: true,\r\n\t\t\t});\r\n\t\t} else if (!line.breakpoint.enabled) {\r\n\t\t\tthis.context.ppsspp.send({\r\n\t\t\t\tevent: 'cpu.breakpoint.update',\r\n\t\t\t\taddress: line.breakpoint.address || line.address,\r\n\t\t\t\tenabled: true,\r\n\t\t\t});\r\n\t\t} else if (keep) {\r\n\t\t\tthis.context.ppsspp.send({\r\n\t\t\t\tevent: 'cpu.breakpoint.update',\r\n\t\t\t\taddress: line.breakpoint.address || line.address,\r\n\t\t\t\tenabled: false,\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tif (line.breakpoint.condition !== null) {\r\n\t\t\t\tif (!window.confirm('This breakpoint has has a condition.\\n\\nAre you sure you want to remove it?')) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.context.ppsspp.send({\r\n\t\t\t\tevent: 'cpu.breakpoint.remove',\r\n\t\t\t\taddress: line.breakpoint.address || line.address,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\teditBreakpoint = (line) => {\r\n\t\t// In case it's actually in the middle of a macro.\r\n\t\tconst breakpointAddress = line.breakpoint?.address || line.address;\r\n\t\tthis.context.ppsspp.send({\r\n\t\t\tevent: 'cpu.breakpoint.list',\r\n\t\t\taddress: breakpointAddress,\r\n\t\t\tenabled: true,\r\n\t\t}).then(({ breakpoints }) => {\r\n\t\t\tconst bp = breakpoints.find(bp => bp.address === breakpointAddress);\r\n\t\t\tif (bp) {\r\n\t\t\t\tconst editingBreakpoint = { ...bp, type: 'execute' };\r\n\t\t\t\tthis.setState({ editingBreakpoint });\r\n\t\t\t} else {\r\n\t\t\t\tconst creatingBreakpoint = { address: breakpointAddress, type: 'execute' };\r\n\t\t\t\tthis.setState({ creatingBreakpoint });\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tcloseEditBreakpoint = () => {\r\n\t\tthis.setState({ editingBreakpoint: null, creatingBreakpoint: null });\r\n\t}\r\n\r\n\tgotoAddress = (addr, snap = 'center') => {\r\n\t\tthis.needsScroll = snap;\r\n\t\tthis.props.updateSelection({\r\n\t\t\tselectionTop: addr,\r\n\t\t\tselectionBottom: addr,\r\n\t\t});\r\n\t}\r\n\r\n\tsearchDisasm = (cont) => {\r\n\t\tconst continueLast = cont && this.lastSearch !== null;\r\n\t\tconst { cursor, searchString } = this.state;\r\n\t\tif (!continueLast && !searchString) {\r\n\t\t\t// Prompt for a term so we can even do this.\r\n\t\t\tthis.searchPrompt();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.state.searchInProgress) {\r\n\t\t\tif (continueLast) {\r\n\t\t\t\t// Already doing that, silly.\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.searchCancel();\r\n\t\t}\r\n\r\n\t\tif (!continueLast) {\r\n\t\t\tthis.lastSearch = {\r\n\t\t\t\tmatch: searchString,\r\n\t\t\t\tend: cursor,\r\n\t\t\t\tlast: null,\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// Set a new object so we can detect cancel uniquely.\r\n\t\tconst cancelState = { cancel: false };\r\n\t\tthis.lastSearch.cancelState = cancelState;\r\n\t\tthis.setState({ searchInProgress: true });\r\n\r\n\t\tconst { match, end, last } = this.lastSearch;\r\n\t\tthis.context.ppsspp.send({\r\n\t\t\tevent: 'memory.searchDisasm',\r\n\t\t\taddress: cursor === last ? cursor + 4 : cursor,\r\n\t\t\tend,\r\n\t\t\tmatch,\r\n\t\t}).then(({ address }) => {\r\n\t\t\tif (cancelState.cancel) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (this.lastSearch) {\r\n\t\t\t\tthis.lastSearch.last = address;\r\n\t\t\t}\r\n\r\n\t\t\tif (address !== null) {\r\n\t\t\t\tthis.gotoAddress(address);\r\n\t\t\t} else if (cursor !== end) {\r\n\t\t\t\twindow.alert('Reached the starting point of the search');\r\n\t\t\t\tthis.gotoAddress(end);\r\n\t\t\t} else {\r\n\t\t\t\twindow.alert('The specified text was not found:\\n\\n' + match);\r\n\t\t\t}\r\n\t\t}).finally(() => {\r\n\t\t\tif (!cancelState.cancel) {\r\n\t\t\t\tthis.setState({ searchInProgress: false });\r\n\t\t\t\tif (this.lastSearch) {\r\n\t\t\t\t\tthis.lastSearch.cancelState = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tupdateSearchString = (match) => {\r\n\t\tconst highlightText = match ? match.toLowerCase() : null;\r\n\t\tthis.setState({ highlightText, searchString: match });\r\n\t\tif (this.lastSearch && this.lastSearch.match !== match) {\r\n\t\t\t// Clear the search start position when changing the search.\r\n\t\t\tthis.searchCancel();\r\n\t\t\tthis.lastSearch = null;\r\n\t\t}\r\n\r\n\t\tif (match === null) {\r\n\t\t\t// Return focus to list.\r\n\t\t\tif (this.listRef.current) {\r\n\t\t\t\tthis.listRef.current.ensureCursorInView(false);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tsearchPrompt = () => {\r\n\t\tthis.updateSearchString(this.state.searchString || (this.lastSearch ? this.lastSearch.match : ''));\r\n\t\tthis.searchRef.current.focus();\r\n\t}\r\n\r\n\tsearchNext = () => {\r\n\t\tthis.searchDisasm(true);\r\n\t}\r\n\r\n\tsearchCancel = () => {\r\n\t\tif (this.lastSearch && this.lastSearch.cancelState) {\r\n\t\t\tthis.lastSearch.cancelState.cancel = true;\r\n\t\t\tthis.setState({ searchInProgress: false });\r\n\t\t\tthis.lastSearch.cancelState = null;\r\n\t\t}\r\n\t}\r\n\r\n\tgetSnapshotBeforeUpdate(prevProps, prevState) {\r\n\t\tif (this.needsOffsetFix && this.listRef.current && this.state.lines.length !== 0) {\r\n\t\t\tconst { lines } = this.state;\r\n\t\t\tconst centerAddress = lines[Math.floor(lines.length / 2)].address;\r\n\t\t\tconst top = this.listRef.current.addressBoundingTop(centerAddress);\r\n\t\t\tif (top) {\r\n\t\t\t\treturn { top, centerAddress };\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'connection': () => {\r\n\t\t\t\tif (this.context.gameStatus.started) {\r\n\t\t\t\t\tthis.updateDisasm('center');\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'cpu.stepping': () => {\r\n\t\t\t\tconst hasRange = this.state.range.start !== 0 || this.state.range.end !== 0;\r\n\t\t\t\tthis.updateDisasm(hasRange ? 'nearest' : 'center');\r\n\t\t\t},\r\n\t\t\t'cpu.setReg': (result) => {\r\n\t\t\t\t// Need to re-render if pc is changed.\r\n\t\t\t\tif (result.category === 0 && result.register === 32) {\r\n\t\t\t\t\tthis.updateDisasm('center');\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'cpu.breakpoint.add': () => {\r\n\t\t\t\tthis.updateDisasm();\r\n\t\t\t},\r\n\t\t\t'cpu.breakpoint.update': () => {\r\n\t\t\t\tthis.updateDisasm();\r\n\t\t\t},\r\n\t\t\t'cpu.breakpoint.remove': () => {\r\n\t\t\t\tthis.updateDisasm();\r\n\t\t\t},\r\n\t\t});\r\n\t\tthis.updatesCancel = false;\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tthis.searchCancel();\r\n\t\tthis.updatesCancel = true;\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState, snapshot) {\r\n\t\tconst { selectionTop, selectionBottom } = this.props;\r\n\t\tconst { range, lineHeight } = this.state;\r\n\r\n\t\tlet disasmChange = null, updateDisasmRange = null;\r\n\t\tif (this.state.wantDisplaySymbols !== prevState.wantDisplaySymbols) {\r\n\t\t\t// Keep the existing range, just update.\r\n\t\t\tdisasmChange = false;\r\n\t\t}\r\n\t\tif (this.props.currentThread !== prevProps.currentThread) {\r\n\t\t\tdisasmChange = false;\r\n\t\t}\r\n\t\tif (selectionTop !== prevProps.selectionTop || selectionBottom !== prevProps.selectionBottom) {\r\n\t\t\tif (selectionTop < range.start || selectionBottom >= range.end) {\r\n\t\t\t\tdisasmChange = 'center';\r\n\t\t\t\tupdateDisasmRange = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!disasmChange && !prevProps.setInitialPC && this.props.setInitialPC) {\r\n\t\t\tdisasmChange = 'center';\r\n\t\t\tupdateDisasmRange = true;\r\n\t\t}\r\n\t\tif (disasmChange !== null && this.props.setInitialPC) {\r\n\t\t\tthis.updateDisasm(disasmChange, updateDisasmRange);\r\n\t\t}\r\n\r\n\t\tif (lineHeight === 0) {\r\n\t\t\tconst foundLine = document.querySelector('.DisasmLine');\r\n\t\t\tif (foundLine) {\r\n\t\t\t\t// Defer for other updates.\r\n\t\t\t\tsetTimeout(() => this.setState({ lineHeight: foundLine.getBoundingClientRect().height }), 0);\r\n\t\t\t}\r\n\t\t} else if (this.ref.current) {\r\n\t\t\tconst visibleLines = Math.floor(this.ref.current.clientHeight / lineHeight);\r\n\t\t\tif (visibleLines !== this.state.visibleLines) {\r\n\t\t\t\tthis.setState({ visibleLines });\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.props.jumpMarker !== prevProps.jumpMarker) {\r\n\t\t\tthis.needsScroll = 'center';\r\n\t\t}\r\n\t\t// Always associated with a state update.\r\n\t\tif (this.needsScroll && this.listRef.current) {\r\n\t\t\tconst list = this.listRef.current;\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tlist.ensureCursorInView(this.needsScroll);\r\n\t\t\t\tthis.needsScroll = false;\r\n\t\t\t}, 0);\r\n\t\t}\r\n\r\n\t\tif (snapshot && this.listRef.current) {\r\n\t\t\tconst top = this.listRef.current.addressBoundingTop(snapshot.centerAddress);\r\n\t\t\tthis.ref.current.scrollTop -= snapshot.top - top;\r\n\t\t\tthis.needsOffsetFix = false;\r\n\t\t}\r\n\t}\r\n\r\n\tupdateDisasm(needsScroll, newRange) {\r\n\t\tthis.updatesSequence = this.updatesSequence.then(() => {\r\n\t\t\tif (this.updatesCancel) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t\treturn this.updateDisasmNow(needsScroll, newRange);\r\n\t\t});\r\n\t}\r\n\r\n\tupdateDisasmNow(needsScroll, newRange = null) {\r\n\t\tif (!this.props.setInitialPC) {\r\n\t\t\treturn Promise.resolve(null);\r\n\t\t}\r\n\r\n\t\tconst { range, visibleLines, wantDisplaySymbols: displaySymbols } = this.state;\r\n\t\tlet updateRange = newRange;\r\n\t\tif (newRange === true || (newRange === null && range.start === 0 && range.end === 0)) {\r\n\t\t\tconst minBuffer = Math.max(MIN_BUFFER, visibleLines);\r\n\t\t\tconst defaultBuffer = Math.floor(minBuffer * 1.5);\r\n\t\t\tupdateRange = {\r\n\t\t\t\taddress: this.props.selectionTop - defaultBuffer * 4,\r\n\t\t\t\tcount: defaultBuffer * 2,\r\n\t\t\t};\r\n\t\t} else if (newRange === null) {\r\n\t\t\tupdateRange = {\r\n\t\t\t\taddress: range.start,\r\n\t\t\t\tend: range.end,\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\treturn Promise.resolve(null).then(() => {\r\n\t\t\treturn this.context.ppsspp.send({\r\n\t\t\t\tevent: 'memory.disasm',\r\n\t\t\t\tthread: this.context.gameStatus.currentThread,\r\n\t\t\t\t...updateRange,\r\n\t\t\t\tdisplaySymbols,\r\n\t\t\t}).then((data) => {\r\n\t\t\t\tif (this.updatesCancel) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst { range, branchGuides, lines } = data;\r\n\t\t\t\tif (needsScroll) {\r\n\t\t\t\t\tthis.needsScroll = needsScroll;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.needsOffsetFix = true;\r\n\t\t\t\t}\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\trange,\r\n\t\t\t\t\tbranchGuides: this.cleanupBranchGuides(branchGuides),\r\n\t\t\t\t\tlines,\r\n\t\t\t\t\tdisplaySymbols,\r\n\t\t\t\t});\r\n\t\t\t}, (err) => {\r\n\t\t\t\tif (!this.updatesCancel) {\r\n\t\t\t\t\tthis.setState({\r\n\t\t\t\t\t\trange: { start: 0, end: 0 },\r\n\t\t\t\t\t\tbranchGuides: [],\r\n\t\t\t\t\t\tlines: [],\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tcleanupBranchGuides(branchGuides) {\r\n\t\t// TODO: Temporary (?) workaround for a bug with duplicate branch guides.\r\n\t\tconst unique = new Map();\r\n\t\tbranchGuides.forEach((guide) => {\r\n\t\t\tconst key = String(guide.top) + String(guide.bottom) + guide.direction;\r\n\t\t\tunique.set(key, guide);\r\n\t\t});\r\n\t\treturn [...unique.values()];\r\n\t}\r\n\r\n\tonDoubleClick = (ev, data) => {\r\n\t\tthis.toggleBreakpoint(data.line);\r\n\t}\r\n\r\n\tapplyScroll = (dist) => {\r\n\t\tthis.ref.current.scrollTop += dist * this.state.lineHeight;\r\n\t}\r\n\r\n\tonScroll(ev) {\r\n\t\tthis.updatesSequence = this.updatesSequence.then(() => {\r\n\t\t\tif (this.updatesCancel) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tconst { bufferTop, bufferBottom } = this.bufferRange();\r\n\t\t\tconst minBuffer = Math.max(MIN_BUFFER, this.state.visibleLines);\r\n\t\t\tconst maxBuffer = Math.max(MAX_BUFFER, this.state.visibleLines * 5);\r\n\t\t\tlet { start, end } = this.state.range;\r\n\r\n\t\t\tif (bufferTop < minBuffer) {\r\n\t\t\t\tstart -= minBuffer * 4;\r\n\t\t\t} else if (bufferTop > maxBuffer) {\r\n\t\t\t\tstart += Math.max(minBuffer, bufferTop - maxBuffer) * 4;\r\n\t\t\t}\r\n\r\n\t\t\tif (bufferBottom < minBuffer) {\r\n\t\t\t\tend += minBuffer * 4;\r\n\t\t\t} else if (bufferBottom > maxBuffer) {\r\n\t\t\t\tend -= Math.max(minBuffer, bufferBottom - maxBuffer) * 4;\r\n\t\t\t}\r\n\r\n\t\t\tif (start !== this.state.range.start || end !== this.state.range.end) {\r\n\t\t\t\treturn this.updateDisasmNow(false, { address: start, end });\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t});\r\n\t}\r\n\r\n\tbufferRange() {\r\n\t\tconst { scrollHeight, scrollTop, clientHeight } = this.ref.current;\r\n\t\tconst bufferTop = scrollTop / this.state.lineHeight;\r\n\t\tconst bufferBottom = (scrollHeight - scrollTop - clientHeight) / this.state.lineHeight;\r\n\t\tconst visibleEachDirection = Math.floor((this.state.visibleLines - 1) / 2);\r\n\r\n\t\treturn {\r\n\t\t\tbufferTop: bufferTop + visibleEachDirection,\r\n\t\t\tbufferBottom: bufferBottom + visibleEachDirection,\r\n\t\t};\r\n\t}\r\n\r\n\tstatic getDerivedStateFromProps(nextProps, prevState) {\r\n\t\tconst { selectionTop, selectionBottom } = nextProps;\r\n\t\tif (prevState.cursor < selectionTop || prevState.cursor > selectionBottom) {\r\n\t\t\tlet cursor = selectionTop;\r\n\t\t\tif (prevState.lines.length) {\r\n\t\t\t\t// Snap to in case we goto an address in the middle\r\n\t\t\t\tconst line = prevState.lines.find(l => l.address <= selectionTop && l.address + l.addressSize > selectionTop);\r\n\t\t\t\tcursor = line ? line.address : cursor;\r\n\t\t\t}\r\n\t\t\treturn { cursor };\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n}\r\n\r\nDisasm.propTypes = {\r\n\tselectionTop: PropTypes.number,\r\n\tselectionBottom: PropTypes.number,\r\n\tpc: PropTypes.number,\r\n\tsetInitialPC: PropTypes.bool.isRequired,\r\n\tcurrentThread: PropTypes.number,\r\n\r\n\tupdateSelection: PropTypes.func.isRequired,\r\n\tpromptGoto: PropTypes.func.isRequired,\r\n};\r\n\r\nDisasm.contextType = DebuggerContext;\r\n\r\nexport default Disasm;\r\n","import { PureComponent } from 'react';\r\nimport DebuggerContext, { DebuggerContextValues } from '../DebuggerContext';\r\nimport PropTypes from 'prop-types';\r\nimport BreakpointModal from './BreakpointModal';\r\nimport listeners from '../../utils/listeners.js';\r\nimport './DisasmButtons.css';\r\n\r\nclass DisasmButtons extends PureComponent {\r\n\tstate = {\r\n\t\tbreakpointModalOpen: false,\r\n\t\tconnected: false,\r\n\t\tlastThread: '',\r\n\t\tthreads: [],\r\n\t};\r\n\t/**\r\n\t * @type {DebuggerContextValues}\r\n\t */\r\n\tcontext;\r\n\tlisteners_;\r\n\r\n\trender() {\r\n\t\tconst { started, paused, stepping } = this.context.gameStatus;\r\n\t\tconst disabled = !started || !stepping || paused;\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"DisasmButtons\">\r\n\t\t\t\t<div className=\"DisasmButtons__group DisasmButtons__nav\">\r\n\t\t\t\t\t<button type=\"button\" onClick={this.props.showNavTray}>Nav</button>\r\n\t\t\t\t\t<span className=\"DisasmButtons__spacer\"></span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"DisasmButtons__group\">\r\n\t\t\t\t\t<button type=\"button\" disabled={!started || paused} onClick={this.handleGoBreak}>\r\n\t\t\t\t\t\t{stepping || !started ? 'Go' : 'Break'}\r\n\t\t\t\t\t</button>\r\n\t\t\t\t\t<span className=\"DisasmButtons__spacer\"></span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"DisasmButtons__group\">\r\n\t\t\t\t\t<button type=\"button\" disabled={disabled} onClick={this.handleStepInto}>Step Into</button>\r\n\t\t\t\t\t<button type=\"button\" disabled={disabled} onClick={this.handleStepOver}>Step Over</button>\r\n\t\t\t\t\t<button type=\"button\" disabled={disabled} onClick={this.handleStepOut}>Step Out</button>\r\n\t\t\t\t\t<span className=\"DisasmButtons__spacer\"></span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"DisasmButtons__group\">\r\n\t\t\t\t\t<button type=\"button\" disabled={disabled} onClick={this.handleNextHLE}>Next HLE</button>\r\n\t\t\t\t\t<span className=\"DisasmButtons__spacer\"></span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"DisasmButtons__group\">\r\n\t\t\t\t\t<button type=\"button\" onClick={this.handleBreakpointOpen} disabled={!started}>Breakpoint</button>\r\n\t\t\t\t\t<span className=\"DisasmButtons__spacer\"></span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"DisasmButtons__group\">\r\n\t\t\t\t\t<span className=\"DisasmButtons__thread-list\">\r\n\t\t\t\t\t\tThread: {this.renderThreadList()}\r\n\t\t\t\t\t</span>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<BreakpointModal\r\n\t\t\t\t\tisOpen={this.state.breakpointModalOpen}\r\n\t\t\t\t\tonClose={this.handleBreakpointClose}\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderThreadList() {\r\n\t\tif (this.state.threads.length === 0) {\r\n\t\t\treturn '(none)';\r\n\t\t}\r\n\t\treturn (\r\n\t\t\t<select onChange={this.handleThreadSelect} value={this.context.gameStatus.currentThread || this.state.lastThread}>\r\n\t\t\t\t{this.state.threads.map(thread => this.renderThread(thread))}\r\n\t\t\t</select>\r\n\t\t);\r\n\t}\r\n\r\n\trenderThread(thread) {\r\n\t\tconst classes = 'DisasmButtons__thread' + (thread.isCurrent ? ' DisasmButtons__thread--current' : '');\r\n\t\treturn (\r\n\t\t\t<option key={thread.id} value={thread.id} className={classes}>\r\n\t\t\t\t{thread.name}{thread.isCurrent ? ' (current)' : ''}\r\n\t\t\t</option>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'connection.change': (connected) => this.setState({ connected }),\r\n\t\t\t'cpu.stepping': () => this.updateThreadList(true),\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (!prevState.connected && this.state.connected) {\r\n\t\t\tthis.updateThreadList(this.context.gameStatus.currentThread === undefined);\r\n\t\t}\r\n\t}\r\n\r\n\tupdateThreadList(resetCurrentThread) {\r\n\t\tif (!this.state.connected) {\r\n\t\t\t// This avoids a duplicate update during initial connect.\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.context.ppsspp.send({\r\n\t\t\tevent: 'hle.thread.list',\r\n\t\t}).then(({ threads }) => {\r\n\t\t\tthis.setState({ threads });\r\n\t\t\tif (resetCurrentThread) {\r\n\t\t\t\tconst currentThread = threads.find(th => th.isCurrent);\r\n\t\t\t\tif (currentThread && currentThread.id !== this.context.gameStatus.currentThread) {\r\n\t\t\t\t\tthis.props.updateCurrentThread(currentThread.id);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, () => {\r\n\t\t\tthis.setState({ threads: [] });\r\n\t\t});\r\n\t}\r\n\r\n\thandleGoBreak = () => {\r\n\t\tif (this.context.gameStatus.stepping) {\r\n\t\t\tthis.props.updateCurrentThread(undefined);\r\n\t\t}\r\n\t\tthis.context.ppsspp.send({\r\n\t\t\tevent: this.context.gameStatus.stepping ? 'cpu.resume' : 'cpu.stepping',\r\n\t\t}).catch(() => {\r\n\t\t\t// Already logged, let's assume the parent will have marked it disconnected/not started by now.\r\n\t\t});\r\n\t}\r\n\r\n\thandleStepInto = () => {\r\n\t\tthis.props.updateCurrentThread(undefined);\r\n\t\tthis.context.ppsspp.send({\r\n\t\t\tevent: 'cpu.stepInto',\r\n\t\t\tthread: this.context.gameStatus.currentThread,\r\n\t\t}).catch(() => {\r\n\t\t\t// Already logged, let's assume the parent will have marked it disconnected/not started by now.\r\n\t\t});\r\n\t}\r\n\r\n\thandleStepOver = () => {\r\n\t\tthis.props.updateCurrentThread(undefined);\r\n\t\tthis.context.ppsspp.send({\r\n\t\t\tevent: 'cpu.stepOver',\r\n\t\t\tthread: this.context.gameStatus.currentThread,\r\n\t\t}).catch(() => {\r\n\t\t\t// Already logged, let's assume the parent will have marked it disconnected/not started by now.\r\n\t\t});\r\n\t}\r\n\r\n\thandleStepOut = () => {\r\n\t\tconst threadID = this.context.gameStatus.currentThread;\r\n\t\tthis.props.updateCurrentThread(undefined);\r\n\t\tthis.context.ppsspp.send({\r\n\t\t\tevent: 'cpu.stepOut',\r\n\t\t\tthread: this.context.gameStatus.currentThread,\r\n\t\t}).catch(() => {\r\n\t\t\t// This might fail if they aren't inside a function call on this thread, so restore the thread.\r\n\t\t\tthis.props.updateCurrentThread(threadID);\r\n\t\t});\r\n\t}\r\n\r\n\thandleNextHLE = () => {\r\n\t\tthis.props.updateCurrentThread(undefined);\r\n\t\tthis.context.ppsspp.send({\r\n\t\t\tevent: 'cpu.nextHLE',\r\n\t\t}).catch(() => {\r\n\t\t\t// Already logged, let's assume the parent will have marked it disconnected/not started by now.\r\n\t\t});\r\n\t}\r\n\r\n\thandleThreadSelect = (ev) => {\r\n\t\tconst currentThread = this.state.threads.find(th => th.id === Number(ev.target.value));\r\n\t\tif (currentThread) {\r\n\t\t\tthis.props.updateCurrentThread(currentThread.id, currentThread.pc);\r\n\t\t}\r\n\t}\r\n\r\n\thandleBreakpointOpen = () => {\r\n\t\tthis.setState({ breakpointModalOpen: true });\r\n\t}\r\n\r\n\thandleBreakpointClose = () => {\r\n\t\tthis.setState({ breakpointModalOpen: false });\r\n\t}\r\n\r\n\tstatic getDerivedStateFromProps(nextProps, prevState) {\r\n\t\tlet update = null;\r\n\t\tif (nextProps.currentThread && nextProps.currentThread !== prevState.lastThread) {\r\n\t\t\tupdate = { ...update, lastThread: nextProps.currentThread || '' };\r\n\t\t}\r\n\t\tif (nextProps.stepping || nextProps.started) {\r\n\t\t\tupdate = { ...update, connected: true };\r\n\t\t}\r\n\t\tif (!nextProps.started && prevState.threads.length) {\r\n\t\t\tupdate = { ...update, threads: [] };\r\n\t\t}\r\n\t\treturn update;\r\n\t}\r\n}\r\n\r\nDisasmButtons.propTypes = {\r\n\tstarted: PropTypes.bool.isRequired,\r\n\tstepping: PropTypes.bool.isRequired,\r\n\tcurrentThread: PropTypes.number,\r\n\tshowNavTray: PropTypes.func.isRequired,\r\n\r\n\tupdateCurrentThread: PropTypes.func.isRequired,\r\n};\r\n\r\nDisasmButtons.contextType = DebuggerContext;\r\n\r\nexport default DisasmButtons;\r\n","import { createRef, PureComponent } from 'react';\r\nimport DebuggerContext, { DebuggerContextValues } from '../DebuggerContext';\r\nimport PropTypes from 'prop-types';\r\nimport './GotoBox.css';\r\n\r\nclass GotoBox extends PureComponent {\r\n\tstate = {\r\n\t\taddress: '',\r\n\t};\r\n\t/**\r\n\t * @type {DebuggerContextValues}\r\n\t */\r\n\tcontext;\r\n\tref;\r\n\tid;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.ref = createRef();\r\n\t\tthis.id = 'GotoBox__address--' + Math.random().toString(36).substr(2, 9);\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<form action=\"#\" className=\"GotoBox\" onSubmit={this.handleSubmit}>\r\n\t\t\t\t<label className=\"GotoBox__label\" htmlFor={this.id}>Go to:</label>\r\n\t\t\t\t<input ref={this.ref}\r\n\t\t\t\t\ttype=\"text\" id={this.id}\r\n\t\t\t\t\tclassName=\"GotoBox__address\"\r\n\t\t\t\t\tvalue={this.state.address} onChange={this.handleChange}\r\n\t\t\t\t\ttitle=\"Hexadecimal address or expression, enter to submit\"\r\n\t\t\t\t\tautoComplete=\"off\"\r\n\t\t\t\t/>\r\n\t\t\t\t{this.renderPCButtons()}\r\n\t\t\t</form>\r\n\t\t);\r\n\t}\r\n\r\n\trenderPCButtons() {\r\n\t\tif (!this.includePC) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tconst disabled = !this.context.gameStatus.started;\r\n\t\treturn (\r\n\t\t\t<>\r\n\t\t\t\t<button type=\"button\" className=\"GotoBox__button\" onClick={this.handlePC} disabled={disabled}>PC</button>\r\n\t\t\t\t<button type=\"button\" className=\"GotoBox__button\" onClick={this.handleRA} disabled={disabled}>RA</button>\r\n\t\t\t</>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (this.props.promptGotoMarker !== prevProps.promptGotoMarker) {\r\n\t\t\tthis.ref.current.focus();\r\n\t\t\tthis.ref.current.select();\r\n\t\t}\r\n\t}\r\n\r\n\tjumpToReg(name) {\r\n\t\tthis.context.ppsspp.send({\r\n\t\t\tevent: 'cpu.getReg',\r\n\t\t\tname,\r\n\t\t}).then((result) => {\r\n\t\t\tif (this.context.gameStatus.started) {\r\n\t\t\t\tthis.props.gotoAddress(result.uintValue);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\thandleChange = (ev) => {\r\n\t\tthis.setState({ address: ev.target.value });\r\n\t}\r\n\r\n\thandleSubmit = (ev) => {\r\n\t\tif (this.context.gameStatus.started) {\r\n\t\t\tthis.context.ppsspp.send({\r\n\t\t\t\tevent: 'cpu.evaluate',\r\n\t\t\t\tthread: this.context.gameStatus.currentThread,\r\n\t\t\t\texpression: this.state.address,\r\n\t\t\t}).then(({ uintValue }) => {\r\n\t\t\t\tif (this.context.gameStatus.started) {\r\n\t\t\t\t\tthis.props.gotoAddress(uintValue);\r\n\t\t\t\t}\r\n\t\t\t}, err => {\r\n\t\t\t\t// Probably a bad reference.\r\n\t\t\t\tthis.ref.current.focus();\r\n\t\t\t\tthis.ref.current.select();\r\n\t\t\t});\r\n\t\t}\r\n\t\tev.preventDefault();\r\n\t}\r\n\r\n\thandlePC = (ev) => {\r\n\t\tthis.jumpToReg('pc');\r\n\t}\r\n\r\n\thandleRA = (ev) => {\r\n\t\tthis.jumpToReg('ra');\r\n\t}\r\n}\r\n\r\nGotoBox.propTypes = {\r\n\tincludePC: PropTypes.bool.isRequired,\r\n\tpromptGotoMarker: PropTypes.any,\r\n\tgotoAddress: PropTypes.func.isRequired,\r\n};\r\n\r\nGotoBox.contextType = DebuggerContext;\r\n\r\nexport default GotoBox;\r\n","import { PureComponent } from 'react';\r\nimport DebuggerContext, { DebuggerContextValues } from '../DebuggerContext';\r\nimport PropTypes from 'prop-types';\r\nimport { AutoSizer, List } from 'react-virtualized';\r\nimport listeners from '../../utils/listeners.js';\r\nimport 'react-virtualized/styles.css';\r\nimport './FuncList.css';\r\n\r\nclass FuncList extends PureComponent {\r\n\tstate = {\r\n\t\tconnected: false,\r\n\t\t// Lots of functions can take a while...\r\n\t\tloading: true,\r\n\t\trowHeight: null,\r\n\t\tfunctions: [],\r\n\t\tfilter: '',\r\n\t\tfilteredFunctions: [],\r\n\t};\r\n\t/**\r\n\t * @type {DebuggerContextValues}\r\n\t */\r\n\tcontext;\r\n\tlisteners_;\r\n\r\n\trender() {\r\n\t\tconst { filter } = this.state;\r\n\t\treturn (\r\n\t\t\t<div className=\"FuncList\">\r\n\t\t\t\t<input type=\"search\" className=\"FuncList__search\" value={filter} onChange={this.handleFilter} />\r\n\t\t\t\t{this.renderList()}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderList() {\r\n\t\tconst { filter, loading, rowHeight } = this.state;\r\n\t\tif (loading || !rowHeight) {\r\n\t\t\treturn <div className=\"FuncList__loading\">Loading...</div>;\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"FuncList__listing\" onClick={this.handleClick}>\r\n\t\t\t\t<AutoSizer filter={filter}>{this.renderSizedList}</AutoSizer>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderSizedList = ({ height, width }) => {\r\n\t\tconst { filter, filteredFunctions, rowHeight } = this.state;\r\n\t\treturn (\r\n\t\t\t<List\r\n\t\t\t\theight={height}\r\n\t\t\t\trowHeight={rowHeight}\r\n\t\t\t\trowRenderer={this.renderFunc}\r\n\t\t\t\twidth={width}\r\n\t\t\t\trowCount={filteredFunctions.length}\r\n\t\t\t\tfilter={filter}\r\n\t\t\t/>\r\n\t\t);\r\n\t}\r\n\r\n\trenderFunc = ({ index, key, style }) => {\r\n\t\tconst func = this.state.filteredFunctions[index];\r\n\t\treturn (\r\n\t\t\t<div key={key + '-' + func.address} style={style}>\r\n\t\t\t\t<button type=\"button\" data-address={func.address}>{func.name}</button>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'connection.change': (connected) => this.setState({ connected }),\r\n\t\t\t'game.start': () => this.updateList(),\r\n\t\t});\r\n\t\tif (this.state.connected) {\r\n\t\t\tthis.updateList();\r\n\t\t}\r\n\t\tif (!this.state.rowHeight) {\r\n\t\t\tsetTimeout(() => this.measureHeight(), 0);\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (!prevState.connected && this.state.connected) {\r\n\t\t\tthis.updateList();\r\n\t\t}\r\n\t\tif (!this.state.rowHeight) {\r\n\t\t\tsetTimeout(() => this.measureHeight(), 0);\r\n\t\t}\r\n\t}\r\n\r\n\tmeasureHeight() {\r\n\t\tconst node = document.querySelector('.FuncList__loading');\r\n\t\tif (node) {\r\n\t\t\tconst rowHeight = node.getBoundingClientRect().height;\r\n\t\t\tthis.setState({ rowHeight });\r\n\t\t}\r\n\t}\r\n\r\n\tupdateList() {\r\n\t\tif (!this.state.connected) {\r\n\t\t\t// This avoids a duplicate update during initial connect.\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!this.state.loading && this.state.functions.length === 0) {\r\n\t\t\tthis.setState({ loading: true });\r\n\t\t}\r\n\r\n\t\tthis.context.ppsspp.send({\r\n\t\t\tevent: 'hle.func.list',\r\n\t\t}).then(({ functions }) => {\r\n\t\t\tfunctions.sort((a, b) => a.name.localeCompare(b.name));\r\n\t\t\tthis.setState(prevState => ({\r\n\t\t\t\tfunctions,\r\n\t\t\t\tfilteredFunctions: this.applyFilter(functions, prevState.filter),\r\n\t\t\t\tloading: false,\r\n\t\t\t}));\r\n\t\t}, () => {\r\n\t\t\tthis.setState({ functions: [], filteredFunctions: [], loading: false });\r\n\t\t});\r\n\t}\r\n\r\n\tapplyFilter(functions, filter) {\r\n\t\tif (filter === '') {\r\n\t\t\treturn functions;\r\n\t\t}\r\n\t\tconst match = filter.toLowerCase();\r\n\t\treturn functions.filter(func => func.name.toLowerCase().indexOf(match) !== -1);\r\n\t}\r\n\r\n\thandleFilter = (ev) => {\r\n\t\tconst filter = ev.target.value;\r\n\t\tthis.setState(prevState => ({\r\n\t\t\tfilter,\r\n\t\t\tfilteredFunctions: this.applyFilter(prevState.functions, filter),\r\n\t\t}));\r\n\t}\r\n\r\n\thandleClick = (ev) => {\r\n\t\tconst { address } = ev.target.dataset;\r\n\t\tthis.props.gotoDisasm(Number(address));\r\n\t\tev.preventDefault();\r\n\t}\r\n\r\n\tstatic getDerivedStateFromProps(nextProps, prevState) {\r\n\t\tlet update = null;\r\n\t\tif (nextProps.started) {\r\n\t\t\tupdate = { ...update, connected: true };\r\n\t\t}\r\n\t\tif (!nextProps.started && prevState.functions.length) {\r\n\t\t\tupdate = { ...update, functions: [], filteredFunctions: [] };\r\n\t\t}\r\n\t\treturn update;\r\n\t}\r\n}\r\n\r\nFuncList.propTypes = {\r\n\tstarted: PropTypes.bool,\r\n\tgotoDisasm: PropTypes.func.isRequired,\r\n};\r\n\r\nFuncList.contextType = DebuggerContext;\r\n\r\nexport default FuncList;\r\n","import { createRef, PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { ContextMenuTrigger } from 'react-contextmenu';\r\nimport { toString08X } from '../../utils/format';\r\nimport { ensureInView, hasContextMenu } from '../../utils/dom';\r\nimport classNames from 'clsx';\r\n\r\nclass RegList extends PureComponent {\r\n\tstate = {\r\n\t\tcursor: 0,\r\n\t};\r\n\tcursorRef;\r\n\tneedsScroll = false;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.cursorRef = createRef();\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<dl>\r\n\t\t\t\t{this.props.registerNames.map((name, reg) => {\r\n\t\t\t\t\treturn this.renderReg(name, reg);\r\n\t\t\t\t})}\r\n\t\t\t</dl>\r\n\t\t);\r\n\t}\r\n\r\n\trenderReg(name, reg) {\r\n\t\tconst mapData = (props) => {\r\n\t\t\treturn { cat: this.props.id, reg, value: this.format(reg) };\r\n\t\t};\r\n\t\tconst attributes = {\r\n\t\t\tonDoubleClick: (ev) => this.onDoubleClick(ev, mapData()),\r\n\t\t\tonMouseDown: (ev) => this.setState({ cursor: reg }),\r\n\t\t\tonKeyDown: (ev) => this.onKeyDown(ev),\r\n\t\t\ttabIndex: 0,\r\n\t\t};\r\n\t\tconst ddClasses = {\r\n\t\t\t'RegPanel__item--changed': this.changed(reg),\r\n\t\t\t'RegPanel__item--selected': this.state.cursor === reg,\r\n\t\t};\r\n\t\tconst ref = this.state.cursor === reg ? this.cursorRef : undefined;\r\n\r\n\t\treturn (\r\n\t\t\t<ContextMenuTrigger id={this.props.contextmenu} renderTag=\"a\" attributes={attributes} collect={mapData} holdToDisplay={-1} key={reg}>\r\n\t\t\t\t<dt>{name}</dt>\r\n\t\t\t\t<dd className={classNames(ddClasses)} ref={ref}>\r\n\t\t\t\t\t{this.format(reg)}\r\n\t\t\t\t</dd>\r\n\t\t\t</ContextMenuTrigger>\r\n\t\t);\r\n\t}\r\n\r\n\tformat(reg) {\r\n\t\tif (this.props.id === 0) {\r\n\t\t\treturn toString08X(this.props.uintValues[reg]);\r\n\t\t} else {\r\n\t\t\treturn this.props.floatValues[reg];\r\n\t\t}\r\n\t}\r\n\r\n\tchanged(reg) {\r\n\t\treturn this.props.uintValues[reg] !== this.props.uintValuesLast[reg];\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\t// Always associated with a state update.\r\n\t\tif (this.needsScroll && this.cursorRef.current) {\r\n\t\t\tconst triggerNode = this.cursorRef.current.parentNode;\r\n\t\t\tensureInView(triggerNode, { block: 'nearest' });\r\n\t\t\ttriggerNode.focus();\r\n\t\t\tthis.needsScroll = false;\r\n\t\t}\r\n\t}\r\n\r\n\tonDoubleClick = (ev, data) => {\r\n\t\tif (ev.button === 0) {\r\n\t\t\tthis.props.onDoubleClick(ev, data);\r\n\t\t}\r\n\t}\r\n\r\n\tonKeyDown(ev) {\r\n\t\tif (hasContextMenu()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (ev.key === 'ArrowUp' && this.state.cursor > 0) {\r\n\t\t\tthis.needsScroll = true;\r\n\t\t\tthis.setState(prevState => ({ cursor: prevState.cursor - 1 }));\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t\tif (ev.key === 'ArrowDown' && this.state.cursor < this.props.registerNames.length - 1) {\r\n\t\t\tthis.needsScroll = true;\r\n\t\t\tthis.setState(prevState => ({ cursor: prevState.cursor + 1 }));\r\n\t\t\tev.preventDefault();\r\n\t\t}\r\n\t}\r\n}\r\n\r\nRegList.propTypes = {\r\n\tid: PropTypes.number.isRequired,\r\n\tcontextmenu: PropTypes.string.isRequired,\r\n\tonDoubleClick: PropTypes.func.isRequired,\r\n\tregisterNames: PropTypes.arrayOf(PropTypes.string).isRequired,\r\n\tuintValues: PropTypes.arrayOf(PropTypes.number).isRequired,\r\n\tfloatValues: PropTypes.arrayOf(PropTypes.string).isRequired,\r\n\tuintValuesLast: PropTypes.arrayOf(PropTypes.number).isRequired,\r\n\tfloatValuesLast: PropTypes.arrayOf(PropTypes.string).isRequired,\r\n};\r\n\r\nexport default RegList;\r\n","import { PureComponent } from 'react';\r\nimport DebuggerContext, { DebuggerContextValues } from '../DebuggerContext';\r\nimport PropTypes from 'prop-types';\r\nimport { ContextMenu, MenuItem } from 'react-contextmenu';\r\nimport { Tab, Tabs, TabList, TabPanel } from 'react-tabs';\r\nimport RegList from './RegList';\r\nimport listeners from '../../utils/listeners.js';\r\nimport { copyText } from '../../utils/clipboard';\r\nimport './RegPanel.css';\r\nimport '../ext/react-contextmenu.css';\r\nimport '../ext/react-tabs.css';\r\n\r\nclass RegPanel extends PureComponent {\r\n\tstate = {\r\n\t\tcategories: [],\r\n\t};\r\n\t/**\r\n\t * @type {DebuggerContextValues}\r\n\t */\r\n\tcontext;\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div id=\"RegPanel\">\r\n\t\t\t\t{this.renderTabs()}\r\n\t\t\t\t{this.renderContextMenu()}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderTabs() {\r\n\t\tconst { categories } = this.state;\r\n\t\t// Seems react-tabs is buggy when tabs are initially empty.\r\n\t\tif (categories.length === 0) {\r\n\t\t\treturn '';\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<Tabs>\r\n\t\t\t\t<TabList>\r\n\t\t\t\t\t{categories.map(c => <Tab key={c.id}>{c.name}</Tab>)}\r\n\t\t\t\t</TabList>\r\n\t\t\t\t{categories.map(c => (\r\n\t\t\t\t\t<TabPanel key={c.id}>\r\n\t\t\t\t\t\t<RegList contextmenu=\"reglist\" onDoubleClick={this.handleChangeReg} {...c} />\r\n\t\t\t\t\t</TabPanel>\r\n\t\t\t\t))}\r\n\t\t\t</Tabs>\r\n\t\t);\r\n\t}\r\n\r\n\trenderContextMenu() {\r\n\t\tconst disabled = !this.context.gameStatus.stepping;\r\n\t\treturn (\r\n\t\t\t<ContextMenu id=\"reglist\">\r\n\t\t\t\t<MenuItem onClick={this.handleViewMemory}>\r\n\t\t\t\t\tGo to in Memory View\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem onClick={this.handleViewDisassembly}>\r\n\t\t\t\t\tGo to in Disassembly\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem divider />\r\n\t\t\t\t<MenuItem onClick={this.handleCopyReg}>\r\n\t\t\t\t\tCopy Value\r\n\t\t\t\t</MenuItem>\r\n\t\t\t\t<MenuItem disabled={disabled} onClick={this.handleChangeReg}>\r\n\t\t\t\t\tChange...\r\n\t\t\t\t</MenuItem>\r\n\t\t\t</ContextMenu>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'connection': () => this.updateRegs(false),\r\n\t\t\t'cpu.stepping': () => this.updateRegs(false),\r\n\t\t\t'cpu.setReg': (result) => this.updateReg(result),\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps, prevState) {\r\n\t\tif (this.props.currentThread && this.props.currentThread !== prevProps.currentThread) {\r\n\t\t\tthis.updateRegs(true);\r\n\t\t}\r\n\t}\r\n\r\n\thandleViewMemory = (ev, data) => {\r\n\t\t// TODO\r\n\t\tconsole.log(data);\r\n\t}\r\n\r\n\thandleViewDisassembly = (ev, data) => {\r\n\t\tconst uintValue = this.state.categories[data.cat].uintValues[data.reg];\r\n\t\tthis.props.gotoDisasm(uintValue);\r\n\t}\r\n\r\n\thandleCopyReg = (ev, data, regNode) => {\r\n\t\tcopyText(data.value);\r\n\t}\r\n\r\n\thandleChangeReg = (ev, data, regNode) => {\r\n\t\tconst prevValue = (data.cat === 0 ? '0x' : '') + data.value;\r\n\t\tconst registerName = this.state.categories[data.cat].registerNames[data.reg];\r\n\r\n\t\tconst newValue = window.prompt('New value for ' + registerName, prevValue);\r\n\t\tif (newValue === null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst packet = {\r\n\t\t\tevent: 'cpu.setReg',\r\n\t\t\tthread: this.context.gameStatus.currentThread,\r\n\t\t\tcategory: data.cat,\r\n\t\t\tregister: data.reg,\r\n\t\t\tvalue: newValue,\r\n\t\t};\r\n\r\n\t\t// The result is automatically listened for.\r\n\t\tthis.context.ppsspp.send(packet).catch((err) => {\r\n\t\t\twindow.alert(err);\r\n\t\t});\r\n\t}\r\n\r\n\tupdateRegs(keepLast) {\r\n\t\tthis.context.ppsspp.send({\r\n\t\t\tevent: 'cpu.getAllRegs',\r\n\t\t\tthread: this.context.gameStatus.currentThread,\r\n\t\t}).then((result) => {\r\n\t\t\tlet { categories } = result;\r\n\t\t\t// Add values for change tracking.\r\n\t\t\tconst hasPrev = this.state.categories.length !== 0;\r\n\t\t\tfor (let cat of categories) {\r\n\t\t\t\tconst prevCat = hasPrev ? this.state.categories[cat.id] : null;\r\n\t\t\t\tcat.uintValuesLast = hasPrev ? (keepLast ? prevCat.uintValuesLast : prevCat.uintValues) : cat.uintValues;\r\n\t\t\t\tcat.floatValuesLast = hasPrev ? (keepLast ? prevCat.floatValuesLast : prevCat.floatValues) : cat.floatValues;\r\n\t\t\t}\r\n\t\t\tthis.setState({ categories });\r\n\t\t}, (err) => {\r\n\t\t\t// Leave regs alone.\r\n\t\t\tconsole.error(err);\r\n\t\t});\r\n\t}\r\n\r\n\tupdateReg(result) {\r\n\t\tconst replaceCopy = (arr, index, item) => {\r\n\t\t\treturn arr.slice(0, index).concat([item]).concat(arr.slice(index + 1));\r\n\t\t};\r\n\r\n\t\tthis.setState(prevState => ({\r\n\t\t\tcategories: prevState.categories.map((cat) => {\r\n\t\t\t\tif (cat.id === result.category) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\t...cat,\r\n\t\t\t\t\t\t// Keep values from last time, until next stepping.\r\n\t\t\t\t\t\tuintValuesLast: cat.uintValuesLast,\r\n\t\t\t\t\t\tfloatValuesLast: cat.floatValuesLast,\r\n\t\t\t\t\t\tuintValues: replaceCopy(cat.uintValues, result.register, result.uintValue),\r\n\t\t\t\t\t\tfloatValues: replaceCopy(cat.floatValues, result.register, result.floatValue),\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t\treturn cat;\r\n\t\t\t}),\r\n\t\t}));\r\n\t}\r\n}\r\n\r\nRegPanel.propTypes = {\r\n\tgotoDisasm: PropTypes.func.isRequired,\r\n\tcurrentThread: PropTypes.number,\r\n};\r\n\r\nRegPanel.contextType = DebuggerContext;\r\n\r\nexport default RegPanel;\r\n","import { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport FitModal from '../common/FitModal';\r\nimport listeners from '../../utils/listeners';\r\nimport { toString08X } from '../../utils/format';\r\nimport '../ext/react-modal.css';\r\nimport './VisualizeVFPU.css';\r\n\r\n// TODO: Consider using react-new-window for desktop?\r\n\r\nclass VisualizeVFPU extends PureComponent {\r\n\tstate = {\r\n\t\tcategories: [],\r\n\t\tformat: 'float',\r\n\t};\r\n\tlisteners_;\r\n\r\n\trender() {\r\n\t\tconst { categories, format } = this.state;\r\n\t\tif (categories.length < 3) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tlet matrices = [];\r\n\t\tfor (let m = 0; m < categories[2].uintValues.length / 16; ++m) {\r\n\t\t\tmatrices.push(this.renderMatrix(m));\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<FitModal contentLabel=\"VFPU\" isOpen={this.props.isOpen} onClose={this.props.onClose}>\r\n\t\t\t\t<h2>VFPU Registers</h2>\r\n\t\t\t\t<div className=\"VisualizeVFPU__list\">\r\n\t\t\t\t\t{matrices}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"VisualizeVFPU__format\">\r\n\t\t\t\t\tDisplay as:\r\n\t\t\t\t\t<label><input type=\"radio\" checked={format === 'float'} value=\"float\" onChange={this.handleFormat} /> Float</label>\r\n\t\t\t\t\t<label><input type=\"radio\" checked={format === 'uint'} value=\"uint\" onChange={this.handleFormat} /> Hex</label>\r\n\t\t\t\t</div>\r\n\t\t\t</FitModal>\r\n\t\t);\r\n\t}\r\n\r\n\trenderMatrix(m) {\r\n\t\treturn (\r\n\t\t\t<table className=\"VisualizeVFPU__matrix\" key={m}>\r\n\t\t\t\t<thead>\r\n\t\t\t\t\t<tr>\r\n\t\t\t\t\t\t<th className=\"VisualizeVFPU__name\">M{m}00</th>\r\n\t\t\t\t\t\t<th className=\"VisualizeVFPU__row-header\">R{m}00</th>\r\n\t\t\t\t\t\t<th className=\"VisualizeVFPU__row-header\">R{m}01</th>\r\n\t\t\t\t\t\t<th className=\"VisualizeVFPU__row-header\">R{m}02</th>\r\n\t\t\t\t\t\t<th className=\"VisualizeVFPU__row-header\">R{m}03</th>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</thead>\r\n\t\t\t\t<tbody>\r\n\t\t\t\t\t{this.renderColumn(m, 0)}\r\n\t\t\t\t\t{this.renderColumn(m, 1)}\r\n\t\t\t\t\t{this.renderColumn(m, 2)}\r\n\t\t\t\t\t{this.renderColumn(m, 3)}\r\n\t\t\t\t</tbody>\r\n\t\t\t</table>\r\n\t\t);\r\n\t}\r\n\r\n\trenderColumn(m, c) {\r\n\t\treturn (\r\n\t\t\t<tr key={c}>\r\n\t\t\t\t<th className=\"VisualizeVFPU__col-header\">C{m}{c}0</th>\r\n\t\t\t\t<td>{this.renderValue(m, c, 0)}</td>\r\n\t\t\t\t<td>{this.renderValue(m, c, 1)}</td>\r\n\t\t\t\t<td>{this.renderValue(m, c, 2)}</td>\r\n\t\t\t\t<td>{this.renderValue(m, c, 3)}</td>\r\n\t\t\t</tr>\r\n\t\t);\r\n\t}\r\n\r\n\trenderValue(m, c, r) {\r\n\t\tconst reg = m * 4 + c * 32 + r;\r\n\t\tconst cat = this.state.categories[2];\r\n\t\tif (this.state.format === 'uint') {\r\n\t\t\treturn toString08X(cat.uintValues[reg]);\r\n\t\t}\r\n\t\treturn cat.floatValues[reg];\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'cpu.getAllRegs': ({ categories }) => this.setState({ categories }),\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\thandleFormat = (ev) => {\r\n\t\tconst format = ev.target.value;\r\n\t\tthis.setState({ format });\r\n\t}\r\n}\r\n\r\nVisualizeVFPU.propTypes = {\r\n\tisOpen: PropTypes.bool.isRequired,\r\n\tonClose: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default VisualizeVFPU;\r\n","import { PureComponent } from 'react';\r\nimport DebuggerContext, { DebuggerContextValues } from '../DebuggerContext';\r\nimport PropTypes from 'prop-types';\r\nimport { Tab, Tabs, TabList, TabPanel } from 'react-tabs';\r\nimport FuncList from './FuncList';\r\nimport RegPanel from './RegPanel';\r\nimport VisualizeVFPU from './VisualizeVFPU';\r\nimport './LeftPanel.css';\r\nimport '../ext/react-tabs.css';\r\n\r\nclass LeftPanel extends PureComponent {\r\n\tstate = {\r\n\t\tvfpuModalOpen: false,\r\n\t\t// These can be slow, so we want to prevent render until it's selected.\r\n\t\teverShownFuncs: false,\r\n\t};\r\n\t/**\r\n\t * @type {DebuggerContextValues}\r\n\t */\r\n\tcontext;\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div className=\"LeftPanel\">\r\n\t\t\t\t<Tabs onSelect={this.handleSelect}>\r\n\t\t\t\t\t<TabList>\r\n\t\t\t\t\t\t<Tab>Regs</Tab>\r\n\t\t\t\t\t\t<Tab>Funcs</Tab>\r\n\t\t\t\t\t\t<Tab>Tools</Tab>\r\n\t\t\t\t\t</TabList>\r\n\t\t\t\t\t<TabPanel forceRender={true}>\r\n\t\t\t\t\t\t<RegPanel gotoDisasm={this.props.gotoDisasm} currentThread={this.context.gameStatus.currentThread} />\r\n\t\t\t\t\t</TabPanel>\r\n\t\t\t\t\t<TabPanel forceRender={this.state.everShownFuncs}>\r\n\t\t\t\t\t\t<FuncList gotoDisasm={this.props.gotoDisasm} started={this.context.gameStatus.started} />\r\n\t\t\t\t\t</TabPanel>\r\n\t\t\t\t\t<TabPanel className=\"react-tabs__tab-panel LeftPanel__tools\">\r\n\t\t\t\t\t\t<button type=\"button\" onClick={this.handleVFPUOpen}>Visualize VFPU</button>\r\n\t\t\t\t\t</TabPanel>\r\n\t\t\t\t</Tabs>\r\n\r\n\t\t\t\t<VisualizeVFPU isOpen={this.state.vfpuModalOpen} onClose={this.handleVFPUClose} />\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\thandleSelect = (index) => {\r\n\t\tif (index === 1 && !this.state.everShownFuncs) {\r\n\t\t\tthis.setState({ everShownFuncs: true });\r\n\t\t}\r\n\t}\r\n\r\n\thandleVFPUOpen = () => {\r\n\t\tthis.setState({ vfpuModalOpen: true });\r\n\t}\r\n\r\n\thandleVFPUClose = () => {\r\n\t\tthis.setState({ vfpuModalOpen: false });\r\n\t}\r\n}\r\n\r\nLeftPanel.propTypes = {\r\n\tgotoDisasm: PropTypes.func.isRequired,\r\n};\r\n\r\nLeftPanel.contextType = DebuggerContext;\r\n\r\nexport default LeftPanel;\r\n","import { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport classNames from 'clsx';\r\n\r\nclass LogItem extends PureComponent {\r\n\trender() {\r\n\t\tif (this.props.item.event === 'log') {\r\n\t\t\treturn this.formatLogEvent();\r\n\t\t}\r\n\r\n\t\treturn this.renderInternal();\r\n\t}\r\n\r\n\trenderInternal() {\r\n\t\treturn (\r\n\t\t\t<span className={this.makeClassName()}>\r\n\t\t\t\t{this.props.item.message}\r\n\t\t\t</span>\r\n\t\t);\r\n\t}\r\n\r\n\tformatLogEvent() {\r\n\t\tconst { item } = this.props;\r\n\t\treturn (\r\n\t\t\t<span className={this.makeClassName()}>\r\n\t\t\t\t<span className=\"Log__message__header\">\r\n\t\t\t\t\t<span className=\"Log__message__timestamp\">{item.timestamp}</span>\r\n\t\t\t\t\t{' ' + item.header + ' '}\r\n\t\t\t\t</span>\r\n\t\t\t\t{item.message}\r\n\t\t\t</span>\r\n\t\t);\r\n\t}\r\n\r\n\tmakeClassName() {\r\n\t\tconst { item } = this.props;\r\n\r\n\t\treturn classNames('Log__message', {\r\n\t\t\t'Log__message--internal': item.event !== 'log',\r\n\t\t\t['Log__message--channel-' + item.channel]: item.event === 'log',\r\n\t\t\t['Log__message--level-' + item.level]: true,\r\n\t\t});\r\n\t}\r\n}\r\n\r\nLogItem.propTypes = {\r\n\titem: PropTypes.shape({\r\n\t\tevent: PropTypes.string,\r\n\t\tchannel: PropTypes.string,\r\n\t\tlevel: PropTypes.number,\r\n\t\ttimestamp: PropTypes.string,\r\n\t\theader: PropTypes.string,\r\n\t\tmessage: PropTypes.string.isRequired,\r\n\t}).isRequired,\r\n};\r\n\r\nexport default LogItem;\r\n","import listeners from './listeners';\r\nimport { useEffect, useState } from 'react';\r\n\r\nconst MAX_LINES = 5000;\r\n\r\nclass Logger {\r\n\tconstructor() {\r\n\t\tthis.id_ = 0;\r\n\t\tthis.items_ = [];\r\n\t\tthis.changeListeners_ = [];\r\n\t}\r\n\r\n\tinit(ppsspp) {\r\n\t\tppsspp.onError = (message, level) => {\r\n\t\t\tconst newItem = { message: message + '\\n', level };\r\n\t\t\tthis.addLogItem(newItem);\r\n\t\t};\r\n\r\n\t\tlisteners.listen({\r\n\t\t\t'log': this.onLogEvent.bind(this),\r\n\t\t});\r\n\t}\r\n\r\n\tonLogEvent(data) {\r\n\t\tconst newItem = { ...data };\r\n\t\tthis.addLogItem(newItem);\r\n\t}\r\n\r\n\taddLogItem(newItem) {\r\n\t\tconst id = ++this.id_;\r\n\t\tconst itemWithId = { id, ...newItem };\r\n\t\tthis.items_ = this.items_.concat([itemWithId ]).slice(-MAX_LINES);\r\n\t\tfor (let listener of this.changeListeners_) {\r\n\t\t\tlistener(this.items_);\r\n\t\t}\r\n\t}\r\n\r\n\tlisten(listener) {\r\n\t\tif (!this.changeListeners_.includes(listener)) {\r\n\t\t\tthis.changeListeners_.push(listener);\r\n\t\t\tlistener(this.items_); // Make sure listener receives initial state\r\n\t\t}\r\n\t}\r\n\r\n\tforget(listener) {\r\n\t\tthis.changeListeners_ = this.changeListeners_.filter(e => e !== listener);\r\n\t}\r\n}\r\n\r\nconst logger = new Logger();\r\nexport default logger;\r\n\r\nexport function useLogItems() {\r\n\tconst [logItems, setLogItems] = useState([]);\r\n\r\n\tuseEffect(() => {\r\n\t\tfunction changeListener(items) {\r\n\t\t\tsetLogItems(items);\r\n\t\t}\r\n\r\n\t\tlogger.listen(changeListener);\r\n\t\treturn () => logger.forget(changeListener);\r\n\t}, []);\r\n\r\n\treturn logItems;\r\n}\r\n","import { useEffect, useRef } from 'react';\r\nimport LogItem from './LogItem';\r\nimport { useLogItems } from '../utils/logger';\r\nimport './Log.css';\r\n\r\nexport default function Log(props) {\r\n\tconst logItems = useLogItems();\r\n\r\n\tconst divRef = useRef();\r\n\r\n\tuseEffect(() => {\r\n\t\tconst div = divRef.current;\r\n\t\tdiv.scrollTop = div.scrollHeight - div.clientHeight;\r\n\t}, [divRef, logItems]);\r\n\r\n\treturn (\r\n\t\t<div id=\"Log\" ref={divRef}>\r\n\t\t\t{logItems.map(item => <LogItem key={item.id} item={item} />)}\r\n\t\t</div>\r\n\t);\r\n}\r\n","import { PureComponent } from 'react';\r\nimport { Tab, TabList, TabPanel, Tabs } from 'react-tabs';\r\nimport BreakpointPanel from './CPU/BreakpointPanel';\r\nimport DebuggerContext, { DebuggerContextValues } from './DebuggerContext';\r\nimport Disasm from './CPU/Disasm';\r\nimport DisasmButtons from './CPU/DisasmButtons';\r\nimport GotoBox from './common/GotoBox';\r\nimport LeftPanel from './CPU/LeftPanel';\r\nimport listeners from '../utils/listeners.js';\r\nimport Log from './Log';\r\nimport './CPU.css';\r\n\r\nclass CPU extends PureComponent {\r\n\tstate = {\r\n\t\tsetInitialPC: false,\r\n\t\t// Note: these are inclusive.\r\n\t\tselectionTop: null,\r\n\t\tselectionBottom: null,\r\n\t\tjumpMarker: null,\r\n\t\tpromptGotoMarker: null,\r\n\t\tlastTicks: 0,\r\n\t\tticks: 0,\r\n\t\tnavTray: false,\r\n\t};\r\n\t/**\r\n\t * @type {DebuggerContextValues}\r\n\t */\r\n\tcontext;\r\n\tlisteners_;\r\n\r\n\trender() {\r\n\t\tconst { pc, currentThread } = this.context.gameStatus;\r\n\t\tconst { selectionTop, selectionBottom, jumpMarker, setInitialPC, navTray } = this.state;\r\n\t\tconst disasmProps = { currentThread, selectionTop, selectionBottom, jumpMarker, pc, setInitialPC };\r\n\r\n\t\treturn (\r\n\t\t\t<div id=\"CPU\">\r\n\t\t\t\t{this.renderMain(navTray, disasmProps)}\r\n\t\t\t\t{this.renderUtilityPanel()}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderMain(navTray, disasmProps) {\r\n\t\tconst { stepping, paused, started, currentThread } = this.context.gameStatus;\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"CPU__main\">\r\n\t\t\t\t<div className={navTray ? 'CPU__pane CPU__pane--open' : 'CPU__pane'}>\r\n\t\t\t\t\t<button type=\"button\" onClick={this.hideNavTray} className=\"CPU__paneClose\">Close</button>\r\n\t\t\t\t\t<GotoBox gotoAddress={this.gotoDisasm} includePC={true} promptGotoMarker={this.state.promptGotoMarker} />\r\n\t\t\t\t\t<LeftPanel gotoDisasm={this.gotoDisasm} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"Disasm__container\">\r\n\t\t\t\t\t<DisasmButtons stepping={stepping && !paused} started={started} currentThread={currentThread} updateCurrentThread={this.updateCurrentThread} showNavTray={this.showNavTray} />\r\n\t\t\t\t\t<Disasm {...disasmProps} updateSelection={this.updateSelection} promptGoto={this.promptGoto} />\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderUtilityPanel() {\r\n\t\treturn (\r\n\t\t\t<div className=\"CPU__utilityPanel App-utilityPanel\">\r\n\t\t\t\t<Tabs onSelect={this.handleSelect}>\r\n\t\t\t\t\t<TabList>\r\n\t\t\t\t\t\t<Tab>Log</Tab>\r\n\t\t\t\t\t\t<Tab>Breakpoints</Tab>\r\n\t\t\t\t\t</TabList>\r\n\t\t\t\t\t<TabPanel forceRender={true}>\r\n\t\t\t\t\t\t<Log />\r\n\t\t\t\t\t</TabPanel>\r\n\t\t\t\t\t<TabPanel>\r\n\t\t\t\t\t\t<BreakpointPanel gotoDisasm={this.gotoDisasm} />\r\n\t\t\t\t\t</TabPanel>\r\n\t\t\t\t</Tabs>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'connection': () => this.onConnection(),\r\n\t\t\t'cpu.stepping': (data) => this.onStepping(data),\r\n\t\t\t'game.start': () => {\r\n\t\t\t\t// This may often not happen if the register list is visible.\r\n\t\t\t\tif (!this.state.setInitialPC) {\r\n\t\t\t\t\tthis.updateInitialPC();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'game.quit': () => {\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\tsetInitialPC: false,\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t'cpu.setReg': (result) => {\r\n\t\t\t\tif (result.category === 0 && result.register === 32) {\r\n\t\t\t\t\tconst pc = result.uintValue;\r\n\t\t\t\t\tif (!this.state.setInitialPC) {\r\n\t\t\t\t\t\tthis.gotoDisasm(pc);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.setState({ setInitialPC: pc !== 0 });\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t'cpu.getAllRegs': (result) => {\r\n\t\t\t\tconst pc = result.categories[0].uintValues[32];\r\n\t\t\t\tif (!this.state.setInitialPC) {\r\n\t\t\t\t\tthis.gotoDisasm(pc);\r\n\t\t\t\t}\r\n\t\t\t\tthis.setState({ setInitialPC: pc !== 0 });\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\tonConnection() {\r\n\t\t// Update the status of this connection immediately too.\r\n\t\tthis.context.ppsspp.send({ event: 'cpu.status' }).then((result) => {\r\n\t\t\tconst { pc, ticks } = result;\r\n\r\n\t\t\tif (!this.state.setInitialPC) {\r\n\t\t\t\tthis.gotoDisasm(pc);\r\n\t\t\t}\r\n\t\t\tthis.setState({ setInitialPC: pc !== 0, ticks, lastTicks: ticks });\r\n\t\t});\r\n\t}\r\n\r\n\tonStepping(data) {\r\n\t\tthis.setState(prevState => ({\r\n\t\t\tselectionTop: data.pc,\r\n\t\t\tselectionBottom: data.pc,\r\n\t\t\tlastTicks: prevState.ticks,\r\n\t\t\tticks: data.ticks,\r\n\t\t}));\r\n\t}\r\n\r\n\tupdateSelection = (data) => {\r\n\t\tthis.setState(data);\r\n\t}\r\n\r\n\tgotoDisasm = (pc) => {\r\n\t\tthis.setState({\r\n\t\t\tselectionTop: pc,\r\n\t\t\tselectionBottom: pc,\r\n\t\t\t// It just matters that this is a new object.\r\n\t\t\tjumpMarker: {},\r\n\t\t});\r\n\t}\r\n\r\n\tpromptGoto = () => {\r\n\t\tthis.setState({\r\n\t\t\tpromptGotoMarker: {},\r\n\t\t});\r\n\t}\r\n\r\n\tupdateCurrentThread = (currentThread, pc) => {\r\n\t\tthis.setState({ setInitialPC: pc !== 0 && pc !== undefined });\r\n\t\tthis.context.gameStatus.setState({ currentThread });\r\n\t\tif (pc !== 0 && pc !== undefined) {\r\n\t\t\tthis.context.gameStatus.setState({ pc });\r\n\t\t\tthis.gotoDisasm(pc);\r\n\t\t}\r\n\t}\r\n\r\n\tshowNavTray = () => {\r\n\t\tthis.setState({ navTray: true });\r\n\t}\r\n\r\n\thideNavTray = () => {\r\n\t\tthis.setState({ navTray: false });\r\n\t}\r\n\r\n\tupdateInitialPC = () => {\r\n\t\tthis.context.ppsspp.send({ event: 'cpu.getReg', name: 'pc' }).then(result => {\r\n\t\t\tconst pc = result.uintValue;\r\n\t\t\tif (!this.state.setInitialPC) {\r\n\t\t\t\tthis.gotoDisasm(pc);\r\n\t\t\t}\r\n\t\t\tthis.setState({ setInitialPC: pc !== 0 });\r\n\t\t\tthis.context.gameStatus.setState({ pc });\r\n\t\t});\r\n\t}\r\n}\r\n\r\nCPU.contextType = DebuggerContext;\r\n\r\nexport default CPU;\r\n","import { PureComponent } from 'react';\r\nimport DebuggerContext, { DebuggerContextValues } from './DebuggerContext';\r\nimport listeners from '../utils/listeners.js';\r\nimport Log from './Log';\r\nimport './GPU.css';\r\n\r\nclass GPU extends PureComponent {\r\n\tstate = {\r\n\t\tconnected: false,\r\n\t\tstarted: false,\r\n\t\tpaused: true,\r\n\t\trecording: false,\r\n\t};\r\n\t/**\r\n\t * @type {DebuggerContextValues}\r\n\t */\r\n\tcontext;\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div id=\"GPU\">\r\n\t\t\t\t{this.renderMain()}\r\n\t\t\t\t{this.renderUtilityPanel()}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderMain() {\r\n\t\treturn (\r\n\t\t\t<div className=\"GPU__main\">\r\n\t\t\t\t<div className=\"GPU__info\">\r\n\t\t\t\t\t{this.state.started && !this.state.paused ? 'Click below to generate a GE dump.  It will download as a file.' : 'Waiting for a game to start...'}\r\n\t\t\t\t</div>\r\n\t\t\t\t{this.state.started && !this.state.paused ? (\r\n\t\t\t\t\t<form className=\"GPU__form\" onSubmit={this.beginRecord}>\r\n\t\t\t\t\t\t<button type=\"submit\" disabled={this.state.recording}>{this.state.recording ? 'Recording...' : 'Record'}</button>\r\n\t\t\t\t\t</form>\r\n\t\t\t\t) : null}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderUtilityPanel() {\r\n\t\treturn (\r\n\t\t\t<div className=\"GPU__utilityPanel App-utilityPanel\">\r\n\t\t\t\t<Log />\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.listeners_ = listeners.listen({\r\n\t\t\t'connection': () => this.onConnection(),\r\n\t\t\t'connection.change': (connected) => this.onConnectionChange(connected),\r\n\t\t\t'game.start': () => this.setState({ started: true, paused: false }),\r\n\t\t\t'game.quit': () => this.setState({ started: false, paused: true }),\r\n\t\t\t'game.pause': () => this.setState({ paused: true }),\r\n\t\t\t'game.resume': () => this.setState({ paused: false }),\r\n\t\t});\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tlisteners.forget(this.listeners_);\r\n\t}\r\n\r\n\tonConnectionChange(connected) {\r\n\t\t// On any reconnect, assume paused until proven otherwise.\r\n\t\tthis.setState({ connected, started: false, paused: true });\r\n\t}\r\n\r\n\tonConnection() {\r\n\t\t// Update the status of this connection immediately too.\r\n\t\tthis.context.ppsspp.send({ event: 'cpu.status' }).then((result) => {\r\n\t\t\tconst { stepping, paused, pc } = result;\r\n\t\t\tconst started = pc !== 0 || stepping;\r\n\r\n\t\t\tthis.setState({ connected: true, started, paused });\r\n\t\t}, (err) => {\r\n\t\t\tthis.setState({ paused: true });\r\n\t\t});\r\n\t}\r\n\r\n\tbeginRecord = (ev) => {\r\n\t\tthis.setState({ recording: true });\r\n\t\tthis.context.ppsspp.send({ event: 'gpu.record.dump' }).then(result => {\r\n\t\t\tvar a = document.createElement('a');\r\n\t\t\ta.setAttribute('download', 'recording.ppdmp');\r\n\t\t\ta.href = result.uri;\r\n\t\t\ta.hidden = true;\r\n\t\t\tdocument.body.appendChild(a);\r\n\t\t\ta.click();\r\n\t\t\tdocument.body.removeChild(a);\r\n\r\n\t\t\tthis.setState({ recording: false });\r\n\t\t});\r\n\t\tev.preventDefault();\r\n\t}\r\n}\r\n\r\nGPU.contextType = DebuggerContext;\r\n\r\nexport default GPU;\r\n","import PropTypes from 'prop-types';\r\nimport Log from './Log';\r\nimport './NotConnected.css';\r\n\r\nexport default function NotConnected(props) {\r\n\tconst connectManually = (ev) => {\r\n\t\tconst uri = ev.target.elements['debugger-uri'].value;\r\n\t\tprops.connect(uri);\r\n\t\tev.preventDefault();\r\n\t};\r\n\tconst connectAutomatically = (ev) => {\r\n\t\tprops.connect(null);\r\n\t\tev.preventDefault();\r\n\t};\r\n\r\n\tconst mainDiv = (\r\n\t\t<div className=\"NotConnected__main\">\r\n\t\t\t{props.connecting ? 'Connecting to PPSSPP...' : 'Not connected to PPSSPP'}\r\n\r\n\t\t\t<div className=\"NotConnected__info\">\r\n\t\t\t\tMake sure &quot;Allow remote debugger&quot; is enabled in Developer tools.\r\n\t\t\t</div>\r\n\t\t\t<form className=\"NotConnected__form\" onSubmit={connectManually}>\r\n\t\t\t\t<input type=\"text\" name=\"debugger-uri\" placeholder=\"ws://ip:port/debugger\" className=\"NotConnected__uri\" />\r\n\t\t\t\t<button type=\"submit\" disabled={props.connecting}>Connect Manually</button>\r\n\t\t\t</form>\r\n\t\t\t<form className=\"NotConnected__form\" onSubmit={connectAutomatically}>\r\n\t\t\t\t<button type=\"submit\" disabled={props.connecting}>Connect Automatically</button>\r\n\t\t\t</form>\r\n\t\t</div>\r\n\t);\r\n\r\n\tconst utilityPanelDiv = (\r\n\t\t<div className=\"NotConnected__utilityPanel App-utilityPanel\">\r\n\t\t\t<Log />\r\n\t\t</div>\r\n\t);\r\n\r\n\treturn (\r\n\t\t<div id=\"NotConnected\">\r\n\t\t\t{mainDiv}\r\n\t\t\t{utilityPanelDiv}\r\n\t\t</div>\r\n\t);\r\n}\r\n\r\nNotConnected.propTypes = {\r\n\tconnect: PropTypes.func.isRequired,\r\n};\r\n","export default __webpack_public_path__ + \"static/media/logo.752c728e.svg\";","import { Component } from 'react';\r\nimport { BrowserRouter as Router, NavLink, Route, Switch } from 'react-router-dom';\r\nimport CPU from './CPU';\r\nimport GPU from './GPU';\r\nimport { DebuggerProvider } from './DebuggerContext';\r\nimport NotConnected from './NotConnected';\r\nimport PPSSPP from '../sdk/ppsspp.js';\r\nimport listeners from '../utils/listeners.js';\r\nimport logger from '../utils/logger.js';\r\nimport GameStatus from '../utils/game.js';\r\nimport logo from '../assets/logo.svg';\r\nimport './App.css';\r\n\r\nconst versionInfo = {\r\n\tname: process.env.REACT_APP_NAME,\r\n\tversion: process.env.REACT_APP_VERSION,\r\n};\r\n\r\nclass App extends Component {\r\n\tstate = {\r\n\t\tconnected: false,\r\n\t\tconnecting: false,\r\n\t\tgameStatus: null,\r\n\t};\r\n\tgameStatus;\r\n\tppsspp;\r\n\toriginalTitle;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.ppsspp = new PPSSPP();\r\n\t\tthis.gameStatus = new GameStatus();\r\n\t\tthis.originalTitle = document.title;\r\n\r\n\t\tlisteners.init(this.ppsspp);\r\n\t\tlisteners.listen({\r\n\t\t\t'connection.change': this.onConnectionChange,\r\n\t\t\t'game.start': this.updateTitle,\r\n\t\t\t'game.quit': this.updateTitle,\r\n\t\t});\r\n\t\tlogger.init(this.ppsspp);\r\n\t\tthis.gameStatus.init(this.ppsspp);\r\n\t\tthis.gameStatus.listenState(gameStatus => {\r\n\t\t\tthis.setState({ gameStatus });\r\n\t\t});\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<Router>\r\n\t\t\t\t<DebuggerProvider gameStatus={this.state.gameStatus} log={this.log} ppsspp={this.ppsspp}>\r\n\t\t\t\t\t<div className=\"App\">\r\n\t\t\t\t\t\t<header className=\"App-header\">\r\n\t\t\t\t\t\t\t<ul className=\"App-nav\">\r\n\t\t\t\t\t\t\t\t<NavLink to=\"/cpu\" isActive={(m, l) => m || l.pathname === '/'}>CPU</NavLink>\r\n\t\t\t\t\t\t\t\t<NavLink to=\"/gpu\">GPU</NavLink>\r\n\t\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t\t<img src={logo} className=\"App-logo\" alt=\"PPSSPP\" />\r\n\t\t\t\t\t\t\t<h1 className=\"App-title\">Debugger</h1>\r\n\t\t\t\t\t\t</header>\r\n\t\t\t\t\t\t{this.renderContent()}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</DebuggerProvider>\r\n\t\t\t</Router>\r\n\t\t);\r\n\t}\r\n\r\n\trenderContent() {\r\n\t\tif (!this.state.connected) {\r\n\t\t\treturn <NotConnected connecting={this.state.connecting} connect={this.connect} />;\r\n\t\t}\r\n\r\n\t\treturn (\r\n\t\t\t<Switch>\r\n\t\t\t\t<Route path=\"/gpu\">\r\n\t\t\t\t\t<GPU />\r\n\t\t\t\t</Route>\r\n\t\t\t\t<Route>\r\n\t\t\t\t\t<CPU />\r\n\t\t\t\t</Route>\r\n\t\t\t</Switch>\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\t// Connect automatically on start.\r\n\t\tif (!this.props.testing) {\r\n\t\t\tthis.handleAutoConnect();\r\n\t\t}\r\n\t}\r\n\r\n\thandleAutoConnect = () => {\r\n\t\tthis.connect(null);\r\n\t}\r\n\r\n\tconnect = (uri) => {\r\n\t\tthis.setState({ connecting: true });\r\n\r\n\t\tthis.ppsspp.onClose = () => {\r\n\t\t\tthis.log('Debugger disconnected');\r\n\t\t\tlisteners.change(false);\r\n\t\t\tthis.setState({ connected: false, connecting: false });\r\n\t\t};\r\n\r\n\t\tlet connection;\r\n\t\tif (uri === null) {\r\n\t\t\tconnection = this.ppsspp.autoConnect();\r\n\t\t} else {\r\n\t\t\tconnection = this.ppsspp.connect(uri);\r\n\t\t}\r\n\r\n\t\tconnection.then(() => {\r\n\t\t\tthis.log('Debugger connected');\r\n\t\t\tlisteners.change(true);\r\n\t\t\tthis.setState({ connected: true, connecting: false });\r\n\t\t}, err => {\r\n\t\t\tthis.log('Debugger could not connect');\r\n\t\t\tlisteners.change(false);\r\n\t\t\tthis.setState({ connected: false, connecting: false });\r\n\t\t});\r\n\t}\r\n\r\n\thandleDisconnect = () => {\r\n\t\t// Should trigger the appropriate events automatically.\r\n\t\tthis.ppsspp.disconnect();\r\n\t}\r\n\r\n\tlog = (message) => {\r\n\t\t// Would rather keep Logger managing its state, and pass this callback around.\r\n\t\tlogger.addLogItem({ message: message + '\\n' });\r\n\t}\r\n\r\n\tupdateTitle = (data) => {\r\n\t\tif (!document) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (data.game) {\r\n\t\t\tdocument.title = this.originalTitle + ' - ' + data.game.id + ': ' + data.game.title;\r\n\t\t} else {\r\n\t\t\tdocument.title = this.originalTitle;\r\n\t\t}\r\n\t}\r\n\r\n\tonConnectionChange = (status) => {\r\n\t\tif (status) {\r\n\t\t\tthis.ppsspp.send({ event: 'version', ...versionInfo }).catch((err) => {\r\n\t\t\t\twindow.alert('PPSSPP seems to think this debugger is out of date.  Try refreshing?\\n\\nDetails: ' + err);\r\n\t\t\t});\r\n\t\t\tthis.ppsspp.send({ event: 'game.status' }).then(this.updateTitle, (err) => this.updateTitle({}));\r\n\t\t} else {\r\n\t\t\tthis.updateTitle({});\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport default App;\r\n","// In production, we register a service worker to serve assets from local cache.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\r\n// cached resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\r\n// This link also includes instructions on opting out of this behavior.\r\n\r\nconst isLocalhost = Boolean(\r\n\twindow.location.hostname === 'localhost' ||\r\n\t\t// [::1] is the IPv6 localhost address.\r\n\t\twindow.location.hostname === '[::1]' ||\r\n\t\t// 127.0.0.1/8 is considered localhost for IPv4.\r\n\t\twindow.location.hostname.match(\r\n\t\t\t/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n\t\t)\r\n);\r\n\r\nexport default function register() {\r\n\tif (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n\t\t// The URL constructor is available in all browsers that support SW.\r\n\t\tconst publicUrl = new URL(process.env.PUBLIC_URL, window.location);\r\n\t\tif (publicUrl.origin !== window.location.origin) {\r\n\t\t\t// Our service worker won't work if PUBLIC_URL is on a different origin\r\n\t\t\t// from what our page is served on. This might happen if a CDN is used to\r\n\t\t\t// serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\twindow.addEventListener('load', () => {\r\n\t\t\tconst swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n\t\t\tif (isLocalhost) {\r\n\t\t\t\t// This is running on localhost. Lets check if a service worker still exists or not.\r\n\t\t\t\tcheckValidServiceWorker(swUrl);\r\n\r\n\t\t\t\t// Add some additional logging to localhost, pointing developers to the\r\n\t\t\t\t// service worker/PWA documentation.\r\n\t\t\t\tnavigator.serviceWorker.ready.then(() => {\r\n\t\t\t\t\tconsole.log(\r\n\t\t\t\t\t\t'This web app is being served cache-first by a service ' +\r\n\t\t\t\t\t\t\t'worker. To learn more, visit https://goo.gl/SC7cgQ'\r\n\t\t\t\t\t);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\t// Is not local host. Just register service worker\r\n\t\t\t\tregisterValidSW(swUrl);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\nfunction registerValidSW(swUrl) {\r\n\tnavigator.serviceWorker\r\n\t\t.register(swUrl)\r\n\t\t.then(registration => {\r\n\t\t\tregistration.onupdatefound = () => {\r\n\t\t\t\tconst installingWorker = registration.installing;\r\n\t\t\t\tinstallingWorker.onstatechange = () => {\r\n\t\t\t\t\tif (installingWorker.state === 'installed') {\r\n\t\t\t\t\t\tif (navigator.serviceWorker.controller) {\r\n\t\t\t\t\t\t\t// At this point, the old content will have been purged and\r\n\t\t\t\t\t\t\t// the fresh content will have been added to the cache.\r\n\t\t\t\t\t\t\t// It's the perfect time to display a \"New content is\r\n\t\t\t\t\t\t\t// available; please refresh.\" message in your web app.\r\n\t\t\t\t\t\t\tconsole.log('New content is available; please refresh.');\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// At this point, everything has been precached.\r\n\t\t\t\t\t\t\t// It's the perfect time to display a\r\n\t\t\t\t\t\t\t// \"Content is cached for offline use.\" message.\r\n\t\t\t\t\t\t\tconsole.log('Content is cached for offline use.');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t};\r\n\t\t})\r\n\t\t.catch(error => {\r\n\t\t\tconsole.error('Error during service worker registration:', error);\r\n\t\t});\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl) {\r\n\t// Check if the service worker can be found. If it can't reload the page.\r\n\tfetch(swUrl)\r\n\t\t.then(response => {\r\n\t\t\t// Ensure service worker exists, and that we really are getting a JS file.\r\n\t\t\tif (\r\n\t\t\t\tresponse.status === 404 ||\r\n\t\t\t\tresponse.headers.get('content-type').indexOf('javascript') === -1\r\n\t\t\t) {\r\n\t\t\t\t// No service worker found. Probably a different app. Reload the page.\r\n\t\t\t\tnavigator.serviceWorker.ready.then(registration => {\r\n\t\t\t\t\tregistration.unregister().then(() => {\r\n\t\t\t\t\t\twindow.location.reload();\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\t// Service worker found. Proceed as normal.\r\n\t\t\t\tregisterValidSW(swUrl);\r\n\t\t\t}\r\n\t\t})\r\n\t\t.catch(() => {\r\n\t\t\tconsole.log(\r\n\t\t\t\t'No internet connection found. App is running in offline mode.'\r\n\t\t\t);\r\n\t\t});\r\n}\r\n\r\nexport function unregister() {\r\n\tif ('serviceWorker' in navigator) {\r\n\t\tnavigator.serviceWorker.ready.then(registration => {\r\n\t\t\tregistration.unregister();\r\n\t\t});\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport Modal from 'react-modal';\r\nimport './index.css';\r\nimport App from './components/App';\r\nimport registerServiceWorker from './registerServiceWorker';\r\nimport 'core-js/stable';\r\nimport 'regenerator-runtime/runtime';\r\nimport 'react-app-polyfill/ie11';\r\nimport 'react-app-polyfill/stable';\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\nModal.setAppElement('#root');\r\nregisterServiceWorker();\r\n"],"sourceRoot":""}