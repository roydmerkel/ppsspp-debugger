(this["webpackJsonpppsspp-debugger"]=this["webpackJsonpppsspp-debugger"]||[]).push([[0],{166:function(e,t,n){},385:function(e,t,n){},426:function(e,t,n){},428:function(e,t,n){},429:function(e,t,n){},430:function(e,t,n){},431:function(e,t,n){},432:function(e,t,n){},433:function(e,t,n){},434:function(e,t,n){},445:function(e,t,n){},446:function(e,t,n){},447:function(e,t,n){},448:function(e,t,n){},449:function(e,t,n){},450:function(e,t,n){},451:function(e,t,n){},452:function(e,t,n){},453:function(e,t,n){},454:function(e,t,n){},469:function(e,t,n){"use strict";n.r(t);n(120),n(129),n(130),n(131),n(132),n(133),n(134),n(135),n(136),n(137),n(138),n(139),n(140),n(141),n(142),n(180),n(182),n(183),n(184),n(185),n(186),n(188),n(144),n(191),n(192),n(93),n(196),n(197),n(199),n(200),n(201),n(202),n(203),n(204),n(205),n(209),n(210),n(211),n(212),n(213),n(216),n(217),n(218),n(219),n(151),n(220),n(222),n(224),n(225),n(226),n(227),n(228),n(229),n(230),n(231),n(232),n(233),n(234),n(235),n(236),n(237),n(238),n(153),n(239),n(240),n(241),n(242),n(244),n(245),n(246),n(247),n(248),n(250),n(252),n(253),n(255),n(256),n(257),n(259),n(260),n(261),n(262),n(263),n(264),n(265),n(267),n(268),n(269),n(270),n(271),n(272),n(273),n(274),n(275),n(155),n(276),n(277),n(278),n(279),n(285),n(286),n(287),n(288),n(289),n(290),n(291),n(292),n(293),n(294),n(295),n(296),n(297),n(298),n(157),n(299),n(300),n(301),n(302),n(303),n(304),n(305),n(112),n(306),n(307),n(310),n(311),n(312),n(313),n(314),n(315),n(316),n(317),n(318),n(319),n(320),n(321),n(322),n(323),n(324),n(325),n(326),n(327),n(328),n(329),n(330),n(331),n(332),n(333),n(336),n(337),n(338),n(339),n(340),n(341),n(342),n(343),n(344),n(345),n(346),n(347),n(348),n(349),n(350),n(351),n(352),n(353),n(354),n(355),n(356),n(357),n(358),n(359),n(360),n(361),n(362),n(363),n(364),n(365),n(366),n(367),n(368),n(369),n(371),n(372),n(374),n(375),n(376),n(377),n(379),n(164);var s=n(1),r=n.n(s),a=n(58),i=n.n(a),o=n(115),c=n.n(o),l=(n(426),n(6)),u=n(8),d=n(9),p=n(12),h=n(11),f=n(118),v=n(29),m=n(392),g=n(38),b=(n(166),n(0)),j=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(u.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).handleRequestClose=function(){e.props.confirmClose&&!window.confirm(e.props.confirmClose)||e.props.onClose()},e}return Object(d.a)(n,[{key:"render",value:function(){return Object(b.jsx)(c.a,Object(l.a)({className:"ReactModal__FitContent",overlayClassName:"ReactModal__FitOverlay",onRequestClose:this.handleRequestClose,closeTimeoutMS:150},this.props))}}]),n}(s.PureComponent),O=n(393),y=n(74),k=["label","type","children","onChange","component","prop"],x=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(u.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).handleChange=function(t){if(e.props.onChange)e.props.onChange(t);else if(e.props.component){var n=t.target,s=n.dataset.prop||e.props.prop,r="checkbox"===n.type?n.checked:n.value;e.props.component.setState(Object(y.a)({},s,r))}},e}return Object(d.a)(n,[{key:"render",value:function(){var e=this.props,t=e.label,n=e.children;return Object(b.jsxs)("div",{className:"Field",children:[Object(b.jsx)("label",{className:"Field__label",htmlFor:this.fieldID(),children:t}),this.renderInput(),n]})}},{key:"renderInput",value:function(){return"text"===this.props.type?this.renderText():"hex"===this.props.type?this.renderHex():"radio"===this.props.type?this.renderRadio():"checkboxes"===this.props.type?this.renderCheckboxes():null}},{key:"renderText",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.props,n=(t.label,t.type,t.children,t.onChange,t.component,t.prop,Object(O.a)(t,k));return n.value=this.fieldValue(),Object(b.jsx)("input",Object(l.a)(Object(l.a)({type:"text",id:this.fieldID(),onChange:this.handleChange},n),e))}},{key:"renderHex",value:function(){return this.renderText({pattern:"(0x)?[0-9A-Fa-f]+",title:"Hexadecimal value"})}},{key:"renderRadio",value:function(){var e=this,t=this.fieldValue();return this.props.options.map((function(n){var s={name:e.fieldID(),value:n.value,checked:t===n.value,onChange:e.handleChange,disabled:e.props.disabled};return Object(b.jsxs)("label",{children:[Object(b.jsx)("input",Object(l.a)({type:"radio"},s))," "+n.label]},n.value)}))}},{key:"renderCheckboxes",value:function(){var e=this;return this.props.options.map((function(t){var n={"data-prop":t.value,checked:e.props.component.state[t.value],onChange:e.handleChange,disabled:e.props.disabled};return Object(b.jsxs)("label",{children:[Object(b.jsx)("input",Object(l.a)({type:"checkbox"},n))," "+t.label]},t.value)}))}},{key:"fieldID",value:function(){var e=this.props,t=e.id,n=e.component,s=e.prop;return!t&&n&&s?(n.displayName||n.constructor.name)+"__"+s:t}},{key:"fieldValue",value:function(){var e=this.props,t=e.value,n=e.component,s=e.prop;return void 0===t&&n&&s?n.state[s]:t}}]),n}(s.Component),C=n(5),S=n.n(C),_=n(15);n(428);function w(e){return Object(b.jsxs)("form",{action:"#",className:Object(_.a)(e.className,"Form"),onSubmit:e.onSubmit,children:[e.heading?Object(b.jsx)("h2",{className:"Form__heading",children:e.heading}):null,e.children]})}w.Buttons=function(e){var t=!0!==e.onSave?e.onSave:void 0,n=e.onSave?Object(b.jsx)("button",{onClick:t,children:"Save"}):null,s=e.onCancel?Object(b.jsx)("button",{type:"button",onClick:e.onCancel,children:"Cancel"}):null;return Object(b.jsxs)("div",{className:"Form__buttons",children:[e.children,n,s]})},w.Buttons.propTypes={onSave:S.a.oneOfType([S.a.func,S.a.bool]),onCancel:S.a.func,children:S.a.node};var D=w,T=function(){function e(t,n){Object(u.a)(this,e),this.func=t,this.ms=n}return Object(d.a)(e,[{key:"start",value:function(){var e=this;this.cancel(),this.handle=setTimeout((function(){e.handle=null,e.func()}),this.ms)}},{key:"reset",value:function(e){this.func=e}},{key:"runEarly",value:function(){this.handle&&(this.cancel(),this.func())}},{key:"cancel",value:function(){null!==this.handle&&(clearTimeout(this.handle),this.handle=null)}}]),e}();function P(e){return("00000000"+e.toString(16).toUpperCase()).substr(-8)}n(429);var N=[{label:"Memory",value:"memory"},{label:"Execute",value:"execute"}],B=[{label:"Read",value:"read"},{label:"Write",value:"write"},{label:"On change",value:"change"}],L=[{label:"Break",value:"enabled"},{label:"Log",value:"log"}],R=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(u.a)(this,n),(s=t.call(this,e)).state={},s.cleanState={isOpen:!1,derivedBreakpoint:null},s.cleanBreakpoint={type:"memory",address:"",size:"0x00000001",condition:"",logFormat:"",read:!0,write:!0,change:!1,enabled:!0,log:!0},s.onSave=function(e){var t=s.props.ppsspp.send({event:"cpu.evaluate",thread:s.props.currentThread,expression:s.state.address});if(s.props.breakpoint){var n=s.state,r=n.derivedBreakpoint,a=n.address,i=n.size,o=n.type;t=o!==r.type||r.address!==a||"memory"===o&&r.size!==i?t.then(s.deleteOld).then(s.saveNew):t.then(s.updateExisting)}else t=t.then(s.saveNew);t.then(s.onClose,(function(e){window.alert(e.message)})),e.preventDefault()},s.saveNew=function(e){var t=e.uintValue;return s.props.ppsspp.send(Object(l.a)(Object(l.a)({event:s.getEvent(s.state.type,"add")},s.state),{},{address:t}))},s.deleteOld=function(e){var t=e.uintValue;return s.props.ppsspp.send({event:s.getEvent(s.props.breakpoint.type,"remove"),address:s.props.breakpoint.address}).then((function(){return{uintValue:t}}))},s.updateExisting=function(e){var t=e.uintValue;return s.props.ppsspp.send(Object(l.a)(Object(l.a)({event:s.getEvent(s.state.type,"update")},s.state),{},{address:t}))},s.onClose=function(){s.cleanTimeout.start(),s.props.onClose()},Object.assign(s.state,Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)({},s.cleanState),s.cleanBreakpoint),e.breakpoint),e.initialOverrides)),s.cleanTimeout=new T((function(){s.setState(Object(l.a)(Object(l.a)(Object(l.a)(Object(l.a)({},s.cleanState),s.cleanBreakpoint),s.props.breakpoint),s.props.initialOverrides))}),200),s}return Object(d.a)(n,[{key:"render",value:function(){var e=!!this.props.breakpoint;return Object(b.jsx)(j,{contentLabel:"Breakpoint settings",isOpen:this.props.isOpen,onClose:this.onClose,confirmClose:this.hasChanges()?"Discard changes?":null,children:Object(b.jsxs)(D,{heading:e?"Edit Breakpoint":"Create Breakpoint",onSubmit:this.onSave,className:"BreakpointModal",children:[Object(b.jsx)(x,{type:"radio",label:"Type",options:N,prop:"type",component:this}),Object(b.jsx)(x,{type:"text",label:"Address",prop:"address",component:this}),this.renderMemory(),this.renderExecute(),Object(b.jsx)(x,{type:"text",label:"Log format",prop:"logFormat",component:this,disabled:!this.state.log}),Object(b.jsx)(x,{type:"checkboxes",label:"Actions",options:L,component:this}),Object(b.jsx)(D.Buttons,{onSave:!0,onCancel:this.onClose})]})})}},{key:"renderMemory",value:function(){return"memory"!==this.state.type?null:Object(b.jsxs)(r.a.Fragment,{children:[Object(b.jsx)(x,{type:"hex",label:"Size",prop:"size",component:this}),Object(b.jsx)(x,{type:"checkboxes",label:"Operations",options:B,component:this})]})}},{key:"renderExecute",value:function(){return"execute"!==this.state.type?null:Object(b.jsx)(r.a.Fragment,{children:Object(b.jsx)(x,{type:"text",label:"Condition",prop:"condition",component:this})})}},{key:"hasChanges",value:function(){var e=this,t=this.state.derivedBreakpoint||this.cleanBreakpoint;return void 0!==Object.keys(t).find((function(n){return e.state[n]!==t[n]}))}},{key:"componentDidUpdate",value:function(e,t){this.props.isOpen&&null!=this.cleanTimeout&&this.cleanTimeout.runEarly()}},{key:"getEvent",value:function(e,t){if("execute"===e)return"cpu.breakpoint."+t;if("memory"===e)return"memory.breakpoint."+t;throw new Error("Unexpected type: "+e)}}],[{key:"getDerivedStateFromProps",value:function(e,t){if(e.isOpen&&!t.isOpen){var n=e.breakpoint;n&&(n.address="0x"+P(n.address),n.condition=n.condition||"",n.logFormat=n.logFormat||"");var s=e.initialOverrides;return s&&(s.address="0x"+P(s.address)),Object(l.a)(Object(l.a)({isOpen:!0},n),{},{derivedBreakpoint:n},s)}return!e.isOpen&&t.derivedBreakpoint?{derivedBreakpoint:null}:null}}]),n}(s.PureComponent),M=n(18),V=!0,A=[];function F(){var e=document.getElementById("clipboard-scratchpad");return e||function(){var e=document.createElement("div");return e.id="clipboard-scratchpad",e.style.width=1,e.style.height=1,e.style.opacity=0,e.style.position="absolute",e.style.top=0,e.style.left=0,e.style.pointerEvents="none",e.style.whiteSpace="pre",document.body.appendChild(e),e}()}function E(e){V=!1;try{var t=F();t.textContent=e;var n=t.firstChild,s=document.createRange();s.setStart(n,0),s.setEnd(n,e.length);var r=window.getSelection(),a=0!==r.rangeCount?r.getRangeAt(0):null;r.removeAllRanges(),r.addRange(s);try{document.execCommand("copy")}catch(i){window.prompt("Use Ctrl-C or Command-C to copy",e)}r.removeAllRanges(),a&&r.addRange(a)}finally{V=!0}}function I(e,t){for(;e&&e!==document;){if(e.matches(t))return!0;e=e.parentNode}return!1}Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector),document.addEventListener("copy",(function(e){var t=0!==document.getSelection().rangeCount?document.getSelection().getRangeAt(0):null;if((!t||t.collapsed)&&V){var n,s=Object(g.a)(A);try{for(s.s();!(n=s.n()).done;){var r=n.value;if(I(document.activeElement,r.selector)){var a=r.handler(e);a&&(/win/i.test(window.navigator.platform)?e.clipboardData.setData("text/plain",a.replace(/\n/g,"\r\n")):e.clipboardData.setData("text/plain",a),e.preventDefault())}}}catch(i){s.e(i)}finally{s.f()}}}));var U=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(u.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).handleCopyAddress=function(e,t){E(P(t.line.address)),t.node.focus()},e.handleCopyHex=function(t,n){E(e.props.getSelectedLines().map((function(e){return e.macroEncoding?e.macroEncoding.map(P).join("\n"):P(e.encoding)})).join("\n")),n.node.focus()},e.handleCopyDisasm=function(t,n){E(e.props.getSelectedDisasm()),n.node.focus()},e.handleAssemble=function(t,n){setTimeout((function(){e.props.assembleInstruction(n.line,"").catch((function(){}))}),0)},e.handleRunUntil=function(t,n){e.props.ppsspp.send({event:"cpu.runUntil",address:n.line.address}).catch((function(){})),n.node.focus()},e.handleJumpPC=function(t,n){e.props.ppsspp.send({event:"cpu.setReg",thread:e.props.currentThread,name:"pc",value:n.line.address}).catch((function(t){e.props.log("Failed to update PC: "+t)}))},e.handleToggleBreakpoint=function(t,n){e.props.toggleBreakpoint(n.line)},e.handleFollowBranch=function(t,n){e.props.followBranch(!0,n.line)},e.handleTodo=function(e,t){console.log(t),t.node.focus()},e}return Object(d.a)(n,[{key:"render",value:function(){var e=this.props,t=e.id,n=e.trigger,s=!this.props.stepping,r=n&&n.line,a=r&&(null!==r.branch||null!==r.relevantData||"data"===r.type);return Object(b.jsxs)(M.a,{id:t,children:[Object(b.jsx)(M.c,{onClick:this.handleCopyAddress,children:"Copy Address"}),Object(b.jsx)(M.c,{onClick:this.handleCopyHex,children:"Copy Instruction (Hex)"}),Object(b.jsx)(M.c,{onClick:this.handleCopyDisasm,children:"Copy Instruction (Disasm)"}),Object(b.jsx)(M.c,{divider:!0}),Object(b.jsx)(M.c,{disabled:s,onClick:this.handleAssemble,children:"Assemble Opcode..."}),Object(b.jsx)(M.c,{divider:!0}),Object(b.jsx)(M.c,{disabled:s,onClick:this.handleRunUntil,children:"Run to Cursor"}),Object(b.jsx)(M.c,{disabled:s,onClick:this.handleJumpPC,children:"Jump to Cursor"}),Object(b.jsx)(M.c,{onClick:this.handleToggleBreakpoint,children:"Toggle Breakpoint"}),Object(b.jsx)(M.c,{divider:!0}),Object(b.jsx)(M.c,{disabled:!a,onClick:this.handleFollowBranch,children:"Follow Branch"}),Object(b.jsx)(M.c,{data:{action:"goto_memory"},onClick:this.handleTodo,children:"Go to in Memory View"}),Object(b.jsx)(M.c,{data:{action:"goto_jit"},onClick:this.handleTodo,children:"Go to in Jit Compare"}),Object(b.jsx)(M.c,{divider:!0}),Object(b.jsx)(M.c,{data:{action:"func_rename"},onClick:this.handleTodo,children:"Rename Function..."}),Object(b.jsx)(M.c,{data:{action:"func_remove"},onClick:this.handleTodo,children:"Remove Function"}),Object(b.jsx)(M.c,{data:{action:"func_add"},onClick:this.handleTodo,children:"Add Function Here"})]})}}]),n}(s.PureComponent),H=Object(M.d)("disasm")(U),G=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){var e=this.calcPos();if(null===e||0===this.props.lineHeight)return null;var t=Object(_.a)({DisasmBranchGuide:!0,"DisasmBranchGuide--selected":this.props.selected});return Object(b.jsx)("div",{className:t,style:e,children:Object(b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"8",height:e.height,children:Object(b.jsx)("path",{d:this.buildPath(e.height)})})})}},{key:"buildPath",value:function(e){var t=this.props,n=t.guide,s=t.range,r=t.lineHeight,a=Math.floor(r/2)+.5,i="m7.5,-".concat(a," l0,").concat(r," m-7.5,-").concat(r-a),o="m3,0 l5,0 m-8,0",c="m5.5,-4 l-4,4 l4,4 m-3.5,-4 l6,0 m-8,0",l=["M0,"+a];return n.top<s.start?l.push(i):"up"===n.direction?l.push(c):l.push(o),l.push("m7.5,0 l0,"+(e-r)+" m-7.5,0"),n.bottom>=s.end?l.push(i):"down"===n.direction?l.push(c):l.push(o),l.join(" ")}},{key:"calcPos",value:function(){var e=this.props.guide,t=this.findAddressOffset(e.top,!1),n=this.findAddressOffset(e.bottom,!0);return null===t||null===n?null:{top:t,right:8*(16-e.lane),height:n-t}}},{key:"findAddressOffset",value:function(e,t){var n,s=this.props,r=s.offsets,a=s.range;if(e>=a.end)return a.end-4 in r&&t?r[a.end-4]+this.props.lineHeight:a.end-8 in r&&t?r[a.end-8]+this.props.lineHeight:null;if(e<a.start&&!t)n=0;else if(e in r)n=r[e];else{if(!(e-4 in r))return null;n=r[e-4]}return t?n+this.props.lineHeight:n}}]),n}(s.PureComponent);function q(e,t){return!(e.top<t.top||e.left<t.left)&&!(e.bottom>t.bottom||e.right>t.right)}function z(e,t){return!function(e){var t={top:0,left:0,bottom:window.innerHeight,right:window.innerWidth},n=e.getBoundingClientRect();if(!q(n,t))return!1;for(var s=e;null!==(s=s.parentNode);)if(s instanceof HTMLElement){var r=window.getComputedStyle(s),a=r.overflow+r.overflowX+r.overflowY;if("static"===r.position&&-1===a.indexOf("auto")&&-1===a.indexOf("scroll"))continue;if(!q(n,s.getBoundingClientRect()))return!1}return!0}(e)&&(e.scrollIntoView(t),!0)}var W=!1;function K(){return W}function J(e){return Object(b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:e.className,viewBox:"0 0 1536 1536",width:"12",height:"12",children:Object(b.jsx)("path",{d:"M768,0 q209,0 385.5,103 t279.5,279.5 t103,385.5 t-103,385.5 t-279.5,279.5 t-385.5,103 t-385.5,-103 t-279.5,-279.5 t-103,-385.5 t103,-385.5 t279.5,-279.5 t385.5,-103 zm128,1247 v-190 q0,-14 -9,-23.5 t-22,-9.5 h-192 q-13,0 -23,10 t-10,23 v190 q0,13 10,23 t23,10 h192 q13,0 22,-9.5 t9,-23.5 zm-2,-344 l18,-621 q0,-12 -10,-18 q-10,-8 -24,-8 h-220 q-14,0 -24,8 q-10,6 -10,18 l17,621 q0,10 10,17.5 t24,7.5 h185 q14,0 23.5,-7.5 t10.5,-17.5 z"})})}window.addEventListener("REACT_CONTEXTMENU_SHOW",(function(e){W=!0})),window.addEventListener("REACT_CONTEXTMENU_HIDE",(function(e){W=!1}));var X=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(u.a)(this,n),(s=t.call(this,e)).ref=r.a.createRef(),s}return Object(d.a)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.line,s=t.selected,r=t.focused,a=t.cursor,i=Object(_.a)({DisasmLine:!0,"DisasmLine--selected":s&&!r,"DisasmLine--focused":r,"DisasmLine--cursor":a,"DisasmLine--breakpoint":n.breakpoint&&n.breakpoint.enabled,"DisasmLine--disabled-breakpoint":n.breakpoint&&!n.breakpoint.enabled,"DisasmLine--current":n.isCurrentPC}),o=function(t){return{line:n,node:e.ref.current.parentNode}},c={onDoubleClick:function(t){return e.onDoubleClick(t,o())},tabIndex:0};return Object(b.jsx)(M.b,{id:this.props.contextmenu,renderTag:"a",collect:o,attributes:c,holdToDisplay:-1,children:Object(b.jsxs)("div",{className:i,style:{backgroundColor:n.backgroundColor},ref:this.ref,"data-address":n.address,children:[Object(b.jsx)(J,{className:"DisasmLine__breakpoint-icon"}),this.renderAddress(n),Object(b.jsxs)("code",{className:"DisasmLine__opcode",children:[this.highlight(n.name,"",n.params)," "]}),Object(b.jsxs)("code",{className:"DisasmLine__params",children:[this.highlightParams(n.params,n.name,""),this.renderConditional(n)]})]})})}},{key:"renderAddress",value:function(e){var t=e.symbol,n=e.address,s=e.encoding,r=P(n);return this.props.displaySymbols?null!==t?Object(b.jsx)("code",{className:"DisasmLine__address DisasmLine__address--symbol",children:this.highlight(t+":")}):Object(b.jsx)("code",{className:"DisasmLine__address DisasmLine__address--nosymbol",children:this.highlight(r)}):Object(b.jsxs)("code",{className:"DisasmLine__address DisasmLine__address--hexonly",children:[this.highlight(r)," ",P(s)]})}},{key:"renderConditional",value:function(e){return e.isCurrentPC&&null!==e.conditionMet?e.conditionMet?" ; true":" ; false":""}},{key:"highlight",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=this.props.highlight;if(null!==s){var a=(t?t+" ":"")+e+" "+n,i=a.toLowerCase().indexOf(s),o=s.length;if(-1!==i){var c=t?t.length+1:0;i<c?i=(o-=c-i)>0?0:-1:i-=c}if(i>=0&&i<e.length){var l=Object(_.a)({DisasmLine__highlight:!0,"DisasmLine__highlight--end":i+o>e.length+1});return Object(b.jsxs)(r.a.Fragment,{children:[e.substr(0,i),Object(b.jsx)("span",{className:l,children:e.substr(i,o)}),e.substr(i+o)]})}}return e}},{key:"highlightParams",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=this.props,r=s.highlight,a=s.highlightParams;if(null===r){var i=e.split(/([,()])/),o=a||[];return i.map((function(e,t){var n="DisasmLine__param";return o.includes(e)&&(n+=" DisasmLine__param--highlighted"),Object(b.jsx)("span",{className:n,children:e},t)}))}return this.highlight(e,t,n)}},{key:"onDoubleClick",value:function(e,t){0===e.button&&this.props.onDoubleClick(e,t)}},{key:"ensureInView",value:function(e){var t=this.ref.current.parentNode;!1!==e&&z(t,{block:e}),t.focus()}}],[{key:"addressBoundingTop",value:function(e,t){var n=e.querySelector('.DisasmLine[data-address="'+t+'"]');return n?n.parentNode.getBoundingClientRect().top:null}}]),n}(s.PureComponent),Y=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(u.a)(this,n),(s=t.call(this,e)).state={mouseDown:!1,focused:!1,lineOffsets:{},pendingLineParams:[],selectedLineParams:[],prevLines:null,prevSelectionTop:null,prevSelectionBottom:null},s.onCopy=function(e){return s.props.getSelectedDisasm()},s.ref=r.a.createRef(),s.cursorRef=r.a.createRef(),s.focusTimeout=new T((function(){return null}),20),s.paramsTimeout=new T((function(){s.setState({selectedLineParams:s.state.pendingLineParams})}),20),s}return Object(d.a)(n,[{key:"render",value:function(){var e=this,t={onMouseDownCapture:function(t){return e.onMouseDown(t)},onMouseUpCapture:this.state.mouseDown?function(t){return e.onMouseUp(t)}:void 0,onMouseMove:this.state.mouseDown?function(t){return e.onMouseMove(t)}:void 0,onKeyDown:function(t){return e.onKeyDown(t)},onBlur:function(t){return e.onFocusChange(t,!1)},onFocus:function(t){return e.onFocusChange(t,!0)}};return Object(b.jsxs)("div",Object(l.a)(Object(l.a)({className:"Disasm__list",ref:this.ref},t),{},{children:[this.props.lines.map((function(t){return e.renderLine(t)})),this.props.branchGuides.map((function(t){return e.renderBranchGuide(t)}))]}))}},{key:"renderLine",value:function(e){var t=this.props,n=t.displaySymbols,s=t.cursor,r={displaySymbols:n,line:e,selected:this.isLineSelected(e),cursor:e.address===s,onDoubleClick:this.props.onDoubleClick,ref:e.address===s?this.cursorRef:void 0,highlight:this.shouldHighlight(e,this.props.highlightText)?this.props.highlightText:null,highlightParams:this.shouldHighlightParams(e)?this.state.selectedLineParams:null};return r.focused=r.selected&&this.state.focused,Object(b.jsx)(X,Object(l.a)({contextmenu:"disasm"},r),e.address)}},{key:"renderBranchGuide",value:function(e){var t=String(e.top)+String(e.bottom)+e.direction,n=this.props,s=n.range,r=n.lineHeight,a=n.cursor,i={key:t,guide:e,offsets:this.state.lineOffsets,range:s,lineHeight:r,selected:e.top===a||e.bottom===a};return Object(b.jsx)(G,Object(l.a)({},i))}},{key:"shouldHighlight",value:function(e,t){var n=[];return n.push(P(e.address)),null!==e.symbol&&n.push(e.symbol+":"),n.push(e.name+" "+e.params),n.some((function(e){return-1!==e.toLowerCase().indexOf(t)}))}},{key:"shouldHighlightParams",value:function(e,t){return!this.isLineSelected(e)&&this.state.selectedLineParams.some((function(t){return-1!==e.params.indexOf(t)}))}},{key:"addressBoundingTop",value:function(e){return X.addressBoundingTop(this.ref.current,e)}},{key:"ensureCursorInView",value:function(e){this.cursorRef.current&&this.cursorRef.current.ensureInView(e)}},{key:"isLineSelected",value:function(e){return n.isLineSelected(this.props,e)}},{key:"componentDidMount",value:function(){var e,t;e=".Disasm__list",t=this.onCopy,A.push({selector:e,handler:t})}},{key:"componentWillUnmount",value:function(){var e,t;e=".Disasm__list",t=this.onCopy,A=A.filter((function(n){return n.selector!==e&&n.handler!==t})),this.paramsTimeout.cancel()}},{key:"componentDidUpdate",value:function(e,t){this.state.pendingLineParams!==t.pendingLineParams&&this.paramsTimeout.start()}},{key:"onFocusChange",value:function(e,t){var n=this,s=function(){t!==n.state.focused&&n.setState({focused:t})};this.focusTimeout.cancel(),t?s():(this.focusTimeout.reset(s),this.focusTimeout.start())}},{key:"onMouseDown",value:function(e){var t=this.mouseEventToLine(e);2===e.button&&this.isLineSelected(t)?this.props.updateCursor(t.address):this.applySelection(e,t),0===e.button&&this.setState({mouseDown:!0})}},{key:"onMouseUp",value:function(e){var t=this.mouseEventToLine(e);t&&this.applySelection(e,t),this.setState({mouseDown:!1})}},{key:"onMouseMove",value:function(e){if(0!==e.buttons){var t=this.mouseEventToLine(e);t&&this.applySelection(e,t)}else this.setState({mouseDown:!1})}},{key:"onKeyDown",value:function(e){if(!K()){var t=(e.ctrlKey?"c":"")+(e.metaKey?"m":"")+(e.altKey?"a":"")+(e.shiftKey?"s":"");if(["ArrowUp","ArrowDown","PageUp","PageDown"].includes(e.key)){var n=1;if("PageUp"!==e.key&&"PageDown"!==e.key||(n=this.props.visibleLines),"ArrowUp"!==e.key&&"PageUp"!==e.key||(n=-n),""===t||"s"===t){var s=this.findCursorLineIndex(),r=Math.min(this.props.lines.length-1,Math.max(0,s+n));s!==r&&(this.applySelection(e,this.props.lines[r]),e.preventDefault())}else e.ctrlKey&&(this.props.applyScroll(n),e.preventDefault())}"ArrowLeft"!==e.key&&"ArrowRight"!==e.key||""!==t||(this.props.followBranch("ArrowRight"===e.key,this.findCursorLine()),e.preventDefault()),"Tab"===e.key&&""===t&&(this.props.updateDisplaySymbols(!this.props.displaySymbols),e.preventDefault()),"a"===e.key&&"c"===t&&(this.props.assembleInstruction(this.findCursorLine(),""),e.preventDefault())," "!==e.key&&"Spacebar"!==e.key||""!==t||(this.props.toggleBreakpoint(this.findCursorLine()),e.preventDefault()),"d"===e.key&&"c"===t&&(this.props.toggleBreakpoint(this.findCursorLine(),!0),e.preventDefault()),"s"!==e.key&&"f"!==e.key||"c"!==t||(this.props.searchPrompt(),e.preventDefault()),"F3"===e.key&&""===t&&(this.props.searchNext(),e.preventDefault()),"g"===e.key&&"c"===t&&(this.props.promptGoto(),e.preventDefault()),"e"===e.key&&"c"===t&&(this.props.editBreakpoint(this.findCursorLine()),e.preventDefault())}}},{key:"applySelection",value:function(e,t){var n=this.props,s=n.selectionTop,r=n.selectionBottom;e.shiftKey?(s=Math.min(s,t.address),r=Math.max(r,t.address)):(s=t.address,r=t.address),s===this.props.selectionTop&&r===this.props.selectionBottom||this.props.updateSelection({selectionTop:s,selectionBottom:r}),this.props.updateCursor(t.address)}},{key:"mouseEventToLine",value:function(e){var t=e.pageY-this.ref.current.getBoundingClientRect().top-window.pageYOffset,n=Math.floor(t/this.props.lineHeight);return this.props.lines[n]}},{key:"findCursorLineIndex",value:function(){for(var e=this.props,t=e.cursor,n=e.lines,s=e.selectionTop,r=t||s,a=0;a<n.length;++a)if(n[a].address===r)return a}},{key:"findCursorLine",value:function(){var e=this.findCursorLineIndex();return this.props.lines[e]}}],[{key:"isLineSelected",value:function(e,t){var n=e.selectionTop,s=e.selectionBottom;return t.address+t.addressSize>n&&t.address<=s}},{key:"calcOffsets",value:function(e,t){var n=0,s={};return e.forEach((function(e){s[e.address]=n,n+=t})),s}},{key:"getSelectedLineParams",value:function(e){var t,s=e.lines,r=e.selectionTop,a=e.selectionBottom,i=s.filter(n.isLineSelected.bind(null,{selectionTop:r,selectionBottom:a})),o={},c=Object(g.a)(i);try{for(c.s();!(t=c.n()).done;){var l,u=t.value,d=Object(g.a)(u.params.split(/[,()]/));try{for(d.s();!(l=d.n()).done;){var p=l.value;o[p]=p}}catch(h){d.e(h)}finally{d.f()}}}catch(h){c.e(h)}finally{c.f()}return delete o[""],Object.values(o)}},{key:"getDerivedStateFromProps",value:function(e,t){var s=e.lines!==t.prevLines,r=e.selectionTop!==t.prevSelectionTop||e.selectionBottom!==t.prevSelectionBottom,a=null;s&&(a={lineOffsets:n.calcOffsets(e.lines,e.lineHeight),prevLines:e.lines});var i=null;return(s||r)&&(i={pendingLineParams:n.getSelectedLineParams(e),prevSelectionTop:e.selectionTop,prevSelectionBottom:e.selectionBottom}),null!==a||null!==i?Object(l.a)(Object(l.a)({},a),i):null}}]),n}(s.PureComponent),$=(n(430),function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(u.a)(this,n),(s=t.call(this,e)).handleChange=function(e){s.props.updateSearchString(e.target.value)},s.handleNext=function(e){s.props.searchNext(),s.focus(),e.preventDefault()},s.handleCancel=function(e){s.props.updateSearchString(null)},s.handleKeyDown=function(e){"Escape"===e.key&&(s.handleCancel(),e.preventDefault())},s.ref=r.a.createRef(),s}return Object(d.a)(n,[{key:"render",value:function(){var e=this.props.searchString||"",t=Object(_.a)("DisasmSearch__field",{"DisasmSearch__field--progress":this.props.inProgress});return Object(b.jsxs)("form",{action:"#",className:"DisasmSearch",hidden:null===this.props.searchString,onSubmit:this.handleNext,children:[Object(b.jsx)("div",{className:t,children:Object(b.jsx)("input",{type:"search",value:e,placeholder:"Find...",onChange:this.handleChange,onKeyDown:this.handleKeyDown,ref:this.ref})}),Object(b.jsx)("button",{type:"submit",children:Object(b.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100",width:"15",height:"15",role:"img",children:[Object(b.jsx)("title",{children:"Search / Next"}),Object(b.jsx)("path",{d:"M10,50 l80,0 l-35,-40 m35,40 l-35,40"})]})}),Object(b.jsx)("button",{type:"button",onClick:this.handleCancel,children:Object(b.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 180 180",width:"15",height:"15",role:"img",children:[Object(b.jsx)("title",{children:"Cancel"}),Object(b.jsx)("path",{d:"M30,30 l120,120 m-120,0 l120,-120"})]})})]})}},{key:"componentDidUpdate",value:function(e,t){null===e.searchString&&null!==this.props.searchString&&this.focus()}},{key:"focus",value:function(){this.ref.current.focus()}}]),n}(s.PureComponent)),Q=(n(431),function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){var e=this.props.line;return e?Object(b.jsxs)("div",{className:"StatusBar",children:[Object(b.jsx)("div",{className:"StatusBar__left",children:this.renderLeftStatus(e)}),Object(b.jsx)("div",{className:"StatusBar__right",children:e.function||e.symbol||""})]}):Object(b.jsx)("div",{className:"StatusBar"})}},{key:"renderLeftStatus",value:function(e){if("opcode"===e.type||"macro"===e.type){if(e.dataAccess)return this.renderDataAccess(e.dataAccess);if(e.branch)return this.renderBranch(e.branch);if(e.relevantData&&"string"===typeof e.relevantData.stringValue)return this.renderString(e.relevantData)}else if("data"===e.type)return this.renderDataSymbol(e.dataSymbol,e.address);return""}},{key:"renderDataAccess",value:function(e){if(null===e.uintValue)return"Invalid address "+P(e.address);var t="["+P(e.address)+"] = ";return e.valueSymbol&&(t+=e.valueSymbol+" ("),1===e.size?t+=("00"+e.uintValue.toString(16).toUpperCase()).substr(-2):2===e.size?t+=function(e){return("0000"+e.toString(16).toUpperCase()).substr(-4)}(e.uintValue):e.size>=4&&(t+=P(e.uintValue)),e.valueSymbol&&(t+=")"),t}},{key:"renderBranch",value:function(e){var t=e.targetAddress?P(e.targetAddress):"";return e.symbol&&(t+=" = "+e.symbol),t}},{key:"renderString",value:function(e){return"["+P(e.address)+"] = "+JSON.stringify(e.stringValue)}},{key:"renderDataSymbol",value:function(e,t){var n=P(e.start);return e.label&&(n+=" ("+e.label+")"),t!==e.start&&(n+=" + "+P(e.start-t)),n}}]),n}(s.PureComponent)),Z=new(function(){function e(){Object(u.a)(this,e),this.changeCallbacks_=[],this.ppsspp_=null,this.connected_=!1}return Object(d.a)(e,[{key:"init",value:function(e){this.ppsspp_=e}},{key:"change",value:function(e){this.connected_=e;var t,n=Object(g.a)(this.changeCallbacks_);try{for(n.s();!(t=n.n()).done;){(0,t.value)(e)}}catch(s){n.e(s)}finally{n.f()}}},{key:"onConnectionChange",value:function(e){var t=this;return this.changeCallbacks_.push(e),{remove:function(){var n=t.changeCallbacks_.indexOf(e);-1!==n&&t.changeCallbacks_.splice(n,1)}}}},{key:"onConnection",value:function(e){return this.connected_&&e(!0),this.onConnectionChange((function(t){t&&e(!0)}))}},{key:"listen",value:function(e){var t=[];for(var n in e)if(e.hasOwnProperty(n)){var s=void 0;s="connection"===n?this.onConnection(e[n]):"connection.change"===n?this.onConnectionChange(e[n]):this.ppsspp_.listen(n,e[n]),t.push(s)}return t}},{key:"forget",value:function(e){var t,n=Object(g.a)(e);try{for(n.s();!(t=n.n()).done;){t.value.remove()}}catch(s){n.e(s)}finally{n.f()}}}]),e}()),ee=(n(432),100),te=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(u.a)(this,n),(s=t.call(this,e)).state={lines:[],branchGuides:[],range:{start:0,end:0},lineHeight:0,visibleLines:0,displaySymbols:!0,wantDisplaySymbols:!0,cursor:null,searchString:null,searchInProgress:!1,highlightText:null,editingBreakpoint:null,creatingBreakpoint:null},s.jumpStack=[],s.needsScroll=!1,s.needsOffsetFix=!1,s.updatesCancel=!1,s.updatesSequence=Promise.resolve(null),s.lastSearch=null,s.updateCursor=function(e){s.state.cursor!==e&&(s.needsScroll="nearest",s.setState({cursor:e}),s.updatesSequence=s.updatesSequence.then((function(){if(s.updatesCancel)return null;var t=s.state.range,n=t.start,r=t.end,a=Math.max(ee,s.state.visibleLines),i=Math.max(500,5*s.state.visibleLines);return e-4*a<n?n=e-2*a*4:e-4*i>n&&(n=e-4*(i-a)),e+4*a>r?r=e+2*a*4:e+4*i<r&&(r=e+4*(i-a)),n!==s.state.range.start||r!==s.state.range.end?s.updateDisasmNow("nearest",{address:n,end:r}):null})))},s.getSelectedLines=function(){var e=s.props,t=e.selectionTop,n=e.selectionBottom;return s.state.lines.filter((function(e){return e.address+e.addressSize>t&&e.address<=n}))},s.getSelectedDisasm=function(){var e,t=s.getSelectedLines(),n={},r=t.map((function(e){return e.branch})).filter((function(e){return e&&!e.symbol&&e.targetAddress})),a=Object(g.a)(r);try{for(a.s();!(e=a.n()).done;){var i=e.value;n[i.targetAddress]="pos_"+P(i.targetAddress)}}catch(h){a.e(h)}finally{a.f()}var o,c="",l=!0,u=Object(g.a)(t);try{for(u.s();!(o=u.n()).done;){var d=o.value,p=d.symbol||n[d.address];p&&(l||(c+="\n"),c+=p+":\n\n"),c+="\t"+d.name+" ",d.branch&&d.branch.targetAddress&&!d.branch.symbol?c+=d.params.replace(/0x[0-9A-f]+/,n[d.branch.targetAddress]):c+=d.params,c+="\n",l=!1}}catch(h){u.e(h)}finally{u.f()}return c},s.updateDisplaySymbols=function(e){s.setState({wantDisplaySymbols:e})},s.followBranch=function(e,t){if(e){var n=t.branch&&t.branch.targetAddress;null===n&&(n=t.relevantData&&t.relevantData.address),null!==n&&(s.jumpStack.push(s.state.cursor),s.gotoAddress(n))}else 0!==s.jumpStack.length?s.gotoAddress(s.jumpStack.pop()):s.gotoAddress(s.props.pc)},s.assembleInstruction=function(e,t){var n=e.address,r=prompt("Assemble instruction",t);if(!r)return Promise.resolve(null);var a=function(){return s.props.ppsspp.send({event:"memory.assemble",address:n,code:r}).then((function(){if(n===s.state.cursor){var t=s.state.lines.indexOf(e);if(t<s.state.lines.length-1){var r=s.state.lines[t+1].address;s.gotoAddress(r,"nearest")}}s.updateDisasm()}))},i=r.split(/\s*=\s*(.+)$/,2);return i.length>=2?s.props.ppsspp.send({event:"cpu.evaluate",thread:s.props.currentThread,expression:i[1]}).then((function(e){return s.props.ppsspp.send({event:"cpu.setReg",thread:s.props.currentThread,name:i[0],value:e.uintValue})})).then((function(e){var t=e.uintValue;s.props.log("Updated "+i[0]+" to "+P(t))}),a):a()},s.toggleBreakpoint=function(e,t){if(null===e.breakpoint)s.props.ppsspp.send({event:"cpu.breakpoint.add",address:e.address,enabled:!0});else if(e.breakpoint.enabled)if(t)s.props.ppsspp.send({event:"cpu.breakpoint.update",address:e.breakpoint.address||e.address,enabled:!1});else{if(null!==e.breakpoint.condition&&!window.confirm("This breakpoint has has a condition.\n\nAre you sure you want to remove it?"))return;s.props.ppsspp.send({event:"cpu.breakpoint.remove",address:e.breakpoint.address||e.address})}else s.props.ppsspp.send({event:"cpu.breakpoint.update",address:e.breakpoint.address||e.address,enabled:!0})},s.editBreakpoint=function(e){var t,n=(null===(t=e.breakpoint)||void 0===t?void 0:t.address)||e.address;s.props.ppsspp.send({event:"cpu.breakpoint.list",address:n,enabled:!0}).then((function(e){var t=e.breakpoints.find((function(e){return e.address===n}));if(t){var r=Object(l.a)(Object(l.a)({},t),{},{type:"execute"});s.setState({editingBreakpoint:r})}else{var a={address:n,type:"execute"};s.setState({creatingBreakpoint:a})}}))},s.closeEditBreakpoint=function(){s.setState({editingBreakpoint:null,creatingBreakpoint:null})},s.gotoAddress=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"center";s.needsScroll=t,s.props.updateSelection({selectionTop:e,selectionBottom:e})},s.searchDisasm=function(e){var t=e&&null!==s.lastSearch,n=s.state,r=n.cursor,a=n.searchString;if(t||a){if(s.state.searchInProgress){if(t)return;s.searchCancel()}t||(s.lastSearch={match:a,end:r,last:null});var i={cancel:!1};s.lastSearch.cancelState=i,s.setState({searchInProgress:!0});var o=s.lastSearch,c=o.match,l=o.end,u=o.last;s.props.ppsspp.send({event:"memory.searchDisasm",address:r===u?r+4:r,end:l,match:c}).then((function(e){var t=e.address;i.cancel||(s.lastSearch&&(s.lastSearch.last=t),null!==t?s.gotoAddress(t):r!==l?(window.alert("Reached the starting point of the search"),s.gotoAddress(l)):window.alert("The specified text was not found:\n\n"+c))})).finally((function(){i.cancel||(s.setState({searchInProgress:!1}),s.lastSearch&&(s.lastSearch.cancelState=null))}))}else s.searchPrompt()},s.updateSearchString=function(e){var t=e?e.toLowerCase():null;s.setState({highlightText:t,searchString:e}),s.lastSearch&&s.lastSearch.match!==e&&(s.searchCancel(),s.lastSearch=null),null===e&&s.listRef.current&&s.listRef.current.ensureCursorInView(!1)},s.searchPrompt=function(){s.updateSearchString(s.state.searchString||(s.lastSearch?s.lastSearch.match:"")),s.searchRef.current.focus()},s.searchNext=function(){s.searchDisasm(!0)},s.searchCancel=function(){s.lastSearch&&s.lastSearch.cancelState&&(s.lastSearch.cancelState.cancel=!0,s.setState({searchInProgress:!1}),s.lastSearch.cancelState=null)},s.onDoubleClick=function(e,t){s.toggleBreakpoint(t.line)},s.applyScroll=function(e){s.ref.current.scrollTop+=e*s.state.lineHeight},s.ref=r.a.createRef(),s.listRef=r.a.createRef(),s.searchRef=r.a.createRef(),s}return Object(d.a)(n,[{key:"render",value:function(){var e=this,t={onScroll:function(t){return e.onScroll(t)},onDragStart:function(e){return e.preventDefault()}};return this.props.started?Object(b.jsxs)(r.a.Fragment,{children:[Object(b.jsx)("div",Object(l.a)(Object(l.a)({ref:this.ref,className:"Disasm"},t),{},{children:Object(b.jsx)(Y,Object(l.a)(Object(l.a)({ref:this.listRef},this.state),{},{onDoubleClick:this.onDoubleClick,updateSelection:this.props.updateSelection,promptGoto:this.props.promptGoto,updateCursor:this.updateCursor,updateDisplaySymbols:this.updateDisplaySymbols,selectionTop:this.props.selectionTop,selectionBottom:this.props.selectionBottom,getSelectedDisasm:this.getSelectedDisasm,followBranch:this.followBranch,assembleInstruction:this.assembleInstruction,toggleBreakpoint:this.toggleBreakpoint,editBreakpoint:this.editBreakpoint,applyScroll:this.applyScroll,searchPrompt:this.searchPrompt,searchNext:this.searchNext}))})),Object(b.jsx)(Q,{line:this.state.lines.find((function(t){return t.address===e.state.cursor}))}),this.renderContextMenu(),Object(b.jsx)($,{ref:this.searchRef,searchString:this.state.searchString,searchNext:this.searchNext,updateSearchString:this.updateSearchString,inProgress:this.state.searchInProgress}),Object(b.jsx)(R,{ppsspp:this.props.ppsspp,currentThread:this.props.currentThread,isOpen:null!==this.state.editingBreakpoint||null!==this.state.creatingBreakpoint,onClose:this.closeEditBreakpoint,breakpoint:this.state.editingBreakpoint,initialOverrides:this.state.creatingBreakpoint})]}):this.renderNotStarted()}},{key:"renderNotStarted",value:function(){return Object(b.jsx)("div",{className:"Disasm--not-started",children:"Waiting for a game to start..."})}},{key:"renderContextMenu",value:function(){return Object(b.jsx)(H,{ppsspp:this.props.ppsspp,log:this.props.log,stepping:this.props.stepping,currentThread:this.props.currentThread,getSelectedLines:this.getSelectedLines,getSelectedDisasm:this.getSelectedDisasm,followBranch:this.followBranch,assembleInstruction:this.assembleInstruction,toggleBreakpoint:this.toggleBreakpoint})}},{key:"getSnapshotBeforeUpdate",value:function(e,t){if(this.needsOffsetFix&&this.listRef.current&&0!==this.state.lines.length){var n=this.state.lines,s=n[Math.floor(n.length/2)].address,r=this.listRef.current.addressBoundingTop(s);if(r)return{top:r,centerAddress:s}}return null}},{key:"componentDidMount",value:function(){var e=this;this.listeners_=Z.listen({connection:function(){e.props.started&&e.updateDisasm("center")},"cpu.stepping":function(){var t=0!==e.state.range.start||0!==e.state.range.end;e.updateDisasm(t?"nearest":"center")},"cpu.setReg":function(t){0===t.category&&32===t.register&&e.updateDisasm("center")},"cpu.breakpoint.add":function(){e.updateDisasm()},"cpu.breakpoint.update":function(){e.updateDisasm()},"cpu.breakpoint.remove":function(){e.updateDisasm()}}),this.updatesCancel=!1}},{key:"componentWillUnmount",value:function(){this.searchCancel(),this.updatesCancel=!0,Z.forget(this.listeners_)}},{key:"componentDidUpdate",value:function(e,t,n){var s=this,r=this.props,a=r.selectionTop,i=r.selectionBottom,o=this.state,c=o.range,l=o.lineHeight,u=null,d=null;if(this.state.wantDisplaySymbols!==t.wantDisplaySymbols&&(u=!1),this.props.currentThread!==e.currentThread&&(u=!1),a===e.selectionTop&&i===e.selectionBottom||(a<c.start||i>=c.end)&&(u="center",d=!0),u||e.setInitialPC||!this.props.setInitialPC||(u="center",d=!0),null!==u&&this.props.setInitialPC&&this.updateDisasm(u,d),0===l){var p=document.querySelector(".DisasmLine");p&&setTimeout((function(){return s.setState({lineHeight:p.getBoundingClientRect().height})}),0)}else if(this.ref.current){var h=Math.floor(this.ref.current.clientHeight/l);h!==this.state.visibleLines&&this.setState({visibleLines:h})}if(this.props.jumpMarker!==e.jumpMarker&&(this.needsScroll="center"),this.needsScroll&&this.listRef.current){var f=this.listRef.current;setTimeout((function(){f.ensureCursorInView(s.needsScroll),s.needsScroll=!1}),0)}if(n&&this.listRef.current){var v=this.listRef.current.addressBoundingTop(n.centerAddress);this.ref.current.scrollTop-=n.top-v,this.needsOffsetFix=!1}}},{key:"updateDisasm",value:function(e,t){var n=this;this.updatesSequence=this.updatesSequence.then((function(){return n.updatesCancel?null:n.updateDisasmNow(e,t)}))}},{key:"updateDisasmNow",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!this.props.setInitialPC)return Promise.resolve(null);var s=this.state,r=s.range,a=s.visibleLines,i=s.wantDisplaySymbols,o=n;if(!0===n||null===n&&0===r.start&&0===r.end){var c=Math.max(ee,a),u=Math.floor(1.5*c);o={address:this.props.selectionTop-4*u,count:2*u}}else null===n&&(o={address:r.start,end:r.end});return Promise.resolve(null).then((function(){return t.props.ppsspp.send(Object(l.a)(Object(l.a)({event:"memory.disasm",thread:t.props.currentThread},o),{},{displaySymbols:i})).then((function(n){if(!t.updatesCancel){var s=n.range,r=n.branchGuides,a=n.lines;e?t.needsScroll=e:t.needsOffsetFix=!0,t.setState({range:s,branchGuides:t.cleanupBranchGuides(r),lines:a,displaySymbols:i})}}),(function(e){t.updatesCancel||t.setState({range:{start:0,end:0},branchGuides:[],lines:[]})}))}))}},{key:"cleanupBranchGuides",value:function(e){var t=new Map;return e.forEach((function(e){var n=String(e.top)+String(e.bottom)+e.direction;t.set(n,e)})),Object(m.a)(t.values())}},{key:"onScroll",value:function(e){var t=this;this.updatesSequence=this.updatesSequence.then((function(){if(t.updatesCancel)return null;var e=t.bufferRange(),n=e.bufferTop,s=e.bufferBottom,r=Math.max(ee,t.state.visibleLines),a=Math.max(500,5*t.state.visibleLines),i=t.state.range,o=i.start,c=i.end;return n<r?o-=4*r:n>a&&(o+=4*Math.max(r,n-a)),s<r?c+=4*r:s>a&&(c-=4*Math.max(r,s-a)),o!==t.state.range.start||c!==t.state.range.end?t.updateDisasmNow(!1,{address:o,end:c}):null}))}},{key:"bufferRange",value:function(){var e=this.ref.current,t=e.scrollHeight,n=e.scrollTop,s=e.clientHeight,r=n/this.state.lineHeight,a=(t-n-s)/this.state.lineHeight,i=Math.floor((this.state.visibleLines-1)/2);return{bufferTop:r+i,bufferBottom:a+i}}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n=e.selectionTop,s=e.selectionBottom;if(t.cursor<n||t.cursor>s){var r=n;if(t.lines.length){var a=t.lines.find((function(e){return e.address<=n&&e.address+e.addressSize>n}));r=a?a.address:r}return{cursor:r}}return null}}]),n}(s.PureComponent),ne=(n(433),function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(u.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).state={breakpointModalOpen:!1,connected:!1,lastThread:"",threads:[]},e.handleGoBreak=function(){e.props.stepping&&e.props.updateCurrentThread(void 0),e.props.ppsspp.send({event:e.props.stepping?"cpu.resume":"cpu.stepping"}).catch((function(){}))},e.handleStepInto=function(){e.props.updateCurrentThread(void 0),e.props.ppsspp.send({event:"cpu.stepInto",thread:e.props.currentThread}).catch((function(){}))},e.handleStepOver=function(){e.props.updateCurrentThread(void 0),e.props.ppsspp.send({event:"cpu.stepOver",thread:e.props.currentThread}).catch((function(){}))},e.handleStepOut=function(){var t=e.props.currentThread;e.props.updateCurrentThread(void 0),e.props.ppsspp.send({event:"cpu.stepOut",thread:e.props.currentThread}).catch((function(){e.props.updateCurrentThread(t)}))},e.handleNextHLE=function(){e.props.updateCurrentThread(void 0),e.props.ppsspp.send({event:"cpu.nextHLE"}).catch((function(){}))},e.handleThreadSelect=function(t){var n=e.state.threads.find((function(e){return e.id===Number(t.target.value)}));n&&e.props.updateCurrentThread(n.id,n.pc)},e.handleBreakpointOpen=function(){e.setState({breakpointModalOpen:!0})},e.handleBreakpointClose=function(){e.setState({breakpointModalOpen:!1})},e}return Object(d.a)(n,[{key:"render",value:function(){var e=!this.props.started||!this.props.stepping;return Object(b.jsxs)("div",{className:"DisasmButtons",children:[Object(b.jsxs)("div",{className:"DisasmButtons__group DisasmButtons__nav",children:[Object(b.jsx)("button",{type:"button",onClick:this.props.showNavTray,children:"Nav"}),Object(b.jsx)("span",{className:"DisasmButtons__spacer"})]}),Object(b.jsxs)("div",{className:"DisasmButtons__group",children:[Object(b.jsx)("button",{type:"button",disabled:!this.props.started||this.props.paused,onClick:this.handleGoBreak,children:this.props.stepping||!this.props.started?"Go":"Break"}),Object(b.jsx)("span",{className:"DisasmButtons__spacer"})]}),Object(b.jsxs)("div",{className:"DisasmButtons__group",children:[Object(b.jsx)("button",{type:"button",disabled:e,onClick:this.handleStepInto,children:"Step Into"}),Object(b.jsx)("button",{type:"button",disabled:e,onClick:this.handleStepOver,children:"Step Over"}),Object(b.jsx)("button",{type:"button",disabled:e,onClick:this.handleStepOut,children:"Step Out"}),Object(b.jsx)("span",{className:"DisasmButtons__spacer"})]}),Object(b.jsxs)("div",{className:"DisasmButtons__group",children:[Object(b.jsx)("button",{type:"button",disabled:e,onClick:this.handleNextHLE,children:"Next HLE"}),Object(b.jsx)("span",{className:"DisasmButtons__spacer"})]}),Object(b.jsxs)("div",{className:"DisasmButtons__group",children:[Object(b.jsx)("button",{type:"button",onClick:this.handleBreakpointOpen,disabled:!this.props.started,children:"Breakpoint"}),Object(b.jsx)("span",{className:"DisasmButtons__spacer"})]}),Object(b.jsx)("div",{className:"DisasmButtons__group",children:Object(b.jsxs)("span",{className:"DisasmButtons__thread-list",children:["Thread: ",this.renderThreadList()]})}),Object(b.jsx)(R,{ppsspp:this.props.ppsspp,currentThread:this.props.currentThread,isOpen:this.state.breakpointModalOpen,onClose:this.handleBreakpointClose})]})}},{key:"renderThreadList",value:function(){var e=this;return 0===this.state.threads.length?"(none)":Object(b.jsx)("select",{onChange:this.handleThreadSelect,value:this.props.currentThread||this.state.lastThread,children:this.state.threads.map((function(t){return e.renderThread(t)}))})}},{key:"renderThread",value:function(e){var t="DisasmButtons__thread"+(e.isCurrent?" DisasmButtons__thread--current":"");return Object(b.jsxs)("option",{value:e.id,className:t,children:[e.name,e.isCurrent?" (current)":""]},e.id)}},{key:"componentDidMount",value:function(){var e=this;this.listeners_=Z.listen({"connection.change":function(t){return e.setState({connected:t})},"cpu.stepping":function(){return e.updateThreadList(!0)}})}},{key:"componentWillUnmount",value:function(){Z.forget(this.listeners_)}},{key:"componentDidUpdate",value:function(e,t){!t.connected&&this.state.connected&&this.updateThreadList(void 0===this.props.currentThread)}},{key:"updateThreadList",value:function(e){var t=this;this.state.connected&&this.props.ppsspp.send({event:"hle.thread.list"}).then((function(n){var s=n.threads;if(t.setState({threads:s}),e){var r=s.find((function(e){return e.isCurrent}));r&&r.id!==t.props.currentThread&&t.props.updateCurrentThread(r.id)}}),(function(){t.setState({threads:[]})}))}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n=null;return e.currentThread&&e.currentThread!==t.lastThread&&(n=Object(l.a)(Object(l.a)({},n),{},{lastThread:e.currentThread||""})),(e.stepping||e.started)&&(n=Object(l.a)(Object(l.a)({},n),{},{connected:!0})),!e.started&&t.threads.length&&(n=Object(l.a)(Object(l.a)({},n),{},{threads:[]})),n}}]),n}(s.PureComponent)),se=(n(434),function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(u.a)(this,n),(s=t.call(this,e)).state={address:""},s.handleChange=function(e){s.setState({address:e.target.value})},s.handleSubmit=function(e){s.props.started&&s.props.ppsspp.send({event:"cpu.evaluate",thread:s.props.currentThread,expression:s.state.address}).then((function(e){var t=e.uintValue;s.props.started&&s.props.gotoDisasm(t)})),e.preventDefault()},s.handlePC=function(e){s.jumpToReg("pc")},s.handleRA=function(e){s.jumpToReg("ra")},s.ref=r.a.createRef(),s}return Object(d.a)(n,[{key:"render",value:function(){var e=!this.props.started;return Object(b.jsxs)("form",{action:"#",className:"GotoBox",onSubmit:this.handleSubmit,children:[Object(b.jsx)("label",{className:"GotoBox__label",htmlFor:"GotoBox__address",children:"Go to:"}),Object(b.jsx)("input",{ref:this.ref,type:"text",id:"GotoBox__address",value:this.state.address,onChange:this.handleChange,title:"Hexadecimal address or expression, enter to submit",autoComplete:"off"}),Object(b.jsx)("button",{type:"button",className:"GotoBox__button",onClick:this.handlePC,disabled:e,children:"PC"}),Object(b.jsx)("button",{type:"button",className:"GotoBox__button",onClick:this.handleRA,disabled:e,children:"RA"})]})}},{key:"componentDidUpdate",value:function(e,t){this.props.promptGotoMarker!==e.promptGotoMarker&&(this.ref.current.focus(),this.ref.current.select())}},{key:"jumpToReg",value:function(e){var t=this;this.props.ppsspp.send({event:"cpu.getReg",name:e}).then((function(e){t.props.started&&t.props.gotoDisasm(e.uintValue)}))}}]),n}(s.PureComponent)),re=n(41),ae=n(169),ie=(n(444),n(445),function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(u.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).state={connected:!1,loading:!0,rowHeight:null,functions:[],filter:"",filteredFunctions:[]},e.renderSizedList=function(t){var n=t.height,s=t.width,r=e.state,a=r.filter,i=r.filteredFunctions,o=r.rowHeight;return Object(b.jsx)(ae.b,{height:n,rowHeight:o,rowRenderer:e.renderFunc,width:s,rowCount:i.length,filter:a})},e.renderFunc=function(t){var n=t.index,s=t.key,r=t.style,a=e.state.filteredFunctions[n];return Object(b.jsx)("div",{style:r,children:Object(b.jsx)("button",{type:"button","data-address":a.address,children:a.name})},s+"-"+a.address)},e.handleFilter=function(t){var n=t.target.value,s=e.applyFilter(e.state.functions,n);e.setState({filter:n,filteredFunctions:s})},e.handleClick=function(t){var n=t.target.dataset.address;e.props.gotoDisasm(Number(n)),t.preventDefault()},e}return Object(d.a)(n,[{key:"render",value:function(){var e=this.state.filter;return Object(b.jsxs)("div",{className:"FuncList",children:[Object(b.jsx)("input",{type:"search",className:"FuncList__search",value:e,onChange:this.handleFilter}),this.renderList()]})}},{key:"renderList",value:function(){var e=this.state,t=e.filter,n=e.loading,s=e.rowHeight;return n||!s?Object(b.jsx)("div",{className:"FuncList__loading",children:"Loading..."}):Object(b.jsx)("div",{className:"FuncList__listing",onClick:this.handleClick,children:Object(b.jsx)(ae.a,{filter:t,children:this.renderSizedList})})}},{key:"componentDidMount",value:function(){var e=this;this.listeners_=Z.listen({"connection.change":function(t){return e.setState({connected:t})},"game.start":function(){return e.updateList()}}),this.state.connected&&this.updateList(),this.state.rowHeight||setTimeout((function(){return e.measureHeight()}),0)}},{key:"componentWillUnmount",value:function(){Z.forget(this.listeners_)}},{key:"componentDidUpdate",value:function(e,t){var n=this;!t.connected&&this.state.connected&&this.updateList(),this.state.rowHeight||setTimeout((function(){return n.measureHeight()}),0)}},{key:"measureHeight",value:function(){var e=document.querySelector(".FuncList__loading");if(e){var t=e.getBoundingClientRect().height;this.setState({rowHeight:t})}}},{key:"updateList",value:function(){var e=this;this.state.connected&&(this.state.loading||0!==this.state.functions.length||this.setState({loading:!0}),this.props.ppsspp.send({event:"hle.func.list"}).then((function(t){var n=t.functions;n.sort((function(e,t){return e.name.localeCompare(t.name)}));var s=e.applyFilter(n,e.state.filter);e.setState({functions:n,filteredFunctions:s,loading:!1})}),(function(){e.setState({functions:[],filteredFunctions:[],loading:!1})})))}},{key:"applyFilter",value:function(e,t){if(""===t)return e;var n=t.toLowerCase();return e.filter((function(e){return-1!==e.name.toLowerCase().indexOf(n)}))}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n=null;return e.started&&(n=Object(l.a)(Object(l.a)({},n),{},{connected:!0})),!e.started&&t.functions.length&&(n=Object(l.a)(Object(l.a)({},n),{},{functions:[],filteredFunctions:[]})),n}}]),n}(s.PureComponent)),oe=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(u.a)(this,n),(s=t.call(this,e)).state={cursor:0},s.needsScroll=!1,s.onDoubleClick=function(e,t){0===e.button&&s.props.onDoubleClick(e,t)},s.cursorRef=r.a.createRef(),s}return Object(d.a)(n,[{key:"render",value:function(){var e=this;return Object(b.jsx)("dl",{children:this.props.registerNames.map((function(t,n){return e.renderReg(t,n)}))})}},{key:"renderReg",value:function(e,t){var n=this,s=function(e){return{cat:n.props.id,reg:t,value:n.format(t)}},r={onDoubleClick:function(e){return n.onDoubleClick(e,s())},onMouseDown:function(e){return n.setState({cursor:t})},onKeyDown:function(e){return n.onKeyDown(e)},tabIndex:0},a={"RegPanel__item--changed":this.changed(t),"RegPanel__item--selected":this.state.cursor===t},i=this.state.cursor===t?this.cursorRef:void 0;return Object(b.jsxs)(M.b,{id:this.props.contextmenu,renderTag:"a",attributes:r,collect:s,holdToDisplay:-1,children:[Object(b.jsx)("dt",{children:e}),Object(b.jsx)("dd",{className:Object(_.a)(a),ref:i,children:this.format(t)})]},t)}},{key:"format",value:function(e){return 0===this.props.id?P(this.props.uintValues[e]):this.props.floatValues[e]}},{key:"changed",value:function(e){return this.props.uintValues[e]!==this.props.uintValuesLast[e]}},{key:"componentDidUpdate",value:function(e,t){if(this.needsScroll&&this.cursorRef.current){var n=this.cursorRef.current.parentNode;z(n,{block:"nearest"}),n.focus(),this.needsScroll=!1}}},{key:"onKeyDown",value:function(e){K()||("ArrowUp"===e.key&&this.state.cursor>0&&(this.needsScroll=!0,this.setState({cursor:this.state.cursor-1}),e.preventDefault()),"ArrowDown"===e.key&&this.state.cursor<this.props.registerNames.length-1&&(this.needsScroll=!0,this.setState({cursor:this.state.cursor+1}),e.preventDefault()))}}]),n}(s.PureComponent),ce=(n(446),n(447),n(385),function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(u.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).state={categories:[]},e.handleViewMemory=function(e,t){console.log(t)},e.handleViewDisassembly=function(t,n){var s=e.state.categories[n.cat].uintValues[n.reg];e.props.gotoDisasm(s)},e.handleCopyReg=function(e,t,n){E(t.value)},e.handleChangeReg=function(t,n,s){var r=(0===n.cat?"0x":"")+n.value,a=e.state.categories[n.cat].registerNames[n.reg],i=window.prompt("New value for "+a,r);if(null!==i){var o={event:"cpu.setReg",thread:e.props.currentThread,category:n.cat,register:n.reg,value:i};e.props.ppsspp.send(o).catch((function(e){window.alert(e)}))}},e}return Object(d.a)(n,[{key:"render",value:function(){return Object(b.jsxs)("div",{id:"RegPanel",children:[this.renderTabs(),this.renderContextMenu()]})}},{key:"renderTabs",value:function(){var e=this,t=this.state.categories;return 0===t.length?"":Object(b.jsxs)(re.d,{children:[Object(b.jsx)(re.b,{children:t.map((function(e){return Object(b.jsx)(re.a,{children:e.name},e.id)}))}),t.map((function(t){return Object(b.jsx)(re.c,{children:Object(b.jsx)(oe,Object(l.a)({contextmenu:"reglist",onDoubleClick:e.handleChangeReg},t))},t.id)}))]})}},{key:"renderContextMenu",value:function(){var e=!this.props.stepping;return Object(b.jsxs)(M.a,{id:"reglist",children:[Object(b.jsx)(M.c,{onClick:this.handleViewMemory,children:"Go to in Memory View"}),Object(b.jsx)(M.c,{onClick:this.handleViewDisassembly,children:"Go to in Disassembly"}),Object(b.jsx)(M.c,{divider:!0}),Object(b.jsx)(M.c,{onClick:this.handleCopyReg,children:"Copy Value"}),Object(b.jsx)(M.c,{disabled:e,onClick:this.handleChangeReg,children:"Change..."})]})}},{key:"componentDidMount",value:function(){var e=this;this.listeners_=Z.listen({connection:function(){return e.updateRegs(!1)},"cpu.stepping":function(){return e.updateRegs(!1)},"cpu.setReg":function(t){return e.updateReg(t)}})}},{key:"componentWillUnmount",value:function(){Z.forget(this.listeners_)}},{key:"componentDidUpdate",value:function(e,t){this.props.currentThread&&this.props.currentThread!==e.currentThread&&this.updateRegs(!0)}},{key:"updateRegs",value:function(e){var t=this;this.props.ppsspp.send({event:"cpu.getAllRegs",thread:this.props.currentThread}).then((function(n){var s,r=n.categories,a=0!==t.state.categories.length,i=Object(g.a)(r);try{for(i.s();!(s=i.n()).done;){var o=s.value,c=a?t.state.categories[o.id]:null;o.uintValuesLast=a?e?c.uintValuesLast:c.uintValues:o.uintValues,o.floatValuesLast=a?e?c.floatValuesLast:c.floatValues:o.floatValues}}catch(l){i.e(l)}finally{i.f()}t.setState({categories:r})}),(function(e){console.error(e)}))}},{key:"updateReg",value:function(e){var t=function(e,t,n){return e.slice(0,t).concat([n]).concat(e.slice(t+1))},n=this.state.categories.map((function(n){return n.id===e.category?Object(l.a)(Object(l.a)({},n),{},{uintValuesLast:n.uintValuesLast,floatValuesLast:n.floatValuesLast,uintValues:t(n.uintValues,e.register,e.uintValue),floatValues:t(n.floatValues,e.register,e.floatValue)}):n}));this.setState({categories:n})}}]),n}(s.PureComponent)),le=(n(448),function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(u.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).state={categories:[],format:"float"},e.handleFormat=function(t){var n=t.target.value;e.setState({format:n})},e}return Object(d.a)(n,[{key:"render",value:function(){var e=this.state,t=e.categories,n=e.format;if(t.length<3)return null;for(var s=[],r=0;r<t[2].uintValues.length/16;++r)s.push(this.renderMatrix(r));return Object(b.jsxs)(j,{contentLabel:"VFPU",isOpen:this.props.isOpen,onClose:this.props.onClose,children:[Object(b.jsx)("h2",{children:"VFPU Registers"}),Object(b.jsx)("div",{className:"VisualizeVFPU__list",children:s}),Object(b.jsxs)("div",{className:"VisualizeVFPU__format",children:["Display as:",Object(b.jsxs)("label",{children:[Object(b.jsx)("input",{type:"radio",checked:"float"===n,value:"float",onChange:this.handleFormat})," Float"]}),Object(b.jsxs)("label",{children:[Object(b.jsx)("input",{type:"radio",checked:"uint"===n,value:"uint",onChange:this.handleFormat})," Hex"]})]})]})}},{key:"renderMatrix",value:function(e){return Object(b.jsxs)("table",{className:"VisualizeVFPU__matrix",children:[Object(b.jsx)("thead",{children:Object(b.jsxs)("tr",{children:[Object(b.jsxs)("th",{className:"VisualizeVFPU__name",children:["M",e,"00"]}),Object(b.jsxs)("th",{className:"VisualizeVFPU__row-header",children:["R",e,"00"]}),Object(b.jsxs)("th",{className:"VisualizeVFPU__row-header",children:["R",e,"01"]}),Object(b.jsxs)("th",{className:"VisualizeVFPU__row-header",children:["R",e,"02"]}),Object(b.jsxs)("th",{className:"VisualizeVFPU__row-header",children:["R",e,"03"]})]})}),Object(b.jsxs)("tbody",{children:[this.renderColumn(e,0),this.renderColumn(e,1),this.renderColumn(e,2),this.renderColumn(e,3)]})]},e)}},{key:"renderColumn",value:function(e,t){return Object(b.jsxs)("tr",{children:[Object(b.jsxs)("th",{className:"VisualizeVFPU__col-header",children:["C",e,t,"0"]}),Object(b.jsx)("td",{children:this.renderValue(e,t,0)}),Object(b.jsx)("td",{children:this.renderValue(e,t,1)}),Object(b.jsx)("td",{children:this.renderValue(e,t,2)}),Object(b.jsx)("td",{children:this.renderValue(e,t,3)})]},t)}},{key:"renderValue",value:function(e,t,n){var s=4*e+32*t+n,r=this.state.categories[2];return"uint"===this.state.format?P(r.uintValues[s]):r.floatValues[s]}},{key:"componentDidMount",value:function(){var e=this;this.listeners_=Z.listen({"cpu.getAllRegs":function(t){var n=t.categories;return e.setState({categories:n})}})}},{key:"componentWillUnmount",value:function(){Z.forget(this.listeners_)}}]),n}(s.PureComponent)),ue=(n(449),function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(u.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).state={vfpuModalOpen:!1,everShownFuncs:!1},e.handleSelect=function(t){1!==t||e.state.everShownFuncs||e.setState({everShownFuncs:!0})},e.handleVFPUOpen=function(){e.setState({vfpuModalOpen:!0})},e.handleVFPUClose=function(){e.setState({vfpuModalOpen:!1})},e}return Object(d.a)(n,[{key:"render",value:function(){return Object(b.jsxs)("div",{className:"LeftPanel",children:[Object(b.jsxs)(re.d,{onSelect:this.handleSelect,children:[Object(b.jsxs)(re.b,{children:[Object(b.jsx)(re.a,{children:"Regs"}),Object(b.jsx)(re.a,{children:"Funcs"}),Object(b.jsx)(re.a,{children:"Tools"})]}),Object(b.jsx)(re.c,{forceRender:!0,children:Object(b.jsx)(ce,Object(l.a)({},this.props))}),Object(b.jsx)(re.c,{forceRender:this.state.everShownFuncs,children:Object(b.jsx)(ie,Object(l.a)({},this.props))}),Object(b.jsx)(re.c,{className:"react-tabs__tab-panel LeftPanel__tools",children:Object(b.jsx)("button",{type:"button",onClick:this.handleVFPUOpen,children:"Visualize VFPU"})})]}),Object(b.jsx)(le,Object(l.a)(Object(l.a)({},this.props),{},{isOpen:this.state.vfpuModalOpen,onClose:this.handleVFPUClose}))]})}}]),n}(s.PureComponent)),de=(n(450),function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(u.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).state={stepping:!1,paused:!0,started:!1,pc:0,setInitialPC:!1,selectionTop:null,selectionBottom:null,jumpMarker:null,promptGotoMarker:null,lastTicks:0,ticks:0,currentThread:void 0,navTray:!1},e.updateSelection=function(t){e.setState(t)},e.gotoDisasm=function(t){e.setState({selectionTop:t,selectionBottom:t,jumpMarker:{}})},e.promptGoto=function(){e.setState({promptGotoMarker:{}})},e.updateCurrentThread=function(t,n){e.setState({currentThread:t,pc:n,setInitialPC:0!==n}),n&&e.gotoDisasm(n)},e.showNavTray=function(){e.setState({navTray:!0})},e.hideNavTray=function(){e.setState({navTray:!1})},e.updateInitialPC=function(){e.props.ppsspp.send({event:"cpu.getReg",name:"pc"}).then((function(t){var n=t.uintValue;e.state.setInitialPC||e.gotoDisasm(n),e.setState({pc:n,setInitialPC:0!==n})}))},e}return Object(d.a)(n,[{key:"render",value:function(){var e=this.state,t=e.paused,n=e.stepping,s=e.started,r=e.currentThread,a=e.navTray,i={stepping:n&&!t,paused:t,started:s,currentThread:r},o=this.state,c=o.selectionTop,u=o.selectionBottom,d=o.jumpMarker,p=o.pc,h=o.setInitialPC,f=Object(l.a)(Object(l.a)({},i),{},{selectionTop:c,selectionBottom:u,jumpMarker:d,pc:p,setInitialPC:h});return Object(b.jsxs)("div",{id:"CPU",children:[Object(b.jsxs)("div",{className:a?"CPU__pane CPU__pane--open":"CPU__pane",children:[Object(b.jsx)("button",{type:"button",onClick:this.hideNavTray,className:"CPU__paneClose",children:"Close"}),Object(b.jsx)(se,Object(l.a)(Object(l.a)({ppsspp:this.props.ppsspp},i),{},{gotoDisasm:this.gotoDisasm,promptGotoMarker:this.state.promptGotoMarker})),Object(b.jsx)(ue,Object(l.a)(Object(l.a)(Object(l.a)({},this.props),i),{},{gotoDisasm:this.gotoDisasm}))]}),Object(b.jsxs)("div",{className:"Disasm__container",children:[Object(b.jsx)(ne,Object(l.a)(Object(l.a)(Object(l.a)({},this.props),i),{},{updateCurrentThread:this.updateCurrentThread,showNavTray:this.showNavTray})),Object(b.jsx)(te,Object(l.a)(Object(l.a)(Object(l.a)({},this.props),f),{},{updateSelection:this.updateSelection,promptGoto:this.promptGoto}))]})]})}},{key:"componentDidMount",value:function(){var e=this;this.listeners_=Z.listen({connection:function(){return e.onConnection()},"connection.change":function(t){return e.onConnectionChange(t)},"cpu.stepping":function(t){return e.onStepping(t)},"cpu.resume":function(){return e.setState({stepping:!1})},"game.start":function(){e.state.setInitialPC||e.updateInitialPC(),e.setState({started:!0,paused:!1})},"game.quit":function(){e.setState({started:!1,stepping:!1,paused:!0,pc:0,setInitialPC:!1,currentThread:void 0})},"game.pause":function(){return e.setState({paused:!0})},"game.resume":function(){return e.setState({paused:!1})},"cpu.setReg":function(t){if(0===t.category&&32===t.register){var n=t.uintValue;e.state.setInitialPC||e.gotoDisasm(n),e.setState({pc:n,setInitialPC:0!==n})}},"cpu.getAllRegs":function(t){var n=t.categories[0].uintValues[32];e.state.setInitialPC||e.gotoDisasm(n),e.setState({pc:n,setInitialPC:0!==n})}})}},{key:"componentWillUnmount",value:function(){Z.forget(this.listeners_)}},{key:"onConnectionChange",value:function(e){this.setState({connected:e,started:!1,stepping:!1,paused:!0}),e||this.setState({currentThread:void 0})}},{key:"onConnection",value:function(){var e=this;this.props.ppsspp.send({event:"cpu.status"}).then((function(t){var n=t.stepping,s=t.paused,r=t.pc,a=t.ticks,i=0!==r||n;e.state.setInitialPC||e.gotoDisasm(r),e.setState({connected:!0,started:i,stepping:n,paused:s,pc:r,setInitialPC:0!==r,ticks:a,lastTicks:a})}),(function(t){e.setState({stepping:!1,paused:!0})}))}},{key:"onStepping",value:function(e){this.setState({stepping:!0,pc:e.pc,selectionTop:e.pc,selectionBottom:e.pc,lastTicks:this.state.ticks,ticks:e.ticks})}}]),n}(s.PureComponent)),pe=(n(451),function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(u.a)(this,n);for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).state={connected:!1,started:!1,paused:!0,recording:!1},e.beginRecord=function(t){e.setState({recording:!0}),e.props.ppsspp.send({event:"gpu.record.dump"}).then((function(t){var n=document.createElement("a");n.setAttribute("download","recording.ppdmp"),n.href=t.uri,n.hidden=!0,document.body.appendChild(n),n.click(),document.body.removeChild(n),e.setState({recording:!1})})),t.preventDefault()},e}return Object(d.a)(n,[{key:"render",value:function(){return Object(b.jsxs)("div",{id:"GPU",children:[Object(b.jsx)("div",{className:"GPU__info",children:this.state.started&&!this.state.paused?"Click below to generate a GE dump.  It will download as a file.":"Waiting for a game to start..."}),this.state.started&&!this.state.paused?Object(b.jsx)("form",{className:"GPU__form",onSubmit:this.beginRecord,children:Object(b.jsx)("button",{disabled:this.state.recording,children:this.state.recording?"Recording...":"Record"})}):null]})}},{key:"componentDidMount",value:function(){var e=this;this.listeners_=Z.listen({connection:function(){return e.onConnection()},"connection.change":function(t){return e.onConnectionChange(t)},"game.start":function(){return e.setState({started:!0,paused:!1})},"game.quit":function(){return e.setState({started:!1,paused:!0})},"game.pause":function(){return e.setState({paused:!0})},"game.resume":function(){return e.setState({paused:!1})}})}},{key:"componentWillUnmount",value:function(){Z.forget(this.listeners_)}},{key:"onConnectionChange",value:function(e){this.setState({connected:e,started:!1,paused:!0})}},{key:"onConnection",value:function(){var e=this;this.props.ppsspp.send({event:"cpu.status"}).then((function(t){var n=t.stepping,s=t.paused,r=0!==t.pc||n;e.setState({connected:!0,started:r,paused:s})}),(function(t){e.setState({paused:!0})}))}}]),n}(s.PureComponent)),he=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){return"log"===this.props.item.event?this.formatLogEvent():this.renderInternal()}},{key:"renderInternal",value:function(){return Object(b.jsx)("span",{className:this.makeClassName(),children:this.props.item.message})}},{key:"formatLogEvent",value:function(){var e=this.props.item;return Object(b.jsxs)("span",{className:this.makeClassName(),children:[Object(b.jsxs)("span",{className:"Log__message__header",children:[Object(b.jsx)("span",{className:"Log__message__timestamp",children:e.timestamp})," "+e.header+" "]}),e.message]})}},{key:"makeClassName",value:function(){var e,t=this.props.item;return Object(_.a)("Log__message",(e={"Log__message--internal":"log"!==t.event},Object(y.a)(e,"Log__message--channel-"+t.channel,"log"===t.event),Object(y.a)(e,"Log__message--level-"+t.level,!0),e))}}]),n}(s.PureComponent),fe=(n(452),function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(u.a)(this,n),(s=t.call(this,e)).state={id:0,items:[]},s.divRef=r.a.createRef(),s}return Object(d.a)(n,[{key:"render",value:function(){return Object(b.jsx)("div",{id:"Log",ref:this.divRef,children:this.state.items.map(this.renderItem.bind(this))})}},{key:"renderItem",value:function(e){return Object(b.jsx)(he,{item:e},e.id)}},{key:"addLogItem",value:function(e){var t=this.state.id+1,n=Object(l.a)({id:t},e),s=this.state.items.concat([n]).slice(-5e3);this.setState({id:t,items:s})}},{key:"componentDidMount",value:function(){var e=this;this.props.ppsspp.onError=function(t,n){var s={message:t+"\n",level:n};e.addLogItem(s)},this.listeners_=Z.listen({log:this.onLogEvent.bind(this)})}},{key:"componentDidUpdate",value:function(e,t){if(t.id!==this.state.id){var n=this.divRef.current;n.scrollTop=n.scrollHeight-n.clientHeight}}},{key:"componentWillUnmount",value:function(){Z.forget(this.listeners_)}},{key:"onLogEvent",value:function(e){var t=Object(l.a)({},e);this.addLogItem(t)}}]),n}(s.PureComponent));n(453);function ve(e){return Object(b.jsxs)("div",{id:"NotConnected",children:[e.connecting?"Connecting to PPSSPP...":"Not connected to PPSSPP",Object(b.jsx)("div",{className:"NotConnected__info",children:'Make sure "Allow remote debugger" is enabled in Developer tools.'}),Object(b.jsxs)("form",{className:"NotConnected__form",onSubmit:function(t){var n=t.target.elements["debugger-uri"].value;e.connect(n),t.preventDefault()},children:[Object(b.jsx)("input",{type:"text",name:"debugger-uri",placeholder:"ws://ip:port/debugger",className:"NotConnected__uri"}),Object(b.jsx)("button",{disabled:e.connecting,children:"Connect Manually"})]}),Object(b.jsx)("form",{className:"NotConnected__form",onSubmit:function(t){e.connect(null),t.preventDefault()},children:Object(b.jsx)("button",{disabled:e.connecting,children:"Connect Automatically"})})]})}var me=["cpu.stepping","cpu.resume"],ge=2,be=function(){function e(){Object(u.a)(this,e),this.onError=null,this.onClose=null,this.socket_=null,this.pendingTickets_={},this.listeners_={}}return Object(d.a)(e,[{key:"autoConnect",value:function(){var e=this;if(null!==this.socket_)return Promise.reject(new Error("Already connected, disconnect first"));var t=new Error("Couldn't connect");return fetch("//report.ppsspp.org/match/list").then((function(e){return e.json()})).then((function(t){return e.tryNextEndpoint_(t)})).then(this.setupSocket_.bind(this),(function(e){throw t.message=e.message,t.originalError=e,t}))}},{key:"connect",value:function(e){var t=this;if(null!==this.socket_)return Promise.reject(new Error("Already connected, disconnect first"));var n=new Error("Couldn't connect to "+e);return new Promise((function(s,r){var a=new WebSocket(e,"debugger.ppsspp.org");a.onopen=function(){t.socket_=a,s()},a.onclose=function(){r(n)}})).then(this.setupSocket_.bind(this))}},{key:"disconnect",value:function(){if(null===this.socket_)throw new Error("Not connected");this.failAllPending_("Disconnected from PPSSPP"),this.socket_.close(1e3),this.socket_=null}},{key:"listen",value:function(e,t){var n=this;return e in this.listeners_||(this.listeners_[e]=[]),this.listeners_[e].push(t),{remove:function(){var s=n.listeners_[e],r=s.indexOf(t);-1!==r&&s.splice(r,1)}}}},{key:"send",value:function(e){var t=this;if(null===this.socket_)return Promise.reject(new Error("Not connected"));var n=new Error("PPSSPP returned an error");return me.includes(e.event)?(this.socket_.send(JSON.stringify(e)),Promise.resolve(null)):new Promise((function(s,r){var a=t.makeTicket_();t.pendingTickets_[a]=function(e){"error"===e.event?(n.name="DebuggerError",n.message=e.message,n.originalMessage=e,r(n)):s(e)},t.socket_.send(JSON.stringify(Object(l.a)(Object(l.a)({},e),{},{ticket:a})))}))}},{key:"setupSocket_",value:function(){var e=this;this.socket_.onclose=function(){e.onClose&&e.onClose(),e.failAllPending_("PPSSPP disconnected"),e.socket_=null},this.socket_.onmessage=function(t){try{var n=JSON.parse(t.data);"error"===n.event&&e.handleError_(n.message,n.level);var s=!1;"ticket"in n&&(s=e.handleTicket_(n.ticket,n)),e.handleMessage_(n,s)}catch(r){e.handleError_("Failed to parse message from PPSSPP: "+r.message,ge)}}}},{key:"tryNextEndpoint_",value:function(e){var t=this;return new Promise((function(n,s){if(!e||0===e.length)return s(new Error("Couldn't connect automatically.  Is PPSSPP connected to the same network?"));var r="ws://"+e[0].ip+":"+e[0].p+"/debugger";return t.connect(r).then(n,(function(r){e.length>1?n(t.tryNextEndpoint_(e.slice(1))):s(r)}))}))}},{key:"handleTicket_",value:function(e,t){if(e in this.pendingTickets_){var n=this.pendingTickets_[t.ticket];return delete this.pendingTickets_[t.ticket],n(t),!0}return this.handleError_("Received mismatched ticket: "+JSON.stringify(t),ge),!1}},{key:"handleMessage_",value:function(e,t){t=this.executeHandlers_(e.event,e,t),this.executeHandlers_("*",e,t)}},{key:"executeHandlers_",value:function(e,t,n){if(e in this.listeners_){var s,r=Object(g.a)(this.listeners_[e]);try{for(r.s();!(s=r.n()).done;){(0,s.value)(t,n)&&(n=!0)}}catch(a){r.e(a)}finally{r.f()}}return n}},{key:"handleError_",value:function(e,t){this.onError?this.onError(e,t):void 0===t||Number(t)===ge?console.error(e):console.log(e)}},{key:"makeTicket_",value:function(){var e=Math.random().toString(36).substr(2);return e in this.pendingTickets_?this.makeTicket_():e}},{key:"failAllPending_",value:function(e){var t={event:"error",message:e,level:ge};for(var n in this.pendingTickets_)this.pendingTickets_.hasOwnProperty(n)&&this.pendingTickets_[n](t);this.pendingTickets_={}}}]),e}(),je=n.p+"static/media/logo.94f885ce.svg",Oe=(n(454),{name:"ppsspp-debugger",version:"1.0.0"}),ye=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(u.a)(this,n),(s=t.call(this,e)).state={connected:!1,connecting:!1},s.handleAutoConnect=function(){s.connect(null)},s.connect=function(e){s.setState({connecting:!0}),s.ppsspp.onClose=function(){s.log("Debugger disconnected"),Z.change(!1),s.setState({connected:!1,connecting:!1})},(null===e?s.ppsspp.autoConnect():s.ppsspp.connect(e)).then((function(){s.log("Debugger connected"),Z.change(!0),s.setState({connected:!0,connecting:!1})}),(function(e){s.log("Debugger could not connect"),Z.change(!1),s.setState({connected:!1,connecting:!1})}))},s.handleDisconnect=function(){s.ppsspp.disconnect()},s.log=function(e){s.logRef.current?s.logRef.current.addLogItem({message:e+"\n"}):console.error(e)},s.updateTitle=function(e){document&&(e.game?document.title=s.originalTitle+" - "+e.game.id+": "+e.game.title:document.title=s.originalTitle)},s.onConnectionChange=function(e){e?(s.ppsspp.send(Object(l.a)({event:"version"},Oe)).catch((function(e){window.alert("PPSSPP seems to think this debugger is out of date.  Try refreshing?\n\nDetails: "+e)})),s.ppsspp.send({event:"game.status"}).then(s.updateTitle,(function(e){return s.updateTitle({})}))):s.updateTitle({})},s.logRef=r.a.createRef(),s.ppsspp=new be,s.originalTitle=document.title,Z.init(s.ppsspp),Z.listen({"connection.change":s.onConnectionChange,"game.start":s.updateTitle,"game.quit":s.updateTitle}),s}return Object(d.a)(n,[{key:"render",value:function(){return Object(b.jsx)(f.a,{children:Object(b.jsxs)("div",{className:"App",children:[Object(b.jsxs)("header",{className:"App-header",children:[Object(b.jsxs)("ul",{className:"App-nav",children:[Object(b.jsx)(f.b,{to:"/cpu",children:"CPU"}),Object(b.jsx)(f.b,{to:"/gpu",children:"GPU"})]}),Object(b.jsx)("img",{src:je,className:"App-logo",alt:"PPSSPP"}),Object(b.jsx)("h1",{className:"App-title",children:"Debugger"})]}),this.renderContent(),Object(b.jsx)(fe,{ppsspp:this.ppsspp,ref:this.logRef})]})})}},{key:"renderContent",value:function(){return this.state.connected?Object(b.jsxs)(v.c,{children:[Object(b.jsx)(v.a,{path:"/gpu",children:Object(b.jsx)(pe,{ppsspp:this.ppsspp,log:this.log})}),Object(b.jsx)(v.a,{children:Object(b.jsx)(de,{ppsspp:this.ppsspp,log:this.log})})]}):Object(b.jsx)(ve,{connecting:this.state.connecting,connect:this.connect})}},{key:"componentDidMount",value:function(){this.props.testing||this.handleAutoConnect()}}]),n}(s.Component),ke=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function xe(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}n(387),n(457),n(465);i.a.render(Object(b.jsx)(ye,{}),document.getElementById("root")),c.a.setAppElement("#root"),function(){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("","/service-worker.js");ke?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):xe(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):xe(e)}))}}()}},[[469,1,2]]]);
//# sourceMappingURL=main.e5939e72.chunk.js.map